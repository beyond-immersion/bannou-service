# Infrastructure Test Configuration
# Minimal service setup (TESTING service only) for infrastructure validation
# Uses in-memory infrastructure (no Redis, RabbitMQ) for isolated testing

services:

  bannou:
    env_file: ../.env.test.infrastructure
    # Override base depends_on - we don't need RabbitMQ for in-memory messaging
    depends_on: []

  # Infrastructure tester - uses Docker DNS to reach bannou
  bannou-infra-tester:
    image: curlimages/curl:latest
    volumes:
      - "../scripts/wait-for-health.sh:/wait-for-health.sh"
      - "../scripts/infrastructure-tests.sh:/infrastructure-tests.sh"
    environment:
      - BANNOU_HOST=bannou
    stdin_open: false
    command: sh -c "/wait-for-health.sh && /infrastructure-tests.sh"
    depends_on:
      bannou:
        condition: service_started
