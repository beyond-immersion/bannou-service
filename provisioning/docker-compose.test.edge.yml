# Edge/WebSocket Test Configuration
# Simulates external client connecting through OpenResty edge proxy
# Edge tester ONLY on external network (not default) to simulate real client

services:

  bannou:
    env_file: ../.env.test.edge
    environment:
      - BANNOU_APP_ID=bannou
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"  # Docker socket for orchestrator deployment
      - "/tmp/bannou-test-fixtures:/fixtures:ro"  # Test fixtures prepared by scripts/prepare-test-fixtures.sh

  # Edge integration tester - simulates external client
  bannou-edge-tester:
    build:
      context: ..
      dockerfile: tools/edge-tester/Dockerfile
    networks:
      - external  # Only on external network - reaches OpenResty, not bannou directly
    env_file: ../.env.test.edge
    environment:
      - DAEMON_MODE=true  # Run tests and exit (don't wait for stdin)
    stdin_open: false
