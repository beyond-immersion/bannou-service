# Base Bannou Services - Infrastructure libs pattern (no sidecars)
# Uses lib-mesh for service routing, lib-messaging for RabbitMQ, lib-state for Redis/MySQL

services:

  # Bannou monoservice - binds to 0.0.0.0 for WSL2 compatibility
  # Image can be overridden via BANNOU_IMAGE env var (default: bannou:latest)
  bannou:
    image: ${BANNOU_IMAGE:-bannou:latest}
    build:
      context: ../
      dockerfile: provisioning/Dockerfile
    environment:
      - BANNOU_APP_ID=bannou
    volumes:
      - "./certificates:/certificates"
      - "logs-data:/app/logs/"
      - "./orchestrator/presets:/app/provisioning/orchestrator/presets:ro"
    # No ports exposed - accessed via OpenResty proxy or Docker network
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://127.0.0.1:80/health"]
      interval: 30s
      timeout: 3s
      retries: 5
      start_period: 60s

volumes:
  logs-data:
