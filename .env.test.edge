# CI Environment Configuration for Edge/WebSocket Integration Testing
# This file configures the coordinator service and WebSocket test environment

# Database Configuration (CI-safe test values - must match docker-compose.services.yml)
ACCOUNT_DB_USER=guest
ACCOUNT_DB_PASSWORD=guest

# Auth Configuration (CI-safe test keys)
AUTH_TOKEN_PUBLIC_KEY=ci_edge_public_key_placeholder
AUTH_TOKEN_PRIVATE_KEY=ci_edge_private_key_placeholder

# Auth Service Configuration (BANNOU_ prefix for auto-binding)
BANNOU_JWTSECRET=ci-edge-test-jwt-secret-key-2025
BANNOU_JWTISSUER=bannou-auth-ci
BANNOU_JWTAUDIENCE=bannou-api-ci
BANNOU_JWTEXPIRATIONMINUTES=60
BANNOU_ACCESSTOKENEXPIRATIONMINUTES=60

# Fallback Auth Configuration (AUTH_ prefix)
AUTH_JWT_SECRET=ci-edge-test-jwt-secret-key-2025
AUTH_JWT_ISSUER=bannou-auth-ci
AUTH_JWT_AUDIENCE=bannou-api-ci
AUTH_JWT_EXPIRATION_MINUTES=60

# Legacy Auth Configuration (no prefix)
JWTSECRET=ci-edge-test-jwt-secret-key-2025
JWTISSUER=bannou-auth-ci
JWTAUDIENCE=bannou-api-ci
JWTEXPIRATIONMINUTES=60

# Service Configuration
ASPNETCORE_ENVIRONMENT=Development
BANNOU_APP_LOGGING_LEVEL=Information
BANNOU_WEB_HOST_LOGGING_LEVEL=Information
APP_LOGGING_LEVEL=Information

# Orchestrator Service (required for orchestrator WebSocket tests)
ORCHESTRATOR_SERVICE_ENABLED=true
# Orchestrator Redis connection (use container name from docker-compose)
# Must match case sensitivity in OrchestratorRedisManager.cs
BANNOU_RedisConnectionString=bannou-redis:6379
RedisConnectionString=bannou-redis:6379

# Coordinator Service Mode Configuration
SERVICE_DOMAIN=ci-edge-test
SERVICES_ENABLED=true
BANNOU_MODE=bannou
COORDINATOR_ENABLED=true

# WebSocket Protocol Configuration
WEBSOCKET_BINARY_PROTOCOL_ENABLED=true
WEBSOCKET_COMPRESSION_ENABLED=false

# Connection Strings
AUTHORIZATION_REDIS_CONNECTION_STRING=bannou-redis:6379
CONNECT_REDIS_CONNECTION_STRING=bannou-redis:6379

# Service Endpoints for Coordinator
COORDINATOR_TARGET_HOST=bannou-test-subject
COORDINATOR_TARGET_PORT=8080
COORDINATOR_WEBSOCKET_PORT=8443

# Edge Testing Configuration
EDGE_INTEGRATION_TESTING=true
WEBSOCKET_TESTING=true
DAEMON_MODE=true

EDGE_TESTER_MODE=compatibility_testing
SDK_COMPATIBILITY_MODE=dual_testing
# OpenResty Gateway Configuration (edge-tester connects through OpenResty container)
# Internal container port (used by edge-tester inside Docker network)
OPENRESTY_HOST=openresty
OPENRESTY_PORT=80
# Host-exposed ports (used by host machine, configurable to avoid conflicts)
# Using 9080/9443 to avoid conflict with both local NGINX (80/443) and bannou (8080/8443)
OPENRESTY_HTTP_PORT=9080
OPENRESTY_HTTPS_PORT=9443

# Configurable Dapr app_id routing (for scalability)
AUTH_SERVICE_APP_ID=bannou
CONNECT_SERVICE_APP_ID=bannou

# Auth endpoints through OpenResty gateway
REGISTER_ENDPOINT=openresty:80/auth/register
LOGIN_CREDENTIALS_ENDPOINT=openresty:80/auth/login
# Token refresh endpoint - expects JWT header + RefreshRequest body
LOGIN_TOKEN_ENDPOINT=openresty:80/auth/refresh
# Connect through OpenResty gateway (WebSocket endpoint)
CONNECT_ENDPOINT=openresty:80/connect
# Client credentials - login uses email field
# Registration creates email as {username}@example.com if no email provided
# So login should use the same email format that registration creates
CLIENT_USERNAME=TestClient@example.com
CLIENT_PASSWORD=SimpleTestPassword

# Admin Role Configuration (for orchestrator API tests)
# Emails matching this domain pattern get admin role on registration
BANNOU_ADMINEMAILDOMAIN=@admin.test.local
# Admin credentials for edge-tester (matches the domain above)
ADMIN_USERNAME=admin@admin.test.local
ADMIN_PASSWORD=admin-test-password-2025

# Service Heartbeat Configuration (faster for testing)
# Default is 30 seconds, but in testing we want fast convergence
HEARTBEAT_INTERVAL_SECONDS=5
# Enable permission re-registration on each heartbeat (solves late-subscriber issues)
PERMISSION_HEARTBEAT_ENABLED=true
