# CI Environment Configuration for Edge/WebSocket Integration Testing
# This file configures the coordinator service and WebSocket test environment
# Uses canonical environment variable naming per IMPLEMENTATION TENETS

# =============================================================================
# Logging Configuration
# =============================================================================
BANNOU_APP_LOGGING_LEVEL=Debug

# =============================================================================
# Auth Service Configuration (canonical AUTH_* prefix)
# =============================================================================
AUTH_JWT_SECRET=ci-edge-test-jwt-secret-key-2025
AUTH_JWT_ISSUER=bannou-auth-ci
AUTH_JWT_AUDIENCE=bannou-api-ci
AUTH_CONNECT_URL=ws://openresty:80/connect

# Main App JWT Configuration (required for JWT validation in Program.cs)
BANNOU_JWT_SECRET=ci-edge-test-jwt-secret-key-2025
BANNOU_JWT_ISSUER=bannou-auth-ci
BANNOU_JWT_AUDIENCE=bannou-api-ci

# OAuth/Steam Mock Providers (for CI testing without real credentials)
AUTH_MOCK_PROVIDERS=true
AUTH_MOCK_STEAM_ID=76561198000000001
AUTH_MOCK_DISCORD_ID=123456789012345678
AUTH_MOCK_GOOGLE_ID=mock-google-user-id-12345

# OAuth Provider Configuration (dummy values for mock mode)
AUTH_DISCORD_CLIENT_ID=test-discord-client-id
AUTH_DISCORD_CLIENT_SECRET=test-discord-client-secret
AUTH_GOOGLE_CLIENT_ID=test-google-client-id
AUTH_GOOGLE_CLIENT_SECRET=test-google-client-secret
AUTH_TWITCH_CLIENT_ID=test-twitch-client-id
AUTH_TWITCH_CLIENT_SECRET=test-twitch-client-secret
AUTH_STEAM_API_KEY=test-steam-api-key
AUTH_STEAM_APP_ID=123456

# Admin Role Configuration (for orchestrator API tests)
ACCOUNT_ADMIN_EMAIL_DOMAIN=@admin.test.local

# =============================================================================
# Connect Service Configuration (canonical CONNECT_* prefix)
# =============================================================================
CONNECT_SERVER_SALT=ci-edge-test-server-salt
CONNECT_URL=ws://openresty:80/connect

# =============================================================================
# Game Session Service Configuration (GAME_SESSION_*)
# =============================================================================
GAME_SESSION_SERVER_SALT=ci-edge-test-server-salt

# =============================================================================
# Matchmaking Service Configuration (MATCHMAKING_*)
# =============================================================================
MATCHMAKING_SERVER_SALT=ci-edge-test-server-salt

# =============================================================================
# Orchestrator Service Configuration (canonical ORCHESTRATOR_* prefix)
# =============================================================================
ORCHESTRATOR_DOCKER_NETWORK=bannou-test-edge_default
# Disable secure mode to allow admin WebSocket access for testing
ORCHESTRATOR_SECURE_WEBSOCKET=false

# =============================================================================
# State Service Configuration (canonical STATE_* prefix)
# =============================================================================
STATE_MYSQL_CONNECTION_STRING=Server=bannou-mysql;Port=3306;Database=bannou;User=guest;Password=guest;

# =============================================================================
# Asset Service Configuration (canonical ASSET_* prefix)
# =============================================================================
ASSET_STORAGE_ENDPOINT=minio:9000
ASSET_STORAGE_PUBLIC_ENDPOINT=http://openresty
ASSET_STORAGE_ACCESS_KEY=minioadmin
ASSET_STORAGE_SECRET_KEY=minioadmin

# =============================================================================
# Voice Service Configuration (disabled for standard edge tests)
# =============================================================================
VOICE_SERVICE_DISABLED=true

# =============================================================================
# Service Configuration
# =============================================================================
ASPNETCORE_ENVIRONMENT=Development
BANNOU_APP_ID=bannou
SERVICES_ENABLED=true

# HTTP Tester Configuration - bannou listens on port 80 inside container
BANNOU_HTTP_ENDPOINT=http://bannou:80

# Test harness control - set to false to enable interactive console debugging
DAEMON_MODE=true

# =============================================================================
# OpenResty Gateway Configuration (used by docker-compose for port mapping)
# =============================================================================
OPENRESTY_HTTP_PORT=9080
OPENRESTY_HTTPS_PORT=9443

# =============================================================================
# Edge Tester Configuration (used by edge-tester via IConfiguration binding)
# =============================================================================
OPENRESTY_HOST=openresty
OPENRESTY_PORT=80

# Auth endpoints through OpenResty gateway
REGISTER_ENDPOINT=openresty:80/auth/register
LOGIN_CREDENTIALS_ENDPOINT=openresty:80/auth/login
LOGIN_TOKEN_ENDPOINT=openresty:80/auth/refresh

# Connect through OpenResty gateway (WebSocket endpoint)
CONNECT_ENDPOINT=openresty:80/connect

# Client credentials for edge-tester
CLIENT_USERNAME=TestClient@example.com
CLIENT_PASSWORD=SimpleTestPassword

# Admin credentials for edge-tester (matches ACCOUNT_ADMIN_EMAIL_DOMAIN above)
ADMIN_USERNAME=admin@admin.test.local
ADMIN_PASSWORD=admin-test-password-2025

# =============================================================================
# Service Heartbeat Configuration (faster for testing)
# =============================================================================
BANNOU_HEARTBEAT_ENABLED=true
BANNOU_HEARTBEAT_INTERVAL_SECONDS=5

# =============================================================================
# Analytics Service Configuration - faster flush for testing
# =============================================================================
ANALYTICS_EVENT_BUFFER_SIZE=100
ANALYTICS_EVENT_BUFFER_FLUSH_INTERVAL_SECONDS=1

# =============================================================================
# Achievement Service Configuration - disable platform sync for CI
# =============================================================================
ACHIEVEMENT_AUTO_SYNC_ON_UNLOCK=false
ACHIEVEMENT_SYNC_RETRY_DELAY_SECONDS=5

# =============================================================================
# Edge Revocation Configuration (Auth service edge-layer token blocking)
# =============================================================================
# Enable edge revocation system
AUTH_EDGE_REVOCATION_ENABLED=true
AUTH_EDGE_REVOCATION_TIMEOUT_SECONDS=5
AUTH_EDGE_REVOCATION_MAX_RETRY_ATTEMPTS=3

# Enable OpenResty edge verification (reads from auth:edge Redis keys)
AUTH_OPENRESTY_EDGE_ENABLED=true

# CloudFlare edge disabled for CI (no real CloudFlare credentials)
AUTH_CLOUDFLARE_EDGE_ENABLED=false
