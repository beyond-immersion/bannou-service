openapi: 3.0.0
info:
  title: Bannou Game Service API
  description: |
    Registry service for game services that users can subscribe to.
    Provides a minimal registry of available services (games/applications).

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before modifying this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)

paths:
  /game-service/services/list:
    post:
      summary: List all registered game services
      description: Returns all game services, optionally filtered by active status.
      operationId: listServices
      tags:
      - Game Service Registry
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListServicesRequest'
      responses:
        '200':
          description: Services retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListServicesResponse'

  /game-service/services/get:
    post:
      summary: Get service by ID or stub name
      description: Retrieves a single service by either serviceId (GUID) or stubName.
      operationId: getService
      tags:
      - Game Service Registry
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetServiceRequest'
      responses:
        '200':
          description: Service retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceInfo'
        '404':
          description: Service not found

  /game-service/services/create:
    post:
      summary: Create a new game service entry
      description: Admin-only endpoint to register a new game service in the registry.
      operationId: createService
      tags:
      - Game Service Registry
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateServiceRequest'
      responses:
        '200':
          description: Service created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceInfo'
        '400':
          description: Invalid service data
        '409':
          description: Service with stub_name already exists

  /game-service/services/update:
    post:
      summary: Update a game service entry
      description: Admin-only endpoint to update an existing game service.
      operationId: updateService
      tags:
      - Game Service Registry
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateServiceRequest'
      responses:
        '200':
          description: Service updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceInfo'
        '404':
          description: Service not found
        '400':
          description: Invalid update data

  /game-service/services/delete:
    post:
      summary: Delete a game service entry
      description: Admin-only endpoint to remove a game service from the registry.
      operationId: deleteService
      tags:
      - Game Service Registry
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteServiceRequest'
      responses:
        '200':
          description: Service deleted successfully
        '404':
          description: Service not found
        '409':
          description: Service cannot be deleted (active subscriptions exist)

components:
  schemas:
    # Request Models
    ListServicesRequest:
      type: object
      additionalProperties: false
      description: Request to list all game services
      properties:
        activeOnly:
          type: boolean
          default: false
          description: If true, only return active services

    GetServiceRequest:
      type: object
      additionalProperties: false
      description: Request to get a service by ID or stub name (provide either one)
      properties:
        serviceId:
          type: string
          format: uuid
          nullable: true
          description: ID of the service to retrieve (null if using stubName)
        stubName:
          type: string
          nullable: true
          description: Stub name of the service to retrieve (null if using serviceId)

    CreateServiceRequest:
      type: object
      additionalProperties: false
      description: Request to create a new game service
      required:
      - stubName
      - displayName
      properties:
        stubName:
          type: string
          pattern: '^[a-z0-9-]+$'
          minLength: 2
          maxLength: 50
          description: URL-safe identifier for the service (e.g., "my-game", "my-other-game")
        displayName:
          type: string
          minLength: 1
          maxLength: 100
          description: Human-readable name for the service (e.g., "My Game Online")
        description:
          type: string
          nullable: true
          maxLength: 500
          description: Optional description of the service
        isActive:
          type: boolean
          default: true
          description: Whether the service is currently active

    UpdateServiceRequest:
      type: object
      additionalProperties: false
      description: Request to update an existing game service
      required:
      - serviceId
      properties:
        serviceId:
          type: string
          format: uuid
          description: ID of the service to update
        displayName:
          type: string
          nullable: true
          maxLength: 100
          description: New display name
        description:
          type: string
          nullable: true
          maxLength: 500
          description: New description
        isActive:
          type: boolean
          nullable: true
          description: New active status

    DeleteServiceRequest:
      type: object
      additionalProperties: false
      description: Request to delete a game service
      required:
      - serviceId
      properties:
        serviceId:
          type: string
          format: uuid
          description: ID of the service to delete
        reason:
          type: string
          nullable: true
          description: Optional reason for deletion (included in the lifecycle event)

    # Response Models
    ServiceInfo:
      type: object
      additionalProperties: false
      description: Information about a game service
      required:
      - serviceId
      - stubName
      - displayName
      - isActive
      - createdAt
      properties:
        serviceId:
          type: string
          format: uuid
          description: Unique identifier for the service
        stubName:
          type: string
          description: URL-safe identifier (e.g., "my-game")
        displayName:
          type: string
          description: Human-readable name (e.g., "My Game Online")
        description:
          type: string
          nullable: true
          description: Optional description
        isActive:
          type: boolean
          description: Whether the service is currently active
        createdAt:
          type: string
          format: date-time
          description: When the service was created
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: When the service was last updated

    ListServicesResponse:
      type: object
      additionalProperties: false
      description: Response containing list of game services
      required:
      - services
      - totalCount
      properties:
        services:
          type: array
          description: List of game services matching the request criteria
          items:
            $ref: '#/components/schemas/ServiceInfo'
        totalCount:
          type: integer
          description: Total number of services matching the filter

