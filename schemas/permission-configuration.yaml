openapi: 3.0.4
info:
  title: Permission Service Configuration
  description: |
    Configuration schema for Permission service.
    Properties are bound to environment variables with BANNOU_ prefix.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    MaxConcurrentRecompilations:
      type: integer
      env: PERMISSION_MAX_CONCURRENT_RECOMPILATIONS
      default: 50
      minimum: 1
      maximum: 500
      description: Maximum number of concurrent session recompilations during service registration (bounds parallel Redis operations)
    SessionDataTtlSeconds:
      type: integer
      env: PERMISSION_SESSION_DATA_TTL_SECONDS
      default: 600
      minimum: 0
      maximum: 604800
      description: Redis TTL in seconds for session permission data keys (states and compiled permissions). With heartbeat-driven TTL refresh (every 30s via ISessionActivityListener), active sessions continuously extend their TTL. Dead sessions expire naturally when heartbeats stop. Default 600 (10 minutes, ~20 heartbeat intervals of headroom). 0 disables Redis TTL. Maximum 604800 (7 days).
    SessionLockTimeoutSeconds:
      type: integer
      env: PERMISSION_SESSION_LOCK_TIMEOUT_SECONDS
      default: 10
      minimum: 1
      maximum: 60
      description: Timeout in seconds for distributed locks during session state and role update operations. Prevents lost updates when concurrent requests modify the same session.
    RoleHierarchy:
      type: array
      items:
        type: string
        minLength: 1
      minItems: 1
      default: ["anonymous", "user", "developer", "admin"]
      env: PERMISSION_ROLE_HIERARCHY
      description: Ordered role hierarchy from lowest to highest privilege. Index determines priority for permission compilation (comma-separated in env var).
