openapi: 3.0.0
info:
  title: Bannou Website Service API
  description: Public-facing website service for registration, information, and account management
  version: 1.0.0
servers:
  - url: http://localhost:3500/v1.0/invoke/bannou/method
    description: Dapr sidecar endpoint

paths:
  /website/status:
    get:
      summary: Get website status and version
      operationId: getStatus
      tags:
        - Status
      x-permissions:
        - role: anonymous
          states: {}
      responses:
        '200':
          description: Website service status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'

  /website/content/{slug}:
    get:
      summary: Get dynamic page content from CMS
      operationId: getPageContent
      tags:
        - Content
      x-permissions:
        - role: anonymous
          states: {}
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
            pattern: "^[a-z0-9-]+$"
          description: Page slug identifier
      responses:
        '200':
          description: Page content retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageContent'
        '404':
          description: Page not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /website/news:
    get:
      summary: Get latest news and announcements
      operationId: getNews
      tags:
        - Content
      x-permissions:
        - role: anonymous
          states: {}
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Number of news items to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Pagination offset
      responses:
        '200':
          description: News items retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'

  /website/server-status:
    get:
      summary: Get game server status for all realms
      operationId: getServerStatus
      tags:
        - Status
      x-permissions:
        - role: anonymous
          states: {}
      responses:
        '200':
          description: Server status information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerStatusResponse'

  /website/downloads:
    get:
      summary: Get download links for game clients
      operationId: getDownloads
      tags:
        - Downloads
      x-permissions:
        - role: anonymous
          states: {}
      parameters:
        - name: platform
          in: query
          schema:
            type: string
            enum: [windows, macos, linux]
          description: Filter by platform
      responses:
        '200':
          description: Download links retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DownloadsResponse'

  /website/contact:
    post:
      summary: Submit contact form
      operationId: submitContact
      tags:
        - Contact
      x-permissions:
        - role: anonymous
          states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContactRequest'
      responses:
        '200':
          description: Contact form submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContactResponse'
        '400':
          description: Invalid form data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /website/account/profile:
    get:
      summary: Get account profile for logged-in user
      operationId: getAccountProfile
      tags:
        - Account
      x-permissions:
        - role: user
          states:
            auth: authenticated
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Account profile retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountProfile'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /website/account/characters:
    get:
      summary: Get character list for logged-in user
      operationId: getAccountCharacters
      tags:
        - Account
      x-permissions:
        - role: user
          states:
            auth: authenticated
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Character list retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /website/cms/pages:
    get:
      summary: List all CMS pages
      operationId: listPages
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      security:
        - BearerAuth: []
      parameters:
        - name: includeUnpublished
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Page list retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PageMetadata'
    post:
      summary: Create new CMS page
      operationId: createPage
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PageContent'
      responses:
        '201':
          description: Page created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageContent'

  /website/cms/pages/{slug}:
    put:
      summary: Update CMS page
      operationId: updatePage
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PageContent'
      responses:
        '200':
          description: Page updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageContent'
    delete:
      summary: Delete CMS page
      operationId: deletePage
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Page deleted

  /website/cms/site-settings:
    get:
      summary: Get site configuration
      operationId: getSiteSettings
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      responses:
        '200':
          description: Site settings retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SiteSettings'
    put:
      summary: Update site configuration
      operationId: updateSiteSettings
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SiteSettings'
      responses:
        '200':
          description: Settings updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SiteSettings'

  /website/cms/theme:
    get:
      summary: Get current theme configuration
      operationId: getTheme
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      responses:
        '200':
          description: Theme configuration retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThemeConfig'
    put:
      summary: Update theme configuration
      operationId: updateTheme
      tags:
        - CMS
      x-permissions:
        - role: developer
          states: {}
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ThemeConfig'
      responses:
        '200':
          description: Theme updated

  /website/account/subscription:
    get:
      summary: Get subscription status
      operationId: getSubscription
      tags:
        - Account
      x-permissions:
        - role: user
          states:
            auth: authenticated
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Subscription information retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    StatusResponse:
      type: object
      required:
        - status
        - version
        - uptime
      properties:
        status:
          type: string
          enum: [healthy, degraded, maintenance]
        version:
          type: string
          example: "1.0.0"
        uptime:
          type: integer
          description: Uptime in seconds
        maintenanceMessage:
          type: string
          nullable: true

    PageContent:
      type: object
      required:
        - slug
        - title
        - content
        - contentType
        - published
      properties:
        slug:
          type: string
          pattern: "^[a-z0-9-]+$"
        title:
          type: string
        content:
          type: string
          description: HTML, Markdown, or custom template content
        contentType:
          type: string
          enum: [html, markdown, blazor]
        template:
          type: string
          nullable: true
          description: Template name for custom layouts
        published:
          type: boolean
        publishedAt:
          type: string
          format: date-time
          nullable: true
        lastModified:
          type: string
          format: date-time
        author:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties: true
          description: Custom metadata for the page
        seo:
          $ref: '#/components/schemas/SEOMetadata'

    PageMetadata:
      type: object
      required:
        - slug
        - title
        - published
      properties:
        slug:
          type: string
        title:
          type: string
        published:
          type: boolean
        publishedAt:
          type: string
          format: date-time
          nullable: true
        lastModified:
          type: string
          format: date-time
        author:
          type: string
          nullable: true

    SEOMetadata:
      type: object
      properties:
        description:
          type: string
          nullable: true
        keywords:
          type: array
          items:
            type: string
        ogTitle:
          type: string
          nullable: true
        ogDescription:
          type: string
          nullable: true
        ogImage:
          type: string
          format: uri
          nullable: true

    SiteSettings:
      type: object
      required:
        - siteName
        - siteUrl
        - defaultLanguage
      properties:
        siteName:
          type: string
        siteUrl:
          type: string
          format: uri
        tagline:
          type: string
          nullable: true
        defaultLanguage:
          type: string
          default: "en"
        supportedLanguages:
          type: array
          items:
            type: string
        maintenanceMode:
          type: boolean
          default: false
        maintenanceMessage:
          type: string
          nullable: true
        contactEmail:
          type: string
          format: email
        socialLinks:
          type: object
          additionalProperties:
            type: string
            format: uri
        analytics:
          type: object
          properties:
            googleAnalyticsId:
              type: string
              nullable: true
            otherTrackers:
              type: object
              additionalProperties: true
        customScripts:
          type: object
          properties:
            head:
              type: string
              nullable: true
            bodyStart:
              type: string
              nullable: true
            bodyEnd:
              type: string
              nullable: true

    ThemeConfig:
      type: object
      required:
        - themeName
        - primaryColor
      properties:
        themeName:
          type: string
        primaryColor:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
        secondaryColor:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
        backgroundColor:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
        textColor:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
        fontFamily:
          type: string
        customCSS:
          type: string
          nullable: true
        logo:
          type: object
          properties:
            url:
              type: string
              format: uri
            alt:
              type: string
        favicon:
          type: string
          format: uri
          nullable: true
        navigation:
          type: array
          items:
            $ref: '#/components/schemas/NavigationItem'

    NavigationItem:
      type: object
      required:
        - label
        - url
        - order
      properties:
        label:
          type: string
        url:
          type: string
        order:
          type: integer
        target:
          type: string
          enum: [_self, _blank]
          default: _self
        children:
          type: array
          items:
            $ref: '#/components/schemas/NavigationItem'

    NewsResponse:
      type: object
      required:
        - items
        - total
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/NewsItem'
        total:
          type: integer
        hasMore:
          type: boolean

    NewsItem:
      type: object
      required:
        - id
        - title
        - summary
        - publishedAt
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        summary:
          type: string
        content:
          type: string
          nullable: true
        author:
          type: string
        publishedAt:
          type: string
          format: date-time
        tags:
          type: array
          items:
            type: string
        imageUrl:
          type: string
          format: uri
          nullable: true

    ServerStatusResponse:
      type: object
      required:
        - realms
        - globalStatus
      properties:
        globalStatus:
          type: string
          enum: [online, partial, offline, maintenance]
        realms:
          type: array
          items:
            $ref: '#/components/schemas/RealmStatus'

    RealmStatus:
      type: object
      required:
        - realmId
        - name
        - status
        - population
      properties:
        realmId:
          type: string
        name:
          type: string
        status:
          type: string
          enum: [online, offline, maintenance, full]
        population:
          type: string
          enum: [low, medium, high, full]
        playerCount:
          type: integer
          nullable: true
        ping:
          type: integer
          description: Latency in milliseconds
          nullable: true

    DownloadsResponse:
      type: object
      required:
        - clients
      properties:
        clients:
          type: array
          items:
            $ref: '#/components/schemas/DownloadInfo'

    DownloadInfo:
      type: object
      required:
        - platform
        - version
        - url
        - size
        - checksum
      properties:
        platform:
          type: string
          enum: [windows, macos, linux]
        version:
          type: string
        url:
          type: string
          format: uri
        size:
          type: integer
          description: File size in bytes
        checksum:
          type: string
          description: SHA256 checksum
        releaseNotes:
          type: string
          nullable: true
        minimumRequirements:
          type: object
          additionalProperties: true

    ContactRequest:
      type: object
      required:
        - email
        - subject
        - message
      properties:
        email:
          type: string
          format: email
        name:
          type: string
          nullable: true
        subject:
          type: string
          minLength: 5
          maxLength: 200
        message:
          type: string
          minLength: 10
          maxLength: 2000
        category:
          type: string
          enum: [general, support, bug, feedback, business]
          default: general

    ContactResponse:
      type: object
      required:
        - ticketId
        - message
      properties:
        ticketId:
          type: string
          format: uuid
        message:
          type: string
          default: "Thank you for contacting us. We will respond within 24-48 hours."

    AccountProfile:
      type: object
      required:
        - accountId
        - email
        - createdAt
      properties:
        accountId:
          type: string
          format: uuid
        email:
          type: string
          format: email
        displayName:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        lastLogin:
          type: string
          format: date-time
          nullable: true
        characterSlots:
          type: integer
        usedSlots:
          type: integer

    CharacterListResponse:
      type: object
      required:
        - characters
      properties:
        characters:
          type: array
          items:
            $ref: '#/components/schemas/CharacterSummary'

    CharacterSummary:
      type: object
      required:
        - characterId
        - name
        - realm
        - level
      properties:
        characterId:
          type: string
          format: uuid
        name:
          type: string
        realm:
          type: string
        level:
          type: integer
        class:
          type: string
          nullable: true
        lastPlayed:
          type: string
          format: date-time
          nullable: true

    SubscriptionResponse:
      type: object
      required:
        - status
        - type
      properties:
        status:
          type: string
          enum: [active, inactive, trial, expired]
        type:
          type: string
          enum: [free, basic, premium, lifetime]
        expiresAt:
          type: string
          format: date-time
          nullable: true
        autoRenew:
          type: boolean
        benefits:
          type: array
          items:
            type: string

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
          nullable: true
