openapi: 3.0.3
info:
  title: Orchestrator Service Configuration
  description: |
    Configuration schema for Orchestrator service.
    Properties are bound to environment variables with BANNOU_ prefix.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before
    modifying this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    # Cache Configuration
    CacheTtlMinutes:
      type: integer
      description: Cache TTL in minutes for orchestrator data
      env: ORCHESTRATOR_CACHE_TTL_MINUTES
      default: 5

    # Backend Configuration
    DefaultBackend:
      type: string
      description: Default container orchestration backend when not specified in deploy request (compose, swarm, portainer, kubernetes)
      env: ORCHESTRATOR_DEFAULT_BACKEND
      default: "compose"

    # Heartbeat Configuration
    HeartbeatTimeoutSeconds:
      type: integer
      description: Service heartbeat timeout in seconds
      env: ORCHESTRATOR_HEARTBEAT_TIMEOUT_SECONDS
      default: 90
    DegradationThresholdMinutes:
      type: integer
      description: Time in minutes before a service is marked as degraded
      env: ORCHESTRATOR_DEGRADATION_THRESHOLD_MINUTES
      default: 5

    # Portainer Configuration (Docker Swarm/Compose backend)
    PortainerUrl:
      type: string
      nullable: true  # NRT: Optional config MUST be nullable (only needed for Portainer backend)
      description: Portainer API URL
      env: ORCHESTRATOR_PORTAINER_URL
      example: "https://portainer.example.com:9443"
    PortainerApiKey:
      type: string
      nullable: true  # NRT: Optional config MUST be nullable (only needed for Portainer backend)
      description: Portainer API key
      env: ORCHESTRATOR_PORTAINER_API_KEY
      example: "ptr_your-portainer-api-key-here"
    PortainerEndpointId:
      type: integer
      description: Portainer endpoint ID
      env: ORCHESTRATOR_PORTAINER_ENDPOINT_ID
      default: 1

    # Docker Configuration (Docker Compose backend)
    DockerHost:
      type: string
      description: Docker host for direct Docker API access
      env: ORCHESTRATOR_DOCKER_HOST
      default: "unix:///var/run/docker.sock"
    DockerNetwork:
      type: string
      description: Docker network name for deployed containers
      env: ORCHESTRATOR_DOCKER_NETWORK
      default: "bannou_default"
    CertificatesHostPath:
      type: string
      description: Host path for TLS certificates
      env: ORCHESTRATOR_CERTIFICATES_HOST_PATH
      default: "/app/provisioning/certificates"
    PresetsHostPath:
      type: string
      description: Host path for orchestrator deployment presets
      env: ORCHESTRATOR_PRESETS_HOST_PATH
      default: "/app/provisioning/orchestrator/presets"
    LogsVolumeName:
      type: string
      description: Docker volume name for logs
      env: ORCHESTRATOR_LOGS_VOLUME
      default: "logs-data"

    # OpenResty Configuration (routing cache invalidation)
    OpenRestyHost:
      type: string
      description: OpenResty hostname for cache invalidation calls
      env: ORCHESTRATOR_OPENRESTY_HOST
      default: "openresty"
    OpenRestyPort:
      type: integer
      description: OpenResty port for cache invalidation calls
      env: ORCHESTRATOR_OPENRESTY_PORT
      default: 80

    # Kubernetes Configuration
    KubernetesNamespace:
      type: string
      description: Kubernetes namespace for deployments
      env: ORCHESTRATOR_KUBERNETES_NAMESPACE
      default: "default"
    KubeconfigPath:
      type: string
      nullable: true
      description: Path to kubeconfig file (null uses default ~/.kube/config)
      env: ORCHESTRATOR_KUBECONFIG_PATH
      example: "/path/to/.kube/config"

    # Infrastructure Connection Strings (IMPLEMENTATION TENETS - no insecure defaults)
    RedisConnectionString:
      type: string
      description: Redis connection string for orchestrator state (REQUIRED - service fails fast if missing)
      env: ORCHESTRATOR_REDIS_CONNECTION_STRING
      example: "redis:6379"
    RabbitMqConnectionString:
      type: string
      description: RabbitMQ connection string for orchestrator messaging (REQUIRED - service fails fast if missing)
      env: ORCHESTRATOR_RABBITMQ_CONNECTION_STRING
      example: "amqp://guest:guest@rabbitmq:5672"
