openapi: 3.0.4
info:
  title: Location Service Events
  description: |
    Event models for Location service RabbitMQ pub/sub via MassTransit.
    Lifecycle events are auto-generated from x-lifecycle definition.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
  x-event-subscriptions: []  # Location service doesn't subscribe to external events
  x-event-publications:
    # Location lifecycle events (auto-generated from x-lifecycle)
    - topic: location.created
      event: LocationCreatedEvent
      description: Published when a new location is created
    - topic: location.updated
      event: LocationUpdatedEvent
      description: Published when a location is updated
    - topic: location.deleted
      event: LocationDeletedEvent
      description: Published when a location is soft-deleted
    - topic: location.entity-arrived
      event: LocationEntityArrivedEvent
      description: Published when an entity arrives at a location (position change detected)
    - topic: location.entity-departed
      event: LocationEntityDepartedEvent
      description: Published when an entity departs from a location (position change or clear)

# Lifecycle events auto-generated from this definition
# Output: schemas/Generated/location-lifecycle-events.yaml
x-lifecycle:
  Location:
    model:
      locationId: { type: string, format: uuid, primary: true, required: true, description: "Unique identifier for the location" }
      realmId: { type: string, format: uuid, required: true, description: "ID of the realm this location belongs to" }
      code: { type: string, required: true, description: "Unique code identifier for the location within its realm" }
      name: { type: string, required: true, description: "Human-readable name of the location" }
      description: { type: string, nullable: true, description: "Detailed description of the location" }
      locationType: { $ref: 'location-api.yaml#/components/schemas/LocationType', required: true, description: "Type classification of the location" }
      parentLocationId: { type: string, format: uuid, nullable: true, description: "ID of the parent location for hierarchical structures" }
      depth: { type: integer, required: true, description: "Depth level in the location hierarchy (0 for root locations)" }
      isDeprecated: { type: boolean, required: true, description: "Whether this location has been marked as deprecated" }
      deprecatedAt: { type: string, format: date-time, nullable: true, description: "Timestamp when the location was deprecated" }
      deprecationReason: { type: string, nullable: true, description: "Explanation for why the location was deprecated" }
      bounds: { $ref: 'common-api.yaml#/components/schemas/BoundingBox3D', nullable: true, description: "Optional spatial extent in world coordinates" }
      boundsPrecision: { $ref: 'location-api.yaml#/components/schemas/BoundsPrecision', required: true, description: "Precision level of spatial bounds" }
      coordinateMode: { $ref: 'location-api.yaml#/components/schemas/CoordinateMode', required: true, description: "How this location's coordinate system relates to its parent" }
      localOrigin: { $ref: 'common-api.yaml#/components/schemas/Position3D', nullable: true, description: "Origin point for local or inherited coordinate systems" }
      metadata: { type: object, additionalProperties: true, nullable: true, description: "Client-provided location metadata. No Bannou plugin reads specific keys from this field by convention." }
      createdAt: { type: string, format: date-time, required: true, description: "Timestamp when the location was created" }
      updatedAt: { type: string, format: date-time, required: true, description: "Timestamp when the location was last updated" }

paths: {}  # Events don't have HTTP paths

components:
  schemas:
    LocationEntityArrivedEvent:
      type: object
      additionalProperties: false
      description: Published when an entity arrives at a location
      required:
        - eventId
        - timestamp
        - entityType
        - entityId
        - locationId
        - realmId
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event
        timestamp:
          type: string
          format: date-time
          description: When the arrival was recorded
        entityType:
          type: string
          description: Type of entity (opaque string - character, actor, npc, player, etc.)
        entityId:
          type: string
          format: uuid
          description: ID of the entity that arrived
        locationId:
          type: string
          format: uuid
          description: ID of the location the entity arrived at
        realmId:
          type: string
          format: uuid
          description: ID of the realm the location belongs to
        reportedBy:
          type: string
          nullable: true
          description: Identifier of the reporter (service name or session ID)

    LocationEntityDepartedEvent:
      type: object
      additionalProperties: false
      description: Published when an entity departs from a location
      required:
        - eventId
        - timestamp
        - entityType
        - entityId
        - locationId
        - realmId
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event
        timestamp:
          type: string
          format: date-time
          description: When the departure was recorded
        entityType:
          type: string
          description: Type of entity (opaque string - character, actor, npc, player, etc.)
        entityId:
          type: string
          format: uuid
          description: ID of the entity that departed
        locationId:
          type: string
          format: uuid
          description: ID of the location the entity departed from
        realmId:
          type: string
          format: uuid
          description: ID of the realm the location belongs to
        reportedBy:
          type: string
          nullable: true
          description: Identifier of the reporter (service name or session ID)
