openapi: 3.0.3
info:
  title: Documentation Service Events
  description: |
    Event models for Documentation service RabbitMQ pub/sub via MassTransit.
    Contains documentation-specific events and subscription/publication declarations.
  version: 1.0.0
  # Minimal event subscriptions - sessions use TTL cleanup, no external events needed
  x-event-subscriptions: []
  x-event-publications:
    # Document lifecycle events (auto-generated from x-lifecycle)
    - topic: document.created
      event: DocumentCreatedEvent
      description: Published when a document is created
    - topic: document.updated
      event: DocumentUpdatedEvent
      description: Published when a document is updated
    - topic: document.deleted
      event: DocumentDeletedEvent
      description: Published when a document is soft-deleted
    # Analytics events
    - topic: documentation.queried
      event: DocumentationQueriedEvent
      description: Published when documentation is queried
    - topic: documentation.searched
      event: DocumentationSearchedEvent
      description: Published when documentation is searched
    # Repository binding events
    - topic: documentation.binding.created
      event: DocumentationBindingCreatedEvent
      description: Published when a repository binding is created
    - topic: documentation.binding.removed
      event: DocumentationBindingRemovedEvent
      description: Published when a repository binding is removed
    # Sync events
    - topic: documentation.sync.started
      event: DocumentationSyncStartedEvent
      description: Published when a repository sync starts
    - topic: documentation.sync.completed
      event: DocumentationSyncCompletedEvent
      description: Published when a repository sync completes
    # Archive events
    - topic: documentation.archive.created
      event: DocumentationArchiveCreatedEvent
      description: Published when a documentation archive is created

paths: {}  # Events don't have HTTP paths

# Auto-generate CRUD events for Document entity
x-lifecycle:
  Document:
    model:
      documentId:
        type: string
        format: uuid
        primary: true
        required: true
        description: Unique identifier for the document
      namespace:
        type: string
        required: true
        description: The namespace this document belongs to
      slug:
        type: string
        required: true
        description: URL-friendly identifier for the document within its namespace
      title:
        type: string
        required: true
        description: Human-readable title of the document
      category:
        type: string
        required: true
        description: Category classification for the document
      tags:
        type: array
        items:
          type: string
        description: List of tags for categorization and search
      createdAt:
        type: string
        format: date-time
        required: true
        description: Timestamp when the document was created
      updatedAt:
        type: string
        format: date-time
        required: true
        description: Timestamp when the document was last updated
    # Fields excluded from events (content too large for pub/sub)
    sensitive:
      - content
      - summary
      - voiceSummary
      - metadata

components:
  schemas:
    # Note: DocumentCreatedEvent, DocumentUpdatedEvent, DocumentDeletedEvent are auto-generated
    # from the x-lifecycle definition above. Do not define them manually here.

    # Analytics events
    DocumentationQueriedEvent:
      type: object
      description: Published when documentation is queried with natural language
      required:
        - eventId
        - timestamp
        - namespace
        - query
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the query was executed
        namespace:
          type: string
          description: The namespace that was queried
        query:
          type: string
          description: The natural language query string submitted by the user
        sessionId:
          type: string
          format: uuid
          nullable: true
          description: Optional session identifier for tracking query context
        resultCount:
          type: integer
          description: Number of documents returned in the query results
        topResultId:
          type: string
          format: uuid
          nullable: true
          description: Document ID of the highest-ranked result, if any
        relevanceScore:
          type: number
          nullable: true
          description: Relevance score of the top result, if applicable

    DocumentationSearchedEvent:
      type: object
      description: Published when documentation is searched with keywords
      required:
        - eventId
        - timestamp
        - namespace
        - searchTerm
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the search was executed
        namespace:
          type: string
          description: The namespace that was searched
        searchTerm:
          type: string
          description: The keyword search term submitted by the user
        sessionId:
          type: string
          format: uuid
          nullable: true
          description: Optional session identifier for tracking search context
        resultCount:
          type: integer
          description: Number of documents returned in the search results

    # Repository binding events
    DocumentationBindingCreatedEvent:
      type: object
      description: Published when a repository binding is created
      required:
        - eventId
        - timestamp
        - namespace
        - bindingId
        - repositoryUrl
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the binding was created
        namespace:
          type: string
          description: The namespace the repository is bound to
        bindingId:
          type: string
          format: uuid
          description: Unique identifier for the repository binding
        repositoryUrl:
          type: string
          description: URL of the Git repository being bound
        branch:
          type: string
          description: Git branch to sync documentation from

    DocumentationBindingRemovedEvent:
      type: object
      description: Published when a repository binding is removed
      required:
        - eventId
        - timestamp
        - namespace
        - bindingId
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the binding was removed
        namespace:
          type: string
          description: The namespace the repository was bound to
        bindingId:
          type: string
          format: uuid
          description: Unique identifier of the removed binding
        documentsDeleted:
          type: integer
          description: Number of documents deleted as a result of removing the binding

    # Sync events
    DocumentationSyncStartedEvent:
      type: object
      description: Published when a repository sync starts
      required:
        - eventId
        - timestamp
        - namespace
        - bindingId
        - syncId
        - triggeredBy
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the sync operation started
        namespace:
          type: string
          description: The namespace being synced
        bindingId:
          type: string
          format: uuid
          description: Identifier of the repository binding being synced
        syncId:
          type: string
          format: uuid
          description: Unique identifier for this sync operation
        triggeredBy:
          type: string
          enum:
            - manual
            - scheduled
          description: How the sync was triggered (manual user action or scheduled job)

    DocumentationSyncCompletedEvent:
      type: object
      description: Published when a repository sync completes
      required:
        - eventId
        - timestamp
        - namespace
        - bindingId
        - syncId
        - status
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the sync operation completed
        namespace:
          type: string
          description: The namespace that was synced
        bindingId:
          type: string
          format: uuid
          description: Identifier of the repository binding that was synced
        syncId:
          type: string
          format: uuid
          description: Unique identifier for this sync operation
        status:
          type: string
          enum:
            - success
            - partial
            - failed
          description: Final status of the sync operation
        commitHash:
          type: string
          description: Git commit hash that was synced
        documentsCreated:
          type: integer
          description: Number of new documents created during sync
        documentsUpdated:
          type: integer
          description: Number of existing documents updated during sync
        documentsDeleted:
          type: integer
          description: Number of documents deleted during sync
        durationMs:
          type: integer
          description: Duration of the sync operation in milliseconds
        errorMessage:
          type: string
          nullable: true
          description: Error message if the sync failed or partially failed

    # Archive events
    DocumentationArchiveCreatedEvent:
      type: object
      description: Published when a documentation archive is created
      required:
        - eventId
        - timestamp
        - namespace
        - archiveId
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the archive was created
        namespace:
          type: string
          description: The namespace the archive was created for
        archiveId:
          type: string
          format: uuid
          description: Unique identifier for the archive
        bundleAssetId:
          type: string
          format: uuid
          description: Asset ID of the archive bundle in the asset storage system
        documentCount:
          type: integer
          description: Number of documents included in the archive
        sizeBytes:
          type: integer
          description: Total size of the archive in bytes
        commitHash:
          type: string
          nullable: true
          description: Git commit hash the archive was created from, if applicable
