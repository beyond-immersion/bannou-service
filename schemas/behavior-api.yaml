openapi: 3.0.0
info:
  title: ABML Behavior Management API
  version: 3.0.0
  description: |
    Arcadia Behavior Markup Language (ABML) API for character behavior management.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    This API handles:
    - YAML-based behavior definition parsing and compilation
    - Stackable behavior set management with priority resolution
    - GOAP (Goal-Oriented Action Planning) integration
    - Cultural adaptation and context-aware behavior modification
    - Real-time behavior state management and caching
    - Integration with Bannou mesh for distributed character agents

servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)

paths:
  /compile:
    post:
      summary: Compile ABML behavior definition
      description: |
        Compiles a YAML-based ABML behavior definition into executable behavior trees.
        Handles stackable behavior sets, cultural adaptations, and context variable resolution.
      operationId: CompileAbmlBehavior
      tags:
      - ABML
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/yaml:
            schema:
              type: string
              description: Raw ABML YAML content
            example: |
              version: "1.0.0"
              metadata:
                id: "blacksmith_daily_routine"
                category: "profession"
                priority: 60
                description: "Daily routine for a master blacksmith NPC"

              context:
                variables:
                  energy_level: "${npc.stats.energy}"
                  skill_level: "${npc.skills.blacksmithing}"
                  shop_reputation: "${npc.reputation.local}"
                
                services:
                  - name: "crafting_service"
                    required: true
                  - name: "economy_service"
                    required: true

              behaviors:
                morning_startup:
                  triggers:
                    - time_range: "06:00-09:00"
                    - condition: "${context.energy_level > 0.7}"
                  actions:
                    - wake_up:
                        animation: "stretch_and_yawn"
                        duration: 3
                        energy_cost: -0.05
          application/json:
            schema:
              $ref: '#/components/schemas/CompileBehaviorRequest'
      responses:
        '200':
          description: ABML behavior compiled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompileBehaviorResponse'
        '400':
          description: Invalid ABML definition or compilation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CompileBehaviorRequest\"\
        ,\n  \"$defs\": {\n    \"CompileBehaviorRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n       \
        \ \"abml_content\"\n      ],\n      \"properties\": {\n        \"abml_content\": {\n          \"type\": \"string\"\
        ,\n          \"description\": \"Raw ABML YAML content to compile\",\n          \"example\": \"version: \\\"1.0.0\\\
        \"\\nmetadata:\\n  id: \\\"example_behavior\\\"\\n  category: \\\"basic\\\"\\nbehaviors:\\n  example:\\n    triggers:\\\
        n      - condition: \\\"true\\\"\\n    actions:\\n      - log:\\n          message: \\\"Hello World\\\"\\n\"\n   \
        \     },\n        \"character_context\": {\n          \"$ref\": \"#/$defs/CharacterContext\"\n        },\n       \
        \ \"compilation_options\": {\n          \"$ref\": \"#/$defs/CompilationOptions\"\n        }\n      }\n    },\n   \
        \ \"CharacterContext\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"npc_id\": {\n         \
        \ \"type\": \"string\",\n          \"description\": \"Unique identifier for the NPC\",\n          \"example\": \"\
        npc_12345\"\n        },\n        \"culture\": {\n          \"type\": \"string\",\n          \"description\": \"Cultural
        background identifier\",\n          \"example\": \"european_medieval\"\n        },\n        \"profession\": {\n  \
        \        \"type\": \"string\",\n          \"description\": \"Character profession identifier\",\n          \"example\"\
        : \"blacksmith\"\n        },\n        \"stats\": {\n          \"type\": \"object\",\n          \"additionalProperties\"\
        : {\n            \"type\": \"number\"\n          },\n          \"description\": \"Character statistics and attributes\"\
        ,\n          \"example\": {\n            \"energy\": 0.8,\n            \"health\": 1.0,\n            \"hunger\": 0.3\n\
        \          }\n        },\n        \"skills\": {\n          \"type\": \"object\",\n          \"additionalProperties\"\
        : {\n            \"type\": \"number\"\n          },\n          \"description\": \"Character skill levels\",\n    \
        \      \"example\": {\n            \"blacksmithing\": 85,\n            \"trading\": 42\n          }\n        },\n\
        \        \"location\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"current\": {\n\
        \              \"type\": \"string\"\n            },\n            \"region\": {\n              \"type\": \"string\"\
        \n            },\n            \"coordinates\": {\n              \"type\": \"object\",\n              \"properties\"\
        : {\n                \"x\": {\n                  \"type\": \"number\"\n                },\n                \"y\":
        {\n                  \"type\": \"number\"\n                },\n                \"z\": {\n                  \"type\"\
        : \"number\"\n                }\n              }\n            }\n          }\n        },\n        \"relationships\"\
        : {\n          \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"number\"\n  \
        \        },\n          \"description\": \"Relationship values with other characters\"\n        },\n        \"world_state\"\
        : {\n          \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"description\": \"Relevant
        world state information\"\n        }\n      }\n    },\n    \"CompilationOptions\": {\n      \"type\": \"object\",\n\
        \      \"properties\": {\n        \"enable_optimizations\": {\n          \"type\": \"boolean\",\n          \"default\"\
        : true,\n          \"description\": \"Enable behavior tree optimizations\"\n        },\n        \"cache_compiled_result\"\
        : {\n          \"type\": \"boolean\",\n          \"default\": true,\n          \"description\": \"Cache the compiled
        behavior for reuse\"\n        },\n        \"strict_validation\": {\n          \"type\": \"boolean\",\n          \"\
        default\": false,\n          \"description\": \"Enable strict validation mode\"\n        },\n        \"cultural_adaptations\"\
        : {\n          \"type\": \"boolean\",\n          \"default\": true,\n          \"description\": \"Apply cultural adaptations
        during compilation\"\n        },\n        \"goap_integration\": {\n          \"type\": \"boolean\",\n          \"\
        default\": true,\n          \"description\": \"Generate GOAP goals from behaviors\"\n        }\n      }\n    }\n \
        \ }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CompileBehaviorResponse\"\
        ,\n  \"$defs\": {\n    \"CompileBehaviorResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n      \
        \  \"success\",\n        \"behavior_id\"\n      ],\n      \"properties\": {\n        \"success\": {\n          \"\
        type\": \"boolean\",\n          \"description\": \"Whether compilation was successful\"\n        },\n        \"behavior_id\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"Unique identifier for the compiled behavior\",\n\
        \          \"example\": \"behavior_abc123\"\n        },\n        \"compiled_behavior\": {\n          \"$ref\": \"\
        #/$defs/CompiledBehavior\"\n        },\n        \"compilation_time_ms\": {\n          \"type\": \"integer\",\n   \
        \       \"description\": \"Time taken to compile the behavior\"\n        },\n        \"cache_key\": {\n          \"\
        type\": \"string\",\n          \"description\": \"Key for caching the compiled behavior\"\n        },\n        \"\
        warnings\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n        \
        \  },\n          \"description\": \"Non-fatal warnings during compilation\"\n        }\n      }\n    },\n    \"CompiledBehavior\"\
        : {\n      \"type\": \"object\",\n      \"required\": [\n        \"behavior_tree\",\n        \"context_schema\"\n\
        \      ],\n      \"properties\": {\n        \"behavior_tree\": {\n          \"type\": \"object\",\n          \"description\"\
        : \"Compiled executable behavior tree structure\"\n        },\n        \"context_schema\": {\n          \"type\":
        \"object\",\n          \"description\": \"Schema defining required context variables\"\n        },\n        \"service_dependencies\"\
        : {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          },\n    \
        \      \"description\": \"List of required services for this behavior\"\n        },\n        \"goap_goals\": {\n \
        \         \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/GoapGoal\"\n          },\n\
        \          \"description\": \"GOAP goals extracted from the behavior\"\n        },\n        \"execution_metadata\"\
        : {\n          \"type\": \"object\",\n          \"properties\": {\n            \"estimated_duration\": {\n       \
        \       \"type\": \"integer\",\n              \"description\": \"Estimated execution time in seconds\"\n         \
        \   },\n            \"resource_requirements\": {\n              \"type\": \"object\",\n              \"additionalProperties\"\
        : {\n                \"type\": \"number\"\n              }\n            },\n            \"interrupt_conditions\":
        {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n        \
        \      }\n            }\n          }\n        }\n      }\n    },\n    \"GoapGoal\": {\n      \"type\": \"object\"\
        ,\n      \"required\": [\n        \"name\",\n        \"conditions\",\n        \"priority\"\n      ],\n      \"properties\"\
        : {\n        \"name\": {\n          \"type\": \"string\",\n          \"description\": \"Name of the goal\",\n    \
        \      \"example\": \"satisfy_hunger\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n\
        \          \"description\": \"Human-readable description of the goal\"\n        },\n        \"conditions\": {\n  \
        \        \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n        \
        \  },\n          \"description\": \"World state conditions that satisfy this goal (literal conditions)\",\n      \
        \    \"example\": {\n            \"hunger\": \"<= 0.3\",\n            \"gold\": \">= 50\"\n          }\n        },\n\
        \        \"priority\": {\n          \"type\": \"integer\",\n          \"minimum\": 1,\n          \"maximum\": 100,\n\
        \          \"description\": \"Priority of this goal relative to others\"\n        },\n        \"preconditions\": {\n\
        \          \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n      \
        \    },\n          \"description\": \"World state conditions required to pursue this goal\"\n        }\n      }\n\
        \    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Compile ABML behavior definition\",\n  \"description\": \"Compiles a YAML-based
        ABML behavior definition into executable behavior trees.\\nHandles stackable behavior sets, cultural adaptations,
        and context variable resolution.\\n\",\n  \"tags\": [\n    \"ABML\"\n  ],\n  \"deprecated\": false,\n  \"operationId\"\
        : \"CompileAbmlBehavior\"\n}"
  /stack/compile:
    post:
      summary: Compile stackable behavior sets
      description: |
        Compiles multiple ABML behavior sets with priority-based merging.
        Handles cultural adaptations, profession specializations, and context resolution.
      operationId: CompileBehaviorStack
      tags:
      - BehaviorStacks
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BehaviorStackRequest'
      responses:
        '200':
          description: Behavior stack compiled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompileBehaviorResponse'
        '400':
          description: Invalid behavior stack or compilation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/BehaviorStackRequest\"\
        ,\n  \"$defs\": {\n    \"BehaviorStackRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        behavior_sets\"\n      ],\n      \"properties\": {\n        \"behavior_sets\": {\n          \"type\": \"array\",\n\
        \          \"items\": {\n            \"$ref\": \"#/$defs/BehaviorSetDefinition\"\n          },\n          \"description\"\
        : \"Array of behavior sets to compile together\"\n        },\n        \"character_context\": {\n          \"$ref\"\
        : \"#/$defs/CharacterContext\"\n        },\n        \"compilation_options\": {\n          \"$ref\": \"#/$defs/CompilationOptions\"\
        \n        }\n      }\n    },\n    \"BehaviorSetDefinition\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"id\",\n        \"priority\",\n        \"abml_content\"\n      ],\n      \"properties\": {\n        \"id\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"Unique identifier for the behavior set\",\n   \
        \       \"example\": \"base_humanoid\"\n        },\n        \"priority\": {\n          \"type\": \"integer\",\n  \
        \        \"minimum\": 1,\n          \"maximum\": 100,\n          \"description\": \"Priority level for merging (higher
        priority overrides lower)\",\n          \"example\": 50\n        },\n        \"category\": {\n          \"type\":
        \"string\",\n          \"description\": \"Category of the behavior set\",\n          \"enum\": [\n            \"base\"\
        ,\n            \"cultural\",\n            \"professional\",\n            \"personal\",\n            \"situational\"\
        \n          ]\n        },\n        \"abml_content\": {\n          \"type\": \"string\",\n          \"description\"\
        : \"Raw ABML YAML content for this behavior set\"\n        },\n        \"metadata\": {\n          \"type\": \"object\"\
        ,\n          \"additionalProperties\": true,\n          \"description\": \"Additional metadata for the behavior set\"\
        \n        }\n      }\n    },\n    \"CharacterContext\": {\n      \"type\": \"object\",\n      \"properties\": {\n\
        \        \"npc_id\": {\n          \"type\": \"string\",\n          \"description\": \"Unique identifier for the NPC\"\
        ,\n          \"example\": \"npc_12345\"\n        },\n        \"culture\": {\n          \"type\": \"string\",\n   \
        \       \"description\": \"Cultural background identifier\",\n          \"example\": \"european_medieval\"\n     \
        \   },\n        \"profession\": {\n          \"type\": \"string\",\n          \"description\": \"Character profession
        identifier\",\n          \"example\": \"blacksmith\"\n        },\n        \"stats\": {\n          \"type\": \"object\"\
        ,\n          \"additionalProperties\": {\n            \"type\": \"number\"\n          },\n          \"description\"\
        : \"Character statistics and attributes\",\n          \"example\": {\n            \"energy\": 0.8,\n            \"\
        health\": 1.0,\n            \"hunger\": 0.3\n          }\n        },\n        \"skills\": {\n          \"type\": \"\
        object\",\n          \"additionalProperties\": {\n            \"type\": \"number\"\n          },\n          \"description\"\
        : \"Character skill levels\",\n          \"example\": {\n            \"blacksmithing\": 85,\n            \"trading\"\
        : 42\n          }\n        },\n        \"location\": {\n          \"type\": \"object\",\n          \"properties\"\
        : {\n            \"current\": {\n              \"type\": \"string\"\n            },\n            \"region\": {\n \
        \             \"type\": \"string\"\n            },\n            \"coordinates\": {\n              \"type\": \"object\"\
        ,\n              \"properties\": {\n                \"x\": {\n                  \"type\": \"number\"\n           \
        \     },\n                \"y\": {\n                  \"type\": \"number\"\n                },\n                \"\
        z\": {\n                  \"type\": \"number\"\n                }\n              }\n            }\n          }\n \
        \       },\n        \"relationships\": {\n          \"type\": \"object\",\n          \"additionalProperties\": {\n\
        \            \"type\": \"number\"\n          },\n          \"description\": \"Relationship values with other characters\"\
        \n        },\n        \"world_state\": {\n          \"type\": \"object\",\n          \"additionalProperties\": true,\n\
        \          \"description\": \"Relevant world state information\"\n        }\n      }\n    },\n    \"CompilationOptions\"\
        : {\n      \"type\": \"object\",\n      \"properties\": {\n        \"enable_optimizations\": {\n          \"type\"\
        : \"boolean\",\n          \"default\": true,\n          \"description\": \"Enable behavior tree optimizations\"\n\
        \        },\n        \"cache_compiled_result\": {\n          \"type\": \"boolean\",\n          \"default\": true,\n\
        \          \"description\": \"Cache the compiled behavior for reuse\"\n        },\n        \"strict_validation\":
        {\n          \"type\": \"boolean\",\n          \"default\": false,\n          \"description\": \"Enable strict validation
        mode\"\n        },\n        \"cultural_adaptations\": {\n          \"type\": \"boolean\",\n          \"default\":
        true,\n          \"description\": \"Apply cultural adaptations during compilation\"\n        },\n        \"goap_integration\"\
        : {\n          \"type\": \"boolean\",\n          \"default\": true,\n          \"description\": \"Generate GOAP goals
        from behaviors\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CompileBehaviorResponse\"\
        ,\n  \"$defs\": {\n    \"CompileBehaviorResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n      \
        \  \"success\",\n        \"behavior_id\"\n      ],\n      \"properties\": {\n        \"success\": {\n          \"\
        type\": \"boolean\",\n          \"description\": \"Whether compilation was successful\"\n        },\n        \"behavior_id\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"Unique identifier for the compiled behavior\",\n\
        \          \"example\": \"behavior_abc123\"\n        },\n        \"compiled_behavior\": {\n          \"$ref\": \"\
        #/$defs/CompiledBehavior\"\n        },\n        \"compilation_time_ms\": {\n          \"type\": \"integer\",\n   \
        \       \"description\": \"Time taken to compile the behavior\"\n        },\n        \"cache_key\": {\n          \"\
        type\": \"string\",\n          \"description\": \"Key for caching the compiled behavior\"\n        },\n        \"\
        warnings\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n        \
        \  },\n          \"description\": \"Non-fatal warnings during compilation\"\n        }\n      }\n    },\n    \"CompiledBehavior\"\
        : {\n      \"type\": \"object\",\n      \"required\": [\n        \"behavior_tree\",\n        \"context_schema\"\n\
        \      ],\n      \"properties\": {\n        \"behavior_tree\": {\n          \"type\": \"object\",\n          \"description\"\
        : \"Compiled executable behavior tree structure\"\n        },\n        \"context_schema\": {\n          \"type\":
        \"object\",\n          \"description\": \"Schema defining required context variables\"\n        },\n        \"service_dependencies\"\
        : {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          },\n    \
        \      \"description\": \"List of required services for this behavior\"\n        },\n        \"goap_goals\": {\n \
        \         \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/GoapGoal\"\n          },\n\
        \          \"description\": \"GOAP goals extracted from the behavior\"\n        },\n        \"execution_metadata\"\
        : {\n          \"type\": \"object\",\n          \"properties\": {\n            \"estimated_duration\": {\n       \
        \       \"type\": \"integer\",\n              \"description\": \"Estimated execution time in seconds\"\n         \
        \   },\n            \"resource_requirements\": {\n              \"type\": \"object\",\n              \"additionalProperties\"\
        : {\n                \"type\": \"number\"\n              }\n            },\n            \"interrupt_conditions\":
        {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n        \
        \      }\n            }\n          }\n        }\n      }\n    },\n    \"GoapGoal\": {\n      \"type\": \"object\"\
        ,\n      \"required\": [\n        \"name\",\n        \"conditions\",\n        \"priority\"\n      ],\n      \"properties\"\
        : {\n        \"name\": {\n          \"type\": \"string\",\n          \"description\": \"Name of the goal\",\n    \
        \      \"example\": \"satisfy_hunger\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n\
        \          \"description\": \"Human-readable description of the goal\"\n        },\n        \"conditions\": {\n  \
        \        \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n        \
        \  },\n          \"description\": \"World state conditions that satisfy this goal (literal conditions)\",\n      \
        \    \"example\": {\n            \"hunger\": \"<= 0.3\",\n            \"gold\": \">= 50\"\n          }\n        },\n\
        \        \"priority\": {\n          \"type\": \"integer\",\n          \"minimum\": 1,\n          \"maximum\": 100,\n\
        \          \"description\": \"Priority of this goal relative to others\"\n        },\n        \"preconditions\": {\n\
        \          \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n      \
        \    },\n          \"description\": \"World state conditions required to pursue this goal\"\n        }\n      }\n\
        \    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Compile stackable behavior sets\",\n  \"description\": \"Compiles multiple
        ABML behavior sets with priority-based merging.\\nHandles cultural adaptations, profession specializations, and context
        resolution.\\n\",\n  \"tags\": [\n    \"BehaviorStacks\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"CompileBehaviorStack\"\
        \n}"
  /validate:
    post:
      summary: Validate ABML definition
      description: |
        Validates ABML YAML against schema and checks for semantic correctness.
        Includes context variable validation and service dependency checking.
      operationId: ValidateAbml
      tags:
      - Validation
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/yaml:
            schema:
              type: string
              description: Raw ABML YAML content to validate
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateAbmlRequest'
      responses:
        '200':
          description: Validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateAbmlResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ValidateAbmlRequest\"\
        ,\n  \"$defs\": {\n    \"ValidateAbmlRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        abml_content\"\n      ],\n      \"properties\": {\n        \"abml_content\": {\n          \"type\": \"string\",\n\
        \          \"description\": \"Raw ABML YAML content to validate\"\n        },\n        \"strict_mode\": {\n      \
        \    \"type\": \"boolean\",\n          \"default\": false,\n          \"description\": \"Enable strict validation
        mode with enhanced checking\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ValidateAbmlResponse\"\
        ,\n  \"$defs\": {\n    \"ValidateAbmlResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        is_valid\"\n      ],\n      \"properties\": {\n        \"is_valid\": {\n          \"type\": \"boolean\",\n       \
        \   \"description\": \"Whether the ABML definition is valid\"\n        },\n        \"validation_errors\": {\n    \
        \      \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/ValidationError\"\n         \
        \ },\n          \"description\": \"List of validation errors if invalid\"\n        },\n        \"semantic_warnings\"\
        : {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          },\n    \
        \      \"description\": \"Semantic warnings that don't prevent compilation\"\n        },\n        \"schema_version\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"ABML schema version used for validation\"\n   \
        \     }\n      }\n    },\n    \"ValidationError\": {\n      \"type\": \"object\",\n      \"required\": [\n       \
        \ \"type\",\n        \"message\"\n      ],\n      \"properties\": {\n        \"type\": {\n          \"type\": \"string\"\
        ,\n          \"enum\": [\n            \"syntax\",\n            \"semantic\",\n            \"schema\",\n          \
        \  \"context\",\n            \"service_dependency\"\n          ],\n          \"description\": \"Type of validation
        error\"\n        },\n        \"message\": {\n          \"type\": \"string\",\n          \"description\": \"Human-readable
        error message\"\n        },\n        \"line_number\": {\n          \"type\": \"integer\",\n          \"description\"\
        : \"Line number where the error occurred (if applicable)\"\n        },\n        \"column_number\": {\n          \"\
        type\": \"integer\",\n          \"description\": \"Column number where the error occurred (if applicable)\"\n    \
        \    },\n        \"yaml_path\": {\n          \"type\": \"string\",\n          \"description\": \"YAML path to the
        problematic element\",\n          \"example\": \"behaviors.morning_startup.actions[0]\"\n        }\n      }\n    }\n\
        \  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Validate ABML definition\",\n  \"description\": \"Validates ABML YAML against
        schema and checks for semantic correctness.\\nIncludes context variable validation and service dependency checking.\\\
        n\",\n  \"tags\": [\n    \"Validation\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"ValidateAbml\"\n}"
  /cache/get:
    post:
      summary: Get cached compiled behavior
      description: |
        Retrieves a previously compiled behavior from the cache.
        Used for performance optimization in high-frequency behavior execution.
      operationId: GetCachedBehavior
      tags:
      - Cache
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCachedBehaviorRequest'
      responses:
        '200':
          description: Cached behavior retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CachedBehaviorResponse'
        '404':
          description: Behavior not found in cache
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GetCachedBehaviorRequest\"\
        ,\n  \"$defs\": {\n    \"GetCachedBehaviorRequest\": {\n      \"type\": \"object\",\n      \"description\": \"Request
        to get a cached compiled behavior\",\n      \"required\": [\n        \"behaviorId\"\n      ],\n      \"properties\"\
        : {\n        \"behaviorId\": {\n          \"type\": \"string\",\n          \"description\": \"Unique identifier for
        the cached behavior\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CachedBehaviorResponse\"\
        ,\n  \"$defs\": {\n    \"CachedBehaviorResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n       \
        \ \"behavior_id\",\n        \"compiled_behavior\"\n      ],\n      \"properties\": {\n        \"behavior_id\": {\n\
        \          \"type\": \"string\",\n          \"description\": \"Unique identifier for the cached behavior\"\n     \
        \   },\n        \"compiled_behavior\": {\n          \"$ref\": \"#/$defs/CompiledBehavior\"\n        },\n        \"\
        cache_timestamp\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\"\
        : \"When the behavior was cached\"\n        },\n        \"cache_hit\": {\n          \"type\": \"boolean\",\n     \
        \     \"description\": \"Whether this was a cache hit or miss\"\n        }\n      }\n    },\n    \"CompiledBehavior\"\
        : {\n      \"type\": \"object\",\n      \"required\": [\n        \"behavior_tree\",\n        \"context_schema\"\n\
        \      ],\n      \"properties\": {\n        \"behavior_tree\": {\n          \"type\": \"object\",\n          \"description\"\
        : \"Compiled executable behavior tree structure\"\n        },\n        \"context_schema\": {\n          \"type\":
        \"object\",\n          \"description\": \"Schema defining required context variables\"\n        },\n        \"service_dependencies\"\
        : {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          },\n    \
        \      \"description\": \"List of required services for this behavior\"\n        },\n        \"goap_goals\": {\n \
        \         \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/GoapGoal\"\n          },\n\
        \          \"description\": \"GOAP goals extracted from the behavior\"\n        },\n        \"execution_metadata\"\
        : {\n          \"type\": \"object\",\n          \"properties\": {\n            \"estimated_duration\": {\n       \
        \       \"type\": \"integer\",\n              \"description\": \"Estimated execution time in seconds\"\n         \
        \   },\n            \"resource_requirements\": {\n              \"type\": \"object\",\n              \"additionalProperties\"\
        : {\n                \"type\": \"number\"\n              }\n            },\n            \"interrupt_conditions\":
        {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n        \
        \      }\n            }\n          }\n        }\n      }\n    },\n    \"GoapGoal\": {\n      \"type\": \"object\"\
        ,\n      \"required\": [\n        \"name\",\n        \"conditions\",\n        \"priority\"\n      ],\n      \"properties\"\
        : {\n        \"name\": {\n          \"type\": \"string\",\n          \"description\": \"Name of the goal\",\n    \
        \      \"example\": \"satisfy_hunger\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n\
        \          \"description\": \"Human-readable description of the goal\"\n        },\n        \"conditions\": {\n  \
        \        \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n        \
        \  },\n          \"description\": \"World state conditions that satisfy this goal (literal conditions)\",\n      \
        \    \"example\": {\n            \"hunger\": \"<= 0.3\",\n            \"gold\": \">= 50\"\n          }\n        },\n\
        \        \"priority\": {\n          \"type\": \"integer\",\n          \"minimum\": 1,\n          \"maximum\": 100,\n\
        \          \"description\": \"Priority of this goal relative to others\"\n        },\n        \"preconditions\": {\n\
        \          \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n      \
        \    },\n          \"description\": \"World state conditions required to pursue this goal\"\n        }\n      }\n\
        \    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get cached compiled behavior\",\n  \"description\": \"Retrieves a previously
        compiled behavior from the cache.\\nUsed for performance optimization in high-frequency behavior execution.\\n\",\n\
        \  \"tags\": [\n    \"Cache\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"GetCachedBehavior\"\n}"
  /cache/invalidate:
    post:
      summary: Invalidate cached behavior
      description: |
        Removes a behavior from the cache, forcing recompilation on next access.
        Used when behavior definitions are updated.
      operationId: InvalidateCachedBehavior
      tags:
      - Cache
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvalidateCacheRequest'
      responses:
        '200':
          description: Cache invalidated successfully
        '404':
          description: Behavior not found in cache

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/InvalidateCacheRequest\"\
        ,\n  \"$defs\": {\n    \"InvalidateCacheRequest\": {\n      \"type\": \"object\",\n      \"description\": \"Request
        to invalidate a cached behavior\",\n      \"required\": [\n        \"behaviorId\"\n      ],\n      \"properties\"\
        : {\n        \"behaviorId\": {\n          \"type\": \"string\",\n          \"description\": \"Unique identifier for
        the cached behavior to invalidate\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n  \"summary\": \"Invalidate cached behavior\",\n  \"description\": \"Removes a behavior from
        the cache, forcing recompilation on next access.\\nUsed when behavior definitions are updated.\\n\",\n  \"tags\":
        [\n    \"Cache\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"InvalidateCachedBehavior\"\n}"
  /context/resolve:
    post:
      summary: Resolve context variables
      description: |
        Resolves context variables in ABML definitions against character and world state.
        Used for dynamic behavior adaptation based on current game state.
      operationId: ResolveContextVariables
      tags:
      - Context
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResolveContextRequest'
      responses:
        '200':
          description: Context variables resolved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResolveContextResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ResolveContextRequest\"\
        ,\n  \"$defs\": {\n    \"ResolveContextRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        context_expression\",\n        \"character_context\"\n      ],\n      \"properties\": {\n        \"context_expression\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"Context variable expression to resolve\",\n   \
        \       \"example\": \"${npc.stats.energy > 0.5 && world.time.hour < 18}\"\n        },\n        \"character_context\"\
        : {\n          \"$ref\": \"#/$defs/CharacterContext\"\n        }\n      }\n    },\n    \"CharacterContext\": {\n \
        \     \"type\": \"object\",\n      \"properties\": {\n        \"npc_id\": {\n          \"type\": \"string\",\n   \
        \       \"description\": \"Unique identifier for the NPC\",\n          \"example\": \"npc_12345\"\n        },\n  \
        \      \"culture\": {\n          \"type\": \"string\",\n          \"description\": \"Cultural background identifier\"\
        ,\n          \"example\": \"european_medieval\"\n        },\n        \"profession\": {\n          \"type\": \"string\"\
        ,\n          \"description\": \"Character profession identifier\",\n          \"example\": \"blacksmith\"\n      \
        \  },\n        \"stats\": {\n          \"type\": \"object\",\n          \"additionalProperties\": {\n            \"\
        type\": \"number\"\n          },\n          \"description\": \"Character statistics and attributes\",\n          \"\
        example\": {\n            \"energy\": 0.8,\n            \"health\": 1.0,\n            \"hunger\": 0.3\n          }\n\
        \        },\n        \"skills\": {\n          \"type\": \"object\",\n          \"additionalProperties\": {\n     \
        \       \"type\": \"number\"\n          },\n          \"description\": \"Character skill levels\",\n          \"example\"\
        : {\n            \"blacksmithing\": 85,\n            \"trading\": 42\n          }\n        },\n        \"location\"\
        : {\n          \"type\": \"object\",\n          \"properties\": {\n            \"current\": {\n              \"type\"\
        : \"string\"\n            },\n            \"region\": {\n              \"type\": \"string\"\n            },\n    \
        \        \"coordinates\": {\n              \"type\": \"object\",\n              \"properties\": {\n              \
        \  \"x\": {\n                  \"type\": \"number\"\n                },\n                \"y\": {\n              \
        \    \"type\": \"number\"\n                },\n                \"z\": {\n                  \"type\": \"number\"\n\
        \                }\n              }\n            }\n          }\n        },\n        \"relationships\": {\n      \
        \    \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"number\"\n          },\n\
        \          \"description\": \"Relationship values with other characters\"\n        },\n        \"world_state\": {\n\
        \          \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"description\": \"Relevant
        world state information\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ResolveContextResponse\"\
        ,\n  \"$defs\": {\n    \"ResolveContextResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n       \
        \ \"resolved_value\"\n      ],\n      \"properties\": {\n        \"resolved_value\": {\n          \"description\"\
        : \"The resolved value of the context expression\"\n        },\n        \"resolved_type\": {\n          \"type\":
        \"string\",\n          \"enum\": [\n            \"boolean\",\n            \"string\",\n            \"number\",\n \
        \           \"object\",\n            \"array\"\n          ],\n          \"description\": \"Type of the resolved value\"\
        \n        },\n        \"context_variables_used\": {\n          \"type\": \"array\",\n          \"items\": {\n    \
        \        \"type\": \"string\"\n          },\n          \"description\": \"List of context variables referenced in
        the expression\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Resolve context variables\",\n  \"description\": \"Resolves context variables
        in ABML definitions against character and world state.\\nUsed for dynamic behavior adaptation based on current game
        state.\\n\",\n  \"tags\": [\n    \"Context\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"ResolveContextVariables\"\
        \n}"
  /goap/plan:
    post:
      summary: Generate GOAP plan
      description: |
        Generates a GOAP plan to achieve a goal from the current world state.
        Uses A* search to find the optimal sequence of actions.
      operationId: GenerateGoapPlan
      tags:
      - GOAP
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoapPlanRequest'
      responses:
        '200':
          description: Plan generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoapPlanResponse'
        '400':
          description: Invalid request or planning failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GoapPlanRequest\"\
        ,\n  \"$defs\": {\n    \"GoapPlanRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"goal\"\
        ,\n        \"world_state\",\n        \"behavior_id\"\n      ],\n      \"properties\": {\n        \"agent_id\": {\n\
        \          \"type\": \"string\",\n          \"description\": \"Unique identifier for the agent requesting the plan\"\
        \n        },\n        \"goal\": {\n          \"$ref\": \"#/$defs/GoapGoal\"\n        },\n        \"world_state\":
        {\n          \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"description\": \"Current
        world state as key-value pairs\",\n          \"example\": {\n            \"hunger\": 0.8,\n            \"gold\": 50,\n\
        \            \"location\": \"home\"\n          }\n        },\n        \"behavior_id\": {\n          \"type\": \"string\"\
        ,\n          \"description\": \"ID of compiled behavior containing GOAP actions\"\n        },\n        \"options\"\
        : {\n          \"$ref\": \"#/$defs/GoapPlanningOptions\"\n        }\n      }\n    },\n    \"GoapGoal\": {\n      \"\
        type\": \"object\",\n      \"required\": [\n        \"name\",\n        \"conditions\",\n        \"priority\"\n   \
        \   ],\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"description\":
        \"Name of the goal\",\n          \"example\": \"satisfy_hunger\"\n        },\n        \"description\": {\n       \
        \   \"type\": \"string\",\n          \"description\": \"Human-readable description of the goal\"\n        },\n   \
        \     \"conditions\": {\n          \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\"\
        : \"string\"\n          },\n          \"description\": \"World state conditions that satisfy this goal (literal conditions)\"\
        ,\n          \"example\": {\n            \"hunger\": \"<= 0.3\",\n            \"gold\": \">= 50\"\n          }\n \
        \       },\n        \"priority\": {\n          \"type\": \"integer\",\n          \"minimum\": 1,\n          \"maximum\"\
        : 100,\n          \"description\": \"Priority of this goal relative to others\"\n        },\n        \"preconditions\"\
        : {\n          \"type\": \"object\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n  \
        \        },\n          \"description\": \"World state conditions required to pursue this goal\"\n        }\n     \
        \ }\n    },\n    \"GoapPlanningOptions\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"max_depth\"\
        : {\n          \"type\": \"integer\",\n          \"default\": 10,\n          \"description\": \"Maximum plan depth
        (number of actions)\"\n        },\n        \"max_nodes\": {\n          \"type\": \"integer\",\n          \"default\"\
        : 1000,\n          \"description\": \"Maximum nodes to expand during search\"\n        },\n        \"timeout_ms\"\
        : {\n          \"type\": \"integer\",\n          \"default\": 100,\n          \"description\": \"Planning timeout
        in milliseconds\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GoapPlanResponse\"\
        ,\n  \"$defs\": {\n    \"GoapPlanResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"success\"\
        \n      ],\n      \"properties\": {\n        \"success\": {\n          \"type\": \"boolean\",\n          \"description\"\
        : \"Whether planning was successful\"\n        },\n        \"plan\": {\n          \"$ref\": \"#/$defs/GoapPlanResult\"\
        \n        },\n        \"planning_time_ms\": {\n          \"type\": \"integer\",\n          \"description\": \"Time
        spent planning in milliseconds\"\n        },\n        \"nodes_expanded\": {\n          \"type\": \"integer\",\n  \
        \        \"description\": \"Number of nodes expanded during A* search\"\n        },\n        \"failure_reason\": {\n\
        \          \"type\": \"string\",\n          \"description\": \"Reason for planning failure if unsuccessful\",\n  \
        \        \"example\": \"No plan found - goal unreachable\"\n        }\n      }\n    },\n    \"GoapPlanResult\": {\n\
        \      \"type\": \"object\",\n      \"required\": [\n        \"goal_id\",\n        \"actions\",\n        \"total_cost\"\
        \n      ],\n      \"properties\": {\n        \"goal_id\": {\n          \"type\": \"string\",\n          \"description\"\
        : \"ID of the goal this plan achieves\"\n        },\n        \"actions\": {\n          \"type\": \"array\",\n    \
        \      \"items\": {\n            \"$ref\": \"#/$defs/PlannedActionResponse\"\n          },\n          \"description\"\
        : \"Ordered sequence of actions to execute\"\n        },\n        \"total_cost\": {\n          \"type\": \"number\"\
        ,\n          \"format\": \"float\",\n          \"description\": \"Total cost of all actions in the plan\"\n      \
        \  }\n      }\n    },\n    \"PlannedActionResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n    \
        \    \"action_id\",\n        \"index\",\n        \"cost\"\n      ],\n      \"properties\": {\n        \"action_id\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"ID of the action (flow name)\"\n        },\n  \
        \      \"index\": {\n          \"type\": \"integer\",\n          \"description\": \"Position in the plan sequence\"\
        \n        },\n        \"cost\": {\n          \"type\": \"number\",\n          \"format\": \"float\",\n          \"\
        description\": \"Cost of this action\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Generate GOAP plan\",\n  \"description\": \"Generates a GOAP plan to achieve
        a goal from the current world state.\\nUses A* search to find the optimal sequence of actions.\\n\",\n  \"tags\":
        [\n    \"GOAP\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"GenerateGoapPlan\"\n}"
  /goap/validate-plan:
    post:
      summary: Validate existing GOAP plan
      description: |
        Validates an existing GOAP plan against the current world state.
        Returns whether the plan is still valid or needs replanning.
      operationId: ValidateGoapPlan
      tags:
      - GOAP
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateGoapPlanRequest'
      responses:
        '200':
          description: Plan validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateGoapPlanResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ValidateGoapPlanRequest\"\
        ,\n  \"$defs\": {\n    \"ValidateGoapPlanRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n      \
        \  \"plan\",\n        \"current_action_index\",\n        \"world_state\"\n      ],\n      \"properties\": {\n    \
        \    \"plan\": {\n          \"$ref\": \"#/$defs/GoapPlanResult\"\n        },\n        \"current_action_index\": {\n\
        \          \"type\": \"integer\",\n          \"description\": \"Index of the action currently being executed\"\n \
        \       },\n        \"world_state\": {\n          \"type\": \"object\",\n          \"additionalProperties\": true,\n\
        \          \"description\": \"Current world state\"\n        },\n        \"active_goals\": {\n          \"type\":
        \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/GoapGoal\"\n          },\n          \"description\"\
        : \"All active goals for priority checking\"\n        }\n      }\n    },\n    \"GoapPlanResult\": {\n      \"type\"\
        : \"object\",\n      \"required\": [\n        \"goal_id\",\n        \"actions\",\n        \"total_cost\"\n      ],\n\
        \      \"properties\": {\n        \"goal_id\": {\n          \"type\": \"string\",\n          \"description\": \"ID
        of the goal this plan achieves\"\n        },\n        \"actions\": {\n          \"type\": \"array\",\n          \"\
        items\": {\n            \"$ref\": \"#/$defs/PlannedActionResponse\"\n          },\n          \"description\": \"Ordered
        sequence of actions to execute\"\n        },\n        \"total_cost\": {\n          \"type\": \"number\",\n       \
        \   \"format\": \"float\",\n          \"description\": \"Total cost of all actions in the plan\"\n        }\n    \
        \  }\n    },\n    \"PlannedActionResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"action_id\"\
        ,\n        \"index\",\n        \"cost\"\n      ],\n      \"properties\": {\n        \"action_id\": {\n          \"\
        type\": \"string\",\n          \"description\": \"ID of the action (flow name)\"\n        },\n        \"index\": {\n\
        \          \"type\": \"integer\",\n          \"description\": \"Position in the plan sequence\"\n        },\n    \
        \    \"cost\": {\n          \"type\": \"number\",\n          \"format\": \"float\",\n          \"description\": \"\
        Cost of this action\"\n        }\n      }\n    },\n    \"GoapGoal\": {\n      \"type\": \"object\",\n      \"required\"\
        : [\n        \"name\",\n        \"conditions\",\n        \"priority\"\n      ],\n      \"properties\": {\n       \
        \ \"name\": {\n          \"type\": \"string\",\n          \"description\": \"Name of the goal\",\n          \"example\"\
        : \"satisfy_hunger\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n          \"description\"\
        : \"Human-readable description of the goal\"\n        },\n        \"conditions\": {\n          \"type\": \"object\"\
        ,\n          \"additionalProperties\": {\n            \"type\": \"string\"\n          },\n          \"description\"\
        : \"World state conditions that satisfy this goal (literal conditions)\",\n          \"example\": {\n            \"\
        hunger\": \"<= 0.3\",\n            \"gold\": \">= 50\"\n          }\n        },\n        \"priority\": {\n       \
        \   \"type\": \"integer\",\n          \"minimum\": 1,\n          \"maximum\": 100,\n          \"description\": \"\
        Priority of this goal relative to others\"\n        },\n        \"preconditions\": {\n          \"type\": \"object\"\
        ,\n          \"additionalProperties\": {\n            \"type\": \"string\"\n          },\n          \"description\"\
        : \"World state conditions required to pursue this goal\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ValidateGoapPlanResponse\"\
        ,\n  \"$defs\": {\n    \"ValidateGoapPlanResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"is_valid\",\n        \"reason\",\n        \"suggested_action\"\n      ],\n      \"properties\": {\n        \"\
        is_valid\": {\n          \"type\": \"boolean\",\n          \"description\": \"Whether the plan is still valid\"\n\
        \        },\n        \"reason\": {\n          \"type\": \"string\",\n          \"enum\": [\n            \"none\",\n\
        \            \"precondition_invalidated\",\n            \"action_failed\",\n            \"better_goal_available\"\
        ,\n            \"plan_completed\",\n            \"goal_already_satisfied\",\n            \"suboptimal_plan\"\n   \
        \       ],\n          \"description\": \"Reason for the validation result\"\n        },\n        \"suggested_action\"\
        : {\n          \"type\": \"string\",\n          \"enum\": [\n            \"continue\",\n            \"replan\",\n\
        \            \"abort\"\n          ],\n          \"description\": \"Suggested action based on validation\"\n      \
        \  },\n        \"invalidated_at_index\": {\n          \"type\": \"integer\",\n          \"description\": \"Index where
        plan became invalid (if applicable)\"\n        },\n        \"message\": {\n          \"type\": \"string\",\n     \
        \     \"description\": \"Additional details about the validation result\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Validate existing GOAP plan\",\n  \"description\": \"Validates an existing
        GOAP plan against the current world state.\\nReturns whether the plan is still valid or needs replanning.\\n\",\n\
        \  \"tags\": [\n    \"GOAP\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"ValidateGoapPlan\"\n}"
components:
  schemas:
    # Request Models for POST-only pattern
    GetCachedBehaviorRequest:
      type: object
      description: Request to get a cached compiled behavior
      required:
      - behaviorId
      properties:
        behaviorId:
          type: string
          description: Unique identifier for the cached behavior

    InvalidateCacheRequest:
      type: object
      description: Request to invalidate a cached behavior
      required:
      - behaviorId
      properties:
        behaviorId:
          type: string
          description: Unique identifier for the cached behavior to invalidate

    CompileBehaviorRequest:
      type: object
      required:
      - abml_content
      properties:
        abml_content:
          type: string
          description: Raw ABML YAML content to compile
          example: |
            version: "1.0.0"
            metadata:
              id: "example_behavior"
              category: "basic"
            behaviors:
              example:
                triggers:
                  - condition: "true"
                actions:
                  - log:
                      message: "Hello World"
        character_context:
          $ref: '#/components/schemas/CharacterContext'
        compilation_options:
          $ref: '#/components/schemas/CompilationOptions'

    BehaviorStackRequest:
      type: object
      required:
      - behavior_sets
      properties:
        behavior_sets:
          type: array
          items:
            $ref: '#/components/schemas/BehaviorSetDefinition'
          description: Array of behavior sets to compile together
        character_context:
          $ref: '#/components/schemas/CharacterContext'
        compilation_options:
          $ref: '#/components/schemas/CompilationOptions'

    ValidateAbmlRequest:
      type: object
      required:
      - abml_content
      properties:
        abml_content:
          type: string
          description: Raw ABML YAML content to validate
        strict_mode:
          type: boolean
          default: false
          description: Enable strict validation mode with enhanced checking

    ResolveContextRequest:
      type: object
      required:
      - context_expression
      - character_context
      properties:
        context_expression:
          type: string
          description: Context variable expression to resolve
          example: "${npc.stats.energy > 0.5 && world.time.hour < 18}"
        character_context:
          $ref: '#/components/schemas/CharacterContext'

    # Response Models
    CompileBehaviorResponse:
      type: object
      required:
      - success
      - behavior_id
      properties:
        success:
          type: boolean
          description: Whether compilation was successful
        behavior_id:
          type: string
          description: Unique identifier for the compiled behavior
          example: "behavior_abc123"
        compiled_behavior:
          $ref: '#/components/schemas/CompiledBehavior'
        compilation_time_ms:
          type: integer
          description: Time taken to compile the behavior
        cache_key:
          type: string
          description: Key for caching the compiled behavior
        warnings:
          type: array
          items:
            type: string
          description: Non-fatal warnings during compilation

    ValidateAbmlResponse:
      type: object
      required:
      - is_valid
      properties:
        is_valid:
          type: boolean
          description: Whether the ABML definition is valid
        validation_errors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
          description: List of validation errors if invalid
        semantic_warnings:
          type: array
          items:
            type: string
          description: Semantic warnings that don't prevent compilation
        schema_version:
          type: string
          description: ABML schema version used for validation

    CachedBehaviorResponse:
      type: object
      required:
      - behavior_id
      - compiled_behavior
      properties:
        behavior_id:
          type: string
          description: Unique identifier for the cached behavior
        compiled_behavior:
          $ref: '#/components/schemas/CompiledBehavior'
        cache_timestamp:
          type: string
          format: date-time
          description: When the behavior was cached
        cache_hit:
          type: boolean
          description: Whether this was a cache hit or miss

    ResolveContextResponse:
      type: object
      required:
      - resolved_value
      properties:
        resolved_value:
          description: The resolved value of the context expression
        resolved_type:
          type: string
          enum: [boolean, string, number, object, array]
          description: Type of the resolved value
        context_variables_used:
          type: array
          items:
            type: string
          description: List of context variables referenced in the expression

    # Core Data Models
    BehaviorSetDefinition:
      type: object
      required:
      - id
      - priority
      - abml_content
      properties:
        id:
          type: string
          description: Unique identifier for the behavior set
          example: "base_humanoid"
        priority:
          type: integer
          minimum: 1
          maximum: 100
          description: Priority level for merging (higher priority overrides lower)
          example: 50
        category:
          type: string
          description: Category of the behavior set
          enum: [base, cultural, professional, personal, situational]
        abml_content:
          type: string
          description: Raw ABML YAML content for this behavior set
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata for the behavior set

    CharacterContext:
      type: object
      properties:
        npc_id:
          type: string
          description: Unique identifier for the NPC
          example: "npc_12345"
        culture:
          type: string
          description: Cultural background identifier
          example: "european_medieval"
        profession:
          type: string
          description: Character profession identifier
          example: "blacksmith"
        stats:
          type: object
          additionalProperties:
            type: number
          description: Character statistics and attributes
          example:
            energy: 0.8
            health: 1.0
            hunger: 0.3
        skills:
          type: object
          additionalProperties:
            type: number
          description: Character skill levels
          example:
            blacksmithing: 85
            trading: 42
        location:
          type: object
          properties:
            current:
              type: string
            region:
              type: string
            coordinates:
              type: object
              properties:
                x: {type: number}
                y: {type: number}
                z: {type: number}
        relationships:
          type: object
          additionalProperties:
            type: number
          description: Relationship values with other characters
        world_state:
          type: object
          additionalProperties: true
          description: Relevant world state information

    CompiledBehavior:
      type: object
      required:
      - behavior_tree
      - context_schema
      properties:
        behavior_tree:
          type: object
          description: Compiled executable behavior tree structure
        context_schema:
          type: object
          description: Schema defining required context variables
        service_dependencies:
          type: array
          items:
            type: string
          description: List of required services for this behavior
        goap_goals:
          type: array
          items:
            $ref: '#/components/schemas/GoapGoal'
          description: GOAP goals extracted from the behavior
        execution_metadata:
          type: object
          properties:
            estimated_duration:
              type: integer
              description: Estimated execution time in seconds
            resource_requirements:
              type: object
              additionalProperties:
                type: number
            interrupt_conditions:
              type: array
              items:
                type: string

    GoapGoal:
      type: object
      required:
      - name
      - conditions
      - priority
      properties:
        name:
          type: string
          description: Name of the goal
          example: "satisfy_hunger"
        description:
          type: string
          description: Human-readable description of the goal
        conditions:
          type: object
          additionalProperties:
            type: string
          description: World state conditions that satisfy this goal (literal conditions)
          example:
            hunger: "<= 0.3"
            gold: ">= 50"
        priority:
          type: integer
          minimum: 1
          maximum: 100
          description: Priority of this goal relative to others
        preconditions:
          type: object
          additionalProperties:
            type: string
          description: World state conditions required to pursue this goal

    GoapPlanRequest:
      type: object
      required:
      - goal
      - world_state
      - behavior_id
      properties:
        agent_id:
          type: string
          description: Unique identifier for the agent requesting the plan
        goal:
          $ref: '#/components/schemas/GoapGoal'
        world_state:
          type: object
          additionalProperties: true
          description: Current world state as key-value pairs
          example:
            hunger: 0.8
            gold: 50
            location: "home"
        behavior_id:
          type: string
          description: ID of compiled behavior containing GOAP actions
        options:
          $ref: '#/components/schemas/GoapPlanningOptions'

    GoapPlanResponse:
      type: object
      required:
      - success
      properties:
        success:
          type: boolean
          description: Whether planning was successful
        plan:
          $ref: '#/components/schemas/GoapPlanResult'
        planning_time_ms:
          type: integer
          description: Time spent planning in milliseconds
        nodes_expanded:
          type: integer
          description: Number of nodes expanded during A* search
        failure_reason:
          type: string
          description: Reason for planning failure if unsuccessful
          example: "No plan found - goal unreachable"

    GoapPlanResult:
      type: object
      required:
      - goal_id
      - actions
      - total_cost
      properties:
        goal_id:
          type: string
          description: ID of the goal this plan achieves
        actions:
          type: array
          items:
            $ref: '#/components/schemas/PlannedActionResponse'
          description: Ordered sequence of actions to execute
        total_cost:
          type: number
          format: float
          description: Total cost of all actions in the plan

    PlannedActionResponse:
      type: object
      required:
      - action_id
      - index
      - cost
      properties:
        action_id:
          type: string
          description: ID of the action (flow name)
        index:
          type: integer
          description: Position in the plan sequence
        cost:
          type: number
          format: float
          description: Cost of this action

    ValidateGoapPlanRequest:
      type: object
      required:
      - plan
      - current_action_index
      - world_state
      properties:
        plan:
          $ref: '#/components/schemas/GoapPlanResult'
        current_action_index:
          type: integer
          description: Index of the action currently being executed
        world_state:
          type: object
          additionalProperties: true
          description: Current world state
        active_goals:
          type: array
          items:
            $ref: '#/components/schemas/GoapGoal'
          description: All active goals for priority checking

    ValidateGoapPlanResponse:
      type: object
      required:
      - is_valid
      - reason
      - suggested_action
      properties:
        is_valid:
          type: boolean
          description: Whether the plan is still valid
        reason:
          type: string
          enum:
          - none
          - precondition_invalidated
          - action_failed
          - better_goal_available
          - plan_completed
          - goal_already_satisfied
          - suboptimal_plan
          description: Reason for the validation result
        suggested_action:
          type: string
          enum:
          - continue
          - replan
          - abort
          description: Suggested action based on validation
        invalidated_at_index:
          type: integer
          description: Index where plan became invalid (if applicable)
        message:
          type: string
          description: Additional details about the validation result

    GoapPlanningOptions:
      type: object
      properties:
        max_depth:
          type: integer
          default: 10
          description: Maximum plan depth (number of actions)
        max_nodes:
          type: integer
          default: 1000
          description: Maximum nodes to expand during search
        timeout_ms:
          type: integer
          default: 100
          description: Planning timeout in milliseconds

    CompilationOptions:
      type: object
      properties:
        enable_optimizations:
          type: boolean
          default: true
          description: Enable behavior tree optimizations
        cache_compiled_result:
          type: boolean
          default: true
          description: Cache the compiled behavior for reuse
        strict_validation:
          type: boolean
          default: false
          description: Enable strict validation mode
        cultural_adaptations:
          type: boolean
          default: true
          description: Apply cultural adaptations during compilation
        goap_integration:
          type: boolean
          default: true
          description: Generate GOAP goals from behaviors

    ValidationError:
      type: object
      required:
      - type
      - message
      properties:
        type:
          type: string
          enum: [syntax, semantic, schema, context, service_dependency]
          description: Type of validation error
        message:
          type: string
          description: Human-readable error message
        line_number:
          type: integer
          description: Line number where the error occurred (if applicable)
        column_number:
          type: integer
          description: Column number where the error occurred (if applicable)
        yaml_path:
          type: string
          description: YAML path to the problematic element
          example: "behaviors.morning_startup.actions[0]"

    # Error Response Model
    AbmlErrorResponse:
      type: object
      required:
      - error
      properties:
        error:
          type: string
          description: Error message
          example: "ABML compilation failed"
        error_code:
          type: string
          description: Specific error code for programmatic handling
          example: "ABML_SYNTAX_ERROR"
        details:
          type: array
          items:
            type: string
          description: Detailed error information
        validation_errors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
          description: Validation errors encountered
        yaml_line:
          type: integer
          description: Line number in YAML where error occurred
        context:
          type: object
          additionalProperties: true
          description: Additional context about the error
        timestamp:
          type: string
          format: date-time
          description: When the error occurred
        request_id:
          type: string
          description: Unique identifier for the failed request

tags:
- name: ABML
  description: Core ABML compilation and management operations
- name: BehaviorStacks
  description: Stackable behavior set compilation and merging
- name: Validation
  description: ABML validation and semantic checking
- name: Cache
  description: Behavior compilation caching operations
- name: Context
  description: Context variable resolution and management
- name: GOAP
  description: Goal-Oriented Action Planning for NPC behavior

