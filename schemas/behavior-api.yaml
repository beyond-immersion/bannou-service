openapi: 3.0.0
info:
  title: ABML Behavior Management API
  version: 3.0.0
  description: |
    Arcadia Behavior Markup Language (ABML) API for character behavior management.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    This API handles:
    - YAML-based behavior definition parsing and compilation
    - Stackable behavior set management with priority resolution
    - GOAP (Goal-Oriented Action Planning) integration
    - Cultural adaptation and context-aware behavior modification
    - Real-time behavior state management and caching
    - Integration with Bannou mesh for distributed character agents

servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)

paths:
  /compile:
    post:
      summary: Compile ABML behavior definition
      description: |
        Compiles a YAML-based ABML behavior definition into executable behavior trees.
        Handles stackable behavior sets, cultural adaptations, and context variable resolution.
      operationId: CompileAbmlBehavior
      tags:
      - ABML
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/yaml:
            schema:
              type: string
              description: Raw ABML YAML content
            example: |
              version: "1.0.0"
              metadata:
                id: "blacksmith_daily_routine"
                category: "profession"
                priority: 60
                description: "Daily routine for a master blacksmith NPC"

              context:
                variables:
                  energy_level: "${npc.stats.energy}"
                  skill_level: "${npc.skills.blacksmithing}"
                  shop_reputation: "${npc.reputation.local}"

                services:
                  - name: "crafting_service"
                    required: true
                  - name: "economy_service"
                    required: true

              behaviors:
                morning_startup:
                  triggers:
                    - time_range: "06:00-09:00"
                    - condition: "${context.energy_level > 0.7}"
                  actions:
                    - wake_up:
                        animation: "stretch_and_yawn"
                        duration: 3
                        energy_cost: -0.05
          application/json:
            schema:
              $ref: '#/components/schemas/CompileBehaviorRequest'
      responses:
        '200':
          description: ABML behavior compiled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompileBehaviorResponse'
        '400':
          description: Invalid ABML definition or compilation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CompileBehaviorRequest\"\
        ,\n    \"$defs\": {\n        \"CompileBehaviorRequest\": {\n            \"description\": \"Request to compile an ABML
        behavior definition into executable behavior trees\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"abmlContent\"\n            ],\n            \"properties\"\
        : {\n                \"abmlContent\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Raw ABML YAML content to compile\",\n                    \"example\": \"version: \\\"1.0.0\\\"\\nmetadata:\\n\
        \  id: \\\"example_behavior\\\"\\n  category: \\\"basic\\\"\\nbehaviors:\\n  example:\\n    triggers:\\n      - condition:
        \\\"true\\\"\\n    actions:\\n      - log:\\n          message: \\\"Hello World\\\"\\n\"\n                },\n   \
        \             \"behaviorName\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Optional human-readable name for the behavior.\\nIf not provided, extracted from ABML metadata.id or generated
        from content hash.\\n\",\n                    \"example\": \"blacksmith_daily_routine\"\n                },\n    \
        \            \"behaviorCategory\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Category for organizing behaviors (e.g., profession, cultural, situational).\\nUsed for filtering and grouping
        in bundles.\\n\",\n                    \"enum\": [\n                        \"base\",\n                        \"\
        cultural\",\n                        \"professional\",\n                        \"personal\",\n                  \
        \      \"situational\",\n                        \"ambient\"\n                    ],\n                    \"example\"\
        : \"professional\"\n                },\n                \"bundleId\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Optional bundle identifier for grouping related behaviors.\\nWhen specified,
        the compiled behavior will be added to a bundle with this ID.\\nClients can then download entire bundles for efficient
        bulk loading.\\nIf the bundle doesn't exist, it will be created.\\n\",\n                    \"example\": \"blacksmith-behaviors-v1\"\
        \n                },\n                \"characterContext\": {\n                    \"$ref\": \"#/$defs/CharacterContext\"\
        ,\n                    \"description\": \"Character context for context variable resolution during compilation\"\n\
        \                },\n                \"compilationOptions\": {\n                    \"$ref\": \"#/$defs/CompilationOptions\"\
        ,\n                    \"description\": \"Options controlling the compilation process\"\n                }\n     \
        \       }\n        },\n        \"CharacterContext\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Context information about a character for behavior resolution\",\n      \
        \      \"properties\": {\n                \"npcId\": {\n                    \"type\": \"string\",\n              \
        \      \"description\": \"Unique identifier for the NPC\",\n                    \"example\": \"npc_12345\"\n     \
        \           },\n                \"culture\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Cultural background identifier\",\n                    \"example\": \"european_medieval\"\n     \
        \           },\n                \"profession\": {\n                    \"type\": \"string\",\n                   \
        \ \"description\": \"Character profession identifier\",\n                    \"example\": \"blacksmith\"\n       \
        \         },\n                \"stats\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"number\"\n                    },\n                    \"description\": \"\
        Character statistics and attributes\",\n                    \"example\": {\n                        \"energy\": 0.8,\n\
        \                        \"health\": 1.0,\n                        \"hunger\": 0.3\n                    }\n      \
        \          },\n                \"skills\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"number\"\n                    },\n                    \"description\": \"\
        Character skill levels\",\n                    \"example\": {\n                        \"blacksmithing\": 85,\n  \
        \                      \"trading\": 42\n                    }\n                },\n                \"location\": {\n\
        \                    \"$ref\": \"#/$defs/Location\",\n                    \"description\": \"Current location information
        for the character\"\n                },\n                \"relationships\": {\n                    \"type\": \"object\"\
        ,\n                    \"additionalProperties\": {\n                        \"type\": \"number\"\n               \
        \     },\n                    \"description\": \"Relationship values with other characters\"\n                },\n\
        \                \"worldState\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Relevant world state information\"\n                }\n          \
        \  }\n        },\n        \"Location\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Character location information including current position, region, and 3D
        coordinates\",\n            \"properties\": {\n                \"current\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Current location name or identifier\"\n                },\n            \
        \    \"region\": {\n                    \"type\": \"string\",\n                    \"description\": \"Region or zone
        the character is in\"\n                },\n                \"coordinates\": {\n                    \"$ref\": \"#/$defs/Coordinates\"\
        ,\n                    \"description\": \"3D spatial coordinates of the character's position in the game world\"\n\
        \                }\n            }\n        },\n        \"Coordinates\": {\n            \"type\": \"object\",\n   \
        \         \"additionalProperties\": false,\n            \"description\": \"3D spatial coordinates representing a position
        in the game world\",\n            \"properties\": {\n                \"x\": {\n                    \"type\": \"number\"\
        ,\n                    \"description\": \"X coordinate position\"\n                },\n                \"y\": {\n\
        \                    \"type\": \"number\",\n                    \"description\": \"Y coordinate position\"\n     \
        \           },\n                \"z\": {\n                    \"type\": \"number\",\n                    \"description\"\
        : \"Z coordinate position\"\n                }\n            }\n        },\n        \"CompilationOptions\": {\n   \
        \         \"description\": \"Options controlling the ABML compilation process including optimizations and caching\"\
        ,\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"properties\": {\n\
        \                \"enableOptimizations\": {\n                    \"type\": \"boolean\",\n                    \"default\"\
        : true,\n                    \"description\": \"Enable behavior tree optimizations\"\n                },\n       \
        \         \"cacheCompiledResult\": {\n                    \"type\": \"boolean\",\n                    \"default\"\
        : true,\n                    \"description\": \"Cache the compiled behavior for reuse\"\n                },\n    \
        \            \"strictValidation\": {\n                    \"type\": \"boolean\",\n                    \"default\"\
        : false,\n                    \"description\": \"Enable strict validation mode\"\n                },\n           \
        \     \"culturalAdaptations\": {\n                    \"type\": \"boolean\",\n                    \"default\": true,\n\
        \                    \"description\": \"Apply cultural adaptations during compilation\"\n                },\n    \
        \            \"goapIntegration\": {\n                    \"type\": \"boolean\",\n                    \"default\":
        true,\n                    \"description\": \"Generate GOAP goals from behaviors\"\n                }\n          \
        \  }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CompileBehaviorResponse\"\
        ,\n    \"$defs\": {\n        \"CompileBehaviorResponse\": {\n            \"description\": \"Response containing the
        results of an ABML behavior compilation\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\",\n                \"behaviorId\"\n            ],\n\
        \            \"properties\": {\n                \"success\": {\n                    \"type\": \"boolean\",\n     \
        \               \"description\": \"Whether compilation was successful\"\n                },\n                \"behaviorId\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Unique identifier for the compiled
        behavior (content-addressable hash)\",\n                    \"example\": \"behavior-a1b2c3d4e5f6g7h8\"\n         \
        \       },\n                \"behaviorName\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Human-readable name of the behavior\",\n                    \"example\": \"blacksmith_daily_routine\"\
        \n                },\n                \"compiledBehavior\": {\n                    \"$ref\": \"#/$defs/CompiledBehavior\"\
        ,\n                    \"description\": \"The compiled behavior data including behavior tree and metadata\"\n    \
        \            },\n                \"compilationTimeMs\": {\n                    \"type\": \"integer\",\n          \
        \          \"description\": \"Time taken to compile the behavior in milliseconds\"\n                },\n         \
        \       \"assetId\": {\n                    \"type\": \"string\",\n                    \"description\": \"Asset service
        ID where the compiled bytecode is stored\"\n                },\n                \"bundleId\": {\n                \
        \    \"type\": \"string\",\n                    \"description\": \"Bundle ID if the behavior was added to a bundle\"\
        \n                },\n                \"isUpdate\": {\n                    \"type\": \"boolean\",\n              \
        \      \"description\": \"True if this replaced an existing behavior with the same content hash\"\n              \
        \  },\n                \"warnings\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"type\": \"string\"\n                    },\n                    \"description\": \"Non-fatal
        warnings during compilation\"\n                }\n            }\n        },\n        \"CompiledBehavior\": {\n   \
        \         \"description\": \"Compiled behavior containing behavior tree, context schema, and GOAP integration data\"\
        ,\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n\
        \                \"behaviorTree\",\n                \"contextSchema\"\n            ],\n            \"properties\"\
        : {\n                \"behaviorTree\": {\n                    \"$ref\": \"#/$defs/BehaviorTreeData\",\n          \
        \          \"description\": \"Compiled behavior tree data with bytecode or download reference\"\n                },\n\
        \                \"contextSchema\": {\n                    \"$ref\": \"#/$defs/ContextSchemaData\",\n            \
        \        \"description\": \"Schema defining required context variables for execution\"\n                },\n     \
        \           \"serviceDependencies\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"type\": \"string\"\n                    },\n                    \"description\": \"List
        of required services for this behavior\"\n                },\n                \"goapGoals\": {\n                 \
        \   \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/GoapGoal\"\
        \n                    },\n                    \"description\": \"GOAP goals extracted from the behavior\"\n      \
        \          },\n                \"executionMetadata\": {\n                    \"$ref\": \"#/$defs/ExecutionMetadata\"\
        ,\n                    \"description\": \"Metadata for behavior execution including performance hints and resource
        requirements\"\n                }\n            }\n        },\n        \"BehaviorTreeData\": {\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Compiled behavior tree
        data with bytecode or download reference\",\n            \"properties\": {\n                \"bytecode\": {\n    \
        \                \"type\": \"string\",\n                    \"description\": \"Base64-encoded compiled bytecode for
        the behavior tree\"\n                },\n                \"bytecodeSize\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Size of the bytecode in bytes\"\n                },\n                \"\
        downloadUrl\": {\n                    \"type\": \"string\",\n                    \"description\": \"URL to download
        the compiled behavior asset\"\n                }\n            }\n        },\n        \"ContextSchemaData\": {\n  \
        \          \"type\": \"object\",\n            \"description\": \"Schema defining required context variables for behavior
        execution\",\n            \"additionalProperties\": true\n        },\n        \"GoapGoal\": {\n            \"description\"\
        : \"Goal definition for GOAP planning with conditions and priority\",\n            \"type\": \"object\",\n       \
        \     \"additionalProperties\": false,\n            \"required\": [\n                \"name\",\n                \"\
        conditions\",\n                \"priority\"\n            ],\n            \"properties\": {\n                \"name\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Name of the goal\",\n     \
        \               \"example\": \"satisfy_hunger\"\n                },\n                \"description\": {\n        \
        \            \"type\": \"string\",\n                    \"description\": \"Human-readable description of the goal\"\
        \n                },\n                \"conditions\": {\n                    \"type\": \"object\",\n             \
        \       \"additionalProperties\": {\n                        \"type\": \"string\"\n                    },\n      \
        \              \"description\": \"World state conditions that satisfy this goal (literal conditions)\",\n        \
        \            \"example\": {\n                        \"hunger\": \"<= 0.3\",\n                        \"gold\": \"\
        >= 50\"\n                    }\n                },\n                \"priority\": {\n                    \"type\"\
        : \"integer\",\n                    \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"\
        description\": \"Priority of this goal relative to others\"\n                },\n                \"preconditions\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"description\": \"World state conditions
        required to pursue this goal\"\n                }\n            }\n        },\n        \"ExecutionMetadata\": {\n \
        \           \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Metadata
        about behavior execution requirements including timing, resources, and interrupt conditions\",\n            \"properties\"\
        : {\n                \"estimatedDuration\": {\n                    \"type\": \"integer\",\n                    \"\
        description\": \"Estimated execution time in seconds\"\n                },\n                \"resourceRequirements\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"number\"\n                    },\n                    \"description\": \"Resource requirements
        for behavior execution\"\n                },\n                \"interruptConditions\": {\n                    \"type\"\
        : \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                   \
        \ },\n                    \"description\": \"Conditions that can interrupt behavior execution\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Compile ABML behavior definition\",\n    \"description\": \"Compiles a
        YAML-based ABML behavior definition into executable behavior trees.\\nHandles stackable behavior sets, cultural adaptations,
        and context variable resolution.\\n\",\n    \"tags\": [\n        \"ABML\"\n    ],\n    \"deprecated\": false,\n  \
        \  \"operationId\": \"CompileAbmlBehavior\"\n}"
  /stack/compile:
    post:
      summary: Compile stackable behavior sets
      description: |
        Compiles multiple ABML behavior sets with priority-based merging.
        Handles cultural adaptations, profession specializations, and context resolution.
      operationId: CompileBehaviorStack
      tags:
      - BehaviorStacks
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BehaviorStackRequest'
      responses:
        '200':
          description: Behavior stack compiled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompileBehaviorResponse'
        '400':
          description: Invalid behavior stack or compilation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/BehaviorStackRequest\"\
        ,\n    \"$defs\": {\n        \"BehaviorStackRequest\": {\n            \"description\": \"Request to compile multiple
        stackable behavior sets with priority-based merging\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"behaviorSets\"\n            ],\n            \"properties\"\
        : {\n                \"behaviorSets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/BehaviorSetDefinition\"\n                    },\n               \
        \     \"description\": \"Array of behavior sets to compile together\"\n                },\n                \"characterContext\"\
        : {\n                    \"$ref\": \"#/$defs/CharacterContext\",\n                    \"description\": \"Character
        context for context variable resolution during compilation\"\n                },\n                \"compilationOptions\"\
        : {\n                    \"$ref\": \"#/$defs/CompilationOptions\",\n                    \"description\": \"Options
        controlling the compilation process\"\n                }\n            }\n        },\n        \"BehaviorSetDefinition\"\
        : {\n            \"description\": \"Definition of a behavior set with priority for stackable behavior merging\",\n\
        \            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n  \
        \              \"id\",\n                \"priority\",\n                \"abmlContent\"\n            ],\n         \
        \   \"properties\": {\n                \"id\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Unique identifier for the behavior set\",\n                    \"example\": \"base_humanoid\"\n \
        \               },\n                \"priority\": {\n                    \"type\": \"integer\",\n                \
        \    \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"description\": \"Priority level
        for merging (higher priority overrides lower)\",\n                    \"example\": 50\n                },\n      \
        \          \"category\": {\n                    \"type\": \"string\",\n                    \"description\": \"Category
        of the behavior set\",\n                    \"enum\": [\n                        \"base\",\n                     \
        \   \"cultural\",\n                        \"professional\",\n                        \"personal\",\n            \
        \            \"situational\"\n                    ]\n                },\n                \"abmlContent\": {\n    \
        \                \"type\": \"string\",\n                    \"description\": \"Raw ABML YAML content for this behavior
        set\"\n                },\n                \"metadata\": {\n                    \"type\": \"object\",\n          \
        \          \"additionalProperties\": true,\n                    \"description\": \"Additional metadata for the behavior
        set\"\n                }\n            }\n        },\n        \"CharacterContext\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Context information about a character
        for behavior resolution\",\n            \"properties\": {\n                \"npcId\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Unique identifier for the NPC\",\n                    \"example\"\
        : \"npc_12345\"\n                },\n                \"culture\": {\n                    \"type\": \"string\",\n \
        \                   \"description\": \"Cultural background identifier\",\n                    \"example\": \"european_medieval\"\
        \n                },\n                \"profession\": {\n                    \"type\": \"string\",\n             \
        \       \"description\": \"Character profession identifier\",\n                    \"example\": \"blacksmith\"\n \
        \               },\n                \"stats\": {\n                    \"type\": \"object\",\n                    \"\
        additionalProperties\": {\n                        \"type\": \"number\"\n                    },\n                \
        \    \"description\": \"Character statistics and attributes\",\n                    \"example\": {\n             \
        \           \"energy\": 0.8,\n                        \"health\": 1.0,\n                        \"hunger\": 0.3\n\
        \                    }\n                },\n                \"skills\": {\n                    \"type\": \"object\"\
        ,\n                    \"additionalProperties\": {\n                        \"type\": \"number\"\n               \
        \     },\n                    \"description\": \"Character skill levels\",\n                    \"example\": {\n \
        \                       \"blacksmithing\": 85,\n                        \"trading\": 42\n                    }\n \
        \               },\n                \"location\": {\n                    \"$ref\": \"#/$defs/Location\",\n       \
        \             \"description\": \"Current location information for the character\"\n                },\n          \
        \      \"relationships\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"number\"\n                    },\n                    \"description\": \"\
        Relationship values with other characters\"\n                },\n                \"worldState\": {\n             \
        \       \"type\": \"object\",\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Relevant world state information\"\n                }\n            }\n        },\n        \"Location\": {\n  \
        \          \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Character
        location information including current position, region, and 3D coordinates\",\n            \"properties\": {\n  \
        \              \"current\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Current location name or identifier\"\n                },\n                \"region\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Region or zone the character is in\"\n                },\n \
        \               \"coordinates\": {\n                    \"$ref\": \"#/$defs/Coordinates\",\n                    \"\
        description\": \"3D spatial coordinates of the character's position in the game world\"\n                }\n     \
        \       }\n        },\n        \"Coordinates\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"3D spatial coordinates representing a position in the game world\",\n   \
        \         \"properties\": {\n                \"x\": {\n                    \"type\": \"number\",\n               \
        \     \"description\": \"X coordinate position\"\n                },\n                \"y\": {\n                 \
        \   \"type\": \"number\",\n                    \"description\": \"Y coordinate position\"\n                },\n  \
        \              \"z\": {\n                    \"type\": \"number\",\n                    \"description\": \"Z coordinate
        position\"\n                }\n            }\n        },\n        \"CompilationOptions\": {\n            \"description\"\
        : \"Options controlling the ABML compilation process including optimizations and caching\",\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"properties\": {\n                \"enableOptimizations\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Enable behavior tree optimizations\"\n                },\n                \"cacheCompiledResult\": {\n       \
        \             \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Cache the compiled behavior for reuse\"\n                },\n                \"strictValidation\": {\n       \
        \             \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Enable strict validation mode\"\n                },\n                \"culturalAdaptations\": {\n            \
        \        \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Apply
        cultural adaptations during compilation\"\n                },\n                \"goapIntegration\": {\n          \
        \          \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"\
        Generate GOAP goals from behaviors\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CompileBehaviorResponse\"\
        ,\n    \"$defs\": {\n        \"CompileBehaviorResponse\": {\n            \"description\": \"Response containing the
        results of an ABML behavior compilation\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\",\n                \"behaviorId\"\n            ],\n\
        \            \"properties\": {\n                \"success\": {\n                    \"type\": \"boolean\",\n     \
        \               \"description\": \"Whether compilation was successful\"\n                },\n                \"behaviorId\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Unique identifier for the compiled
        behavior (content-addressable hash)\",\n                    \"example\": \"behavior-a1b2c3d4e5f6g7h8\"\n         \
        \       },\n                \"behaviorName\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Human-readable name of the behavior\",\n                    \"example\": \"blacksmith_daily_routine\"\
        \n                },\n                \"compiledBehavior\": {\n                    \"$ref\": \"#/$defs/CompiledBehavior\"\
        ,\n                    \"description\": \"The compiled behavior data including behavior tree and metadata\"\n    \
        \            },\n                \"compilationTimeMs\": {\n                    \"type\": \"integer\",\n          \
        \          \"description\": \"Time taken to compile the behavior in milliseconds\"\n                },\n         \
        \       \"assetId\": {\n                    \"type\": \"string\",\n                    \"description\": \"Asset service
        ID where the compiled bytecode is stored\"\n                },\n                \"bundleId\": {\n                \
        \    \"type\": \"string\",\n                    \"description\": \"Bundle ID if the behavior was added to a bundle\"\
        \n                },\n                \"isUpdate\": {\n                    \"type\": \"boolean\",\n              \
        \      \"description\": \"True if this replaced an existing behavior with the same content hash\"\n              \
        \  },\n                \"warnings\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"type\": \"string\"\n                    },\n                    \"description\": \"Non-fatal
        warnings during compilation\"\n                }\n            }\n        },\n        \"CompiledBehavior\": {\n   \
        \         \"description\": \"Compiled behavior containing behavior tree, context schema, and GOAP integration data\"\
        ,\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n\
        \                \"behaviorTree\",\n                \"contextSchema\"\n            ],\n            \"properties\"\
        : {\n                \"behaviorTree\": {\n                    \"$ref\": \"#/$defs/BehaviorTreeData\",\n          \
        \          \"description\": \"Compiled behavior tree data with bytecode or download reference\"\n                },\n\
        \                \"contextSchema\": {\n                    \"$ref\": \"#/$defs/ContextSchemaData\",\n            \
        \        \"description\": \"Schema defining required context variables for execution\"\n                },\n     \
        \           \"serviceDependencies\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"type\": \"string\"\n                    },\n                    \"description\": \"List
        of required services for this behavior\"\n                },\n                \"goapGoals\": {\n                 \
        \   \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/GoapGoal\"\
        \n                    },\n                    \"description\": \"GOAP goals extracted from the behavior\"\n      \
        \          },\n                \"executionMetadata\": {\n                    \"$ref\": \"#/$defs/ExecutionMetadata\"\
        ,\n                    \"description\": \"Metadata for behavior execution including performance hints and resource
        requirements\"\n                }\n            }\n        },\n        \"BehaviorTreeData\": {\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Compiled behavior tree
        data with bytecode or download reference\",\n            \"properties\": {\n                \"bytecode\": {\n    \
        \                \"type\": \"string\",\n                    \"description\": \"Base64-encoded compiled bytecode for
        the behavior tree\"\n                },\n                \"bytecodeSize\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Size of the bytecode in bytes\"\n                },\n                \"\
        downloadUrl\": {\n                    \"type\": \"string\",\n                    \"description\": \"URL to download
        the compiled behavior asset\"\n                }\n            }\n        },\n        \"ContextSchemaData\": {\n  \
        \          \"type\": \"object\",\n            \"description\": \"Schema defining required context variables for behavior
        execution\",\n            \"additionalProperties\": true\n        },\n        \"GoapGoal\": {\n            \"description\"\
        : \"Goal definition for GOAP planning with conditions and priority\",\n            \"type\": \"object\",\n       \
        \     \"additionalProperties\": false,\n            \"required\": [\n                \"name\",\n                \"\
        conditions\",\n                \"priority\"\n            ],\n            \"properties\": {\n                \"name\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Name of the goal\",\n     \
        \               \"example\": \"satisfy_hunger\"\n                },\n                \"description\": {\n        \
        \            \"type\": \"string\",\n                    \"description\": \"Human-readable description of the goal\"\
        \n                },\n                \"conditions\": {\n                    \"type\": \"object\",\n             \
        \       \"additionalProperties\": {\n                        \"type\": \"string\"\n                    },\n      \
        \              \"description\": \"World state conditions that satisfy this goal (literal conditions)\",\n        \
        \            \"example\": {\n                        \"hunger\": \"<= 0.3\",\n                        \"gold\": \"\
        >= 50\"\n                    }\n                },\n                \"priority\": {\n                    \"type\"\
        : \"integer\",\n                    \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"\
        description\": \"Priority of this goal relative to others\"\n                },\n                \"preconditions\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"description\": \"World state conditions
        required to pursue this goal\"\n                }\n            }\n        },\n        \"ExecutionMetadata\": {\n \
        \           \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Metadata
        about behavior execution requirements including timing, resources, and interrupt conditions\",\n            \"properties\"\
        : {\n                \"estimatedDuration\": {\n                    \"type\": \"integer\",\n                    \"\
        description\": \"Estimated execution time in seconds\"\n                },\n                \"resourceRequirements\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"number\"\n                    },\n                    \"description\": \"Resource requirements
        for behavior execution\"\n                },\n                \"interruptConditions\": {\n                    \"type\"\
        : \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                   \
        \ },\n                    \"description\": \"Conditions that can interrupt behavior execution\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Compile stackable behavior sets\",\n    \"description\": \"Compiles multiple
        ABML behavior sets with priority-based merging.\\nHandles cultural adaptations, profession specializations, and context
        resolution.\\n\",\n    \"tags\": [\n        \"BehaviorStacks\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"CompileBehaviorStack\"\n}"
  /validate:
    post:
      summary: Validate ABML definition
      description: |
        Validates ABML YAML against schema and checks for semantic correctness.
        Includes context variable validation and service dependency checking.
      operationId: ValidateAbml
      tags:
      - Validation
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/yaml:
            schema:
              type: string
              description: Raw ABML YAML content to validate
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateAbmlRequest'
      responses:
        '200':
          description: Validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateAbmlResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateAbmlRequest\"\
        ,\n    \"$defs\": {\n        \"ValidateAbmlRequest\": {\n            \"description\": \"Request to validate ABML YAML
        content against schema and semantic rules\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"abmlContent\"\n            ],\n            \"properties\"\
        : {\n                \"abmlContent\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Raw ABML YAML content to validate\"\n                },\n                \"strictMode\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\": \"Enable
        strict validation mode with enhanced checking\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateAbmlResponse\"\
        ,\n    \"$defs\": {\n        \"ValidateAbmlResponse\": {\n            \"description\": \"Response containing the results
        of ABML validation including errors and warnings\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"isValid\"\n            ],\n            \"properties\": {\n\
        \                \"isValid\": {\n                    \"type\": \"boolean\",\n                    \"description\":
        \"Whether the ABML definition is valid\"\n                },\n                \"validationErrors\": {\n          \
        \          \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ValidationError\"\
        \n                    },\n                    \"description\": \"List of validation errors if invalid\"\n        \
        \        },\n                \"semanticWarnings\": {\n                    \"type\": \"array\",\n                 \
        \   \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\"\
        : \"Semantic warnings that don't prevent compilation\"\n                },\n                \"schemaVersion\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"ABML schema version used for validation\"\
        \n                }\n            }\n        },\n        \"ValidationError\": {\n            \"description\": \"Detailed
        validation error with type, location, and message information\",\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"required\": [\n                \"type\",\n                \"message\"\
        \n            ],\n            \"properties\": {\n                \"type\": {\n                    \"type\": \"string\"\
        ,\n                    \"enum\": [\n                        \"syntax\",\n                        \"semantic\",\n \
        \                       \"schema\",\n                        \"context\",\n                        \"service_dependency\"\
        \n                    ],\n                    \"description\": \"Type of validation error\"\n                },\n\
        \                \"message\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Human-readable error message\"\n                },\n                \"lineNumber\": {\n                    \"type\"\
        : \"integer\",\n                    \"description\": \"Line number where the error occurred (if applicable)\"\n  \
        \              },\n                \"columnNumber\": {\n                    \"type\": \"integer\",\n             \
        \       \"description\": \"Column number where the error occurred (if applicable)\"\n                },\n        \
        \        \"yamlPath\": {\n                    \"type\": \"string\",\n                    \"description\": \"YAML path
        to the problematic element\",\n                    \"example\": \"behaviors.morning_startup.actions[0]\"\n       \
        \         }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Validate ABML definition\",\n    \"description\": \"Validates ABML YAML
        against schema and checks for semantic correctness.\\nIncludes context variable validation and service dependency
        checking.\\n\",\n    \"tags\": [\n        \"Validation\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"ValidateAbml\"\n}"
  /cache/get:
    post:
      summary: Get cached compiled behavior
      description: |
        Retrieves a previously compiled behavior from the cache.
        Used for performance optimization in high-frequency behavior execution.
      operationId: GetCachedBehavior
      tags:
      - Cache
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCachedBehaviorRequest'
      responses:
        '200':
          description: Cached behavior retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CachedBehaviorResponse'
        '404':
          description: Behavior not found in cache
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetCachedBehaviorRequest\"\
        ,\n    \"$defs\": {\n        \"GetCachedBehaviorRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get a cached compiled behavior\",\n            \"required\": [\n\
        \                \"behaviorId\"\n            ],\n            \"properties\": {\n                \"behaviorId\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Unique identifier for the cached
        behavior\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CachedBehaviorResponse\"\
        ,\n    \"$defs\": {\n        \"CachedBehaviorResponse\": {\n            \"description\": \"Response containing a previously
        compiled behavior retrieved from cache\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"behaviorId\",\n                \"compiledBehavior\"\n   \
        \         ],\n            \"properties\": {\n                \"behaviorId\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Unique identifier for the cached behavior\"\n                },\n      \
        \          \"compiledBehavior\": {\n                    \"$ref\": \"#/$defs/CompiledBehavior\",\n                \
        \    \"description\": \"The compiled behavior data retrieved from cache\"\n                },\n                \"\
        cacheTimestamp\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n \
        \                   \"description\": \"When the behavior was cached\"\n                },\n                \"cacheHit\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this was a cache hit
        or miss\"\n                }\n            }\n        },\n        \"CompiledBehavior\": {\n            \"description\"\
        : \"Compiled behavior containing behavior tree, context schema, and GOAP integration data\",\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n                \"behaviorTree\"\
        ,\n                \"contextSchema\"\n            ],\n            \"properties\": {\n                \"behaviorTree\"\
        : {\n                    \"$ref\": \"#/$defs/BehaviorTreeData\",\n                    \"description\": \"Compiled
        behavior tree data with bytecode or download reference\"\n                },\n                \"contextSchema\": {\n\
        \                    \"$ref\": \"#/$defs/ContextSchemaData\",\n                    \"description\": \"Schema defining
        required context variables for execution\"\n                },\n                \"serviceDependencies\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\
        \n                    },\n                    \"description\": \"List of required services for this behavior\"\n \
        \               },\n                \"goapGoals\": {\n                    \"type\": \"array\",\n                 \
        \   \"items\": {\n                        \"$ref\": \"#/$defs/GoapGoal\"\n                    },\n               \
        \     \"description\": \"GOAP goals extracted from the behavior\"\n                },\n                \"executionMetadata\"\
        : {\n                    \"$ref\": \"#/$defs/ExecutionMetadata\",\n                    \"description\": \"Metadata
        for behavior execution including performance hints and resource requirements\"\n                }\n            }\n\
        \        },\n        \"BehaviorTreeData\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Compiled behavior tree data with bytecode or download reference\",\n    \
        \        \"properties\": {\n                \"bytecode\": {\n                    \"type\": \"string\",\n         \
        \           \"description\": \"Base64-encoded compiled bytecode for the behavior tree\"\n                },\n    \
        \            \"bytecodeSize\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Size of the bytecode in bytes\"\n                },\n                \"downloadUrl\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"URL to download the compiled behavior asset\"\n      \
        \          }\n            }\n        },\n        \"ContextSchemaData\": {\n            \"type\": \"object\",\n   \
        \         \"description\": \"Schema defining required context variables for behavior execution\",\n            \"\
        additionalProperties\": true\n        },\n        \"GoapGoal\": {\n            \"description\": \"Goal definition
        for GOAP planning with conditions and priority\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"conditions\",\n              \
        \  \"priority\"\n            ],\n            \"properties\": {\n                \"name\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Name of the goal\",\n                    \"example\":
        \"satisfy_hunger\"\n                },\n                \"description\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Human-readable description of the goal\"\n                },\n         \
        \       \"conditions\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        World state conditions that satisfy this goal (literal conditions)\",\n                    \"example\": {\n      \
        \                  \"hunger\": \"<= 0.3\",\n                        \"gold\": \">= 50\"\n                    }\n \
        \               },\n                \"priority\": {\n                    \"type\": \"integer\",\n                \
        \    \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"description\": \"Priority of this
        goal relative to others\"\n                },\n                \"preconditions\": {\n                    \"type\"\
        : \"object\",\n                    \"additionalProperties\": {\n                        \"type\": \"string\"\n   \
        \                 },\n                    \"description\": \"World state conditions required to pursue this goal\"\
        \n                }\n            }\n        },\n        \"ExecutionMetadata\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Metadata about behavior execution
        requirements including timing, resources, and interrupt conditions\",\n            \"properties\": {\n           \
        \     \"estimatedDuration\": {\n                    \"type\": \"integer\",\n                    \"description\": \"\
        Estimated execution time in seconds\"\n                },\n                \"resourceRequirements\": {\n         \
        \           \"type\": \"object\",\n                    \"additionalProperties\": {\n                        \"type\"\
        : \"number\"\n                    },\n                    \"description\": \"Resource requirements for behavior execution\"\
        \n                },\n                \"interruptConditions\": {\n                    \"type\": \"array\",\n     \
        \               \"items\": {\n                        \"type\": \"string\"\n                    },\n             \
        \       \"description\": \"Conditions that can interrupt behavior execution\"\n                }\n            }\n\
        \        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get cached compiled behavior\",\n    \"description\": \"Retrieves a previously
        compiled behavior from the cache.\\nUsed for performance optimization in high-frequency behavior execution.\\n\",\n\
        \    \"tags\": [\n        \"Cache\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"GetCachedBehavior\"\
        \n}"
  /cache/invalidate:
    post:
      summary: Invalidate cached behavior
      description: |
        Removes a behavior from the cache, forcing recompilation on next access.
        Used when behavior definitions are updated.
      operationId: InvalidateCachedBehavior
      tags:
      - Cache
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvalidateCacheRequest'
      responses:
        '200':
          description: Cache invalidated successfully
        '404':
          description: Behavior not found in cache

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/InvalidateCacheRequest\"\
        ,\n    \"$defs\": {\n        \"InvalidateCacheRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to invalidate a cached behavior\",\n            \"required\": [\n\
        \                \"behaviorId\"\n            ],\n            \"properties\": {\n                \"behaviorId\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Unique identifier for the cached
        behavior to invalidate\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n    \"summary\": \"Invalidate cached behavior\",\n    \"description\": \"Removes a behavior
        from the cache, forcing recompilation on next access.\\nUsed when behavior definitions are updated.\\n\",\n    \"\
        tags\": [\n        \"Cache\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"InvalidateCachedBehavior\"\
        \n}"
  /context/resolve:
    post:
      summary: Resolve context variables
      description: |
        Resolves context variables in ABML definitions against character and world state.
        Used for dynamic behavior adaptation based on current game state.
      operationId: ResolveContextVariables
      tags:
      - Context
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResolveContextRequest'
      responses:
        '200':
          description: Context variables resolved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResolveContextResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ResolveContextRequest\"\
        ,\n    \"$defs\": {\n        \"ResolveContextRequest\": {\n            \"description\": \"Request to resolve context
        variable expressions against character and world state\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"contextExpression\",\n                \"characterContext\"\
        \n            ],\n            \"properties\": {\n                \"contextExpression\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Context variable expression to resolve\",\n          \
        \          \"example\": \"${npc.stats.energy > 0.5 && world.time.hour < 18}\"\n                },\n              \
        \  \"characterContext\": {\n                    \"$ref\": \"#/$defs/CharacterContext\",\n                    \"description\"\
        : \"Character context providing values for variable resolution\"\n                }\n            }\n        },\n \
        \       \"CharacterContext\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"description\": \"Context information about a character for behavior resolution\",\n            \"properties\"\
        : {\n                \"npcId\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Unique identifier for the NPC\",\n                    \"example\": \"npc_12345\"\n                },\n       \
        \         \"culture\": {\n                    \"type\": \"string\",\n                    \"description\": \"Cultural
        background identifier\",\n                    \"example\": \"european_medieval\"\n                },\n           \
        \     \"profession\": {\n                    \"type\": \"string\",\n                    \"description\": \"Character
        profession identifier\",\n                    \"example\": \"blacksmith\"\n                },\n                \"\
        stats\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n         \
        \               \"type\": \"number\"\n                    },\n                    \"description\": \"Character statistics
        and attributes\",\n                    \"example\": {\n                        \"energy\": 0.8,\n                \
        \        \"health\": 1.0,\n                        \"hunger\": 0.3\n                    }\n                },\n  \
        \              \"skills\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"number\"\n                    },\n                    \"description\": \"\
        Character skill levels\",\n                    \"example\": {\n                        \"blacksmithing\": 85,\n  \
        \                      \"trading\": 42\n                    }\n                },\n                \"location\": {\n\
        \                    \"$ref\": \"#/$defs/Location\",\n                    \"description\": \"Current location information
        for the character\"\n                },\n                \"relationships\": {\n                    \"type\": \"object\"\
        ,\n                    \"additionalProperties\": {\n                        \"type\": \"number\"\n               \
        \     },\n                    \"description\": \"Relationship values with other characters\"\n                },\n\
        \                \"worldState\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Relevant world state information\"\n                }\n          \
        \  }\n        },\n        \"Location\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Character location information including current position, region, and 3D
        coordinates\",\n            \"properties\": {\n                \"current\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Current location name or identifier\"\n                },\n            \
        \    \"region\": {\n                    \"type\": \"string\",\n                    \"description\": \"Region or zone
        the character is in\"\n                },\n                \"coordinates\": {\n                    \"$ref\": \"#/$defs/Coordinates\"\
        ,\n                    \"description\": \"3D spatial coordinates of the character's position in the game world\"\n\
        \                }\n            }\n        },\n        \"Coordinates\": {\n            \"type\": \"object\",\n   \
        \         \"additionalProperties\": false,\n            \"description\": \"3D spatial coordinates representing a position
        in the game world\",\n            \"properties\": {\n                \"x\": {\n                    \"type\": \"number\"\
        ,\n                    \"description\": \"X coordinate position\"\n                },\n                \"y\": {\n\
        \                    \"type\": \"number\",\n                    \"description\": \"Y coordinate position\"\n     \
        \           },\n                \"z\": {\n                    \"type\": \"number\",\n                    \"description\"\
        : \"Z coordinate position\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ResolveContextResponse\"\
        ,\n    \"$defs\": {\n        \"ResolveContextResponse\": {\n            \"description\": \"Response containing the
        resolved value of a context variable expression\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"resolvedValue\"\n            ],\n            \"properties\"\
        : {\n                \"resolvedValue\": {\n                    \"description\": \"The resolved value of the context
        expression\"\n                },\n                \"resolvedType\": {\n                    \"type\": \"string\",\n\
        \                    \"enum\": [\n                        \"boolean\",\n                        \"string\",\n    \
        \                    \"number\",\n                        \"object\",\n                        \"array\"\n       \
        \             ],\n                    \"description\": \"Type of the resolved value\"\n                },\n      \
        \          \"contextVariablesUsed\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"type\": \"string\"\n                    },\n                    \"description\": \"List
        of context variables referenced in the expression\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Resolve context variables\",\n    \"description\": \"Resolves context variables
        in ABML definitions against character and world state.\\nUsed for dynamic behavior adaptation based on current game
        state.\\n\",\n    \"tags\": [\n        \"Context\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"ResolveContextVariables\"\
        \n}"
  /goap/plan:
    post:
      summary: Generate GOAP plan
      description: |
        Generates a GOAP plan to achieve a goal from the current world state.
        Uses A* search to find the optimal sequence of actions.
      operationId: GenerateGoapPlan
      tags:
      - GOAP
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoapPlanRequest'
      responses:
        '200':
          description: Plan generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoapPlanResponse'
        '400':
          description: Invalid request or planning failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GoapPlanRequest\"\
        ,\n    \"$defs\": {\n        \"GoapPlanRequest\": {\n            \"description\": \"Request to generate a GOAP plan
        to achieve a goal from current world state\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"goal\",\n                \"worldState\",\n              \
        \  \"behaviorId\"\n            ],\n            \"properties\": {\n                \"agentId\": {\n               \
        \     \"type\": \"string\",\n                    \"description\": \"Unique identifier for the agent requesting the
        plan\"\n                },\n                \"goal\": {\n                    \"$ref\": \"#/$defs/GoapGoal\",\n   \
        \                 \"description\": \"The goal to achieve through planning\"\n                },\n                \"\
        worldState\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Current world state as key-value pairs\",\n                    \"example\"\
        : {\n                        \"hunger\": 0.8,\n                        \"gold\": 50,\n                        \"location\"\
        : \"home\"\n                    }\n                },\n                \"behaviorId\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"ID of compiled behavior containing GOAP actions\"\n        \
        \        },\n                \"options\": {\n                    \"$ref\": \"#/$defs/GoapPlanningOptions\",\n    \
        \                \"description\": \"Options controlling the planning process\"\n                }\n            }\n\
        \        },\n        \"GoapGoal\": {\n            \"description\": \"Goal definition for GOAP planning with conditions
        and priority\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"name\",\n                \"conditions\",\n                \"priority\"\n            ],\n  \
        \          \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n           \
        \         \"description\": \"Name of the goal\",\n                    \"example\": \"satisfy_hunger\"\n          \
        \      },\n                \"description\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Human-readable description of the goal\"\n                },\n                \"conditions\": {\n            \
        \        \"type\": \"object\",\n                    \"additionalProperties\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"description\": \"World state conditions that satisfy this
        goal (literal conditions)\",\n                    \"example\": {\n                        \"hunger\": \"<= 0.3\",\n\
        \                        \"gold\": \">= 50\"\n                    }\n                },\n                \"priority\"\
        : {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n                    \"maximum\"\
        : 100,\n                    \"description\": \"Priority of this goal relative to others\"\n                },\n  \
        \              \"preconditions\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        World state conditions required to pursue this goal\"\n                }\n            }\n        },\n        \"GoapPlanningOptions\"\
        : {\n            \"description\": \"Options controlling the GOAP planning process including depth and timeout limits\"\
        ,\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"properties\": {\n\
        \                \"maxDepth\": {\n                    \"type\": \"integer\",\n                    \"default\": 10,\n\
        \                    \"description\": \"Maximum plan depth (number of actions)\"\n                },\n           \
        \     \"maxNodes\": {\n                    \"type\": \"integer\",\n                    \"default\": 1000,\n      \
        \              \"description\": \"Maximum nodes to expand during search\"\n                },\n                \"\
        timeoutMs\": {\n                    \"type\": \"integer\",\n                    \"default\": 100,\n              \
        \      \"description\": \"Planning timeout in milliseconds\"\n                }\n            }\n        }\n    }\n\
        }"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GoapPlanResponse\"\
        ,\n    \"$defs\": {\n        \"GoapPlanResponse\": {\n            \"description\": \"Response containing the generated
        GOAP plan or failure information\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"success\"\n            ],\n            \"properties\": {\n       \
        \         \"success\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether
        planning was successful\"\n                },\n                \"plan\": {\n                    \"$ref\": \"#/$defs/GoapPlanResult\"\
        ,\n                    \"description\": \"The generated plan if successful\"\n                },\n               \
        \ \"planningTimeMs\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Time spent
        planning in milliseconds\"\n                },\n                \"nodesExpanded\": {\n                    \"type\"\
        : \"integer\",\n                    \"description\": \"Number of nodes expanded during A* search\"\n             \
        \   },\n                \"failureReason\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Reason for planning failure if unsuccessful\",\n                    \"example\": \"No plan found - goal unreachable\"\
        \n                }\n            }\n        },\n        \"GoapPlanResult\": {\n            \"description\": \"Result
        of GOAP planning containing the ordered sequence of actions to achieve a goal\",\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"required\": [\n                \"goalId\",\n      \
        \          \"actions\",\n                \"totalCost\"\n            ],\n            \"properties\": {\n          \
        \      \"goalId\": {\n                    \"type\": \"string\",\n                    \"description\": \"ID of the
        goal this plan achieves\"\n                },\n                \"actions\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/PlannedActionResponse\"\n       \
        \             },\n                    \"description\": \"Ordered sequence of actions to execute\"\n              \
        \  },\n                \"totalCost\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"float\",\n                    \"description\": \"Total cost of all actions in the plan\"\n                }\n\
        \            }\n        },\n        \"PlannedActionResponse\": {\n            \"description\": \"Single action within
        a GOAP plan with position and cost information\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"actionId\",\n                \"index\",\n               \
        \ \"cost\"\n            ],\n            \"properties\": {\n                \"actionId\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"ID of the action (flow name)\"\n                },\n \
        \               \"index\": {\n                    \"type\": \"integer\",\n                    \"description\": \"\
        Position in the plan sequence\"\n                },\n                \"cost\": {\n                    \"type\": \"\
        number\",\n                    \"format\": \"float\",\n                    \"description\": \"Cost of this action\"\
        \n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Generate GOAP plan\",\n    \"description\": \"Generates a GOAP plan to
        achieve a goal from the current world state.\\nUses A* search to find the optimal sequence of actions.\\n\",\n   \
        \ \"tags\": [\n        \"GOAP\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"GenerateGoapPlan\"\n}"
  /goap/validate-plan:
    post:
      summary: Validate existing GOAP plan
      description: |
        Validates an existing GOAP plan against the current world state.
        Returns whether the plan is still valid or needs replanning.
      operationId: ValidateGoapPlan
      tags:
      - GOAP
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateGoapPlanRequest'
      responses:
        '200':
          description: Plan validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateGoapPlanResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbmlErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateGoapPlanRequest\"\
        ,\n    \"$defs\": {\n        \"ValidateGoapPlanRequest\": {\n            \"description\": \"Request to validate an
        existing GOAP plan against current world state\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"plan\",\n                \"currentActionIndex\",\n      \
        \          \"worldState\"\n            ],\n            \"properties\": {\n                \"plan\": {\n          \
        \          \"$ref\": \"#/$defs/GoapPlanResult\",\n                    \"description\": \"The plan to validate\"\n\
        \                },\n                \"currentActionIndex\": {\n                    \"type\": \"integer\",\n     \
        \               \"description\": \"Index of the action currently being executed\"\n                },\n          \
        \      \"worldState\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Current world state\"\n                },\n                \"activeGoals\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/GoapGoal\"\n                    },\n                    \"description\": \"All active goals for priority
        checking\"\n                }\n            }\n        },\n        \"GoapPlanResult\": {\n            \"description\"\
        : \"Result of GOAP planning containing the ordered sequence of actions to achieve a goal\",\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n                \"goalId\"\
        ,\n                \"actions\",\n                \"totalCost\"\n            ],\n            \"properties\": {\n  \
        \              \"goalId\": {\n                    \"type\": \"string\",\n                    \"description\": \"ID
        of the goal this plan achieves\"\n                },\n                \"actions\": {\n                    \"type\"\
        : \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/PlannedActionResponse\"\
        \n                    },\n                    \"description\": \"Ordered sequence of actions to execute\"\n      \
        \          },\n                \"totalCost\": {\n                    \"type\": \"number\",\n                    \"\
        format\": \"float\",\n                    \"description\": \"Total cost of all actions in the plan\"\n           \
        \     }\n            }\n        },\n        \"PlannedActionResponse\": {\n            \"description\": \"Single action
        within a GOAP plan with position and cost information\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"actionId\",\n                \"index\",\n               \
        \ \"cost\"\n            ],\n            \"properties\": {\n                \"actionId\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"ID of the action (flow name)\"\n                },\n \
        \               \"index\": {\n                    \"type\": \"integer\",\n                    \"description\": \"\
        Position in the plan sequence\"\n                },\n                \"cost\": {\n                    \"type\": \"\
        number\",\n                    \"format\": \"float\",\n                    \"description\": \"Cost of this action\"\
        \n                }\n            }\n        },\n        \"GoapGoal\": {\n            \"description\": \"Goal definition
        for GOAP planning with conditions and priority\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"conditions\",\n              \
        \  \"priority\"\n            ],\n            \"properties\": {\n                \"name\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Name of the goal\",\n                    \"example\":
        \"satisfy_hunger\"\n                },\n                \"description\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Human-readable description of the goal\"\n                },\n         \
        \       \"conditions\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        World state conditions that satisfy this goal (literal conditions)\",\n                    \"example\": {\n      \
        \                  \"hunger\": \"<= 0.3\",\n                        \"gold\": \">= 50\"\n                    }\n \
        \               },\n                \"priority\": {\n                    \"type\": \"integer\",\n                \
        \    \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"description\": \"Priority of this
        goal relative to others\"\n                },\n                \"preconditions\": {\n                    \"type\"\
        : \"object\",\n                    \"additionalProperties\": {\n                        \"type\": \"string\"\n   \
        \                 },\n                    \"description\": \"World state conditions required to pursue this goal\"\
        \n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateGoapPlanResponse\"\
        ,\n    \"$defs\": {\n        \"ValidateGoapPlanResponse\": {\n            \"description\": \"Response indicating whether
        a GOAP plan is still valid and suggested next action\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"isValid\",\n                \"reason\",\n               \
        \ \"suggestedAction\"\n            ],\n            \"properties\": {\n                \"isValid\": {\n           \
        \         \"type\": \"boolean\",\n                    \"description\": \"Whether the plan is still valid\"\n     \
        \           },\n                \"reason\": {\n                    \"type\": \"string\",\n                    \"enum\"\
        : [\n                        \"none\",\n                        \"preconditionInvalidated\",\n                   \
        \     \"actionFailed\",\n                        \"betterGoalAvailable\",\n                        \"planCompleted\"\
        ,\n                        \"goalAlreadySatisfied\",\n                        \"suboptimalPlan\"\n               \
        \     ],\n                    \"description\": \"Reason for the validation result\"\n                },\n        \
        \        \"suggestedAction\": {\n                    \"type\": \"string\",\n                    \"enum\": [\n    \
        \                    \"continue\",\n                        \"replan\",\n                        \"abort\"\n     \
        \               ],\n                    \"description\": \"Suggested action based on validation\"\n              \
        \  },\n                \"invalidatedAtIndex\": {\n                    \"type\": \"integer\",\n                   \
        \ \"description\": \"Index where plan became invalid (if applicable)\"\n                },\n                \"message\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Additional details about the
        validation result\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Validate existing GOAP plan\",\n    \"description\": \"Validates an existing
        GOAP plan against the current world state.\\nReturns whether the plan is still valid or needs replanning.\\n\",\n\
        \    \"tags\": [\n        \"GOAP\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"ValidateGoapPlan\"\n\
        }"
components:
  schemas:
    # Request Models for POST-only pattern
    GetCachedBehaviorRequest:
      type: object
      additionalProperties: false
      description: Request to get a cached compiled behavior
      required:
      - behaviorId
      properties:
        behaviorId:
          type: string
          description: Unique identifier for the cached behavior

    InvalidateCacheRequest:
      type: object
      additionalProperties: false
      description: Request to invalidate a cached behavior
      required:
      - behaviorId
      properties:
        behaviorId:
          type: string
          description: Unique identifier for the cached behavior to invalidate

    CompileBehaviorRequest:
      description: Request to compile an ABML behavior definition into executable behavior trees
      type: object
      additionalProperties: false
      required:
      - abmlContent
      properties:
        abmlContent:
          type: string
          description: Raw ABML YAML content to compile
          example: |
            version: "1.0.0"
            metadata:
              id: "example_behavior"
              category: "basic"
            behaviors:
              example:
                triggers:
                  - condition: "true"
                actions:
                  - log:
                      message: "Hello World"
        behaviorName:
          type: string
          description: |
            Optional human-readable name for the behavior.
            If not provided, extracted from ABML metadata.id or generated from content hash.
          example: "blacksmith_daily_routine"
        behaviorCategory:
          type: string
          description: |
            Category for organizing behaviors (e.g., profession, cultural, situational).
            Used for filtering and grouping in bundles.
          enum: [base, cultural, professional, personal, situational, ambient]
          example: "professional"
        bundleId:
          type: string
          description: |
            Optional bundle identifier for grouping related behaviors.
            When specified, the compiled behavior will be added to a bundle with this ID.
            Clients can then download entire bundles for efficient bulk loading.
            If the bundle doesn't exist, it will be created.
          example: "blacksmith-behaviors-v1"
        characterContext:
          $ref: '#/components/schemas/CharacterContext'
          description: Character context for context variable resolution during compilation
        compilationOptions:
          $ref: '#/components/schemas/CompilationOptions'
          description: Options controlling the compilation process

    BehaviorStackRequest:
      description: Request to compile multiple stackable behavior sets with priority-based merging
      type: object
      additionalProperties: false
      required:
      - behaviorSets
      properties:
        behaviorSets:
          type: array
          items:
            $ref: '#/components/schemas/BehaviorSetDefinition'
          description: Array of behavior sets to compile together
        characterContext:
          $ref: '#/components/schemas/CharacterContext'
          description: Character context for context variable resolution during compilation
        compilationOptions:
          $ref: '#/components/schemas/CompilationOptions'
          description: Options controlling the compilation process

    ValidateAbmlRequest:
      description: Request to validate ABML YAML content against schema and semantic rules
      type: object
      additionalProperties: false
      required:
      - abmlContent
      properties:
        abmlContent:
          type: string
          description: Raw ABML YAML content to validate
        strictMode:
          type: boolean
          default: false
          description: Enable strict validation mode with enhanced checking

    ResolveContextRequest:
      description: Request to resolve context variable expressions against character and world state
      type: object
      additionalProperties: false
      required:
      - contextExpression
      - characterContext
      properties:
        contextExpression:
          type: string
          description: Context variable expression to resolve
          example: "${npc.stats.energy > 0.5 && world.time.hour < 18}"
        characterContext:
          $ref: '#/components/schemas/CharacterContext'
          description: Character context providing values for variable resolution

    # Response Models
    CompileBehaviorResponse:
      description: Response containing the results of an ABML behavior compilation
      type: object
      additionalProperties: false
      required:
      - success
      - behaviorId
      properties:
        success:
          type: boolean
          description: Whether compilation was successful
        behaviorId:
          type: string
          description: Unique identifier for the compiled behavior (content-addressable hash)
          example: "behavior-a1b2c3d4e5f6g7h8"
        behaviorName:
          type: string
          description: Human-readable name of the behavior
          example: "blacksmith_daily_routine"
        compiledBehavior:
          $ref: '#/components/schemas/CompiledBehavior'
          description: The compiled behavior data including behavior tree and metadata
        compilationTimeMs:
          type: integer
          description: Time taken to compile the behavior in milliseconds
        assetId:
          type: string
          description: Asset service ID where the compiled bytecode is stored
        bundleId:
          type: string
          description: Bundle ID if the behavior was added to a bundle
        isUpdate:
          type: boolean
          description: True if this replaced an existing behavior with the same content hash
        warnings:
          type: array
          items:
            type: string
          description: Non-fatal warnings during compilation

    ValidateAbmlResponse:
      description: Response containing the results of ABML validation including errors and warnings
      type: object
      additionalProperties: false
      required:
      - isValid
      properties:
        isValid:
          type: boolean
          description: Whether the ABML definition is valid
        validationErrors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
          description: List of validation errors if invalid
        semanticWarnings:
          type: array
          items:
            type: string
          description: Semantic warnings that don't prevent compilation
        schemaVersion:
          type: string
          description: ABML schema version used for validation

    CachedBehaviorResponse:
      description: Response containing a previously compiled behavior retrieved from cache
      type: object
      additionalProperties: false
      required:
      - behaviorId
      - compiledBehavior
      properties:
        behaviorId:
          type: string
          description: Unique identifier for the cached behavior
        compiledBehavior:
          $ref: '#/components/schemas/CompiledBehavior'
          description: The compiled behavior data retrieved from cache
        cacheTimestamp:
          type: string
          format: date-time
          description: When the behavior was cached
        cacheHit:
          type: boolean
          description: Whether this was a cache hit or miss

    ResolveContextResponse:
      description: Response containing the resolved value of a context variable expression
      type: object
      additionalProperties: false
      required:
      - resolvedValue
      properties:
        resolvedValue:
          description: The resolved value of the context expression
        resolvedType:
          type: string
          enum: [boolean, string, number, object, array]
          description: Type of the resolved value
        contextVariablesUsed:
          type: array
          items:
            type: string
          description: List of context variables referenced in the expression

    # Core Data Models
    BehaviorSetDefinition:
      description: Definition of a behavior set with priority for stackable behavior merging
      type: object
      additionalProperties: false
      required:
      - id
      - priority
      - abmlContent
      properties:
        id:
          type: string
          description: Unique identifier for the behavior set
          example: "base_humanoid"
        priority:
          type: integer
          minimum: 1
          maximum: 100
          description: Priority level for merging (higher priority overrides lower)
          example: 50
        category:
          type: string
          description: Category of the behavior set
          enum: [base, cultural, professional, personal, situational]
        abmlContent:
          type: string
          description: Raw ABML YAML content for this behavior set
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata for the behavior set

    CharacterContext:
      type: object
      additionalProperties: false
      description: Context information about a character for behavior resolution
      properties:
        npcId:
          type: string
          description: Unique identifier for the NPC
          example: "npc_12345"
        culture:
          type: string
          description: Cultural background identifier
          example: "european_medieval"
        profession:
          type: string
          description: Character profession identifier
          example: "blacksmith"
        stats:
          type: object
          additionalProperties:
            type: number
          description: Character statistics and attributes
          example:
            energy: 0.8
            health: 1.0
            hunger: 0.3
        skills:
          type: object
          additionalProperties:
            type: number
          description: Character skill levels
          example:
            blacksmithing: 85
            trading: 42
        location:
          $ref: '#/components/schemas/Location'
          description: Current location information for the character
        relationships:
          type: object
          additionalProperties:
            type: number
          description: Relationship values with other characters
        worldState:
          type: object
          additionalProperties: true
          description: Relevant world state information

    BehaviorTreeData:
      type: object
      additionalProperties: false
      description: Compiled behavior tree data with bytecode or download reference
      properties:
        bytecode:
          type: string
          description: Base64-encoded compiled bytecode for the behavior tree
        bytecodeSize:
          type: integer
          description: Size of the bytecode in bytes
        downloadUrl:
          type: string
          description: URL to download the compiled behavior asset

    ContextSchemaData:
      type: object
      description: Schema defining required context variables for behavior execution
      additionalProperties: true

    CompiledBehavior:
      description: Compiled behavior containing behavior tree, context schema, and GOAP integration data
      type: object
      additionalProperties: false
      required:
      - behaviorTree
      - contextSchema
      properties:
        behaviorTree:
          $ref: '#/components/schemas/BehaviorTreeData'
          description: Compiled behavior tree data with bytecode or download reference
        contextSchema:
          $ref: '#/components/schemas/ContextSchemaData'
          description: Schema defining required context variables for execution
        serviceDependencies:
          type: array
          items:
            type: string
          description: List of required services for this behavior
        goapGoals:
          type: array
          items:
            $ref: '#/components/schemas/GoapGoal'
          description: GOAP goals extracted from the behavior
        executionMetadata:
          $ref: '#/components/schemas/ExecutionMetadata'
          description: Metadata for behavior execution including performance hints and resource requirements

    Location:
      type: object
      additionalProperties: false
      description: Character location information including current position, region, and 3D coordinates
      properties:
        current:
          type: string
          description: Current location name or identifier
        region:
          type: string
          description: Region or zone the character is in
        coordinates:
          $ref: '#/components/schemas/Coordinates'
          description: 3D spatial coordinates of the character's position in the game world

    Coordinates:
      type: object
      additionalProperties: false
      description: 3D spatial coordinates representing a position in the game world
      properties:
        x:
          type: number
          description: X coordinate position
        y:
          type: number
          description: Y coordinate position
        z:
          type: number
          description: Z coordinate position

    ExecutionMetadata:
      type: object
      additionalProperties: false
      description: Metadata about behavior execution requirements including timing, resources, and interrupt conditions
      properties:
        estimatedDuration:
          type: integer
          description: Estimated execution time in seconds
        resourceRequirements:
          type: object
          additionalProperties:
            type: number
          description: Resource requirements for behavior execution
        interruptConditions:
          type: array
          items:
            type: string
          description: Conditions that can interrupt behavior execution

    GoapGoal:
      description: Goal definition for GOAP planning with conditions and priority
      type: object
      additionalProperties: false
      required:
      - name
      - conditions
      - priority
      properties:
        name:
          type: string
          description: Name of the goal
          example: "satisfy_hunger"
        description:
          type: string
          description: Human-readable description of the goal
        conditions:
          type: object
          additionalProperties:
            type: string
          description: World state conditions that satisfy this goal (literal conditions)
          example:
            hunger: "<= 0.3"
            gold: ">= 50"
        priority:
          type: integer
          minimum: 1
          maximum: 100
          description: Priority of this goal relative to others
        preconditions:
          type: object
          additionalProperties:
            type: string
          description: World state conditions required to pursue this goal

    GoapPlanRequest:
      description: Request to generate a GOAP plan to achieve a goal from current world state
      type: object
      additionalProperties: false
      required:
      - goal
      - worldState
      - behaviorId
      properties:
        agentId:
          type: string
          description: Unique identifier for the agent requesting the plan
        goal:
          $ref: '#/components/schemas/GoapGoal'
          description: The goal to achieve through planning
        worldState:
          type: object
          additionalProperties: true
          description: Current world state as key-value pairs
          example:
            hunger: 0.8
            gold: 50
            location: "home"
        behaviorId:
          type: string
          description: ID of compiled behavior containing GOAP actions
        options:
          $ref: '#/components/schemas/GoapPlanningOptions'
          description: Options controlling the planning process

    GoapPlanResponse:
      description: Response containing the generated GOAP plan or failure information
      type: object
      additionalProperties: false
      required:
      - success
      properties:
        success:
          type: boolean
          description: Whether planning was successful
        plan:
          $ref: '#/components/schemas/GoapPlanResult'
          description: The generated plan if successful
        planningTimeMs:
          type: integer
          description: Time spent planning in milliseconds
        nodesExpanded:
          type: integer
          description: Number of nodes expanded during A* search
        failureReason:
          type: string
          description: Reason for planning failure if unsuccessful
          example: "No plan found - goal unreachable"

    GoapPlanResult:
      description: Result of GOAP planning containing the ordered sequence of actions to achieve a goal
      type: object
      additionalProperties: false
      required:
      - goalId
      - actions
      - totalCost
      properties:
        goalId:
          type: string
          description: ID of the goal this plan achieves
        actions:
          type: array
          items:
            $ref: '#/components/schemas/PlannedActionResponse'
          description: Ordered sequence of actions to execute
        totalCost:
          type: number
          format: float
          description: Total cost of all actions in the plan

    PlannedActionResponse:
      description: Single action within a GOAP plan with position and cost information
      type: object
      additionalProperties: false
      required:
      - actionId
      - index
      - cost
      properties:
        actionId:
          type: string
          description: ID of the action (flow name)
        index:
          type: integer
          description: Position in the plan sequence
        cost:
          type: number
          format: float
          description: Cost of this action

    ValidateGoapPlanRequest:
      description: Request to validate an existing GOAP plan against current world state
      type: object
      additionalProperties: false
      required:
      - plan
      - currentActionIndex
      - worldState
      properties:
        plan:
          $ref: '#/components/schemas/GoapPlanResult'
          description: The plan to validate
        currentActionIndex:
          type: integer
          description: Index of the action currently being executed
        worldState:
          type: object
          additionalProperties: true
          description: Current world state
        activeGoals:
          type: array
          items:
            $ref: '#/components/schemas/GoapGoal'
          description: All active goals for priority checking

    ValidateGoapPlanResponse:
      description: Response indicating whether a GOAP plan is still valid and suggested next action
      type: object
      additionalProperties: false
      required:
      - isValid
      - reason
      - suggestedAction
      properties:
        isValid:
          type: boolean
          description: Whether the plan is still valid
        reason:
          type: string
          enum:
          - none
          - preconditionInvalidated
          - actionFailed
          - betterGoalAvailable
          - planCompleted
          - goalAlreadySatisfied
          - suboptimalPlan
          description: Reason for the validation result
        suggestedAction:
          type: string
          enum:
          - continue
          - replan
          - abort
          description: Suggested action based on validation
        invalidatedAtIndex:
          type: integer
          description: Index where plan became invalid (if applicable)
        message:
          type: string
          description: Additional details about the validation result

    GoapPlanningOptions:
      description: Options controlling the GOAP planning process including depth and timeout limits
      type: object
      additionalProperties: false
      properties:
        maxDepth:
          type: integer
          default: 10
          description: Maximum plan depth (number of actions)
        maxNodes:
          type: integer
          default: 1000
          description: Maximum nodes to expand during search
        timeoutMs:
          type: integer
          default: 100
          description: Planning timeout in milliseconds

    CompilationOptions:
      description: Options controlling the ABML compilation process including optimizations and caching
      type: object
      additionalProperties: false
      properties:
        enableOptimizations:
          type: boolean
          default: true
          description: Enable behavior tree optimizations
        cacheCompiledResult:
          type: boolean
          default: true
          description: Cache the compiled behavior for reuse
        strictValidation:
          type: boolean
          default: false
          description: Enable strict validation mode
        culturalAdaptations:
          type: boolean
          default: true
          description: Apply cultural adaptations during compilation
        goapIntegration:
          type: boolean
          default: true
          description: Generate GOAP goals from behaviors

    ValidationError:
      description: Detailed validation error with type, location, and message information
      type: object
      additionalProperties: false
      required:
      - type
      - message
      properties:
        type:
          type: string
          enum: [syntax, semantic, schema, context, service_dependency]
          description: Type of validation error
        message:
          type: string
          description: Human-readable error message
        lineNumber:
          type: integer
          description: Line number where the error occurred (if applicable)
        columnNumber:
          type: integer
          description: Column number where the error occurred (if applicable)
        yamlPath:
          type: string
          description: YAML path to the problematic element
          example: "behaviors.morning_startup.actions[0]"

    # Error Response Model
    AbmlErrorResponse:
      description: Error response for ABML operations with detailed error information and context
      type: object
      additionalProperties: false
      required:
      - error
      properties:
        error:
          type: string
          description: Error message
          example: "ABML compilation failed"
        errorCode:
          type: string
          description: Specific error code for programmatic handling
          example: "ABML_SYNTAX_ERROR"
        details:
          type: array
          items:
            type: string
          description: Detailed error information
        validationErrors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
          description: Validation errors encountered
        yamlLine:
          type: integer
          description: Line number in YAML where error occurred
        context:
          type: object
          additionalProperties: true
          description: Additional context about the error
        timestamp:
          type: string
          format: date-time
          description: When the error occurred
        requestId:
          type: string
          description: Unique identifier for the failed request

tags:
- name: ABML
  description: Core ABML compilation and management operations
- name: BehaviorStacks
  description: Stackable behavior set compilation and merging
- name: Validation
  description: ABML validation and semantic checking
- name: Cache
  description: Behavior compilation caching operations
- name: Context
  description: Context variable resolution and management
- name: GOAP
  description: Goal-Oriented Action Planning for NPC behavior
