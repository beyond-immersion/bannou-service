openapi: 3.0.4
info:
  title: Character Encounter Service Configuration
  description: |
    Configuration schema for Character Encounter service.
    Properties are bound to environment variables with BANNOU_ prefix.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    MemoryDecayEnabled:
      type: boolean
      description: Enable time-based memory decay for encounter perspectives
      env: CHARACTER_ENCOUNTER_MEMORY_DECAY_ENABLED
      default: true
    MemoryDecayMode:
      type: string
      enum: [lazy, scheduled]
      description: Memory decay mode - 'lazy' applies decay on access, 'scheduled' uses background processing
      env: CHARACTER_ENCOUNTER_MEMORY_DECAY_MODE
      default: lazy
    ScheduledDecayCheckIntervalMinutes:
      type: integer
      description: Interval between scheduled decay checks in minutes (only used when MemoryDecayMode is 'scheduled')
      env: CHARACTER_ENCOUNTER_SCHEDULED_DECAY_CHECK_INTERVAL_MINUTES
      default: 60
      minimum: 1
      maximum: 1440
    ScheduledDecayStartupDelaySeconds:
      type: integer
      description: Startup delay before first scheduled decay check in seconds (allows other services to initialize)
      env: CHARACTER_ENCOUNTER_SCHEDULED_DECAY_STARTUP_DELAY_SECONDS
      default: 30
      minimum: 0
      maximum: 300
    MemoryDecayIntervalHours:
      type: integer
      description: Hours between decay checks (used for calculating decay amount)
      env: CHARACTER_ENCOUNTER_MEMORY_DECAY_INTERVAL_HOURS
      default: 24
    MemoryDecayRate:
      type: number
      description: Memory strength reduction per decay interval (0.0-1.0)
      env: CHARACTER_ENCOUNTER_MEMORY_DECAY_RATE
      default: 0.05
    MemoryFadeThreshold:
      type: number
      description: Memory strength below which encounters are considered forgotten (0.0-1.0)
      env: CHARACTER_ENCOUNTER_MEMORY_FADE_THRESHOLD
      default: 0.1
    MaxEncountersPerCharacter:
      type: integer
      description: Maximum encounters stored per character before oldest are pruned
      env: CHARACTER_ENCOUNTER_MAX_PER_CHARACTER
      default: 1000
    MaxEncountersPerPair:
      type: integer
      description: Maximum encounters stored per character pair before oldest are pruned
      env: CHARACTER_ENCOUNTER_MAX_PER_PAIR
      default: 100
    DefaultPageSize:
      type: integer
      description: Default page size for query results
      env: CHARACTER_ENCOUNTER_DEFAULT_PAGE_SIZE
      default: 20
    MaxPageSize:
      type: integer
      description: Maximum allowed page size for query results
      env: CHARACTER_ENCOUNTER_MAX_PAGE_SIZE
      default: 100
    MaxBatchSize:
      type: integer
      description: Maximum items in bulk operations (batch-get, etc.)
      env: CHARACTER_ENCOUNTER_MAX_BATCH_SIZE
      default: 100
    DefaultMemoryStrength:
      type: number
      description: Default initial memory strength for new perspectives (0.0-1.0)
      env: CHARACTER_ENCOUNTER_DEFAULT_MEMORY_STRENGTH
      default: 1.0
    MemoryRefreshBoost:
      type: number
      description: Default memory strength boost when refreshing (0.0-1.0)
      env: CHARACTER_ENCOUNTER_MEMORY_REFRESH_BOOST
      default: 0.2
    SentimentShiftPositive:
      type: number
      description: Default sentiment shift for positive encounter outcomes
      env: CHARACTER_ENCOUNTER_SENTIMENT_SHIFT_POSITIVE
      default: 0.2
    SentimentShiftNegative:
      type: number
      description: Default sentiment shift for negative encounter outcomes (should be negative)
      env: CHARACTER_ENCOUNTER_SENTIMENT_SHIFT_NEGATIVE
      default: -0.2
    SentimentShiftMemorable:
      type: number
      description: Default sentiment shift for memorable encounter outcomes
      env: CHARACTER_ENCOUNTER_SENTIMENT_SHIFT_MEMORABLE
      default: 0.1
    SentimentShiftTransformative:
      type: number
      description: Default sentiment shift for transformative encounter outcomes
      env: CHARACTER_ENCOUNTER_SENTIMENT_SHIFT_TRANSFORMATIVE
      default: 0.3
    SeedBuiltInTypesOnStartup:
      type: boolean
      description: Automatically seed built-in encounter types on service startup
      env: CHARACTER_ENCOUNTER_SEED_BUILTIN_TYPES_ON_STARTUP
      default: true
    EncounterCacheTtlMinutes:
      type: integer
      description: TTL in minutes for the in-memory encounter data cache used by Actor behavior execution
      env: CHARACTER_ENCOUNTER_CACHE_TTL_MINUTES
      default: 5
      minimum: 1
      maximum: 60
    EncounterCacheMaxResultsPerQuery:
      type: integer
      description: Maximum encounter results loaded per cache query for Actor behavior execution
      env: CHARACTER_ENCOUNTER_CACHE_MAX_RESULTS_PER_QUERY
      default: 50
      minimum: 10
      maximum: 500
    MaxParticipantsPerEncounter:
      type: integer
      description: Maximum participants allowed per encounter (caps O(N^2) pair index creation)
      env: CHARACTER_ENCOUNTER_MAX_PARTICIPANTS_PER_ENCOUNTER
      default: 20
      minimum: 2
      maximum: 100
    DuplicateTimestampToleranceMinutes:
      type: integer
      description: Time window in minutes for duplicate encounter detection. Encounters with the same participants, type, and timestamp within this window are considered duplicates.
      env: CHARACTER_ENCOUNTER_DUPLICATE_TIMESTAMP_TOLERANCE_MINUTES
      default: 5
      minimum: 0
      maximum: 60
