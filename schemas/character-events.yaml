openapi: 3.0.3
info:
  title: Character Service Events
  description: |
    Event models for Character service RabbitMQ pub/sub via MassTransit.
    Lifecycle events are auto-generated from x-lifecycle definition.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
  x-event-subscriptions: []  # Character service doesn't subscribe to external events
  x-event-publications:
    # Character lifecycle events (auto-generated from x-lifecycle)
    - topic: character.created
      event: CharacterCreatedEvent
      description: Published when a new character is created
    - topic: character.updated
      event: CharacterUpdatedEvent
      description: Published when a character is updated
    - topic: character.deleted
      event: CharacterDeletedEvent
      description: Published when a character is soft-deleted
    - topic: character.compressed
      event: CharacterCompressedEvent
      description: Published when a character is compressed to archive format

# Lifecycle events auto-generated from this definition
# Output: schemas/Generated/character-lifecycle-events.yaml
x-lifecycle:
  Character:
    model:
      characterId:
        type: string
        format: uuid
        primary: true
        required: true
        description: Unique identifier for the character
      name:
        type: string
        required: true
        description: Display name of the character
      realmId:
        type: string
        format: uuid
        required: true
        description: Identifier of the realm the character belongs to
      speciesId:
        type: string
        format: uuid
        required: true
        description: Identifier of the species this character is
      birthDate:
        type: string
        format: date-time
        nullable: true  # NRT: Optional property MUST be nullable
        description: In-game birth date of the character
      deathDate:
        type: string
        format: date-time
        nullable: true  # NRT: Optional property MUST be nullable
        description: In-game death timestamp
      status:
        allOf:
          - $ref: 'character-api.yaml#/components/schemas/CharacterStatus'
        nullable: true  # NRT: Optional property MUST be nullable
        description: Current status of the character (e.g., active, inactive, deceased)
      createdAt:
        type: string
        format: date-time
        required: true
        description: Timestamp when the character was created
      updatedAt:
        type: string
        format: date-time
        nullable: true  # NRT: Optional property MUST be nullable
        description: Timestamp when the character was last updated


paths: {}  # Events don't have HTTP paths

components:
  schemas:
    CharacterCompressedEvent:
      type: object
      additionalProperties: false
      description: Published when a character is compressed to archive format
      required:
        - eventId
        - timestamp
        - characterId
        - deletedSourceData
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event
        timestamp:
          type: string
          format: date-time
          description: When the compression occurred
        characterId:
          type: string
          format: uuid
          description: ID of the compressed character
        deletedSourceData:
          type: boolean
          description: Whether source data was deleted after compression

# NOTE: Lifecycle events are auto-generated from x-lifecycle definition.
# CharacterCreatedEvent, CharacterUpdatedEvent, CharacterDeletedEvent
# are generated to schemas/Generated/character-lifecycle-events.yaml
