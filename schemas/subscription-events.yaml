openapi: 3.0.4
info:
  title: Subscription Service Events
  description: |
    Event models for Subscription service RabbitMQ pub/sub via lib-messaging.
    Publishes subscription state change events consumed by Auth and GameSession services.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
  x-event-subscriptions: []  # Subscription service doesn't subscribe to external events
  x-event-publications:
    # Subscription state change events
    - topic: subscription.updated
      event: SubscriptionUpdatedEvent
      description: Published when a subscription changes state (created, updated, cancelled, expired, renewed)

paths: {}  # Events don't have HTTP paths

components:
  schemas:
    SubscriptionUpdatedEvent:
      allOf:
        - $ref: 'common-events.yaml#/components/schemas/BaseServiceEvent'
      type: object
      additionalProperties: false
      description: |
        Published when a subscription changes state (created, updated, cancelled, expired).
        Auth service subscribes to this event to update session authorizations.
      required:
        - subscriptionId
        - accountId
        - serviceId
        - stubName
        - action
        - isActive
      properties:
        subscriptionId:
          type: string
          format: uuid
          description: ID of the subscription that changed
        accountId:
          type: string
          format: uuid
          description: ID of the account that owns the subscription
        serviceId:
          type: string
          format: uuid
          description: ID of the service (game) the subscription is for
        stubName:
          type: string
          description: Stub name of the service (e.g., "my-game")
        displayName:
          type: string
          nullable: true  # NRT: Optional property MUST be nullable
          description: Display name of the service
        action:
          $ref: 'subscription-api.yaml#/components/schemas/SubscriptionAction'
        isActive:
          type: boolean
          description: Whether the subscription is currently active
        expirationDate:
          type: string
          format: date-time
          nullable: true
          description: When the subscription expires (if applicable)
