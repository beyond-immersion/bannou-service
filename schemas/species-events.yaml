openapi: 3.0.4
info:
  title: Species Service Events
  description: |
    Event models for Species service RabbitMQ pub/sub via MassTransit.
    Lifecycle events are auto-generated from x-lifecycle definition.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
  x-event-subscriptions: []  # Species service doesn't subscribe to external events
  x-event-publications:
    # Species lifecycle events (auto-generated from x-lifecycle)
    - topic: species.created
      event: SpeciesCreatedEvent
      description: Published when a new species is created
    - topic: species.updated
      event: SpeciesUpdatedEvent
      description: Published when a species is updated
    - topic: species.deleted
      event: SpeciesDeletedEvent
      description: Published when a species is soft-deleted
    # Species merge events
    - topic: species.merged
      event: SpeciesMergedEvent
      description: Published when two species are merged together

# Lifecycle events auto-generated from this definition
# Output: schemas/Generated/species-lifecycle-events.yaml
x-lifecycle:
  Species:
    model:
      speciesId: { type: string, format: uuid, primary: true, required: true, description: "Unique identifier for the species" }
      code: { type: string, required: true, description: "Machine-readable code for the species" }
      name: { type: string, required: true, description: "Human-readable display name for the species" }
      description: { type: string, nullable: true, description: "Detailed description of the species characteristics and lore" }
      category: { type: string, nullable: true, description: "Category grouping for the species" }
      isPlayable: { type: boolean, required: true, description: "Whether players can create characters of this species" }
      isDeprecated: { type: boolean, required: true, description: "Whether this species is deprecated and should not be used for new characters" }
      deprecatedAt: { type: string, format: date-time, nullable: true, description: "Timestamp when the species was deprecated" }
      deprecationReason: { type: string, nullable: true, description: "Explanation for why the species was deprecated" }
      baseLifespan: { type: integer, description: "Average lifespan in years for this species" }
      maturityAge: { type: integer, description: "Age at which members of this species reach maturity" }
      traitModifiers: { type: object, additionalProperties: true, description: "Client-only trait modifiers. No Bannou plugin reads specific keys from this field by convention." }
      realmIds: { type: array, items: { type: string, format: uuid }, description: "IDs of realms where this species can exist" }
      metadata: { type: object, additionalProperties: true, nullable: true, description: "Client-only metadata. No Bannou plugin reads specific keys from this field by convention." }
      createdAt: { type: string, format: date-time, required: true, description: "Timestamp when the species was created" }
      updatedAt: { type: string, format: date-time, required: true, description: "Timestamp when the species was last updated" }

paths: {}  # Events don't have HTTP paths

components:
  schemas:
    # Species merge event (not auto-generated from lifecycle)
    SpeciesMergedEvent:
      allOf:
        - $ref: 'common-events.yaml#/components/schemas/BaseServiceEvent'
      type: object
      additionalProperties: false
      description: Published when two species are merged, with the source species being deprecated
      required:
        - sourceSpeciesId
        - targetSpeciesId
        - mergedCharacterCount
      properties:
        sourceSpeciesId:
          type: string
          format: uuid
          description: ID of the species being merged (deprecated after merge)
        sourceSpeciesCode:
          type: string
          nullable: true
          description: Code of the source species
        targetSpeciesId:
          type: string
          format: uuid
          description: ID of the species receiving the merge
        targetSpeciesCode:
          type: string
          nullable: true
          description: Code of the target species
        mergedCharacterCount:
          type: integer
          description: Number of characters that were migrated to the target species
