openapi: 3.0.3
info:
  title: Asset Service API
  version: 1.0.0
  description: |
    Asset management service for storage, versioning, and distribution of large binary assets.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    **Pre-signed URL Architecture**: All asset transfers use pre-signed URLs via MinIO/S3.
    WebSocket handles only metadata requests and progress notifications - never raw asset data.
    This bypasses Dapr's 4MB payload limits entirely.

    **Key Features**:
    - Individual asset upload/download via pre-signed URLs
    - Asset versioning with content-based hashing
    - Asset bundles (.bannou format) for grouped distribution
    - Asset search by type, tags, realm
    - Processing pipeline for textures, models, audio, behaviors

servers:
- url: http://localhost:3500/v1.0/invoke/bannou/method
  description: Dapr sidecar endpoint

paths:
  # ==========================================================================
  # Asset Upload Operations
  # ==========================================================================

  /assets/upload/request:
    post:
      summary: Request upload URL for a new asset
      description: |
        Generate a pre-signed URL for uploading a new asset directly to storage.
        For large files (>50MB), returns multipart upload configuration.
      operationId: requestUpload
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadRequest'
      responses:
        '200':
          description: Upload URL generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: Invalid request (filename, size, or content_type)
        '401':
          description: Not authenticated
        '403':
          description: Insufficient permissions

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/UploadRequest\"\
        ,\n  \"$defs\": {\n    \"UploadRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"filename\"\
        ,\n        \"size\",\n        \"content_type\"\n      ],\n      \"properties\": {\n        \"filename\": {\n     \
        \     \"type\": \"string\",\n          \"description\": \"Original filename with extension\"\n        },\n       \
        \ \"size\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\",\n          \"description\": \"File
        size in bytes\"\n        },\n        \"content_type\": {\n          \"type\": \"string\",\n          \"description\"\
        : \"MIME content type (e.g., image/png, model/gltf-binary)\"\n        },\n        \"metadata\": {\n          \"$ref\"\
        : \"#/$defs/AssetMetadataInput\"\n        }\n      }\n    },\n    \"AssetMetadataInput\": {\n      \"type\": \"object\"\
        ,\n      \"description\": \"User-provided metadata for asset categorization\",\n      \"properties\": {\n        \"\
        asset_type\": {\n          \"$ref\": \"#/$defs/AssetType\"\n        },\n        \"realm\": {\n          \"$ref\":
        \"#/$defs/Realm\"\n        },\n        \"tags\": {\n          \"type\": \"array\",\n          \"items\": {\n     \
        \       \"type\": \"string\"\n          },\n          \"description\": \"Searchable tags for the asset\"\n       \
        \ }\n      }\n    },\n    \"AssetType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"texture\",\n\
        \        \"model\",\n        \"audio\",\n        \"behavior\",\n        \"bundle\",\n        \"prefab\",\n       \
        \ \"other\"\n      ],\n      \"description\": \"Type classification for assets\"\n    },\n    \"Realm\": {\n     \
        \ \"type\": \"string\",\n      \"enum\": [\n        \"omega\",\n        \"arcadia\",\n        \"fantasia\",\n    \
        \    \"shared\"\n      ],\n      \"description\": \"Game realm the asset belongs to\"\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/UploadResponse\"\
        ,\n  \"$defs\": {\n    \"UploadResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"upload_id\"\
        ,\n        \"upload_url\",\n        \"expires_at\"\n      ],\n      \"properties\": {\n        \"upload_id\": {\n\
        \          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"Unique upload session
        identifier\"\n        },\n        \"upload_url\": {\n          \"type\": \"string\",\n          \"format\": \"uri\"\
        ,\n          \"description\": \"Pre-signed URL for uploading the file\"\n        },\n        \"expires_at\": {\n \
        \         \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"When the upload
        URL expires\"\n        },\n        \"multipart\": {\n          \"$ref\": \"#/$defs/MultipartConfig\"\n        }\n\
        \      }\n    },\n    \"MultipartConfig\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"required\"\
        : {\n          \"type\": \"boolean\",\n          \"description\": \"Whether multipart upload is required for this
        file size\"\n        },\n        \"part_size\": {\n          \"type\": \"integer\",\n          \"description\": \"\
        Size of each part in bytes\"\n        },\n        \"max_parts\": {\n          \"type\": \"integer\",\n          \"\
        description\": \"Maximum number of parts\"\n        },\n        \"upload_urls\": {\n          \"type\": \"array\"\
        ,\n          \"items\": {\n            \"$ref\": \"#/$defs/PartUploadInfo\"\n          }\n        }\n      }\n   \
        \ },\n    \"PartUploadInfo\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"part_number\",\n  \
        \      \"upload_url\"\n      ],\n      \"properties\": {\n        \"part_number\": {\n          \"type\": \"integer\"\
        ,\n          \"description\": \"Part number (1-based)\"\n        },\n        \"upload_url\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uri\",\n          \"description\": \"Pre-signed URL for uploading this part\"\
        \n        },\n        \"min_size\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\",\n      \
        \    \"description\": \"Minimum size for this part\"\n        },\n        \"max_size\": {\n          \"type\": \"\
        integer\",\n          \"format\": \"int64\",\n          \"description\": \"Maximum size for this part\"\n        }\n\
        \      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Request upload URL for a new asset\",\n  \"description\": \"Generate a pre-signed
        URL for uploading a new asset directly to storage.\\nFor large files (>50MB), returns multipart upload configuration.\\\
        n\",\n  \"tags\": [\n    \"Assets\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"requestUpload\"\n}"
  /assets/upload/complete:
    post:
      summary: Mark upload as complete, trigger processing
      description: |
        Called after the client has uploaded the file to the pre-signed URL.
        Triggers the asset processing pipeline (texture conversion, model validation, etc.)
        and emits completion events via WebSocket.
      operationId: completeUpload
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteUploadRequest'
      responses:
        '201':
          description: Asset created, processing started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetMetadata'
        '400':
          description: Invalid upload_id or missing parts for multipart
        '404':
          description: Upload session not found or expired

  # ==========================================================================
  # Asset Retrieval Operations
  # ==========================================================================

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CompleteUploadRequest\"\
        ,\n  \"$defs\": {\n    \"CompleteUploadRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        upload_id\"\n      ],\n      \"properties\": {\n        \"upload_id\": {\n          \"type\": \"string\",\n      \
        \    \"format\": \"uuid\",\n          \"description\": \"Upload session ID from requestUpload\"\n        },\n    \
        \    \"parts\": {\n          \"type\": \"array\",\n          \"description\": \"For multipart uploads - ETags of completed
        parts\",\n          \"items\": {\n            \"$ref\": \"#/$defs/CompletedPart\"\n          }\n        }\n      }\n\
        \    },\n    \"CompletedPart\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"part_number\",\n\
        \        \"etag\"\n      ],\n      \"properties\": {\n        \"part_number\": {\n          \"type\": \"integer\"\
        ,\n          \"description\": \"Part number (1-based)\"\n        },\n        \"etag\": {\n          \"type\": \"string\"\
        ,\n          \"description\": \"ETag returned from part upload\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AssetMetadata\"\
        ,\n  \"$defs\": {\n    \"AssetMetadata\": {\n      \"type\": \"object\",\n      \"description\": \"Complete asset
        metadata including system-generated fields\",\n      \"properties\": {\n        \"asset_id\": {\n          \"type\"\
        : \"string\",\n          \"description\": \"Unique asset identifier\"\n        },\n        \"content_hash\": {\n \
        \         \"type\": \"string\",\n          \"description\": \"SHA256 hash of file contents\"\n        },\n       \
        \ \"filename\": {\n          \"type\": \"string\",\n          \"description\": \"Original filename\"\n        },\n\
        \        \"content_type\": {\n          \"type\": \"string\",\n          \"description\": \"MIME content type\"\n\
        \        },\n        \"size\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\",\n          \"\
        description\": \"File size in bytes\"\n        },\n        \"asset_type\": {\n          \"$ref\": \"#/$defs/AssetType\"\
        \n        },\n        \"realm\": {\n          \"$ref\": \"#/$defs/Realm\"\n        },\n        \"tags\": {\n     \
        \     \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n  \
        \      \"processing_status\": {\n          \"$ref\": \"#/$defs/ProcessingStatus\"\n        },\n        \"is_archived\"\
        : {\n          \"type\": \"boolean\",\n          \"description\": \"Whether the asset is in cold/archival storage\"\
        ,\n          \"default\": false\n        },\n        \"created_at\": {\n          \"type\": \"string\",\n        \
        \  \"format\": \"date-time\"\n        },\n        \"updated_at\": {\n          \"type\": \"string\",\n          \"\
        format\": \"date-time\"\n        }\n      }\n    },\n    \"AssetType\": {\n      \"type\": \"string\",\n      \"enum\"\
        : [\n        \"texture\",\n        \"model\",\n        \"audio\",\n        \"behavior\",\n        \"bundle\",\n  \
        \      \"prefab\",\n        \"other\"\n      ],\n      \"description\": \"Type classification for assets\"\n    },\n\
        \    \"Realm\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"omega\",\n        \"arcadia\",\n    \
        \    \"fantasia\",\n        \"shared\"\n      ],\n      \"description\": \"Game realm the asset belongs to\"\n   \
        \ },\n    \"ProcessingStatus\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"pending\",\n        \"\
        processing\",\n        \"complete\",\n        \"failed\"\n      ],\n      \"description\": \"Asset processing pipeline
        status\"\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Mark upload as complete, trigger processing\",\n  \"description\": \"Called
        after the client has uploaded the file to the pre-signed URL.\\nTriggers the asset processing pipeline (texture conversion,
        model validation, etc.)\\nand emits completion events via WebSocket.\\n\",\n  \"tags\": [\n    \"Assets\"\n  ],\n\
        \  \"deprecated\": false,\n  \"operationId\": \"completeUpload\"\n}"
  /assets/get:
    post:
      summary: Get asset metadata and download URL
      description: |
        Retrieve asset metadata and generate a pre-signed download URL.
        Specify version to download a specific version, or omit for latest.
      operationId: getAsset
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetAssetRequest'
      responses:
        '200':
          description: Asset metadata with download URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetWithDownloadUrl'
        '404':
          description: Asset not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GetAssetRequest\"\
        ,\n  \"$defs\": {\n    \"GetAssetRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"asset_id\"\
        \n      ],\n      \"properties\": {\n        \"asset_id\": {\n          \"type\": \"string\",\n          \"description\"\
        : \"Asset identifier\"\n        },\n        \"version\": {\n          \"type\": \"string\",\n          \"default\"\
        : \"latest\",\n          \"description\": \"Version ID or 'latest'\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AssetWithDownloadUrl\"\
        ,\n  \"$defs\": {\n    \"AssetWithDownloadUrl\": {\n      \"type\": \"object\",\n      \"properties\": {\n       \
        \ \"asset_id\": {\n          \"type\": \"string\"\n        },\n        \"version_id\": {\n          \"type\": \"string\"\
        \n        },\n        \"download_url\": {\n          \"type\": \"string\",\n          \"format\": \"uri\",\n     \
        \     \"description\": \"Pre-signed download URL\"\n        },\n        \"expires_at\": {\n          \"type\": \"\
        string\",\n          \"format\": \"date-time\",\n          \"description\": \"When the download URL expires\"\n  \
        \      },\n        \"size\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\"\n        },\n  \
        \      \"content_hash\": {\n          \"type\": \"string\"\n        },\n        \"content_type\": {\n          \"\
        type\": \"string\"\n        },\n        \"metadata\": {\n          \"$ref\": \"#/$defs/AssetMetadata\"\n        }\n\
        \      }\n    },\n    \"AssetMetadata\": {\n      \"type\": \"object\",\n      \"description\": \"Complete asset metadata
        including system-generated fields\",\n      \"properties\": {\n        \"asset_id\": {\n          \"type\": \"string\"\
        ,\n          \"description\": \"Unique asset identifier\"\n        },\n        \"content_hash\": {\n          \"type\"\
        : \"string\",\n          \"description\": \"SHA256 hash of file contents\"\n        },\n        \"filename\": {\n\
        \          \"type\": \"string\",\n          \"description\": \"Original filename\"\n        },\n        \"content_type\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"MIME content type\"\n        },\n        \"size\"\
        : {\n          \"type\": \"integer\",\n          \"format\": \"int64\",\n          \"description\": \"File size in
        bytes\"\n        },\n        \"asset_type\": {\n          \"$ref\": \"#/$defs/AssetType\"\n        },\n        \"\
        realm\": {\n          \"$ref\": \"#/$defs/Realm\"\n        },\n        \"tags\": {\n          \"type\": \"array\"\
        ,\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"processing_status\"\
        : {\n          \"$ref\": \"#/$defs/ProcessingStatus\"\n        },\n        \"is_archived\": {\n          \"type\"\
        : \"boolean\",\n          \"description\": \"Whether the asset is in cold/archival storage\",\n          \"default\"\
        : false\n        },\n        \"created_at\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\
        \n        },\n        \"updated_at\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n  \
        \      }\n      }\n    },\n    \"AssetType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"texture\"\
        ,\n        \"model\",\n        \"audio\",\n        \"behavior\",\n        \"bundle\",\n        \"prefab\",\n     \
        \   \"other\"\n      ],\n      \"description\": \"Type classification for assets\"\n    },\n    \"Realm\": {\n   \
        \   \"type\": \"string\",\n      \"enum\": [\n        \"omega\",\n        \"arcadia\",\n        \"fantasia\",\n  \
        \      \"shared\"\n      ],\n      \"description\": \"Game realm the asset belongs to\"\n    },\n    \"ProcessingStatus\"\
        : {\n      \"type\": \"string\",\n      \"enum\": [\n        \"pending\",\n        \"processing\",\n        \"complete\"\
        ,\n        \"failed\"\n      ],\n      \"description\": \"Asset processing pipeline status\"\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get asset metadata and download URL\",\n  \"description\": \"Retrieve asset
        metadata and generate a pre-signed download URL.\\nSpecify version to download a specific version, or omit for latest.\\\
        n\",\n  \"tags\": [\n    \"Assets\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"getAsset\"\n}"
  /assets/list-versions:
    post:
      summary: List all versions of an asset
      description: |
        Retrieve version history for an asset with pagination.
        Includes version IDs, creation timestamps, and archive status.
      operationId: listAssetVersions
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListVersionsRequest'
      responses:
        '200':
          description: List of asset versions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetVersionList'
        '404':
          description: Asset not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ListVersionsRequest\"\
        ,\n  \"$defs\": {\n    \"ListVersionsRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        asset_id\"\n      ],\n      \"properties\": {\n        \"asset_id\": {\n          \"type\": \"string\"\n        },\n\
        \        \"limit\": {\n          \"type\": \"integer\",\n          \"default\": 50\n        },\n        \"offset\"\
        : {\n          \"type\": \"integer\",\n          \"default\": 0\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AssetVersionList\"\
        ,\n  \"$defs\": {\n    \"AssetVersionList\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"asset_id\"\
        : {\n          \"type\": \"string\"\n        },\n        \"versions\": {\n          \"type\": \"array\",\n       \
        \   \"items\": {\n            \"$ref\": \"#/$defs/AssetVersion\"\n          }\n        },\n        \"total\": {\n\
        \          \"type\": \"integer\"\n        },\n        \"limit\": {\n          \"type\": \"integer\"\n        },\n\
        \        \"offset\": {\n          \"type\": \"integer\"\n        }\n      }\n    },\n    \"AssetVersion\": {\n   \
        \   \"type\": \"object\",\n      \"properties\": {\n        \"version_id\": {\n          \"type\": \"string\"\n  \
        \      },\n        \"created_at\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n     \
        \   },\n        \"size\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\"\n        },\n     \
        \   \"is_archived\": {\n          \"type\": \"boolean\",\n          \"description\": \"Whether this version is in
        cold storage\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"List all versions of an asset\",\n  \"description\": \"Retrieve version history
        for an asset with pagination.\\nIncludes version IDs, creation timestamps, and archive status.\\n\",\n  \"tags\":
        [\n    \"Assets\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"listAssetVersions\"\n}"
  /assets/search:
    post:
      summary: Search assets by tags, type, or realm
      description: |
        Search assets using various filters with pagination.
        All filters are optional and combine with AND logic.
      operationId: searchAssets
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssetSearchRequest'
      responses:
        '200':
          description: Matching assets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetSearchResult'

  # ==========================================================================
  # Bundle Operations
  # ==========================================================================

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AssetSearchRequest\"\
        ,\n  \"$defs\": {\n    \"AssetSearchRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"asset_type\"\
        ,\n        \"realm\"\n      ],\n      \"properties\": {\n        \"tags\": {\n          \"type\": \"array\",\n   \
        \       \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"asset_type\": {\n     \
        \     \"$ref\": \"#/$defs/AssetType\"\n        },\n        \"realm\": {\n          \"$ref\": \"#/$defs/Realm\"\n \
        \       },\n        \"content_type\": {\n          \"type\": \"string\",\n          \"description\": \"MIME content
        type filter\"\n        },\n        \"limit\": {\n          \"type\": \"integer\",\n          \"default\": 50\n   \
        \     },\n        \"offset\": {\n          \"type\": \"integer\",\n          \"default\": 0\n        }\n      }\n\
        \    },\n    \"AssetType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"texture\",\n        \"model\"\
        ,\n        \"audio\",\n        \"behavior\",\n        \"bundle\",\n        \"prefab\",\n        \"other\"\n      ],\n\
        \      \"description\": \"Type classification for assets\"\n    },\n    \"Realm\": {\n      \"type\": \"string\",\n\
        \      \"enum\": [\n        \"omega\",\n        \"arcadia\",\n        \"fantasia\",\n        \"shared\"\n      ],\n\
        \      \"description\": \"Game realm the asset belongs to\"\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AssetSearchResult\"\
        ,\n  \"$defs\": {\n    \"AssetSearchResult\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"\
        assets\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/AssetMetadata\"\
        \n          }\n        },\n        \"total\": {\n          \"type\": \"integer\"\n        },\n        \"limit\": {\n\
        \          \"type\": \"integer\"\n        },\n        \"offset\": {\n          \"type\": \"integer\"\n        }\n\
        \      }\n    },\n    \"AssetMetadata\": {\n      \"type\": \"object\",\n      \"description\": \"Complete asset metadata
        including system-generated fields\",\n      \"properties\": {\n        \"asset_id\": {\n          \"type\": \"string\"\
        ,\n          \"description\": \"Unique asset identifier\"\n        },\n        \"content_hash\": {\n          \"type\"\
        : \"string\",\n          \"description\": \"SHA256 hash of file contents\"\n        },\n        \"filename\": {\n\
        \          \"type\": \"string\",\n          \"description\": \"Original filename\"\n        },\n        \"content_type\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"MIME content type\"\n        },\n        \"size\"\
        : {\n          \"type\": \"integer\",\n          \"format\": \"int64\",\n          \"description\": \"File size in
        bytes\"\n        },\n        \"asset_type\": {\n          \"$ref\": \"#/$defs/AssetType\"\n        },\n        \"\
        realm\": {\n          \"$ref\": \"#/$defs/Realm\"\n        },\n        \"tags\": {\n          \"type\": \"array\"\
        ,\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"processing_status\"\
        : {\n          \"$ref\": \"#/$defs/ProcessingStatus\"\n        },\n        \"is_archived\": {\n          \"type\"\
        : \"boolean\",\n          \"description\": \"Whether the asset is in cold/archival storage\",\n          \"default\"\
        : false\n        },\n        \"created_at\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\
        \n        },\n        \"updated_at\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n  \
        \      }\n      }\n    },\n    \"AssetType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"texture\"\
        ,\n        \"model\",\n        \"audio\",\n        \"behavior\",\n        \"bundle\",\n        \"prefab\",\n     \
        \   \"other\"\n      ],\n      \"description\": \"Type classification for assets\"\n    },\n    \"Realm\": {\n   \
        \   \"type\": \"string\",\n      \"enum\": [\n        \"omega\",\n        \"arcadia\",\n        \"fantasia\",\n  \
        \      \"shared\"\n      ],\n      \"description\": \"Game realm the asset belongs to\"\n    },\n    \"ProcessingStatus\"\
        : {\n      \"type\": \"string\",\n      \"enum\": [\n        \"pending\",\n        \"processing\",\n        \"complete\"\
        ,\n        \"failed\"\n      ],\n      \"description\": \"Asset processing pipeline status\"\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Search assets by tags, type, or realm\",\n  \"description\": \"Search assets
        using various filters with pagination.\\nAll filters are optional and combine with AND logic.\\n\",\n  \"tags\": [\n\
        \    \"Assets\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"searchAssets\"\n}"
  /bundles/create:
    post:
      summary: Create asset bundle from multiple assets
      description: |
        Create a .bannou bundle containing multiple assets.
        For large bundles, processing is delegated to the processing pool.
        Completion notification sent via WebSocket event.
      operationId: createBundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBundleRequest'
      responses:
        '200':
          description: Bundle creation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBundleResponse'
        '400':
          description: Invalid asset_ids or bundle_id

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CreateBundleRequest\"\
        ,\n  \"$defs\": {\n    \"CreateBundleRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        bundle_id\",\n        \"asset_ids\"\n      ],\n      \"properties\": {\n        \"bundle_id\": {\n          \"type\"\
        : \"string\",\n          \"description\": \"Unique bundle identifier\"\n        },\n        \"version\": {\n     \
        \     \"type\": \"string\",\n          \"default\": \"1.0.0\",\n          \"description\": \"Bundle version string\"\
        \n        },\n        \"asset_ids\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\"\
        : \"string\"\n          },\n          \"description\": \"List of asset IDs to include in the bundle\"\n        },\n\
        \        \"compression\": {\n          \"$ref\": \"#/$defs/CompressionType\"\n        },\n        \"metadata\": {\n\
        \          \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"description\": \"Custom metadata
        for the bundle\"\n        }\n      }\n    },\n    \"CompressionType\": {\n      \"type\": \"string\",\n      \"enum\"\
        : [\n        \"lz4\",\n        \"lzma\",\n        \"none\"\n      ],\n      \"description\": \"Compression algorithm
        for bundles\"\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CreateBundleResponse\"\
        ,\n  \"$defs\": {\n    \"CreateBundleResponse\": {\n      \"type\": \"object\",\n      \"properties\": {\n       \
        \ \"bundle_id\": {\n          \"type\": \"string\"\n        },\n        \"status\": {\n          \"type\": \"string\"\
        ,\n          \"enum\": [\n            \"queued\",\n            \"processing\",\n            \"ready\",\n         \
        \   \"failed\"\n          ],\n          \"description\": \"Bundle creation status\"\n        },\n        \"estimated_size\"\
        : {\n          \"type\": \"integer\",\n          \"format\": \"int64\",\n          \"description\": \"Estimated bundle
        size in bytes\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Create asset bundle from multiple assets\",\n  \"description\": \"Create
        a .bannou bundle containing multiple assets.\\nFor large bundles, processing is delegated to the processing pool.\\
        nCompletion notification sent via WebSocket event.\\n\",\n  \"tags\": [\n    \"Bundles\"\n  ],\n  \"deprecated\":
        false,\n  \"operationId\": \"createBundle\"\n}"
  /bundles/get:
    post:
      summary: Get bundle manifest and download URL
      description: |
        Retrieve bundle metadata and generate a pre-signed download URL.
        Supports both native .bannou format and ZIP conversion (cached).
      operationId: getBundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetBundleRequest'
      responses:
        '200':
          description: Bundle manifest with download URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BundleWithDownloadUrl'
        '404':
          description: Bundle not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GetBundleRequest\"\
        ,\n  \"$defs\": {\n    \"GetBundleRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"bundle_id\"\
        \n      ],\n      \"properties\": {\n        \"bundle_id\": {\n          \"type\": \"string\"\n        },\n      \
        \  \"format\": {\n          \"$ref\": \"#/$defs/BundleFormat\"\n        }\n      }\n    },\n    \"BundleFormat\":
        {\n      \"type\": \"string\",\n      \"enum\": [\n        \"bannou\",\n        \"zip\"\n      ],\n      \"description\"\
        : \"Bundle file format\"\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/BundleWithDownloadUrl\"\
        ,\n  \"$defs\": {\n    \"BundleWithDownloadUrl\": {\n      \"type\": \"object\",\n      \"properties\": {\n      \
        \  \"bundle_id\": {\n          \"type\": \"string\"\n        },\n        \"version\": {\n          \"type\": \"string\"\
        \n        },\n        \"download_url\": {\n          \"type\": \"string\",\n          \"format\": \"uri\"\n      \
        \  },\n        \"format\": {\n          \"$ref\": \"#/$defs/BundleFormat\"\n        },\n        \"expires_at\": {\n\
        \          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n        \"size\": {\n         \
        \ \"type\": \"integer\",\n          \"format\": \"int64\"\n        },\n        \"asset_count\": {\n          \"type\"\
        : \"integer\"\n        },\n        \"from_cache\": {\n          \"type\": \"boolean\",\n          \"description\"\
        : \"True if ZIP format was served from conversion cache\"\n        }\n      }\n    },\n    \"BundleFormat\": {\n \
        \     \"type\": \"string\",\n      \"enum\": [\n        \"bannou\",\n        \"zip\"\n      ],\n      \"description\"\
        : \"Bundle file format\"\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get bundle manifest and download URL\",\n  \"description\": \"Retrieve bundle
        metadata and generate a pre-signed download URL.\\nSupports both native .bannou format and ZIP conversion (cached).\\\
        n\",\n  \"tags\": [\n    \"Bundles\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"getBundle\"\n}"
  /bundles/upload/request:
    post:
      summary: Request upload URL for a pre-made bundle
      description: |
        Upload a pre-built bundle (.bannou or .zip format).
        After upload, the bundle undergoes validation before registration.
      operationId: requestBundleUpload
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BundleUploadRequest'
      responses:
        '200':
          description: Upload URL generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: Invalid filename or size

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/BundleUploadRequest\"\
        ,\n  \"$defs\": {\n    \"BundleUploadRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        filename\",\n        \"size\"\n      ],\n      \"properties\": {\n        \"filename\": {\n          \"type\": \"\
        string\",\n          \"description\": \"Must end with .bannou or .zip\"\n        },\n        \"size\": {\n       \
        \   \"type\": \"integer\",\n          \"format\": \"int64\"\n        },\n        \"manifest_preview\": {\n       \
        \   \"$ref\": \"#/$defs/BundleManifestPreview\"\n        }\n      }\n    },\n    \"BundleManifestPreview\": {\n  \
        \    \"type\": \"object\",\n      \"description\": \"Preview of bundle manifest for validation\",\n      \"properties\"\
        : {\n        \"bundle_id\": {\n          \"type\": \"string\"\n        },\n        \"version\": {\n          \"type\"\
        : \"string\"\n        },\n        \"asset_count\": {\n          \"type\": \"integer\"\n        }\n      }\n    }\n\
        \  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/UploadResponse\"\
        ,\n  \"$defs\": {\n    \"UploadResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"upload_id\"\
        ,\n        \"upload_url\",\n        \"expires_at\"\n      ],\n      \"properties\": {\n        \"upload_id\": {\n\
        \          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"Unique upload session
        identifier\"\n        },\n        \"upload_url\": {\n          \"type\": \"string\",\n          \"format\": \"uri\"\
        ,\n          \"description\": \"Pre-signed URL for uploading the file\"\n        },\n        \"expires_at\": {\n \
        \         \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"When the upload
        URL expires\"\n        },\n        \"multipart\": {\n          \"$ref\": \"#/$defs/MultipartConfig\"\n        }\n\
        \      }\n    },\n    \"MultipartConfig\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"required\"\
        : {\n          \"type\": \"boolean\",\n          \"description\": \"Whether multipart upload is required for this
        file size\"\n        },\n        \"part_size\": {\n          \"type\": \"integer\",\n          \"description\": \"\
        Size of each part in bytes\"\n        },\n        \"max_parts\": {\n          \"type\": \"integer\",\n          \"\
        description\": \"Maximum number of parts\"\n        },\n        \"upload_urls\": {\n          \"type\": \"array\"\
        ,\n          \"items\": {\n            \"$ref\": \"#/$defs/PartUploadInfo\"\n          }\n        }\n      }\n   \
        \ },\n    \"PartUploadInfo\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"part_number\",\n  \
        \      \"upload_url\"\n      ],\n      \"properties\": {\n        \"part_number\": {\n          \"type\": \"integer\"\
        ,\n          \"description\": \"Part number (1-based)\"\n        },\n        \"upload_url\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uri\",\n          \"description\": \"Pre-signed URL for uploading this part\"\
        \n        },\n        \"min_size\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\",\n      \
        \    \"description\": \"Minimum size for this part\"\n        },\n        \"max_size\": {\n          \"type\": \"\
        integer\",\n          \"format\": \"int64\",\n          \"description\": \"Maximum size for this part\"\n        }\n\
        \      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Request upload URL for a pre-made bundle\",\n  \"description\": \"Upload
        a pre-built bundle (.bannou or .zip format).\\nAfter upload, the bundle undergoes validation before registration.\\\
        n\",\n  \"tags\": [\n    \"Bundles\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"requestBundleUpload\"\n\
        }"
components:
  schemas:
    # ==========================================================================
    # Enums
    # ==========================================================================

    AssetType:
      type: string
      enum:
      - texture
      - model
      - audio
      - behavior
      - bundle
      - prefab
      - other
      description: Type classification for assets

    Realm:
      type: string
      enum:
      - omega
      - arcadia
      - fantasia
      - shared
      description: Game realm the asset belongs to

    ProcessingStatus:
      type: string
      enum:
      - pending
      - processing
      - complete
      - failed
      description: Asset processing pipeline status

    CompressionType:
      type: string
      enum:
      - lz4
      - lzma
      - none
      description: Compression algorithm for bundles

    BundleFormat:
      type: string
      enum:
      - bannou
      - zip
      description: Bundle file format

    # ==========================================================================
    # Upload Request/Response
    # ==========================================================================

    UploadRequest:
      type: object
      required:
      - filename
      - size
      - content_type
      properties:
        filename:
          type: string
          description: Original filename with extension
        size:
          type: integer
          format: int64
          description: File size in bytes
        content_type:
          type: string
          description: MIME content type (e.g., image/png, model/gltf-binary)
        metadata:
          $ref: '#/components/schemas/AssetMetadataInput'

    UploadResponse:
      type: object
      required:
      - upload_id
      - upload_url
      - expires_at
      properties:
        upload_id:
          type: string
          format: uuid
          description: Unique upload session identifier
        upload_url:
          type: string
          format: uri
          description: Pre-signed URL for uploading the file
        expires_at:
          type: string
          format: date-time
          description: When the upload URL expires
        multipart:
          $ref: '#/components/schemas/MultipartConfig'

    CompleteUploadRequest:
      type: object
      required:
      - upload_id
      properties:
        upload_id:
          type: string
          format: uuid
          description: Upload session ID from requestUpload
        parts:
          type: array
          description: For multipart uploads - ETags of completed parts
          items:
            $ref: '#/components/schemas/CompletedPart'

    CompletedPart:
      type: object
      required:
      - part_number
      - etag
      properties:
        part_number:
          type: integer
          description: Part number (1-based)
        etag:
          type: string
          description: ETag returned from part upload

    MultipartConfig:
      type: object
      properties:
        required:
          type: boolean
          description: Whether multipart upload is required for this file size
        part_size:
          type: integer
          description: Size of each part in bytes
        max_parts:
          type: integer
          description: Maximum number of parts
        upload_urls:
          type: array
          items:
            $ref: '#/components/schemas/PartUploadInfo'

    PartUploadInfo:
      type: object
      required:
      - part_number
      - upload_url
      properties:
        part_number:
          type: integer
          description: Part number (1-based)
        upload_url:
          type: string
          format: uri
          description: Pre-signed URL for uploading this part
        min_size:
          type: integer
          format: int64
          description: Minimum size for this part
        max_size:
          type: integer
          format: int64
          description: Maximum size for this part

    # ==========================================================================
    # Asset Metadata
    # ==========================================================================

    AssetMetadataInput:
      type: object
      description: User-provided metadata for asset categorization
      properties:
        asset_type:
          $ref: '#/components/schemas/AssetType'
        realm:
          $ref: '#/components/schemas/Realm'
        tags:
          type: array
          items:
            type: string
          description: Searchable tags for the asset

    AssetMetadata:
      type: object
      description: Complete asset metadata including system-generated fields
      properties:
        asset_id:
          type: string
          description: Unique asset identifier
        content_hash:
          type: string
          description: SHA256 hash of file contents
        filename:
          type: string
          description: Original filename
        content_type:
          type: string
          description: MIME content type
        size:
          type: integer
          format: int64
          description: File size in bytes
        asset_type:
          $ref: '#/components/schemas/AssetType'
        realm:
          $ref: '#/components/schemas/Realm'
        tags:
          type: array
          items:
            type: string
        processing_status:
          $ref: '#/components/schemas/ProcessingStatus'
        is_archived:
          type: boolean
          description: Whether the asset is in cold/archival storage
          default: false
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # ==========================================================================
    # Asset Retrieval
    # ==========================================================================

    GetAssetRequest:
      type: object
      required:
      - asset_id
      properties:
        asset_id:
          type: string
          description: Asset identifier
        version:
          type: string
          default: latest
          description: Version ID or 'latest'

    AssetWithDownloadUrl:
      type: object
      properties:
        asset_id:
          type: string
        version_id:
          type: string
        download_url:
          type: string
          format: uri
          description: Pre-signed download URL
        expires_at:
          type: string
          format: date-time
          description: When the download URL expires
        size:
          type: integer
          format: int64
        content_hash:
          type: string
        content_type:
          type: string
        metadata:
          $ref: '#/components/schemas/AssetMetadata'

    # ==========================================================================
    # Version Listing
    # ==========================================================================

    ListVersionsRequest:
      type: object
      required:
      - asset_id
      properties:
        asset_id:
          type: string
        limit:
          type: integer
          default: 50
        offset:
          type: integer
          default: 0

    AssetVersionList:
      type: object
      properties:
        asset_id:
          type: string
        versions:
          type: array
          items:
            $ref: '#/components/schemas/AssetVersion'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    AssetVersion:
      type: object
      properties:
        version_id:
          type: string
        created_at:
          type: string
          format: date-time
        size:
          type: integer
          format: int64
        is_archived:
          type: boolean
          description: Whether this version is in cold storage

    # ==========================================================================
    # Asset Search
    # ==========================================================================

    AssetSearchRequest:
      type: object
      required:
      - asset_type
      - realm
      properties:
        tags:
          type: array
          items:
            type: string
        asset_type:
          $ref: '#/components/schemas/AssetType'
        realm:
          $ref: '#/components/schemas/Realm'
        content_type:
          type: string
          description: MIME content type filter
        limit:
          type: integer
          default: 50
        offset:
          type: integer
          default: 0

    AssetSearchResult:
      type: object
      properties:
        assets:
          type: array
          items:
            $ref: '#/components/schemas/AssetMetadata'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    # ==========================================================================
    # Bundle Operations
    # ==========================================================================

    CreateBundleRequest:
      type: object
      required:
      - bundle_id
      - asset_ids
      properties:
        bundle_id:
          type: string
          description: Unique bundle identifier
        version:
          type: string
          default: 1.0.0
          description: Bundle version string
        asset_ids:
          type: array
          items:
            type: string
          description: List of asset IDs to include in the bundle
        compression:
          $ref: '#/components/schemas/CompressionType'
        metadata:
          type: object
          additionalProperties: true
          description: Custom metadata for the bundle

    CreateBundleResponse:
      type: object
      properties:
        bundle_id:
          type: string
        status:
          type: string
          enum:
          - queued
          - processing
          - ready
          - failed
          description: Bundle creation status
        estimated_size:
          type: integer
          format: int64
          description: Estimated bundle size in bytes

    GetBundleRequest:
      type: object
      required:
      - bundle_id
      properties:
        bundle_id:
          type: string
        format:
          $ref: '#/components/schemas/BundleFormat'

    BundleWithDownloadUrl:
      type: object
      properties:
        bundle_id:
          type: string
        version:
          type: string
        download_url:
          type: string
          format: uri
        format:
          $ref: '#/components/schemas/BundleFormat'
        expires_at:
          type: string
          format: date-time
        size:
          type: integer
          format: int64
        asset_count:
          type: integer
        from_cache:
          type: boolean
          description: True if ZIP format was served from conversion cache

    BundleUploadRequest:
      type: object
      required:
      - filename
      - size
      properties:
        filename:
          type: string
          description: Must end with .bannou or .zip
        size:
          type: integer
          format: int64
        manifest_preview:
          $ref: '#/components/schemas/BundleManifestPreview'

    BundleManifestPreview:
      type: object
      description: Preview of bundle manifest for validation
      properties:
        bundle_id:
          type: string
        version:
          type: string
        asset_count:
          type: integer
