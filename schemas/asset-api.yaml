openapi: 3.0.3
info:
  title: Asset Service API
  version: 1.0.0
  description: |
    Asset management service for storage, versioning, and distribution of large binary assets.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    **Pre-signed URL Architecture**: All asset transfers use pre-signed URLs via MinIO/S3.
    WebSocket handles only metadata requests and progress notifications - never raw asset data.
    This bypasses payload limits entirely.

    **Key Features**:
    - Individual asset upload/download via pre-signed URLs
    - Asset versioning with content-based hashing
    - Asset bundles (.bannou format) for grouped distribution
    - Asset search by type, tags, realm
    - Processing pipeline for textures, models, audio, behaviors

    **Schema Rules**: AI agents MUST review docs/reference/SCHEMA-RULES.md before modifying this schema. Optional reference types require `nullable: true`.

servers:
- url: http://localhost:5012
  description: Bannou service endpoint

paths:
  # ==========================================================================
  # Asset Upload Operations
  # ==========================================================================

  /assets/upload/request:
    post:
      summary: Request upload URL for a new asset
      description: |
        Generate a pre-signed URL for uploading a new asset directly to storage.
        For large files (>50MB), returns multipart upload configuration.
      operationId: requestUpload
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadRequest'
      responses:
        '200':
          description: Upload URL generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: Invalid request (filename, size, or content_type)
        '401':
          description: Not authenticated
        '403':
          description: Insufficient permissions

  /assets/upload/complete:
    post:
      summary: Mark upload as complete, trigger processing
      description: |
        Called after the client has uploaded the file to the pre-signed URL.
        Triggers the asset processing pipeline (texture conversion, model validation, etc.)
        and emits completion events via WebSocket.
      operationId: completeUpload
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteUploadRequest'
      responses:
        '200':
          description: Asset created, processing started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetMetadata'
        '400':
          description: Invalid upload_id or missing parts for multipart
        '404':
          description: Upload session not found or expired

  # ==========================================================================
  # Asset Retrieval Operations
  # ==========================================================================

  /assets/get:
    post:
      summary: Get asset metadata and download URL
      description: |
        Retrieve asset metadata and generate a pre-signed download URL.
        Specify version to download a specific version, or omit for latest.
      operationId: getAsset
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetAssetRequest'
      responses:
        '200':
          description: Asset metadata with download URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetWithDownloadUrl'
        '404':
          description: Asset not found

  /assets/delete:
    post:
      summary: Delete an asset
      description: |
        Delete an asset from storage. If versionId is specified, only that version is deleted.
        If versionId is omitted, all versions are deleted.
      operationId: deleteAsset
      tags:
      - Assets
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteAssetRequest'
      responses:
        '200':
          description: Asset deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteAssetResponse'
        '404':
          description: Asset not found
        '403':
          description: Insufficient permissions
  /assets/list-versions:
    post:
      summary: List all versions of an asset
      description: |
        Retrieve version history for an asset with pagination.
        Includes version IDs, creation timestamps, and archive status.
      operationId: listAssetVersions
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListVersionsRequest'
      responses:
        '200':
          description: List of asset versions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetVersionList'
        '404':
          description: Asset not found

  /assets/search:
    post:
      summary: Search assets by tags, type, or realm
      description: |
        Search assets using various filters with pagination.
        All filters are optional and combine with AND logic.
      operationId: searchAssets
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssetSearchRequest'
      responses:
        '200':
          description: Matching assets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetSearchResult'

  # ==========================================================================
  # Bundle Operations
  # ==========================================================================

  /bundles/create:
    post:
      summary: Create asset bundle from multiple assets
      description: |
        Create a .bannou bundle containing multiple assets.
        For large bundles, processing is delegated to the processing pool.
        Completion notification sent via WebSocket event.
      operationId: createBundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBundleRequest'
      responses:
        '200':
          description: Bundle created immediately (small bundles)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBundleResponse'
        '202':
          description: Bundle creation queued (large bundles)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBundleResponse'
        '400':
          description: Invalid asset_ids or bundle_id

  /bundles/get:
    post:
      summary: Get bundle manifest and download URL
      description: |
        Retrieve bundle metadata and generate a pre-signed download URL.
        Supports both native .bannou format and ZIP conversion (cached).
      operationId: getBundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetBundleRequest'
      responses:
        '200':
          description: Bundle manifest with download URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BundleWithDownloadUrl'
        '404':
          description: Bundle not found

  /bundles/upload/request:
    post:
      summary: Request upload URL for a pre-made bundle
      description: |
        Upload a pre-built bundle (.bannou or .zip format).
        After upload, the bundle undergoes validation before registration.
      operationId: requestBundleUpload
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BundleUploadRequest'
      responses:
        '200':
          description: Upload URL generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: Invalid filename or size

  /bundles/metabundle/create:
    post:
      summary: Create metabundle from source bundles
      description: |
        Compose a metabundle by extracting and repackaging assets from multiple
        source bundles. The resulting metabundle is a complete physical copy with
        provenance metadata tracking the source bundles.

        Assets are deduplicated by content hash. If the same asset ID exists in
        multiple source bundles with different content hashes, the request fails
        with conflict details.
      operationId: createMetabundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMetabundleRequest'
      responses:
        '200':
          description: Metabundle created or queued for creation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateMetabundleResponse'
        '400':
          description: Invalid request or asset conflicts detected
        '404':
          description: One or more source bundles not found
        '409':
          description: Metabundle ID already exists

  /bundles/job/status:
    post:
      summary: Get async metabundle job status
      description: |
        Poll the status of an async metabundle creation job.
        Use the jobId returned from createMetabundle when status was 'queued'.

        Clients can either poll this endpoint or wait for the
        MetabundleCreationCompleteEvent via WebSocket for completion notification.
      operationId: getJobStatus
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetJobStatusRequest'
      responses:
        '200':
          description: Job status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetJobStatusResponse'
        '404':
          description: Job not found or expired

  /bundles/job/cancel:
    post:
      summary: Cancel an async metabundle job
      description: |
        Cancel a pending or processing metabundle creation job.
        Jobs that are already completed (ready or failed) cannot be cancelled.

        Successfully cancelled jobs will emit a MetabundleCreationCompleteEvent
        with status 'cancelled' via WebSocket.
      operationId: cancelJob
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelJobRequest'
      responses:
        '200':
          description: Job cancellation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelJobResponse'
        '404':
          description: Job not found or expired
        '409':
          description: Job cannot be cancelled (already completed)

  # ==========================================================================
  # Bundle Resolution
  # ==========================================================================

  /bundles/resolve:
    post:
      summary: Compute optimal bundles for requested assets
      description: |
        Given a list of asset IDs, compute the optimal set of bundles to download
        to obtain all requested assets with minimal transfers.

        The algorithm uses greedy set-cover optimization:
        1. Find all bundles containing requested assets
        2. Select bundles that cover the most uncovered assets
        3. Prefer metabundles when coverage is equal (tie-breaker)
        4. Include standalone assets for any remaining unresolved IDs

        Returns pre-signed download URLs for all selected bundles and assets.
      operationId: resolveBundles
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResolveBundlesRequest'
      responses:
        '200':
          description: Resolution complete with download URLs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResolveBundlesResponse'
        '400':
          description: Invalid request

  /bundles/query/by-asset:
    post:
      summary: Find all bundles containing a specific asset
      description: |
        Query the reverse index to find all bundles (source and metabundle)
        that contain a specific asset ID. Useful for understanding asset
        distribution and debugging resolution issues.
      operationId: queryBundlesByAsset
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryBundlesByAssetRequest'
      responses:
        '200':
          description: Bundles containing the asset
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryBundlesByAssetResponse'
        '400':
          description: Invalid request

  # ==========================================================================
  # Bulk Asset Operations
  # ==========================================================================

  /bundles/update:
    post:
      summary: Update bundle metadata
      description: |
        Update metadata for an existing bundle (name, description, tags).
        Does not modify bundle contents - for that, create a new bundle.

        Increments the bundle version and records the change in version history.
        Only the bundle owner or admin can update.
      operationId: updateBundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBundleRequest'
      responses:
        '200':
          description: Bundle updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateBundleResponse'
        '400':
          description: Invalid request
        '403':
          description: Not authorized to update this bundle
        '404':
          description: Bundle not found or deleted

  /bundles/delete:
    post:
      summary: Soft-delete a bundle
      description: |
        Soft-delete a bundle, marking it as deleted but retaining data
        for the configured retention period (default 30 days).

        Deleted bundles are excluded from resolution and queries by default.
        Use permanent=true for immediate, unrecoverable deletion (admin only).

        Only the bundle owner or admin can delete.
      operationId: deleteBundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteBundleRequest'
      responses:
        '200':
          description: Bundle deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteBundleResponse'
        '400':
          description: Invalid request
        '403':
          description: Not authorized to delete this bundle
        '404':
          description: Bundle not found

  /bundles/restore:
    post:
      summary: Restore a soft-deleted bundle
      description: |
        Restore a bundle that was soft-deleted, making it active again.
        Can only restore bundles within their retention period.

        Only the bundle owner or admin can restore.
      operationId: restoreBundle
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestoreBundleRequest'
      responses:
        '200':
          description: Bundle restored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestoreBundleResponse'
        '400':
          description: Invalid request or bundle not in deleted state
        '403':
          description: Not authorized to restore this bundle
        '404':
          description: Bundle not found or permanently deleted
        '410':
          description: Bundle retention period has expired

  /bundles/query:
    post:
      summary: Query bundles with advanced filters
      description: |
        Query bundles with flexible filtering options including:
        - Tag matching (exact, exists, not exists)
        - Status filtering (active, deleted)
        - Date range filtering
        - Name search (contains)
        - Owner filtering
        - Realm and bundle type filtering

        Supports pagination and sorting.
      operationId: queryBundles
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryBundlesRequest'
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryBundlesResponse'
        '400':
          description: Invalid query parameters

  /bundles/list-versions:
    post:
      summary: List version history for a bundle
      description: |
        Get the version history for a bundle, showing all metadata changes
        over time. Each version record includes:
        - Version number
        - When the change was made
        - Who made the change
        - What changed
        - Optional reason for the change

        The current version's full metadata snapshot is always included.
      operationId: listBundleVersions
      tags:
      - Bundles
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListBundleVersionsRequest'
      responses:
        '200':
          description: Version history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListBundleVersionsResponse'
        '404':
          description: Bundle not found

  # ==========================================================================
  # Bulk Asset Operations
  # ==========================================================================

  /assets/bulk-get:
    post:
      summary: Batch asset metadata lookup
      description: |
        Retrieve metadata for multiple assets in a single request.
        Optionally includes pre-signed download URLs.
        Maximum 100 asset IDs per request.
      operationId: bulkGetAssets
      tags:
      - Assets
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkGetAssetsRequest'
      responses:
        '200':
          description: Asset metadata retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkGetAssetsResponse'
        '400':
          description: Invalid request or too many asset IDs

components:
  schemas:
    # ==========================================================================
    # Enums
    # ==========================================================================

    AssetType:
      type: string
      enum:
      - texture
      - model
      - audio
      - behavior
      - bundle
      - prefab
      - other
      description: Type classification for assets

    GameRealm:
      type: string
      description: |
        Realm stub name (lowercase string identifier) that this asset belongs to.
        Use the realm's stub_name property (e.g., "realm-1", "realm-2") from the Realm service.
        Use "shared" for assets that are available across all realms.

    ProcessingStatus:
      type: string
      enum:
      - pending
      - processing
      - complete
      - failed
      description: Asset processing pipeline status

    CompressionType:
      type: string
      enum:
      - lz4
      - lzma
      - none
      description: Compression algorithm for bundles

    BundleFormat:
      type: string
      enum:
      - bannou
      - zip
      description: Bundle file format

    BundleType:
      type: string
      enum:
      - source
      - metabundle
      description: |
        Bundle category:
        - source: Original bundle (uploaded or server-created from assets)
        - metabundle: Composed from other bundles server-side

    # NOTE: AssetIdStyle enum removed - validation style is configuration, not API

    # ==========================================================================
    # Upload Request/Response
    # ==========================================================================

    UploadRequest:
      description: Request to initiate an asset upload and receive a pre-signed URL
      type: object
      additionalProperties: false
      required:
      - filename
      - size
      - contentType
      - owner
      properties:
        owner:
          type: string
          description: |
            Owner of this asset operation. NOT a session ID.
            For user-initiated uploads: the accountId (UUID format).
            For service-initiated uploads: the service name (e.g., "behavior", "orchestrator").
        filename:
          type: string
          description: Original filename with extension
        size:
          type: integer
          format: int64
          description: File size in bytes
        contentType:
          type: string
          description: MIME content type (e.g., image/png, model/gltf-binary)
        metadata:
          $ref: '#/components/schemas/AssetMetadataInput'
          description: Optional metadata for asset categorization

    UploadResponse:
      description: Response containing pre-signed URL and configuration for uploading an asset
      type: object
      additionalProperties: false
      required:
      - uploadId
      - uploadUrl
      - expiresAt
      properties:
        uploadId:
          type: string
          format: uuid
          description: Unique upload session identifier
        uploadUrl:
          type: string
          format: uri
          description: Pre-signed URL for uploading the file
        expiresAt:
          type: string
          format: date-time
          description: When the upload URL expires
        multipart:
          $ref: '#/components/schemas/MultipartConfig'
          description: Configuration for multipart uploads if file size requires it
        requiredHeaders:
          type: object
          additionalProperties:
            type: string
          description: Headers the client must include when uploading to the pre-signed URL

    CompleteUploadRequest:
      description: Request to finalize an upload and trigger asset processing
      type: object
      additionalProperties: false
      required:
      - uploadId
      properties:
        uploadId:
          type: string
          format: uuid
          description: Upload session ID from requestUpload
        parts:
          type: array
          nullable: true
          description: For multipart uploads - ETags of completed parts (null for single-file uploads)
          items:
            $ref: '#/components/schemas/CompletedPart'

    CompletedPart:
      description: Information about a completed part in a multipart upload
      type: object
      additionalProperties: false
      required:
      - partNumber
      - etag
      properties:
        partNumber:
          type: integer
          description: Part number (1-based)
        etag:
          type: string
          description: ETag returned from part upload

    MultipartConfig:
      description: Configuration for multipart uploads of large files
      type: object
      additionalProperties: false
      properties:
        required:
          type: boolean
          description: Whether multipart upload is required for this file size
        partSize:
          type: integer
          description: Size of each part in bytes
        maxParts:
          type: integer
          description: Maximum number of parts
        uploadUrls:
          type: array
          # NRT: Optional array MUST be nullable (Rule 2)
          nullable: true
          description: Pre-signed URLs for each part of the multipart upload
          items:
            $ref: '#/components/schemas/PartUploadInfo'

    PartUploadInfo:
      description: Upload information for a single part in a multipart upload
      type: object
      additionalProperties: false
      required:
      - partNumber
      - uploadUrl
      properties:
        partNumber:
          type: integer
          description: Part number (1-based)
        uploadUrl:
          type: string
          format: uri
          description: Pre-signed URL for uploading this part
        minSize:
          type: integer
          format: int64
          description: Minimum size for this part
        maxSize:
          type: integer
          format: int64
          description: Maximum size for this part

    # ==========================================================================
    # Asset Metadata
    # ==========================================================================

    AssetMetadataInput:
      type: object
      additionalProperties: false
      description: User-provided metadata for asset categorization
      properties:
        assetType:
          $ref: '#/components/schemas/AssetType'
          description: Type classification for the asset
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Game realm the asset belongs to
        tags:
          type: array
          items:
            type: string
          description: Searchable tags for the asset

    AssetMetadata:
      type: object
      additionalProperties: false
      description: Complete asset metadata including system-generated fields
      # NRT: Response properties server always sets (Rule 4)
      required:
      - assetId
      - contentHash
      - filename
      - contentType
      - size
      - assetType
      - realm
      - tags
      - processingStatus
      - isArchived
      - createdAt
      - updatedAt
      properties:
        assetId:
          type: string
          description: Unique asset identifier
        contentHash:
          type: string
          description: SHA256 hash of file contents
        filename:
          type: string
          description: Original filename
        contentType:
          type: string
          description: MIME content type
        size:
          type: integer
          format: int64
          description: File size in bytes
        assetType:
          $ref: '#/components/schemas/AssetType'
          description: Type classification for the asset
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Game realm the asset belongs to
        tags:
          type: array
          items:
            type: string
          description: Searchable tags for the asset
        processingStatus:
          $ref: '#/components/schemas/ProcessingStatus'
          description: Current status of asset processing pipeline
        isArchived:
          type: boolean
          description: Whether the asset is in cold/archival storage
          default: false
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the asset was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the asset was last updated

    # ==========================================================================
    # Asset Retrieval
    # ==========================================================================

    GetAssetRequest:
      description: Request to retrieve asset metadata and download URL
      type: object
      additionalProperties: false
      required:
      - assetId
      properties:
        assetId:
          type: string
          description: Asset identifier
        version:
          type: string
          default: latest
          description: Version ID or 'latest'

    AssetWithDownloadUrl:
      description: Asset metadata with optional pre-signed download URL
      type: object
      additionalProperties: false
      required:
      - assetId
      - versionId
      - size
      - contentHash
      - contentType
      - metadata
      properties:
        assetId:
          type: string
          description: Unique asset identifier
        versionId:
          type: string
          description: Version identifier for this specific asset version
        downloadUrl:
          type: string
          format: uri
          nullable: true
          description: Pre-signed download URL (only populated when requested)
        expiresAt:
          type: string
          format: date-time
          nullable: true
          description: When the download URL expires (only populated when requested)
        size:
          type: integer
          format: int64
          description: File size in bytes
        contentHash:
          type: string
          description: SHA256 hash of file contents
        contentType:
          type: string
          description: MIME content type
        metadata:
          $ref: '#/components/schemas/AssetMetadata'
          description: Complete asset metadata

    # ==========================================================================
    # Asset Deletion
    # ==========================================================================

    DeleteAssetRequest:
      description: Request to delete an asset from storage
      type: object
      additionalProperties: false
      required:
      - assetId
      properties:
        assetId:
          type: string
          description: Asset identifier to delete
        versionId:
          type: string
          nullable: true
          description: |
            Specific version to delete. If omitted, all versions are deleted.

    DeleteAssetResponse:
      description: Response confirming asset deletion
      type: object
      additionalProperties: false
      required:
      - assetId
      - versionsDeleted
      properties:
        assetId:
          type: string
          description: Deleted asset identifier
        versionsDeleted:
          type: integer
          description: Number of versions deleted

    # ==========================================================================
    # Version Listing
    # ==========================================================================

    ListVersionsRequest:
      description: Request to list all versions of an asset with pagination
      type: object
      additionalProperties: false
      required:
      - assetId
      properties:
        assetId:
          type: string
          description: Asset identifier to list versions for
        limit:
          type: integer
          default: 50
          description: Maximum number of versions to return
        offset:
          type: integer
          default: 0
          description: Number of versions to skip for pagination

    AssetVersionList:
      description: Paginated list of asset versions
      type: object
      additionalProperties: false
      # NRT: Response properties server always sets (Rule 4)
      required:
      - assetId
      - versions
      - total
      - limit
      - offset
      properties:
        assetId:
          type: string
          description: Asset identifier
        versions:
          type: array
          items:
            $ref: '#/components/schemas/AssetVersion'
          description: List of asset versions
        total:
          type: integer
          description: Total number of versions available
        limit:
          type: integer
          description: Maximum number of versions returned per page
        offset:
          type: integer
          description: Number of versions skipped

    AssetVersion:
      description: Metadata for a specific version of an asset
      type: object
      additionalProperties: false
      # NRT: Response properties server always sets (Rule 4)
      required:
      - versionId
      - createdAt
      - size
      - isArchived
      properties:
        versionId:
          type: string
          description: Unique version identifier
        createdAt:
          type: string
          format: date-time
          description: Timestamp when this version was created
        size:
          type: integer
          format: int64
          description: File size in bytes for this version
        isArchived:
          type: boolean
          description: Whether this version is in cold storage

    # ==========================================================================
    # Asset Search
    # ==========================================================================

    AssetSearchRequest:
      description: Search criteria for filtering assets with pagination
      type: object
      additionalProperties: false
      required:
      - assetType
      - realm
      properties:
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Filter by tags (assets must have all specified tags) (null to skip tag filtering)
        assetType:
          $ref: '#/components/schemas/AssetType'
          description: Filter by asset type
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Filter by game realm
        contentType:
          type: string
          nullable: true
          description: MIME content type filter (null to skip content type filtering)
        limit:
          type: integer
          default: 50
          description: Maximum number of results to return
        offset:
          type: integer
          default: 0
          description: Number of results to skip for pagination

    AssetSearchResult:
      description: Paginated results from an asset search query
      type: object
      additionalProperties: false
      # NRT: Response properties server always sets (Rule 4)
      required:
      - assets
      - total
      - limit
      - offset
      properties:
        assets:
          type: array
          items:
            $ref: '#/components/schemas/AssetMetadata'
          description: List of matching assets
        total:
          type: integer
          description: Total number of matching assets
        limit:
          type: integer
          description: Maximum number of results returned per page
        offset:
          type: integer
          description: Number of results skipped

    # ==========================================================================
    # Bundle Operations
    # ==========================================================================

    CreateBundleRequest:
      description: Request to create a new asset bundle from multiple assets
      type: object
      additionalProperties: false
      required:
      - bundleId
      - assetIds
      - owner
      properties:
        owner:
          type: string
          description: |
            Owner of this bundle. NOT a session ID.
            For user-initiated bundles: the accountId (UUID format).
            For service-initiated bundles: the service name (e.g., "orchestrator").
        bundleId:
          type: string
          description: Human-readable bundle identifier (e.g., "synty/polygon-adventure", "my-bundle-v1")
        version:
          type: string
          default: 1.0.0
          description: Bundle version string
        realm:
          allOf:
          - $ref: '#/components/schemas/GameRealm'
          nullable: true
          description: |
            Game realm this bundle belongs to.
            Defaults to 'shared' if not specified.
        assetIds:
          type: array
          items:
            type: string
          description: List of asset IDs to include in the bundle
        compression:
          $ref: '#/components/schemas/CompressionType'
          description: Compression algorithm to use for the bundle
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Custom metadata for the bundle (null if none)

    CreateBundleResponse:
      description: Response with bundle creation status and estimated size
      type: object
      additionalProperties: false
      # NRT: Response properties server always sets (Rule 4)
      required:
      - bundleId
      - status
      - estimatedSize
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier (e.g., "synty/polygon-adventure", "my-bundle-v1")
        status:
          type: string
          enum:
          - queued
          - processing
          - ready
          - failed
          description: Bundle creation status
        estimatedSize:
          type: integer
          format: int64
          description: Estimated bundle size in bytes

    GetBundleRequest:
      description: Request to retrieve bundle metadata and download URL
      type: object
      additionalProperties: false
      required:
      - bundleId
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier to retrieve
        format:
          $ref: '#/components/schemas/BundleFormat'
          description: Desired download format (bannou or zip)

    BundleWithDownloadUrl:
      description: Bundle metadata combined with a pre-signed download URL
      type: object
      additionalProperties: false
      # NRT: Response properties server always sets (Rule 4)
      required:
      - bundleId
      - version
      - downloadUrl
      - format
      - expiresAt
      - size
      - assetCount
      - fromCache
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier (e.g., "synty/polygon-adventure", "my-bundle-v1")
        version:
          type: string
          description: Bundle version string
        downloadUrl:
          type: string
          format: uri
          description: Pre-signed URL for downloading the bundle
        format:
          $ref: '#/components/schemas/BundleFormat'
          description: Format of the downloadable bundle
        expiresAt:
          type: string
          format: date-time
          description: When the download URL expires
        size:
          type: integer
          format: int64
          description: Bundle file size in bytes
        assetCount:
          type: integer
          description: Number of assets contained in the bundle
        fromCache:
          type: boolean
          description: True if ZIP format was served from conversion cache

    BundleUploadRequest:
      description: Request to upload a pre-built asset bundle file
      type: object
      additionalProperties: false
      required:
      - filename
      - size
      - owner
      properties:
        owner:
          type: string
          description: |
            Owner of this bundle upload. NOT a session ID.
            For user-initiated uploads: the accountId (UUID format).
            For service-initiated uploads: the service name (e.g., "orchestrator").
        filename:
          type: string
          description: Must end with .bannou or .zip
        size:
          type: integer
          format: int64
          description: Bundle file size in bytes
        manifestPreview:
          allOf:
          - $ref: '#/components/schemas/BundleManifestPreview'
          nullable: true
          description: Optional preview of bundle manifest for validation

    BundleManifestPreview:
      type: object
      additionalProperties: false
      description: Preview of bundle manifest for validation
      # NRT: Response properties server always sets (Rule 4)
      required:
      - bundleId
      - version
      - assetCount
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier from the manifest
        version:
          type: string
          description: Bundle version from the manifest
        assetCount:
          type: integer
          description: Number of assets declared in the manifest

    # ==========================================================================
    # Metabundle Operations
    # ==========================================================================

    SourceBundleReference:
      type: object
      additionalProperties: false
      description: Provenance reference to a source bundle used in metabundle creation
      required:
      - bundleId
      - version
      - assetIds
      - contentHash
      properties:
        bundleId:
          type: string
          description: Source bundle identifier
        version:
          type: string
          description: Version of source bundle at composition time
        assetIds:
          type: array
          items:
            type: string
          description: Asset IDs contributed from this source bundle
        contentHash:
          type: string
          description: Hash of source bundle at composition time (for integrity verification)

    AssetConflict:
      type: object
      additionalProperties: false
      description: Describes a conflict when the same asset ID has different content hashes
      required:
      - assetId
      - conflictingBundles
      properties:
        assetId:
          type: string
          description: The conflicting asset identifier
        conflictingBundles:
          type: array
          items:
            $ref: '#/components/schemas/ConflictingBundleEntry'
          description: Bundles with conflicting versions of this asset

    ConflictingBundleEntry:
      type: object
      additionalProperties: false
      description: A bundle entry in an asset conflict
      required:
      - bundleId
      - contentHash
      properties:
        bundleId:
          type: string
          description: Bundle containing this version
        contentHash:
          type: string
          description: Content hash of asset in this bundle

    CreateMetabundleRequest:
      type: object
      additionalProperties: false
      description: |
        Request to create a metabundle from source bundles and/or standalone assets.
        At least one of sourceBundleIds or standaloneAssetIds must be provided.
        This enables packaging behaviors/scripts with 3D assets as a complete unit.
      required:
      - metabundleId
      - owner
      - realm
      properties:
        metabundleId:
          type: string
          description: Human-readable identifier for the new metabundle (e.g., "game-assets-v1")
        sourceBundleIds:
          type: array
          items:
            type: string
          nullable: true
          description: |
            Human-readable source bundle IDs (e.g., "synty/polygon-adventure") to pull assets from.
            Can cherry-pick specific assets using assetFilter, or include all if assetFilter is null.
        standaloneAssetIds:
          type: array
          items:
            type: string
          nullable: true
          description: |
            Individual asset IDs (not in bundles) to include directly.
            Useful for including behaviors, scripts, or metadata files
            alongside bundled 3D assets.
        version:
          type: string
          default: "1.0.0"
          description: Metabundle version string
        owner:
          type: string
          description: |
            Owner of this metabundle. NOT a session ID.
            For user-initiated: the accountId (UUID format).
            For service-initiated: the service name.
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Game realm for this metabundle
        description:
          type: string
          nullable: true
          description: Human-readable description
        assetFilter:
          type: array
          nullable: true
          items:
            type: string
          description: |
            Optional subset of asset IDs to include FROM SOURCE BUNDLES.
            If null, all assets from source bundles are included.
            Standalone assets are always included regardless of this filter.
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Custom metadata for the metabundle

    CreateMetabundleResponse:
      type: object
      additionalProperties: false
      description: |
        Response from metabundle creation.
        For synchronous creation (small jobs): status=ready with downloadUrl.
        For async creation (large jobs): status=queued with jobId for polling.
      required:
      - metabundleId
      - status
      - assetCount
      - sizeBytes
      properties:
        metabundleId:
          type: string
          description: Human-readable metabundle identifier
        jobId:
          type: string
          format: uuid
          nullable: true
          description: |
            Job ID for async processing. Only present when status is 'queued' or 'processing'.
            Use /bundles/job/status to poll for completion, or wait for
            MetabundleCreationCompleteEvent via WebSocket.
        status:
          type: string
          enum:
          - queued
          - processing
          - ready
          - failed
          description: |
            Creation status.
            - queued: Job accepted for async processing (poll with jobId)
            - processing: Job is actively running
            - ready: Metabundle created and available for download
            - failed: Creation failed (see conflicts for details)
        downloadUrl:
          type: string
          format: uri
          nullable: true
          description: Pre-signed download URL (only present when status is 'ready')
        assetCount:
          type: integer
          description: Number of assets in the metabundle
        standaloneAssetCount:
          type: integer
          nullable: true
          description: Number of standalone assets included directly (not from bundles)
        sizeBytes:
          type: integer
          format: int64
          description: Total size in bytes
        sourceBundles:
          type: array
          items:
            $ref: '#/components/schemas/SourceBundleReference'
          description: Provenance data for the metabundle
        conflicts:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/AssetConflict'
          description: Present if creation failed due to asset conflicts

    # ==========================================================================
    # Async Job Status
    # ==========================================================================

    GetJobStatusRequest:
      type: object
      additionalProperties: false
      description: Request to get the status of an async metabundle creation job
      required:
      - jobId
      properties:
        jobId:
          type: string
          format: uuid
          description: Job ID from the createMetabundle response

    GetJobStatusResponse:
      type: object
      additionalProperties: false
      description: |
        Status of an async metabundle creation job.
        When status is 'ready', the response includes the full metabundle details.
      required:
      - jobId
      - metabundleId
      - status
      properties:
        jobId:
          type: string
          format: uuid
          description: Job identifier
        metabundleId:
          type: string
          description: Human-readable metabundle identifier being created
        status:
          type: string
          enum:
          - queued
          - processing
          - ready
          - failed
          - cancelled
          description: |
            Current job status.
            - queued: Waiting for processing resources
            - processing: Actively being processed
            - ready: Completed successfully
            - failed: Creation failed
            - cancelled: Job was cancelled
        progress:
          type: integer
          minimum: 0
          maximum: 100
          nullable: true
          description: Progress percentage (0-100) when status is 'processing'
        downloadUrl:
          type: string
          format: uri
          nullable: true
          description: Pre-signed download URL (only when status is 'ready')
        assetCount:
          type: integer
          nullable: true
          description: Number of assets in metabundle (when ready)
        standaloneAssetCount:
          type: integer
          nullable: true
          description: Number of standalone assets included (when ready)
        sizeBytes:
          type: integer
          format: int64
          nullable: true
          description: Total size in bytes (when ready)
        sourceBundles:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/SourceBundleReference'
          description: Provenance data (when ready)
        errorCode:
          type: string
          nullable: true
          description: Error code (when status is 'failed')
        errorMessage:
          type: string
          nullable: true
          description: Human-readable error description (when status is 'failed')
        createdAt:
          type: string
          format: date-time
          nullable: true
          description: When the job was created
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: When the job was last updated
        processingTimeMs:
          type: integer
          format: int64
          nullable: true
          description: Total processing time in milliseconds (when complete)

    CancelJobRequest:
      type: object
      additionalProperties: false
      description: Request to cancel an async metabundle creation job
      required:
      - jobId
      properties:
        jobId:
          type: string
          format: uuid
          description: Job ID from the createMetabundle response

    CancelJobResponse:
      type: object
      additionalProperties: false
      description: Result of job cancellation attempt
      required:
      - jobId
      - cancelled
      - status
      properties:
        jobId:
          type: string
          format: uuid
          description: Job identifier
        cancelled:
          type: boolean
          description: Whether the job was successfully cancelled
        status:
          type: string
          enum:
          - queued
          - processing
          - ready
          - failed
          - cancelled
          description: Current job status after cancellation attempt
        message:
          type: string
          nullable: true
          description: Additional context about the cancellation result

    # ==========================================================================
    # Bundle Resolution
    # ==========================================================================

    ResolveBundlesRequest:
      type: object
      additionalProperties: false
      description: Request to resolve optimal bundle downloads for requested assets
      required:
      - assetIds
      - realm
      properties:
        assetIds:
          type: array
          items:
            type: string
          description: Platform asset IDs to resolve
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Game realm to search within
        preferMetabundles:
          type: boolean
          default: true
          description: Prefer metabundles when coverage is equal
        includeStandalone:
          type: boolean
          default: true
          description: Include standalone assets not in any bundle
        maxBundles:
          type: integer
          nullable: true
          description: Maximum number of bundles to return (optimization limit)

    ResolveBundlesResponse:
      type: object
      additionalProperties: false
      description: Optimal bundle set for requested assets
      required:
      - bundles
      - standaloneAssets
      - coverage
      properties:
        bundles:
          type: array
          items:
            $ref: '#/components/schemas/ResolvedBundle'
          description: Bundles to download
        standaloneAssets:
          type: array
          items:
            $ref: '#/components/schemas/ResolvedAsset'
          description: Individual assets to download
        coverage:
          $ref: '#/components/schemas/CoverageAnalysis'
          description: Coverage statistics
        unresolved:
          type: array
          items:
            type: string
          nullable: true
          description: Asset IDs that couldn't be found (null if all resolved)

    ResolvedBundle:
      type: object
      additionalProperties: false
      description: A bundle selected for download in resolution
      required:
      - bundleId
      - bundleType
      - downloadUrl
      - expiresAt
      - size
      - assetsProvided
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier
        bundleType:
          $ref: '#/components/schemas/BundleType'
          description: Whether source or metabundle
        version:
          type: string
          nullable: true
          description: Bundle version
        downloadUrl:
          type: string
          format: uri
          description: Pre-signed download URL
        expiresAt:
          type: string
          format: date-time
          description: When the download URL expires
        size:
          type: integer
          format: int64
          description: Bundle file size in bytes
        assetsProvided:
          type: array
          items:
            type: string
          description: Which of the requested assets this bundle provides

    ResolvedAsset:
      type: object
      additionalProperties: false
      description: A standalone asset selected for download
      required:
      - assetId
      - downloadUrl
      - expiresAt
      - size
      properties:
        assetId:
          type: string
          description: Asset identifier
        downloadUrl:
          type: string
          format: uri
          description: Pre-signed download URL
        expiresAt:
          type: string
          format: date-time
          description: When the download URL expires
        size:
          type: integer
          format: int64
          description: Asset file size in bytes
        contentHash:
          type: string
          nullable: true
          description: SHA256 hash of asset content

    CoverageAnalysis:
      type: object
      additionalProperties: false
      description: Statistics about asset resolution coverage
      required:
      - totalRequested
      - resolvedViaBundles
      - resolvedStandalone
      - unresolvedCount
      properties:
        totalRequested:
          type: integer
          description: Total number of assets requested
        resolvedViaBundles:
          type: integer
          description: Assets resolved through bundle downloads
        resolvedStandalone:
          type: integer
          description: Assets resolved as standalone downloads
        unresolvedCount:
          type: integer
          description: Assets that could not be found
        bundleEfficiency:
          type: number
          format: float
          nullable: true
          description: Ratio of assets provided to bundle downloads (higher is better)

    # ==========================================================================
    # Bundle Query
    # ==========================================================================

    QueryBundlesByAssetRequest:
      type: object
      additionalProperties: false
      description: Request to find bundles containing a specific asset
      required:
      - assetId
      - realm
      properties:
        assetId:
          type: string
          description: Platform asset ID to search for
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Game realm to search within
        bundleType:
          allOf:
          - $ref: '#/components/schemas/BundleType'
          nullable: true
          description: Filter by bundle type (optional, null for all types)
        limit:
          type: integer
          default: 50
          description: Maximum results to return
        offset:
          type: integer
          default: 0
          description: Pagination offset

    QueryBundlesByAssetResponse:
      type: object
      additionalProperties: false
      description: Bundles containing the requested asset
      required:
      - assetId
      - bundles
      - total
      - limit
      - offset
      properties:
        assetId:
          type: string
          description: The queried asset ID
        bundles:
          type: array
          items:
            $ref: '#/components/schemas/BundleSummary'
          description: Bundles containing this asset
        total:
          type: integer
          description: Total matching bundles
        limit:
          type: integer
          description: Page size
        offset:
          type: integer
          description: Page offset

    BundleSummary:
      type: object
      additionalProperties: false
      description: Summary information about a bundle
      required:
      - bundleId
      - bundleType
      - version
      - assetCount
      - realm
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier
        bundleType:
          $ref: '#/components/schemas/BundleType'
          description: Source or metabundle
        version:
          type: string
          description: Bundle version
        assetCount:
          type: integer
          description: Number of assets in bundle
        sizeBytes:
          type: integer
          format: int64
          nullable: true
          description: Bundle file size
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Game realm
        createdAt:
          type: string
          format: date-time
          nullable: true
          description: When the bundle was created

    # ==========================================================================
    # Bulk Asset Operations
    # ==========================================================================

    BulkGetAssetsRequest:
      type: object
      additionalProperties: false
      description: Request to retrieve metadata for multiple assets
      required:
      - assetIds
      properties:
        assetIds:
          type: array
          items:
            type: string
          description: Asset IDs to retrieve (max 100)
        includeDownloadUrls:
          type: boolean
          default: false
          description: Whether to generate pre-signed download URLs

    BulkGetAssetsResponse:
      type: object
      additionalProperties: false
      description: Batch asset metadata response
      required:
      - assets
      - notFound
      properties:
        assets:
          type: array
          items:
            $ref: '#/components/schemas/AssetWithDownloadUrl'
          description: Found assets with metadata
        notFound:
          type: array
          items:
            type: string
          description: Asset IDs that weren't found

    # ==========================================================================
    # Bundle Management
    # ==========================================================================

    BundleStatus:
      type: string
      enum:
      - pending
      - processing
      - ready
      - failed
      description: |
        Bundle processing status:
        - pending: Bundle creation is pending/queued
        - processing: Bundle is being processed
        - ready: Bundle is ready for download
        - failed: Bundle creation failed

    BundleLifecycle:
      type: string
      enum:
      - active
      - deleted
      - processing
      description: |
        Bundle lifecycle status:
        - active: Bundle is available for use
        - deleted: Bundle has been soft-deleted (within retention period)
        - processing: Bundle is being processed (metabundle creation)

    BundleInfo:
      type: object
      additionalProperties: false
      description: Complete metadata for an asset bundle (API response model)
      required:
      - bundleId
      - bundleType
      - version
      - metadataVersion
      - realm
      - status
      - assetCount
      - createdAt
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier (e.g., "synty/polygon-adventure", "my-bundle-v1")
        bundleType:
          $ref: '#/components/schemas/BundleType'
          description: Whether source or metabundle
        version:
          type: string
          description: Bundle content version string
        metadataVersion:
          type: integer
          description: Metadata version number (increments on metadata changes)
        name:
          type: string
          nullable: true
          description: Human-readable bundle name
        description:
          type: string
          nullable: true
          description: Bundle description
        owner:
          type: string
          nullable: true
          description: Owner account ID or service name (null for system-owned bundles)
        realm:
          $ref: '#/components/schemas/GameRealm'
          description: Game realm this bundle belongs to
        tags:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Key-value tags for categorization and filtering
        status:
          $ref: '#/components/schemas/BundleLifecycle'
          description: Bundle lifecycle status
        assetCount:
          type: integer
          description: Number of assets in the bundle
        sizeBytes:
          type: integer
          format: int64
          nullable: true
          description: Bundle file size in bytes (null if not yet calculated)
        createdAt:
          type: string
          format: date-time
          description: When the bundle was created
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: When the bundle metadata was last updated
        deletedAt:
          type: string
          format: date-time
          nullable: true
          description: When the bundle was soft-deleted (null if active)

    UpdateBundleRequest:
      type: object
      additionalProperties: false
      description: Request to update bundle metadata
      required:
      - bundleId
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier to update
        name:
          type: string
          nullable: true
          description: New bundle name (null to leave unchanged)
        description:
          type: string
          nullable: true
          description: New bundle description (null to leave unchanged)
        tags:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Replace all tags with these (null to leave unchanged)
        addTags:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Tags to add (merged with existing)
        removeTags:
          type: array
          items:
            type: string
          nullable: true
          description: Tag keys to remove
        reason:
          type: string
          nullable: true
          description: Optional reason for the update (recorded in version history)

    UpdateBundleResponse:
      type: object
      additionalProperties: false
      description: Result of bundle update operation
      required:
      - bundleId
      - version
      - previousVersion
      - changes
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier that was updated
        version:
          type: integer
          description: New version number after update
        previousVersion:
          type: integer
          description: Version number before update
        changes:
          type: array
          items:
            type: string
          description: List of changes made (e.g., "name changed", "tag 'env' added")
        updatedAt:
          type: string
          format: date-time
          description: When the update occurred

    DeleteBundleRequest:
      type: object
      additionalProperties: false
      description: Request to delete a bundle
      required:
      - bundleId
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier to delete
        permanent:
          type: boolean
          default: false
          description: If true, permanently delete (admin only). If false, soft-delete.
        reason:
          type: string
          nullable: true
          description: Optional reason for deletion (recorded in version history)

    DeleteBundleResponse:
      type: object
      additionalProperties: false
      description: Result of bundle deletion
      required:
      - bundleId
      - status
      - deletedAt
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier that was deleted
        status:
          type: string
          enum:
          - deleted
          - permanently_deleted
          description: Deletion status
        deletedAt:
          type: string
          format: date-time
          description: When the bundle was deleted
        retentionUntil:
          type: string
          format: date-time
          nullable: true
          description: When soft-deleted bundle will be permanently removed (null for permanent deletes)

    RestoreBundleRequest:
      type: object
      additionalProperties: false
      description: Request to restore a soft-deleted bundle
      required:
      - bundleId
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier to restore
        reason:
          type: string
          nullable: true
          description: Optional reason for restoration (recorded in version history)

    RestoreBundleResponse:
      type: object
      additionalProperties: false
      description: Result of bundle restoration
      required:
      - bundleId
      - status
      - restoredAt
      - restoredFromVersion
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier that was restored
        status:
          type: string
          description: Current bundle status (should be "active")
        restoredAt:
          type: string
          format: date-time
          description: When the bundle was restored
        restoredFromVersion:
          type: integer
          description: Version number the bundle was restored from

    QueryBundlesRequest:
      type: object
      additionalProperties: false
      description: Advanced bundle query with filters
      properties:
        tags:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Filter by exact tag key-value matches
        tagExists:
          type: array
          items:
            type: string
          nullable: true
          description: Filter bundles that have these tag keys (any value)
        tagNotExists:
          type: array
          items:
            type: string
          nullable: true
          description: Filter bundles that do NOT have these tag keys
        status:
          allOf:
          - $ref: '#/components/schemas/BundleLifecycle'
          nullable: true
          description: Filter by lifecycle status (null for active only by default)
        createdAfter:
          type: string
          format: date-time
          nullable: true
          description: Filter bundles created after this time
        createdBefore:
          type: string
          format: date-time
          nullable: true
          description: Filter bundles created before this time
        nameContains:
          type: string
          nullable: true
          description: Filter bundles with name containing this string (case-insensitive)
        owner:
          type: string
          nullable: true
          description: Filter by bundle owner account ID
        realm:
          allOf:
          - $ref: '#/components/schemas/GameRealm'
          nullable: true
          description: Filter by realm
        bundleType:
          allOf:
          - $ref: '#/components/schemas/BundleType'
          nullable: true
          description: Filter by bundle type (source or metabundle)
        sortField:
          type: string
          enum:
          - created_at
          - updated_at
          - name
          - size
          nullable: true
          description: Field to sort by (default created_at)
        sortOrder:
          type: string
          enum:
          - asc
          - desc
          nullable: true
          description: Sort order (default desc)
        limit:
          type: integer
          default: 100
          description: Maximum results to return (max 1000)
        offset:
          type: integer
          default: 0
          description: Pagination offset
        includeDeleted:
          type: boolean
          default: false
          description: Include soft-deleted bundles in results

    QueryBundlesResponse:
      type: object
      additionalProperties: false
      description: Bundle query results
      required:
      - bundles
      - totalCount
      - limit
      - offset
      properties:
        bundles:
          type: array
          items:
            $ref: '#/components/schemas/BundleInfo'
          description: Matching bundles
        totalCount:
          type: integer
          description: Total number of matching bundles (for pagination)
        limit:
          type: integer
          description: Page size used
        offset:
          type: integer
          description: Page offset used

    ListBundleVersionsRequest:
      type: object
      additionalProperties: false
      description: Request to list bundle version history
      required:
      - bundleId
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier to get history for
        limit:
          type: integer
          default: 50
          description: Maximum versions to return
        offset:
          type: integer
          default: 0
          description: Pagination offset

    ListBundleVersionsResponse:
      type: object
      additionalProperties: false
      description: Bundle version history
      required:
      - bundleId
      - currentVersion
      - versions
      - totalCount
      properties:
        bundleId:
          type: string
          description: Human-readable bundle identifier
        currentVersion:
          type: integer
          description: Current version number
        versions:
          type: array
          items:
            $ref: '#/components/schemas/BundleVersionRecord'
          description: Version history records (newest first)
        totalCount:
          type: integer
          description: Total number of versions

    BundleVersionRecord:
      type: object
      additionalProperties: false
      description: A single version record in bundle history
      required:
      - version
      - createdAt
      - createdBy
      - changes
      properties:
        version:
          type: integer
          description: Version number
        createdAt:
          type: string
          format: date-time
          description: When this version was created
        createdBy:
          type: string
          description: Account ID that made the change
        changes:
          type: array
          items:
            type: string
          description: List of changes in this version
        reason:
          type: string
          nullable: true
          description: Reason provided for the change
        snapshot:
          allOf:
          - $ref: '#/components/schemas/BundleInfo'
          nullable: true
          description: Full metadata snapshot at this version (only for current version)
