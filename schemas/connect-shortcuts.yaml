openapi: 3.0.3
info:
  title: Connect Session Shortcuts API
  description: |
    Schemas for Session Shortcuts - pre-bound API calls that services push to client sessions.
    Shortcuts are published to CONNECT_SESSION_{sessionId} topics and handled internally by Connect.

    Session Shortcuts enable services to grant clients access to specific API calls with pre-filled
    payloads, without exposing sensitive information (like sessionId or accountId) to the client.
    The client sees a shortcut GUID in their capability manifest and invokes it like any other API,
    but Connect intercepts the call, swaps the GUID for the target capability GUID, and injects
    the pre-bound payload before forwarding to the target service.
  version: 1.0.0
  contact:
    name: Bannou Development Team

servers: []

paths: {}

components:
  schemas:
    SessionShortcut:
      type: object
      additionalProperties: false
      description: |
        A pre-bound API call that clients can invoke with a single GUID.
        The bound_payload is injected by Connect when the shortcut is invoked.
      required:
        - routeGuid
        - targetGuid
        - boundPayload
        - metadata
      properties:
        routeGuid:
          type: string
          format: uuid
          description: |
            Client-salted GUID for invoking this shortcut.
            Generated by the publishing service using GuidGenerator.GenerateSessionShortcutGuid().
            Unique per session - same shortcut name produces different GUIDs for different sessions.
            Uses UUID version 7 bits to distinguish from service GUIDs (version 5).

        targetGuid:
          type: string
          format: uuid
          description: |
            The actual service capability GUID this shortcut invokes.
            Must be a valid capability in the client's current capability manifest.
            Connect uses this GUID when forwarding to the target service.

        boundPayload:
          type: string
          description: |
            Pre-serialized JSON payload passed unchanged to the target service.
            Connect treats this as opaque bytes - no deserialization or modification.
            Services are responsible for ensuring payload validity.
            Can be base64-encoded or raw JSON string.

        metadata:
          $ref: '#/components/schemas/SessionShortcutMetadata'

    SessionShortcutMetadata:
      type: object
      additionalProperties: false
      description: |
        Metadata about a session shortcut for display, debugging, and lifecycle management.
      required:
        - name
        - sourceService
        - createdAt
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 128
          pattern: '^[a-z][a-z0-9_]*$'
          description: |
            Machine-readable identifier for this shortcut.
            Used for debugging, logging, and client-side organization.
            Examples: "get_my_character_stats", "list_nearby_npcs", "join_game"

        description:
          type: string
          maxLength: 500
          nullable: true
          description: |
            Human-readable description of what this shortcut does.
            Displayed in client UIs and debugging tools.

        sourceService:
          type: string
          description: |
            The service that created this shortcut.
            Used for bulk revocation and audit logging.

        createdAt:
          type: string
          format: date-time
          description: When this shortcut was created.

        expiresAt:
          type: string
          format: date-time
          nullable: true
          description: |
            Optional TTL for this shortcut.
            If set, Connect automatically removes the shortcut after this time.
            Most shortcuts should NOT set this - they remain valid for session lifetime.
            Use only for time-transient operations (e.g., "accept quest within 5 minutes").

        tags:
          type: array
          items:
            type: string
          nullable: true
          description: |
            Optional categorization tags for client-side organization.
            Examples: ["character", "combat"], ["inventory", "equipment"]

        displayName:
          type: string
          maxLength: 64
          nullable: true
          description: |
            Optional user-friendly name for display in client UIs.
            If not provided, clients should format the 'name' field.

    ShortcutPublishedEvent:
      type: object
      additionalProperties: false
      description: |
        Published by services to create or update a session shortcut.
        Sent to CONNECT_SESSION_{sessionId} topic for the specific session.
        Connect handles this event internally and does NOT forward to the client.
      required:
        - eventId
        - eventName
        - sessionId
        - shortcut
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event.

        eventName:
          type: string
          default: "session.shortcut_published"
          description: Fixed event type identifier.

        sessionId:
          type: string
          description: Target session for this shortcut.

        shortcut:
          $ref: '#/components/schemas/SessionShortcut'

        replaceExisting:
          type: boolean
          default: true
          description: |
            If true and a shortcut with the same routeGuid exists, replace it.
            If false and shortcut exists, the event is ignored.

    ShortcutRevokedEvent:
      type: object
      additionalProperties: false
      description: |
        Published by services to remove shortcuts.
        Sent to CONNECT_SESSION_{sessionId} topic for the specific session.
        Supports both single-shortcut revocation (by routeGuid) and
        bulk revocation (all shortcuts from a sourceService).
      required:
        - eventId
        - eventName
        - sessionId
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event.

        eventName:
          type: string
          default: "session.shortcut_revoked"
          description: Fixed event type identifier.

        sessionId:
          type: string
          description: Target session for revocation.

        routeGuid:
          type: string
          format: uuid
          nullable: true
          description: |
            Specific shortcut to revoke.
            If provided, only this shortcut is removed.
            Mutually exclusive with revokeByService.

        revokeByService:
          type: string
          nullable: true
          description: |
            Revoke ALL shortcuts from this source service.
            Used when a service needs to clear all its shortcuts (e.g., on logout from that service).
            Mutually exclusive with routeGuid.

        reason:
          type: string
          nullable: true
          description: Optional reason for revocation (for logging/debugging).

    ClientShortcut:
      type: object
      additionalProperties: false
      description: |
        Shortcut information sent to clients in the capability manifest.
        Contains only the information clients need to invoke and display the shortcut.
      required:
        - guid
        - targetService
        - targetEndpoint
        - metadata
      properties:
        guid:
          type: string
          format: uuid
          description: GUID to use in WebSocket message header when invoking this shortcut.

        targetService:
          type: string
          description: The service this shortcut invokes (for client display).

        targetEndpoint:
          type: string
          description: The endpoint this shortcut invokes (for client display).

        metadata:
          $ref: '#/components/schemas/SessionShortcutMetadata'
