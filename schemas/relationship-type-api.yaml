openapi: 3.0.0
info:
  title: Bannou RelationshipType Service API
  description: |
    Relationship type management service for Arcadia game world.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    Relationship types define the kinds of relationships entities can have with each other
    (e.g., parent, child, friend, enemy). Types support hierarchical parent relationships,
    allowing "son" to match "child" for flexible querying.

    **Hierarchy System**: Each type can have a parentTypeId, creating hierarchies like:
    - FAMILY → PARENT → MOTHER, FATHER
    - FAMILY → CHILD → SON, DAUGHTER
    - SOCIAL → FRIEND → CLOSE_FRIEND

    **Deprecation System**: Types can be deprecated instead of deleted directly.
    Deprecated types remain queryable but cannot be used for new relationships.
    Use the merge endpoint to migrate relationships from deprecated types to active ones.
    The special VOID type serves as a sink for relationships whose type should be removed.

    **Two-Step Deletion**:
    1. Deprecate the type (soft delete, prevents new usage)
    2. Merge deprecated type into another type (or VOID to effectively delete)
    3. Optionally hard-delete the deprecated type after merge

    **Seed-Based**: Types are typically seeded at startup from YAML configuration,
    though admin CRUD operations are available for runtime modifications.
  version: 2.0.0
servers:
- url: http://localhost:5012
  description: Dapr sidecar endpoint (internal only)

# NOTE: x-lifecycle moved to relationship-type-events.yaml

paths:
  /relationship-type/get:
    post:
      summary: Get relationship type by ID
      operationId: getRelationshipType
      tags:
      - RelationshipType
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GetRelationshipTypeRequest\"\
        ,\n  \"$defs\": {\n    \"GetRelationshipTypeRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n   \
        \     \"relationshipTypeId\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"Unique identifier of the relationship
        type\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"relationshipTypeId\",\n        \"code\",\n        \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\"\
        ,\n        \"depth\",\n        \"createdAt\",\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"\
        relationshipTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\"\
        : {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n\
        \        \"description\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"\
        category\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\"\
        : {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n\
        \        \"parentTypeCode\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Code of the parent type (for convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"\
        string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\"\
        : {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n \
        \         \"type\": \"boolean\"\n        },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n     \
        \     \"description\": \"Whether this type is deprecated and cannot be used for new relationships\"\n        },\n\
        \        \"deprecatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"\
        nullable\": true,\n          \"description\": \"Timestamp when this type was deprecated\"\n        },\n        \"\
        deprecationReason\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Optional reason for deprecation\"\n        },\n        \"depth\": {\n          \"type\": \"integer\",\n      \
        \    \"description\": \"Depth in the hierarchy (0 for root types)\"\n        },\n        \"metadata\": {\n       \
        \   \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"nullable\": true\n        },\n \
        \       \"createdAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n     \
        \   \"updatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        }\n      }\n \
        \   }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get relationship type by ID\",\n  \"description\": \"\",\n  \"tags\": [\n\
        \    \"RelationshipType\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"getRelationshipType\"\n}"
  /relationship-type/get-by-code:
    post:
      summary: Get relationship type by code
      description: Retrieve a relationship type using its unique code (e.g., "SON", "MOTHER", "FRIEND")
      operationId: getRelationshipTypeByCode
      tags:
      - RelationshipType
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetRelationshipTypeByCodeRequest'
      responses:
        '200':
          description: Relationship type retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GetRelationshipTypeByCodeRequest\"\
        ,\n  \"$defs\": {\n    \"GetRelationshipTypeByCodeRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"code\"\n      ],\n      \"properties\": {\n        \"code\": {\n          \"type\": \"string\",\n     \
        \     \"minLength\": 1,\n          \"maxLength\": 50,\n          \"pattern\": \"^[A-Z][A-Z0-9_]*$\",\n          \"\
        description\": \"Unique code for the relationship type (e.g., \\\"SON\\\", \\\"MOTHER\\\", \\\"FRIEND\\\")\"\n   \
        \     }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"relationshipTypeId\",\n        \"code\",\n        \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\"\
        ,\n        \"depth\",\n        \"createdAt\",\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"\
        relationshipTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\"\
        : {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n\
        \        \"description\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"\
        category\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\"\
        : {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n\
        \        \"parentTypeCode\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Code of the parent type (for convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"\
        string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\"\
        : {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n \
        \         \"type\": \"boolean\"\n        },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n     \
        \     \"description\": \"Whether this type is deprecated and cannot be used for new relationships\"\n        },\n\
        \        \"deprecatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"\
        nullable\": true,\n          \"description\": \"Timestamp when this type was deprecated\"\n        },\n        \"\
        deprecationReason\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Optional reason for deprecation\"\n        },\n        \"depth\": {\n          \"type\": \"integer\",\n      \
        \    \"description\": \"Depth in the hierarchy (0 for root types)\"\n        },\n        \"metadata\": {\n       \
        \   \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"nullable\": true\n        },\n \
        \       \"createdAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n     \
        \   \"updatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        }\n      }\n \
        \   }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get relationship type by code\",\n  \"description\": \"Retrieve a relationship
        type using its unique code (e.g., \\\"SON\\\", \\\"MOTHER\\\", \\\"FRIEND\\\")\",\n  \"tags\": [\n    \"RelationshipType\"\
        \n  ],\n  \"deprecated\": false,\n  \"operationId\": \"getRelationshipTypeByCode\"\n}"
  /relationship-type/list:
    post:
      summary: List all relationship types
      description: Retrieve all relationship types with optional hierarchy filtering
      operationId: listRelationshipTypes
      tags:
      - RelationshipType
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListRelationshipTypesRequest'
      responses:
        '200':
          description: Relationship types retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeListResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ListRelationshipTypesRequest\"\
        ,\n  \"$defs\": {\n    \"ListRelationshipTypesRequest\": {\n      \"type\": \"object\",\n      \"properties\": {\n\
        \        \"category\": {\n          \"type\": \"string\",\n          \"description\": \"Filter by category (e.g.,
        \\\"FAMILY\\\", \\\"SOCIAL\\\", \\\"ECONOMIC\\\")\"\n        },\n        \"includeChildren\": {\n          \"type\"\
        : \"boolean\",\n          \"default\": true,\n          \"description\": \"Whether to include child types in the response\"\
        \n        },\n        \"rootsOnly\": {\n          \"type\": \"boolean\",\n          \"default\": false,\n        \
        \  \"description\": \"Only return types with no parent (root types)\"\n        },\n        \"includeDeprecated\":
        {\n          \"type\": \"boolean\",\n          \"default\": false,\n          \"description\": \"Whether to include
        deprecated types in the response\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeListResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeListResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n \
        \       \"types\",\n        \"totalCount\"\n      ],\n      \"properties\": {\n        \"types\": {\n          \"\
        type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/RelationshipTypeResponse\"\n         \
        \ }\n        },\n        \"totalCount\": {\n          \"type\": \"integer\"\n        }\n      }\n    },\n    \"RelationshipTypeResponse\"\
        : {\n      \"type\": \"object\",\n      \"required\": [\n        \"relationshipTypeId\",\n        \"code\",\n    \
        \    \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\",\n        \"depth\",\n        \"createdAt\"\
        ,\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\": {\n          \"type\": \"string\"\n \
        \       },\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"description\": {\n        \
        \  \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"category\": {\n          \"type\": \"\
        string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\": {\n          \"type\": \"string\",\n\
        \          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"parentTypeCode\": {\n      \
        \    \"type\": \"string\",\n          \"nullable\": true,\n          \"description\": \"Code of the parent type (for
        convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"\
        uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\": {\n          \"type\": \"string\"\
        ,\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n          \"type\": \"boolean\"\n   \
        \     },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n          \"description\": \"Whether this
        type is deprecated and cannot be used for new relationships\"\n        },\n        \"deprecatedAt\": {\n         \
        \ \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"nullable\": true,\n          \"description\"\
        : \"Timestamp when this type was deprecated\"\n        },\n        \"deprecationReason\": {\n          \"type\": \"\
        string\",\n          \"nullable\": true,\n          \"description\": \"Optional reason for deprecation\"\n       \
        \ },\n        \"depth\": {\n          \"type\": \"integer\",\n          \"description\": \"Depth in the hierarchy
        (0 for root types)\"\n        },\n        \"metadata\": {\n          \"type\": \"object\",\n          \"additionalProperties\"\
        : true,\n          \"nullable\": true\n        },\n        \"createdAt\": {\n          \"type\": \"string\",\n   \
        \       \"format\": \"date-time\"\n        },\n        \"updatedAt\": {\n          \"type\": \"string\",\n       \
        \   \"format\": \"date-time\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"List all relationship types\",\n  \"description\": \"Retrieve all relationship
        types with optional hierarchy filtering\",\n  \"tags\": [\n    \"RelationshipType\"\n  ],\n  \"deprecated\": false,\n\
        \  \"operationId\": \"listRelationshipTypes\"\n}"
  /relationship-type/get-children:
    post:
      summary: Get child types for a parent type
      description: Retrieve all relationship types that have the specified type as their parent
      operationId: getChildRelationshipTypes
      tags:
      - RelationshipType
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetChildRelationshipTypesRequest'
      responses:
        '200':
          description: Child relationship types retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeListResponse'
        '404':
          description: Parent relationship type not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GetChildRelationshipTypesRequest\"\
        ,\n  \"$defs\": {\n    \"GetChildRelationshipTypesRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"parentTypeId\"\n      ],\n      \"properties\": {\n        \"parentTypeId\": {\n          \"type\": \"\
        string\",\n          \"format\": \"uuid\",\n          \"description\": \"ID of the parent relationship type\"\n  \
        \      },\n        \"recursive\": {\n          \"type\": \"boolean\",\n          \"default\": false,\n          \"\
        description\": \"Include all descendants, not just direct children\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeListResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeListResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n \
        \       \"types\",\n        \"totalCount\"\n      ],\n      \"properties\": {\n        \"types\": {\n          \"\
        type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/RelationshipTypeResponse\"\n         \
        \ }\n        },\n        \"totalCount\": {\n          \"type\": \"integer\"\n        }\n      }\n    },\n    \"RelationshipTypeResponse\"\
        : {\n      \"type\": \"object\",\n      \"required\": [\n        \"relationshipTypeId\",\n        \"code\",\n    \
        \    \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\",\n        \"depth\",\n        \"createdAt\"\
        ,\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\": {\n          \"type\": \"string\"\n \
        \       },\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"description\": {\n        \
        \  \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"category\": {\n          \"type\": \"\
        string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\": {\n          \"type\": \"string\",\n\
        \          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"parentTypeCode\": {\n      \
        \    \"type\": \"string\",\n          \"nullable\": true,\n          \"description\": \"Code of the parent type (for
        convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"\
        uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\": {\n          \"type\": \"string\"\
        ,\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n          \"type\": \"boolean\"\n   \
        \     },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n          \"description\": \"Whether this
        type is deprecated and cannot be used for new relationships\"\n        },\n        \"deprecatedAt\": {\n         \
        \ \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"nullable\": true,\n          \"description\"\
        : \"Timestamp when this type was deprecated\"\n        },\n        \"deprecationReason\": {\n          \"type\": \"\
        string\",\n          \"nullable\": true,\n          \"description\": \"Optional reason for deprecation\"\n       \
        \ },\n        \"depth\": {\n          \"type\": \"integer\",\n          \"description\": \"Depth in the hierarchy
        (0 for root types)\"\n        },\n        \"metadata\": {\n          \"type\": \"object\",\n          \"additionalProperties\"\
        : true,\n          \"nullable\": true\n        },\n        \"createdAt\": {\n          \"type\": \"string\",\n   \
        \       \"format\": \"date-time\"\n        },\n        \"updatedAt\": {\n          \"type\": \"string\",\n       \
        \   \"format\": \"date-time\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get child types for a parent type\",\n  \"description\": \"Retrieve all relationship
        types that have the specified type as their parent\",\n  \"tags\": [\n    \"RelationshipType\"\n  ],\n  \"deprecated\"\
        : false,\n  \"operationId\": \"getChildRelationshipTypes\"\n}"
  /relationship-type/matches-hierarchy:
    post:
      summary: Check if type matches ancestor in hierarchy
      description: |
        Checks if a relationship type matches or descends from an ancestor type.
        For example, "SON" matches "CHILD" because CHILD is an ancestor of SON.
        This enables queries like "find all CHILD relationships" to match SON, DAUGHTER, etc.
      operationId: matchesHierarchy
      tags:
      - RelationshipType
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MatchesHierarchyRequest'
      responses:
        '200':
          description: Hierarchy match result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchesHierarchyResponse'
        '404':
          description: One or both relationship types not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/MatchesHierarchyRequest\"\
        ,\n  \"$defs\": {\n    \"MatchesHierarchyRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n      \
        \  \"typeId\",\n        \"ancestorTypeId\"\n      ],\n      \"properties\": {\n        \"typeId\": {\n          \"\
        type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"The relationship type to check\"\
        \n        },\n        \"ancestorTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n  \
        \        \"description\": \"The potential ancestor type\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/MatchesHierarchyResponse\"\
        ,\n  \"$defs\": {\n    \"MatchesHierarchyResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"matches\"\n      ],\n      \"properties\": {\n        \"matches\": {\n          \"type\": \"boolean\",\n   \
        \       \"description\": \"True if typeId equals or descends from ancestorTypeId\"\n        },\n        \"depth\"\
        : {\n          \"type\": \"integer\",\n          \"description\": \"Number of levels between the types (0 if same,
        -1 if no match)\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Check if type matches ancestor in hierarchy\",\n  \"description\": \"Checks
        if a relationship type matches or descends from an ancestor type.\\nFor example, \\\"SON\\\" matches \\\"CHILD\\\"\
        \ because CHILD is an ancestor of SON.\\nThis enables queries like \\\"find all CHILD relationships\\\" to match SON,
        DAUGHTER, etc.\\n\",\n  \"tags\": [\n    \"RelationshipType\"\n  ],\n  \"deprecated\": false,\n  \"operationId\":
        \"matchesHierarchy\"\n}"
  /relationship-type/get-ancestors:
    post:
      summary: Get all ancestors of a relationship type
      description: |
        Returns the full ancestry chain from the specified type up to the root.
        For example, for "SON" might return ["CHILD", "FAMILY"].
      operationId: getAncestors
      tags:
      - RelationshipType
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetAncestorsRequest'
      responses:
        '200':
          description: Ancestors retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeListResponse'
        '404':
          description: Relationship type not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/GetAncestorsRequest\"\
        ,\n  \"$defs\": {\n    \"GetAncestorsRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        typeId\"\n      ],\n      \"properties\": {\n        \"typeId\": {\n          \"type\": \"string\",\n          \"\
        format\": \"uuid\",\n          \"description\": \"The relationship type to get ancestors for\"\n        }\n      }\n\
        \    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeListResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeListResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n \
        \       \"types\",\n        \"totalCount\"\n      ],\n      \"properties\": {\n        \"types\": {\n          \"\
        type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/RelationshipTypeResponse\"\n         \
        \ }\n        },\n        \"totalCount\": {\n          \"type\": \"integer\"\n        }\n      }\n    },\n    \"RelationshipTypeResponse\"\
        : {\n      \"type\": \"object\",\n      \"required\": [\n        \"relationshipTypeId\",\n        \"code\",\n    \
        \    \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\",\n        \"depth\",\n        \"createdAt\"\
        ,\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\": {\n          \"type\": \"string\"\n \
        \       },\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"description\": {\n        \
        \  \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"category\": {\n          \"type\": \"\
        string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\": {\n          \"type\": \"string\",\n\
        \          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"parentTypeCode\": {\n      \
        \    \"type\": \"string\",\n          \"nullable\": true,\n          \"description\": \"Code of the parent type (for
        convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"\
        uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\": {\n          \"type\": \"string\"\
        ,\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n          \"type\": \"boolean\"\n   \
        \     },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n          \"description\": \"Whether this
        type is deprecated and cannot be used for new relationships\"\n        },\n        \"deprecatedAt\": {\n         \
        \ \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"nullable\": true,\n          \"description\"\
        : \"Timestamp when this type was deprecated\"\n        },\n        \"deprecationReason\": {\n          \"type\": \"\
        string\",\n          \"nullable\": true,\n          \"description\": \"Optional reason for deprecation\"\n       \
        \ },\n        \"depth\": {\n          \"type\": \"integer\",\n          \"description\": \"Depth in the hierarchy
        (0 for root types)\"\n        },\n        \"metadata\": {\n          \"type\": \"object\",\n          \"additionalProperties\"\
        : true,\n          \"nullable\": true\n        },\n        \"createdAt\": {\n          \"type\": \"string\",\n   \
        \       \"format\": \"date-time\"\n        },\n        \"updatedAt\": {\n          \"type\": \"string\",\n       \
        \   \"format\": \"date-time\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get all ancestors of a relationship type\",\n  \"description\": \"Returns
        the full ancestry chain from the specified type up to the root.\\nFor example, for \\\"SON\\\" might return [\\\"\
        CHILD\\\", \\\"FAMILY\\\"].\\n\",\n  \"tags\": [\n    \"RelationshipType\"\n  ],\n  \"deprecated\": false,\n  \"operationId\"\
        : \"getAncestors\"\n}"
  /relationship-type/create:
    post:
      summary: Create new relationship type
      operationId: createRelationshipType
      tags:
      - RelationshipType Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRelationshipTypeRequest'
      responses:
        '201':
          description: Relationship type created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '400':
          description: Invalid relationship type data
        '409':
          description: Relationship type with this code already exists

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/CreateRelationshipTypeRequest\"\
        ,\n  \"$defs\": {\n    \"CreateRelationshipTypeRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"code\",\n        \"name\"\n      ],\n      \"properties\": {\n        \"code\": {\n          \"type\":
        \"string\",\n          \"minLength\": 1,\n          \"maxLength\": 50,\n          \"pattern\": \"^[A-Z][A-Z0-9_]*$\"\
        ,\n          \"description\": \"Unique code for the relationship type (e.g., \\\"SON\\\", \\\"MOTHER\\\")\"\n    \
        \    },\n        \"name\": {\n          \"type\": \"string\",\n          \"minLength\": 1,\n          \"maxLength\"\
        : 100,\n          \"description\": \"Display name for the relationship type\"\n        },\n        \"description\"\
        : {\n          \"type\": \"string\",\n          \"maxLength\": 500,\n          \"description\": \"Description of the
        relationship type\"\n        },\n        \"category\": {\n          \"type\": \"string\",\n          \"maxLength\"\
        : 50,\n          \"description\": \"Category for grouping (e.g., \\\"FAMILY\\\", \\\"SOCIAL\\\", \\\"ECONOMIC\\\"\
        )\"\n        },\n        \"parentTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n \
        \         \"nullable\": true,\n          \"description\": \"Parent type ID for hierarchy (null for root types)\"\n\
        \        },\n        \"inverseTypeCode\": {\n          \"type\": \"string\",\n          \"maxLength\": 50,\n     \
        \     \"nullable\": true,\n          \"description\": \"Code of the inverse relationship (e.g., \\\"PARENT\\\" for
        \\\"CHILD\\\")\"\n        },\n        \"isBidirectional\": {\n          \"type\": \"boolean\",\n          \"default\"\
        : false,\n          \"description\": \"Whether the relationship is the same in both directions (e.g., \\\"SIBLING\\\
        \")\"\n        },\n        \"metadata\": {\n          \"type\": \"object\",\n          \"additionalProperties\": true,\n\
        \          \"nullable\": true,\n          \"description\": \"Additional metadata for the relationship type\"\n   \
        \     }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"relationshipTypeId\",\n        \"code\",\n        \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\"\
        ,\n        \"depth\",\n        \"createdAt\",\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"\
        relationshipTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\"\
        : {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n\
        \        \"description\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"\
        category\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\"\
        : {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n\
        \        \"parentTypeCode\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Code of the parent type (for convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"\
        string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\"\
        : {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n \
        \         \"type\": \"boolean\"\n        },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n     \
        \     \"description\": \"Whether this type is deprecated and cannot be used for new relationships\"\n        },\n\
        \        \"deprecatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"\
        nullable\": true,\n          \"description\": \"Timestamp when this type was deprecated\"\n        },\n        \"\
        deprecationReason\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Optional reason for deprecation\"\n        },\n        \"depth\": {\n          \"type\": \"integer\",\n      \
        \    \"description\": \"Depth in the hierarchy (0 for root types)\"\n        },\n        \"metadata\": {\n       \
        \   \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"nullable\": true\n        },\n \
        \       \"createdAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n     \
        \   \"updatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        }\n      }\n \
        \   }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Create new relationship type\",\n  \"description\": \"\",\n  \"tags\": [\n\
        \    \"RelationshipType Admin\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"createRelationshipType\"\n}"
  /relationship-type/update:
    post:
      summary: Update relationship type
      operationId: updateRelationshipType
      tags:
      - RelationshipType Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found
        '400':
          description: Invalid update data

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/UpdateRelationshipTypeRequest\"\
        ,\n  \"$defs\": {\n    \"UpdateRelationshipTypeRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"relationshipTypeId\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n          \"\
        type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"ID of the relationship type to
        update\"\n        },\n        \"name\": {\n          \"type\": \"string\",\n          \"minLength\": 1,\n        \
        \  \"maxLength\": 100,\n          \"nullable\": true,\n          \"description\": \"Display name for the relationship
        type\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n          \"maxLength\": 500,\n \
        \         \"nullable\": true,\n          \"description\": \"Description of the relationship type\"\n        },\n \
        \       \"category\": {\n          \"type\": \"string\",\n          \"maxLength\": 50,\n          \"nullable\": true,\n\
        \          \"description\": \"Category for grouping\"\n        },\n        \"parentTypeId\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uuid\",\n          \"nullable\": true,\n          \"description\": \"Parent
        type ID for hierarchy\"\n        },\n        \"inverseTypeCode\": {\n          \"type\": \"string\",\n          \"\
        maxLength\": 50,\n          \"nullable\": true,\n          \"description\": \"Code of the inverse relationship\"\n\
        \        },\n        \"isBidirectional\": {\n          \"type\": \"boolean\",\n          \"nullable\": true,\n   \
        \       \"description\": \"Whether the relationship is bidirectional\"\n        },\n        \"metadata\": {\n    \
        \      \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"nullable\": true,\n         \
        \ \"description\": \"Additional metadata\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"relationshipTypeId\",\n        \"code\",\n        \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\"\
        ,\n        \"depth\",\n        \"createdAt\",\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"\
        relationshipTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\"\
        : {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n\
        \        \"description\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"\
        category\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\"\
        : {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n\
        \        \"parentTypeCode\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Code of the parent type (for convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"\
        string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\"\
        : {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n \
        \         \"type\": \"boolean\"\n        },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n     \
        \     \"description\": \"Whether this type is deprecated and cannot be used for new relationships\"\n        },\n\
        \        \"deprecatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"\
        nullable\": true,\n          \"description\": \"Timestamp when this type was deprecated\"\n        },\n        \"\
        deprecationReason\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Optional reason for deprecation\"\n        },\n        \"depth\": {\n          \"type\": \"integer\",\n      \
        \    \"description\": \"Depth in the hierarchy (0 for root types)\"\n        },\n        \"metadata\": {\n       \
        \   \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"nullable\": true\n        },\n \
        \       \"createdAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n     \
        \   \"updatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        }\n      }\n \
        \   }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Update relationship type\",\n  \"description\": \"\",\n  \"tags\": [\n  \
        \  \"RelationshipType Admin\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"updateRelationshipType\"\n}"
  /relationship-type/delete:
    post:
      summary: Delete relationship type
      description: |
        Hard delete a relationship type. This will fail if the type is still in use.
        For safe removal, first deprecate the type, then merge it into another type
        (or VOID), then delete. Only deprecated types with zero references can be deleted.
      operationId: deleteRelationshipType
      tags:
      - RelationshipType Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteRelationshipTypeRequest'
      responses:
        '204':
          description: Relationship type deleted successfully
        '404':
          description: Relationship type not found
        '409':
          description: Cannot delete - type is in use by relationships or has child types

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/DeleteRelationshipTypeRequest\"\
        ,\n  \"$defs\": {\n    \"DeleteRelationshipTypeRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"relationshipTypeId\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n          \"\
        type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"ID of the relationship type to
        delete\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n  \"summary\": \"Delete relationship type\",\n  \"description\": \"Hard delete a relationship
        type. This will fail if the type is still in use.\\nFor safe removal, first deprecate the type, then merge it into
        another type\\n(or VOID), then delete. Only deprecated types with zero references can be deleted.\\n\",\n  \"tags\"\
        : [\n    \"RelationshipType Admin\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"deleteRelationshipType\"\
        \n}"
  /relationship-type/deprecate:
    post:
      summary: Deprecate a relationship type
      description: |
        Soft-delete a relationship type by marking it as deprecated.
        Deprecated types:
        - Remain queryable for historical data
        - Cannot be used for creating new relationships
        - Can be merged into other types using the merge endpoint
        - Can be hard-deleted after all references are removed
      operationId: deprecateRelationshipType
      tags:
      - RelationshipType Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeprecateRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type deprecated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found
        '409':
          description: Relationship type is already deprecated

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/DeprecateRelationshipTypeRequest\"\
        ,\n  \"$defs\": {\n    \"DeprecateRelationshipTypeRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"relationshipTypeId\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n          \"\
        type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"ID of the relationship type to
        deprecate\"\n        },\n        \"reason\": {\n          \"type\": \"string\",\n          \"maxLength\": 500,\n \
        \         \"nullable\": true,\n          \"description\": \"Optional reason for deprecation (for audit purposes)\"\
        \n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"relationshipTypeId\",\n        \"code\",\n        \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\"\
        ,\n        \"depth\",\n        \"createdAt\",\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"\
        relationshipTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\"\
        : {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n\
        \        \"description\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"\
        category\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\"\
        : {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n\
        \        \"parentTypeCode\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Code of the parent type (for convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"\
        string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\"\
        : {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n \
        \         \"type\": \"boolean\"\n        },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n     \
        \     \"description\": \"Whether this type is deprecated and cannot be used for new relationships\"\n        },\n\
        \        \"deprecatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"\
        nullable\": true,\n          \"description\": \"Timestamp when this type was deprecated\"\n        },\n        \"\
        deprecationReason\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Optional reason for deprecation\"\n        },\n        \"depth\": {\n          \"type\": \"integer\",\n      \
        \    \"description\": \"Depth in the hierarchy (0 for root types)\"\n        },\n        \"metadata\": {\n       \
        \   \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"nullable\": true\n        },\n \
        \       \"createdAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n     \
        \   \"updatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        }\n      }\n \
        \   }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Deprecate a relationship type\",\n  \"description\": \"Soft-delete a relationship
        type by marking it as deprecated.\\nDeprecated types:\\n- Remain queryable for historical data\\n- Cannot be used
        for creating new relationships\\n- Can be merged into other types using the merge endpoint\\n- Can be hard-deleted
        after all references are removed\\n\",\n  \"tags\": [\n    \"RelationshipType Admin\"\n  ],\n  \"deprecated\": false,\n\
        \  \"operationId\": \"deprecateRelationshipType\"\n}"
  /relationship-type/undeprecate:
    post:
      summary: Restore a deprecated relationship type
      description: |
        Remove the deprecated status from a relationship type, making it
        available for new relationships again.
      operationId: undeprecateRelationshipType
      tags:
      - RelationshipType Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UndeprecateRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type restored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found
        '400':
          description: Relationship type is not deprecated

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/UndeprecateRelationshipTypeRequest\"\
        ,\n  \"$defs\": {\n    \"UndeprecateRelationshipTypeRequest\": {\n      \"type\": \"object\",\n      \"required\"\
        : [\n        \"relationshipTypeId\"\n      ],\n      \"properties\": {\n        \"relationshipTypeId\": {\n      \
        \    \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"ID of the relationship type
        to restore\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RelationshipTypeResponse\"\
        ,\n  \"$defs\": {\n    \"RelationshipTypeResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n     \
        \   \"relationshipTypeId\",\n        \"code\",\n        \"name\",\n        \"isBidirectional\",\n        \"isDeprecated\"\
        ,\n        \"depth\",\n        \"createdAt\",\n        \"updatedAt\"\n      ],\n      \"properties\": {\n        \"\
        relationshipTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\n        },\n        \"code\"\
        : {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n\
        \        \"description\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"\
        category\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"parentTypeId\"\
        : {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n\
        \        \"parentTypeCode\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Code of the parent type (for convenience)\"\n        },\n        \"inverseTypeId\": {\n          \"type\": \"\
        string\",\n          \"format\": \"uuid\",\n          \"nullable\": true\n        },\n        \"inverseTypeCode\"\
        : {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"isBidirectional\": {\n \
        \         \"type\": \"boolean\"\n        },\n        \"isDeprecated\": {\n          \"type\": \"boolean\",\n     \
        \     \"description\": \"Whether this type is deprecated and cannot be used for new relationships\"\n        },\n\
        \        \"deprecatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"\
        nullable\": true,\n          \"description\": \"Timestamp when this type was deprecated\"\n        },\n        \"\
        deprecationReason\": {\n          \"type\": \"string\",\n          \"nullable\": true,\n          \"description\"\
        : \"Optional reason for deprecation\"\n        },\n        \"depth\": {\n          \"type\": \"integer\",\n      \
        \    \"description\": \"Depth in the hierarchy (0 for root types)\"\n        },\n        \"metadata\": {\n       \
        \   \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"nullable\": true\n        },\n \
        \       \"createdAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n     \
        \   \"updatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        }\n      }\n \
        \   }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Restore a deprecated relationship type\",\n  \"description\": \"Remove the
        deprecated status from a relationship type, making it\\navailable for new relationships again.\\n\",\n  \"tags\":
        [\n    \"RelationshipType Admin\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"undeprecateRelationshipType\"\
        \n}"
  /relationship-type/merge:
    post:
      summary: Merge a deprecated type into another type
      description: |
        Migrate all relationships using a deprecated type to a target type.
        This is the recommended way to handle type removal:
        1. Deprecate the source type
        2. Merge into the target type (or VOID for effective deletion)
        3. Optionally hard-delete the now-empty deprecated type

        The merge operation:
        - Updates all relationships using sourceTypeId to use targetTypeId
        - Publishes events for each affected relationship
        - Returns count of migrated relationships
        - Fails if source is not deprecated (safety check)
      operationId: mergeRelationshipType
      tags:
      - RelationshipType Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MergeRelationshipTypeRequest'
      responses:
        '200':
          description: Merge completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MergeRelationshipTypeResponse'
        '404':
          description: Source or target relationship type not found
        '400':
          description: Source type must be deprecated before merging
        '409':
          description: Cannot merge into a deprecated type

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/MergeRelationshipTypeRequest\"\
        ,\n  \"$defs\": {\n    \"MergeRelationshipTypeRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n \
        \       \"sourceTypeId\",\n        \"targetTypeId\"\n      ],\n      \"properties\": {\n        \"sourceTypeId\":
        {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"ID of the deprecated
        type to merge from (must be deprecated)\"\n        },\n        \"targetTypeId\": {\n          \"type\": \"string\"\
        ,\n          \"format\": \"uuid\",\n          \"description\": \"ID of the type to merge into (can be VOID for effective
        deletion)\"\n        },\n        \"deleteAfterMerge\": {\n          \"type\": \"boolean\",\n          \"default\"\
        : false,\n          \"description\": \"If true, hard-delete the source type after successful merge\"\n        }\n\
        \      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/MergeRelationshipTypeResponse\"\
        ,\n  \"$defs\": {\n    \"MergeRelationshipTypeResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"sourceTypeId\",\n        \"targetTypeId\",\n        \"relationshipsMigrated\",\n        \"sourceDeleted\"\
        \n      ],\n      \"properties\": {\n        \"sourceTypeId\": {\n          \"type\": \"string\",\n          \"format\"\
        : \"uuid\",\n          \"description\": \"ID of the deprecated type that was merged from\"\n        },\n        \"\
        targetTypeId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\": \"\
        ID of the type that relationships were merged into\"\n        },\n        \"relationshipsMigrated\": {\n         \
        \ \"type\": \"integer\",\n          \"description\": \"Number of relationships updated to use the target type\"\n\
        \        },\n        \"sourceDeleted\": {\n          \"type\": \"boolean\",\n          \"description\": \"Whether
        the source type was hard-deleted after merge\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Merge a deprecated type into another type\",\n  \"description\": \"Migrate
        all relationships using a deprecated type to a target type.\\nThis is the recommended way to handle type removal:\\
        n1. Deprecate the source type\\n2. Merge into the target type (or VOID for effective deletion)\\n3. Optionally hard-delete
        the now-empty deprecated type\\n\\nThe merge operation:\\n- Updates all relationships using sourceTypeId to use targetTypeId\\
        n- Publishes events for each affected relationship\\n- Returns count of migrated relationships\\n- Fails if source
        is not deprecated (safety check)\\n\",\n  \"tags\": [\n    \"RelationshipType Admin\"\n  ],\n  \"deprecated\": false,\n\
        \  \"operationId\": \"mergeRelationshipType\"\n}"
  /relationship-type/seed:
    post:
      summary: Seed relationship types from configuration
      description: |
        Idempotent operation to seed relationship types from provided data.
        Creates types that don't exist, optionally updates existing types.
        Typically called at service startup with YAML-defined types.
      operationId: seedRelationshipTypes
      tags:
      - RelationshipType Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeedRelationshipTypesRequest'
      responses:
        '200':
          description: Seed operation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeedRelationshipTypesResponse'
        '400':
          description: Invalid seed data

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/SeedRelationshipTypesRequest\"\
        ,\n  \"$defs\": {\n    \"SeedRelationshipTypesRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n \
        \       \"types\"\n      ],\n      \"properties\": {\n        \"types\": {\n          \"type\": \"array\",\n     \
        \     \"items\": {\n            \"$ref\": \"#/$defs/SeedRelationshipType\"\n          },\n          \"description\"\
        : \"List of relationship types to seed\"\n        },\n        \"updateExisting\": {\n          \"type\": \"boolean\"\
        ,\n          \"default\": false,\n          \"description\": \"Whether to update types that already exist\"\n    \
        \    }\n      }\n    },\n    \"SeedRelationshipType\": {\n      \"type\": \"object\",\n      \"required\": [\n   \
        \     \"code\",\n        \"name\"\n      ],\n      \"properties\": {\n        \"code\": {\n          \"type\": \"\
        string\",\n          \"description\": \"Unique code for the relationship type\"\n        },\n        \"name\": {\n\
        \          \"type\": \"string\",\n          \"description\": \"Display name\"\n        },\n        \"description\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"Description\"\n        },\n        \"category\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"Category for grouping\"\n        },\n        \"\
        parentTypeCode\": {\n          \"type\": \"string\",\n          \"description\": \"Code of the parent type (resolved
        during seeding)\"\n        },\n        \"inverseTypeCode\": {\n          \"type\": \"string\",\n          \"description\"\
        : \"Code of the inverse relationship\"\n        },\n        \"isBidirectional\": {\n          \"type\": \"boolean\"\
        ,\n          \"default\": false\n        },\n        \"metadata\": {\n          \"type\": \"object\",\n          \"\
        additionalProperties\": true\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/SeedRelationshipTypesResponse\"\
        ,\n  \"$defs\": {\n    \"SeedRelationshipTypesResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n\
        \        \"created\",\n        \"updated\",\n        \"skipped\",\n        \"errors\"\n      ],\n      \"properties\"\
        : {\n        \"created\": {\n          \"type\": \"integer\",\n          \"description\": \"Number of new types created\"\
        \n        },\n        \"updated\": {\n          \"type\": \"integer\",\n          \"description\": \"Number of existing
        types updated\"\n        },\n        \"skipped\": {\n          \"type\": \"integer\",\n          \"description\":
        \"Number of types skipped (already exist, updateExisting=false)\"\n        },\n        \"errors\": {\n          \"\
        type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          },\n          \"description\"\
        : \"List of error messages for types that failed to seed\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Seed relationship types from configuration\",\n  \"description\": \"Idempotent
        operation to seed relationship types from provided data.\\nCreates types that don't exist, optionally updates existing
        types.\\nTypically called at service startup with YAML-defined types.\\n\",\n  \"tags\": [\n    \"RelationshipType
        Admin\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"seedRelationshipTypes\"\n}"
components:
  schemas:
    # Request schemas
    GetRelationshipTypeRequest:
      type: object
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: Unique identifier of the relationship type

    GetRelationshipTypeByCodeRequest:
      type: object
      required:
      - code
      properties:
        code:
          type: string
          minLength: 1
          maxLength: 50
          pattern: '^[A-Z][A-Z0-9_]*$'
          description: Unique code for the relationship type (e.g., "SON", "MOTHER", "FRIEND")

    ListRelationshipTypesRequest:
      type: object
      properties:
        category:
          type: string
          description: Filter by category (e.g., "FAMILY", "SOCIAL", "ECONOMIC")
        includeChildren:
          type: boolean
          default: true
          description: Whether to include child types in the response
        rootsOnly:
          type: boolean
          default: false
          description: Only return types with no parent (root types)
        includeDeprecated:
          type: boolean
          default: false
          description: Whether to include deprecated types in the response

    GetChildRelationshipTypesRequest:
      type: object
      required:
      - parentTypeId
      properties:
        parentTypeId:
          type: string
          format: uuid
          description: ID of the parent relationship type
        recursive:
          type: boolean
          default: false
          description: Include all descendants, not just direct children

    MatchesHierarchyRequest:
      type: object
      required:
      - typeId
      - ancestorTypeId
      properties:
        typeId:
          type: string
          format: uuid
          description: The relationship type to check
        ancestorTypeId:
          type: string
          format: uuid
          description: The potential ancestor type

    GetAncestorsRequest:
      type: object
      required:
      - typeId
      properties:
        typeId:
          type: string
          format: uuid
          description: The relationship type to get ancestors for

    CreateRelationshipTypeRequest:
      type: object
      required:
      - code
      - name
      properties:
        code:
          type: string
          minLength: 1
          maxLength: 50
          pattern: '^[A-Z][A-Z0-9_]*$'
          description: Unique code for the relationship type (e.g., "SON", "MOTHER")
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Display name for the relationship type
        description:
          type: string
          maxLength: 500
          description: Description of the relationship type
        category:
          type: string
          maxLength: 50
          description: Category for grouping (e.g., "FAMILY", "SOCIAL", "ECONOMIC")
        parentTypeId:
          type: string
          format: uuid
          nullable: true
          description: Parent type ID for hierarchy (null for root types)
        inverseTypeCode:
          type: string
          maxLength: 50
          nullable: true
          description: Code of the inverse relationship (e.g., "PARENT" for "CHILD")
        isBidirectional:
          type: boolean
          default: false
          description: Whether the relationship is the same in both directions (e.g., "SIBLING")
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional metadata for the relationship type

    UpdateRelationshipTypeRequest:
      type: object
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to update
        name:
          type: string
          minLength: 1
          maxLength: 100
          nullable: true
          description: Display name for the relationship type
        description:
          type: string
          maxLength: 500
          nullable: true
          description: Description of the relationship type
        category:
          type: string
          maxLength: 50
          nullable: true
          description: Category for grouping
        parentTypeId:
          type: string
          format: uuid
          nullable: true
          description: Parent type ID for hierarchy
        inverseTypeCode:
          type: string
          maxLength: 50
          nullable: true
          description: Code of the inverse relationship
        isBidirectional:
          type: boolean
          nullable: true
          description: Whether the relationship is bidirectional
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional metadata

    DeleteRelationshipTypeRequest:
      type: object
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to delete

    DeprecateRelationshipTypeRequest:
      type: object
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to deprecate
        reason:
          type: string
          maxLength: 500
          nullable: true
          description: Optional reason for deprecation (for audit purposes)

    UndeprecateRelationshipTypeRequest:
      type: object
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to restore

    MergeRelationshipTypeRequest:
      type: object
      required:
      - sourceTypeId
      - targetTypeId
      properties:
        sourceTypeId:
          type: string
          format: uuid
          description: ID of the deprecated type to merge from (must be deprecated)
        targetTypeId:
          type: string
          format: uuid
          description: ID of the type to merge into (can be VOID for effective deletion)
        deleteAfterMerge:
          type: boolean
          default: false
          description: If true, hard-delete the source type after successful merge

    SeedRelationshipTypesRequest:
      type: object
      required:
      - types
      properties:
        types:
          type: array
          items:
            $ref: '#/components/schemas/SeedRelationshipType'
          description: List of relationship types to seed
        updateExisting:
          type: boolean
          default: false
          description: Whether to update types that already exist

    SeedRelationshipType:
      type: object
      required:
      - code
      - name
      properties:
        code:
          type: string
          description: Unique code for the relationship type
        name:
          type: string
          description: Display name
        description:
          type: string
          description: Description
        category:
          type: string
          description: Category for grouping
        parentTypeCode:
          type: string
          description: Code of the parent type (resolved during seeding)
        inverseTypeCode:
          type: string
          description: Code of the inverse relationship
        isBidirectional:
          type: boolean
          default: false
        metadata:
          type: object
          additionalProperties: true

    # Response schemas
    RelationshipTypeResponse:
      type: object
      required:
      - relationshipTypeId
      - code
      - name
      - isBidirectional
      - isDeprecated
      - depth
      - createdAt
      - updatedAt
      properties:
        relationshipTypeId:
          type: string
          format: uuid
        code:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        parentTypeId:
          type: string
          format: uuid
          nullable: true
        parentTypeCode:
          type: string
          nullable: true
          description: Code of the parent type (for convenience)
        inverseTypeId:
          type: string
          format: uuid
          nullable: true
        inverseTypeCode:
          type: string
          nullable: true
        isBidirectional:
          type: boolean
        isDeprecated:
          type: boolean
          description: Whether this type is deprecated and cannot be used for new relationships
        deprecatedAt:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when this type was deprecated
        deprecationReason:
          type: string
          nullable: true
          description: Optional reason for deprecation
        depth:
          type: integer
          description: Depth in the hierarchy (0 for root types)
        metadata:
          type: object
          additionalProperties: true
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    RelationshipTypeListResponse:
      type: object
      required:
      - types
      - totalCount
      properties:
        types:
          type: array
          items:
            $ref: '#/components/schemas/RelationshipTypeResponse'
        totalCount:
          type: integer

    MatchesHierarchyResponse:
      type: object
      required:
      - matches
      properties:
        matches:
          type: boolean
          description: True if typeId equals or descends from ancestorTypeId
        depth:
          type: integer
          description: Number of levels between the types (0 if same, -1 if no match)

    SeedRelationshipTypesResponse:
      type: object
      required:
      - created
      - updated
      - skipped
      - errors
      properties:
        created:
          type: integer
          description: Number of new types created
        updated:
          type: integer
          description: Number of existing types updated
        skipped:
          type: integer
          description: Number of types skipped (already exist, updateExisting=false)
        errors:
          type: array
          items:
            type: string
          description: List of error messages for types that failed to seed

    MergeRelationshipTypeResponse:
      type: object
      required:
      - sourceTypeId
      - targetTypeId
      - relationshipsMigrated
      - sourceDeleted
      properties:
        sourceTypeId:
          type: string
          format: uuid
          description: ID of the deprecated type that was merged from
        targetTypeId:
          type: string
          format: uuid
          description: ID of the type that relationships were merged into
        relationshipsMigrated:
          type: integer
          description: Number of relationships updated to use the target type
        sourceDeleted:
          type: boolean
          description: Whether the source type was hard-deleted after merge
