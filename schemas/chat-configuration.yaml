openapi: 3.0.4
info:
  title: Chat Service Configuration
  description: |
    Configuration schema for Chat service.
    Properties are bound to environment variables with BANNOU_ prefix.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    MaxRoomTypesPerGameService:
      type: integer
      env: CHAT_MAX_ROOM_TYPES_PER_GAME_SERVICE
      default: 50
      minimum: 1
      maximum: 500
      description: Maximum custom room types per game service

    DefaultMaxParticipantsPerRoom:
      type: integer
      env: CHAT_DEFAULT_MAX_PARTICIPANTS_PER_ROOM
      default: 100
      minimum: 1
      maximum: 10000
      description: Default participant limit when room type does not specify

    DefaultRateLimitPerMinute:
      type: integer
      env: CHAT_DEFAULT_RATE_LIMIT_PER_MINUTE
      default: 60
      minimum: 1
      maximum: 600
      description: Default messages per minute per participant when room type does not specify

    IdleRoomCleanupIntervalMinutes:
      type: integer
      env: CHAT_IDLE_ROOM_CLEANUP_INTERVAL_MINUTES
      default: 60
      minimum: 5
      maximum: 1440
      description: How often the background worker checks for idle rooms

    IdleRoomTimeoutMinutes:
      type: integer
      env: CHAT_IDLE_ROOM_TIMEOUT_MINUTES
      default: 1440
      minimum: 10
      maximum: 43200
      description: Minutes of inactivity before a room is eligible for auto-cleanup

    EphemeralMessageTtlMinutes:
      type: integer
      env: CHAT_EPHEMERAL_MESSAGE_TTL_MINUTES
      default: 60
      minimum: 5
      maximum: 1440
      description: TTL for messages in ephemeral (Redis) rooms

    MaxPinnedMessagesPerRoom:
      type: integer
      env: CHAT_MAX_PINNED_MESSAGES_PER_ROOM
      default: 10
      minimum: 0
      maximum: 100
      description: Maximum pinned messages per room

    DefaultContractFulfilledAction:
      $ref: 'chat-api.yaml#/components/schemas/ContractRoomAction'
      env: CHAT_DEFAULT_CONTRACT_FULFILLED_ACTION
      default: Archive
      description: Default action when governing contract is fulfilled

    DefaultContractBreachAction:
      $ref: 'chat-api.yaml#/components/schemas/ContractRoomAction'
      env: CHAT_DEFAULT_CONTRACT_BREACH_ACTION
      default: Lock
      description: Default action when a breach is detected on governing contract

    DefaultContractTerminatedAction:
      $ref: 'chat-api.yaml#/components/schemas/ContractRoomAction'
      env: CHAT_DEFAULT_CONTRACT_TERMINATED_ACTION
      default: Delete
      description: Default action when governing contract is terminated early

    DefaultContractExpiredAction:
      $ref: 'chat-api.yaml#/components/schemas/ContractRoomAction'
      env: CHAT_DEFAULT_CONTRACT_EXPIRED_ACTION
      default: Archive
      description: Default action when governing contract expires naturally

    ContractRoomQueryBatchSize:
      type: integer
      env: CHAT_CONTRACT_ROOM_QUERY_BATCH_SIZE
      default: 100
      minimum: 10
      maximum: 1000
      description: Page size for paginated contract-room queries during contract lifecycle events

    MaxContractRoomQueryResults:
      type: integer
      env: CHAT_MAX_CONTRACT_ROOM_QUERY_RESULTS
      default: 1000
      minimum: 100
      maximum: 10000
      description: Safety cap on total rooms processed per contract lifecycle event, logs warning if reached

    MessageHistoryPageSize:
      type: integer
      env: CHAT_MESSAGE_HISTORY_PAGE_SIZE
      default: 50
      minimum: 10
      maximum: 200
      description: Default page size for message history queries

    LockExpirySeconds:
      type: integer
      env: CHAT_LOCK_EXPIRY_SECONDS
      default: 15
      minimum: 5
      maximum: 300
      description: Distributed lock expiry for chat room and participant mutations

    IdleRoomCleanupStartupDelaySeconds:
      type: integer
      env: CHAT_IDLE_ROOM_CLEANUP_STARTUP_DELAY_SECONDS
      default: 30
      minimum: 5
      maximum: 300
      description: Initial delay before the idle room cleanup worker begins its first cycle

    IdleRoomCleanupLockExpirySeconds:
      type: integer
      env: CHAT_IDLE_ROOM_CLEANUP_LOCK_EXPIRY_SECONDS
      default: 120
      minimum: 30
      maximum: 600
      description: Distributed lock expiry for idle room cleanup batch cycle

    BanExpiryIntervalMinutes:
      type: integer
      env: CHAT_BAN_EXPIRY_INTERVAL_MINUTES
      default: 60
      minimum: 5
      maximum: 1440
      description: How often the background worker checks for expired bans

    BanExpiryStartupDelaySeconds:
      type: integer
      env: CHAT_BAN_EXPIRY_STARTUP_DELAY_SECONDS
      default: 30
      minimum: 5
      maximum: 300
      description: Initial delay before the ban expiry worker begins its first cycle

    BanExpiryBatchSize:
      type: integer
      env: CHAT_BAN_EXPIRY_BATCH_SIZE
      default: 1000
      minimum: 10
      maximum: 10000
      description: Maximum expired ban records processed per worker cycle

    BanExpiryLockExpirySeconds:
      type: integer
      env: CHAT_BAN_EXPIRY_LOCK_EXPIRY_SECONDS
      default: 120
      minimum: 30
      maximum: 600
      description: Distributed lock expiry for ban expiry batch cycle

    MessageRetentionCleanupIntervalMinutes:
      type: integer
      env: CHAT_MESSAGE_RETENTION_CLEANUP_INTERVAL_MINUTES
      default: 360
      minimum: 30
      maximum: 10080
      description: How often the background worker checks for expired persistent messages

    MessageRetentionStartupDelaySeconds:
      type: integer
      env: CHAT_MESSAGE_RETENTION_STARTUP_DELAY_SECONDS
      default: 60
      minimum: 10
      maximum: 600
      description: Initial delay before the message retention cleanup worker begins its first cycle

    MessageRetentionBatchSize:
      type: integer
      env: CHAT_MESSAGE_RETENTION_BATCH_SIZE
      default: 500
      minimum: 10
      maximum: 5000
      description: Maximum expired messages to delete per room per cleanup cycle

    MessageRetentionLockExpirySeconds:
      type: integer
      env: CHAT_MESSAGE_RETENTION_LOCK_EXPIRY_SECONDS
      default: 300
      minimum: 60
      maximum: 1800
      description: Distributed lock expiry for message retention cleanup cycle

    MessageRetentionMaxRoomTypeResults:
      type: integer
      env: CHAT_MESSAGE_RETENTION_MAX_ROOM_TYPE_RESULTS
      default: 1000
      minimum: 10
      maximum: 10000
      description: Maximum room types with retention configuration to process per cleanup cycle

    MessageRetentionMaxRoomsPerType:
      type: integer
      env: CHAT_MESSAGE_RETENTION_MAX_ROOMS_PER_TYPE
      default: 1000
      minimum: 10
      maximum: 100000
      description: Maximum rooms per type to process per retention cleanup cycle

    TypingTimeoutSeconds:
      type: integer
      env: CHAT_TYPING_TIMEOUT_SECONDS
      default: 5
      minimum: 2
      maximum: 30
      description: Seconds of inactivity before typing indicator auto-expires

    TypingWorkerIntervalMilliseconds:
      type: integer
      env: CHAT_TYPING_WORKER_INTERVAL_MILLISECONDS
      default: 1000
      minimum: 250
      maximum: 5000
      description: How often the typing expiry worker checks for stale typing entries

    TypingWorkerBatchSize:
      type: integer
      env: CHAT_TYPING_WORKER_BATCH_SIZE
      default: 100
      minimum: 10
      maximum: 1000
      description: Maximum expired entries processed per worker cycle

    ServerSalt:
      type: string
      env: CHAT_SERVER_SALT
      default: "bannou-dev-chat-salt-change-in-production"
      description: Server salt for session shortcut GUID generation per IMPLEMENTATION TENETS
