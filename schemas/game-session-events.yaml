openapi: 3.0.3
info:
  title: Game Session Service Events
  description: |
    Event subscription and publication declarations for Game Session service.
    Lifecycle events (Created, Updated, Deleted) are auto-generated from x-lifecycle.
    Custom events (PlayerJoined, PlayerLeft) are manually defined.
  version: 1.0.0
  x-event-subscriptions:
    # Session lifecycle events from Connect service
    - topic: session.connected
      event: SessionConnectedEvent
      handler: HandleSessionConnected
    - topic: session.disconnected
      event: SessionDisconnectedEvent
      handler: HandleSessionDisconnected
    - topic: session.reconnected
      event: SessionReconnectedEvent
      handler: HandleSessionReconnected
    # Subscription changes from Subscriptions service
    - topic: subscription.updated
      event: SubscriptionUpdatedEvent
      handler: HandleSubscriptionUpdated
  x-event-publications:
    # Game session state changes (for permission recompilation)
    - topic: permissions.session-state-changed
      event: SessionStateChangeEvent
      description: Published when player enters/exits game session affecting permissions
    # Game session lifecycle events (auto-generated)
    - topic: game-session.created
      event: GameSessionCreatedEvent
      description: Published when a new game session is created
    - topic: game-session.updated
      event: GameSessionUpdatedEvent
      description: Published when a game session is updated
    - topic: game-session.deleted
      event: GameSessionDeletedEvent
      description: Published when a game session is deleted
    # Custom player events (manually defined)
    - topic: game-session.player-joined
      event: GameSessionPlayerJoinedEvent
      description: Published when a player joins a game session
    - topic: game-session.player-left
      event: GameSessionPlayerLeftEvent
      description: Published when a player leaves a game session
# Lifecycle events auto-generated from this definition
# Output: schemas/Generated/game-session-lifecycle-events.yaml
x-lifecycle:
  GameSession:
    model:
      sessionId: { type: string, primary: true, required: true }
      gameType: { type: string, required: true }
      sessionName: { type: string }
      status: { type: string, required: true }
      maxPlayers: { type: integer }
      currentPlayers: { type: integer }
      isPrivate: { type: boolean }
      owner: { type: string, format: uuid }
      createdAt: { type: string, format: date-time, required: true }

paths: {}  # Events don't have HTTP paths

# Note: GameSessionCreatedEvent, GameSessionUpdatedEvent, GameSessionDeletedEvent
# are auto-generated from x-lifecycle. See: schemas/Generated/game-session-lifecycle-events.yaml

components:
  schemas:
    # =========================================================================
    # Custom Player Participation Events (not lifecycle - manually defined)
    # =========================================================================
    GameSessionPlayerJoinedEvent:
      type: object
      description: Published when a player joins a game session
      required:
        - eventId
        - timestamp
        - sessionId
        - accountId
      properties:
        eventId:
          type: string
          description: Unique identifier for this event
        timestamp:
          type: string
          format: date-time
          description: When the player joined
        sessionId:
          type: string
          description: ID of the game session
        accountId:
          type: string
          description: ID of the account that joined

    GameSessionPlayerLeftEvent:
      type: object
      description: Published when a player leaves a game session
      required:
        - eventId
        - timestamp
        - sessionId
        - accountId
      properties:
        eventId:
          type: string
          description: Unique identifier for this event
        timestamp:
          type: string
          format: date-time
          description: When the player left
        sessionId:
          type: string
          description: ID of the game session
        accountId:
          type: string
          description: ID of the account that left
        kicked:
          type: boolean
          description: Whether the player was kicked (vs left voluntarily)
          default: false
        reason:
          type: string
          description: Reason for leaving/being kicked (if applicable)
