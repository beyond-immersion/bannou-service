openapi: 3.0.3
info:
  title: Mapping Service Configuration
  description: |
    Configuration schema for Mapping service.
    Properties are bound to environment variables with BANNOU_ prefix.

    The Mapping service manages spatial data for game worlds, including
    authority management, spatial indexing, and affordance queries.

    **Schema Rules**: AI agents MUST review docs/reference/SCHEMA-RULES.md before
    modifying this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    # Service Enable/Disable
    # Authority Management
    AuthorityTimeoutSeconds:
      type: integer
      description: Time in seconds before authority expires without heartbeat
      default: 60
      env: MAPPING_AUTHORITY_TIMEOUT_SECONDS
    AuthorityGracePeriodSeconds:
      type: integer
      description: Grace period in seconds after missed heartbeat before authority released
      default: 30
      env: MAPPING_AUTHORITY_GRACE_PERIOD_SECONDS
    # Spatial Indexing
    DefaultSpatialCellSize:
      type: number
      description: Size of spatial index cells in world units (default 64)
      default: 64.0
      env: MAPPING_SPATIAL_CELL_SIZE

    # Query Limits
    MaxObjectsPerQuery:
      type: integer
      description: Maximum objects returned in a single query
      default: 5000
      env: MAPPING_MAX_OBJECTS_PER_QUERY
    MaxPayloadsPerPublish:
      type: integer
      description: Maximum payloads in single publish or ingest event
      default: 100
      env: MAPPING_MAX_PAYLOADS_PER_PUBLISH

    # Affordance System
    AffordanceCacheTimeoutSeconds:
      type: integer
      description: Default TTL for cached affordance query results
      default: 60
      env: MAPPING_AFFORDANCE_CACHE_TIMEOUT_SECONDS
    MaxAffordanceCandidates:
      type: integer
      description: Maximum candidate points to evaluate in affordance queries
      default: 1000
      env: MAPPING_MAX_AFFORDANCE_CANDIDATES
    AffordanceExclusionToleranceUnits:
      type: number
      description: Distance tolerance in world units for position exclusion matching in affordance queries
      default: 1.0
      env: MAPPING_AFFORDANCE_EXCLUSION_TOLERANCE_UNITS

    # Large Payload Handling
    InlinePayloadMaxBytes:
      type: integer
      description: Payloads larger than this are stored via lib-asset reference
      default: 65536
      env: MAPPING_INLINE_PAYLOAD_MAX_BYTES

    # Authoring
    MaxCheckoutDurationSeconds:
      type: integer
      description: Maximum duration for authoring checkout locks
      default: 1800
      env: MAPPING_MAX_CHECKOUT_DURATION_SECONDS

    # Layer Storage
    DefaultLayerCacheTtlSeconds:
      type: integer
      description: Default TTL for cached layer data (ephemeral kinds)
      default: 3600
      env: MAPPING_DEFAULT_LAYER_CACHE_TTL_SECONDS

    # Event Aggregation
    EventAggregationWindowMs:
      type: integer
      description: Window in milliseconds for batching rapid updates into single event (0 = disabled)
      default: 100
      env: MAPPING_EVENT_AGGREGATION_WINDOW_MS

    # Per-Kind TTL Settings (in seconds, 0 = use default, -1 = no TTL)
    TtlTerrain:
      type: integer
      description: TTL for terrain layer data (-1 = no TTL, durable)
      default: -1
      env: MAPPING_TTL_TERRAIN
    TtlStaticGeometry:
      type: integer
      description: TTL for static geometry layer data (-1 = no TTL, durable)
      default: -1
      env: MAPPING_TTL_STATIC_GEOMETRY
    TtlNavigation:
      type: integer
      description: TTL for navigation layer data (-1 = no TTL, durable)
      default: -1
      env: MAPPING_TTL_NAVIGATION
    TtlResources:
      type: integer
      description: TTL for resources layer data
      default: 3600
      env: MAPPING_TTL_RESOURCES
    TtlSpawnPoints:
      type: integer
      description: TTL for spawn points layer data
      default: 3600
      env: MAPPING_TTL_SPAWN_POINTS
    TtlPointsOfInterest:
      type: integer
      description: TTL for points of interest layer data
      default: 3600
      env: MAPPING_TTL_POINTS_OF_INTEREST
    TtlDynamicObjects:
      type: integer
      description: TTL for dynamic objects layer data
      default: 3600
      env: MAPPING_TTL_DYNAMIC_OBJECTS
    TtlHazards:
      type: integer
      description: TTL for hazards layer data (short-lived)
      default: 300
      env: MAPPING_TTL_HAZARDS
    TtlWeatherEffects:
      type: integer
      description: TTL for weather effects layer data
      default: 600
      env: MAPPING_TTL_WEATHER_EFFECTS
    TtlOwnership:
      type: integer
      description: TTL for ownership layer data (-1 = no TTL, durable)
      default: -1
      env: MAPPING_TTL_OWNERSHIP
    TtlCombatEffects:
      type: integer
      description: TTL for combat effects layer data (very short-lived, ephemeral)
      default: 30
      env: MAPPING_TTL_COMBAT_EFFECTS
    TtlVisualEffects:
      type: integer
      description: TTL for visual effects layer data (short-lived, ephemeral)
      default: 60
      env: MAPPING_TTL_VISUAL_EFFECTS

    # Spatial Query Configuration
    MaxSpatialQueryResults:
      type: integer
      description: Maximum results returned for spatial queries (bounding box, etc)
      default: 5
      env: MAPPING_MAX_SPATIAL_QUERY_RESULTS
