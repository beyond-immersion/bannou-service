openapi: 3.0.0
info:
  title: Relationship Service API
  version: 2.0.0
  description: |
    Relationship and relationship type management service for entity-to-entity
    relationships in the Arcadia game world.

    **Relationships** are entity-agnostic records linking any two entities (characters,
    NPCs, items, locations, organizations, etc.) with composite uniqueness validation,
    bidirectional support, type-specific metadata, and soft-delete via endedAt.

    **Relationship Types** define the taxonomy of possible relationships (e.g.,
    PARENT â†’ FATHER/MOTHER, FRIEND, RIVAL) with hierarchical parent relationships,
    inverse type tracking, bidirectional flags, and a deprecation/merge lifecycle.

    Key features:
    - Entity-agnostic relationship management
    - Composite uniqueness validation (entity1 + entity2 + type = unique)
    - Hierarchical type system with parent-child relationships
    - Type deprecation with merge-based migration
    - Dependency-ordered bulk seeding from configuration
    - Soft-delete via endedAt (relationships can be re-created after ending)

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
x-service-layer: GameFoundation
servers:
- url: http://localhost:5012

# NOTE: x-lifecycle definitions are in relationship-events.yaml

paths:
  # ============================================================
  # Relationship Instance Operations
  # ============================================================

  /relationship/create:
    post:
      operationId: createRelationship
      tags:
      - Relationship Management
      summary: Create a new relationship between two entities
      description: |
        Creates a relationship between two entities.
        Duplicate relationships (same entities + same type) are prevented.
        Relationships can be re-created after being ended.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRelationshipRequest'
      responses:
        '200':
          description: Relationship created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipResponse'
        '400':
          description: Invalid request (missing fields, invalid entity types)
        '409':
          description: Relationship already exists between these entities with this type
      x-permissions:
      - role: admin
        states: {}

  /relationship/get:
    post:
      operationId: getRelationship
      tags:
      - Relationship Management
      summary: Get a relationship by ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetRelationshipRequest'
      responses:
        '200':
          description: Relationship retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipResponse'
        '404':
          description: Relationship not found
      x-permissions:
      - role: user
        states: {}

  /relationship/list-by-entity:
    post:
      operationId: listRelationshipsByEntity
      tags:
      - Relationship Management
      summary: List all relationships for an entity
      description: |
        Returns all relationships where the specified entity is either
        entity1 or entity2. Supports filtering by relationship type,
        other entity type, and whether to include ended relationships.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListRelationshipsByEntityRequest'
      responses:
        '200':
          description: Relationships retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipListResponse'
      x-permissions:
      - role: user
        states: {}

  /relationship/get-between:
    post:
      operationId: getRelationshipsBetween
      tags:
      - Relationship Management
      summary: Get all relationships between two specific entities
      description: |
        Returns all relationships that exist between two specific entities,
        regardless of which is entity1 or entity2.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetRelationshipsBetweenRequest'
      responses:
        '200':
          description: Relationships retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipListResponse'
      x-permissions:
      - role: user
        states: {}

  /relationship/list-by-type:
    post:
      operationId: listRelationshipsByType
      tags:
      - Relationship Management
      summary: List all relationships of a specific type
      description: |
        Returns all relationships that use a specific relationship type.
        Useful for finding all "FRIEND" relationships, for example.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListRelationshipsByTypeRequest'
      responses:
        '200':
          description: Relationships retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipListResponse'
      x-permissions:
      - role: user
        states: {}

  /relationship/update:
    post:
      operationId: updateRelationship
      tags:
      - Relationship Management
      summary: Update relationship metadata
      description: Only metadata can be updated. Entity IDs and types cannot be changed.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRelationshipRequest'
      responses:
        '200':
          description: Relationship updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipResponse'
        '404':
          description: Relationship not found
      x-permissions:
      - role: admin
        states: {}

  /relationship/end:
    post:
      operationId: endRelationship
      tags:
      - Relationship Management
      summary: End a relationship
      description: |
        Marks a relationship as ended with a timestamp.
        Ended relationships are preserved for history and can be re-created.
        The composite uniqueness key is cleared, allowing new relationships
        between the same entities with the same type.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EndRelationshipRequest'
      responses:
        '200':
          description: Relationship ended successfully
        '404':
          description: Relationship not found
      x-permissions:
      - role: admin
        states: {}

  # ============================================================
  # Relationship Type Operations
  # ============================================================

  /relationship-type/get:
    post:
      summary: Get relationship type by ID
      operationId: getRelationshipType
      tags:
      - Relationship Type Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found

  /relationship-type/get-by-code:
    post:
      summary: Get relationship type by code
      description: Retrieve a relationship type using its unique code (e.g., "SON", "MOTHER", "FRIEND")
      operationId: getRelationshipTypeByCode
      tags:
      - Relationship Type Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetRelationshipTypeByCodeRequest'
      responses:
        '200':
          description: Relationship type retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found

  /relationship-type/list:
    post:
      summary: List all relationship types
      description: Retrieve all relationship types with optional hierarchy filtering
      operationId: listRelationshipTypes
      tags:
      - Relationship Type Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListRelationshipTypesRequest'
      responses:
        '200':
          description: Relationship types retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeListResponse'

  /relationship-type/get-children:
    post:
      summary: Get child types for a parent type
      description: Retrieve all relationship types that have the specified type as their parent
      operationId: getChildRelationshipTypes
      tags:
      - Relationship Type Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetChildRelationshipTypesRequest'
      responses:
        '200':
          description: Child relationship types retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeListResponse'
        '404':
          description: Parent relationship type not found

  /relationship-type/matches-hierarchy:
    post:
      summary: Check if type matches ancestor in hierarchy
      description: |
        Checks if a relationship type matches or descends from an ancestor type.
        For example, "SON" matches "CHILD" because CHILD is an ancestor of SON.
        This enables queries like "find all CHILD relationships" to match SON, DAUGHTER, etc.
      operationId: matchesHierarchy
      tags:
      - Relationship Type Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MatchesHierarchyRequest'
      responses:
        '200':
          description: Hierarchy match result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchesHierarchyResponse'
        '404':
          description: One or both relationship types not found

  /relationship-type/get-ancestors:
    post:
      summary: Get all ancestors of a relationship type
      description: |
        Returns the full ancestry chain from the specified type up to the root.
        For example, for "SON" might return ["CHILD", "FAMILY"].
      operationId: getAncestors
      tags:
      - Relationship Type Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetAncestorsRequest'
      responses:
        '200':
          description: Ancestors retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeListResponse'
        '404':
          description: Relationship type not found

  /relationship-type/create:
    post:
      summary: Create new relationship type
      operationId: createRelationshipType
      tags:
      - Relationship Type Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '400':
          description: Invalid relationship type data
        '409':
          description: Relationship type with this code already exists

  /relationship-type/update:
    post:
      summary: Update relationship type
      operationId: updateRelationshipType
      tags:
      - Relationship Type Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found
        '400':
          description: Invalid update data

  /relationship-type/delete:
    post:
      summary: Delete relationship type
      description: |
        Hard delete a relationship type. This will fail if the type is still in use.
        For safe removal, first deprecate the type, then merge it into another type
        (or VOID), then delete. Only deprecated types with zero references can be deleted.
      operationId: deleteRelationshipType
      tags:
      - Relationship Type Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type deleted successfully
        '404':
          description: Relationship type not found
        '409':
          description: Cannot delete - type is in use by relationships or has child types

  /relationship-type/deprecate:
    post:
      summary: Deprecate a relationship type
      description: |
        Soft-delete a relationship type by marking it as deprecated.
        Deprecated types:
        - Remain queryable for historical data
        - Cannot be used for creating new relationships
        - Can be merged into other types using the merge endpoint
        - Can be hard-deleted after all references are removed
      operationId: deprecateRelationshipType
      tags:
      - Relationship Type Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeprecateRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type deprecated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found
        '409':
          description: Relationship type is already deprecated

  /relationship-type/undeprecate:
    post:
      summary: Restore a deprecated relationship type
      description: |
        Remove the deprecated status from a relationship type, making it
        available for new relationships again.
      operationId: undeprecateRelationshipType
      tags:
      - Relationship Type Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UndeprecateRelationshipTypeRequest'
      responses:
        '200':
          description: Relationship type restored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipTypeResponse'
        '404':
          description: Relationship type not found
        '400':
          description: Relationship type is not deprecated

  /relationship-type/merge:
    post:
      summary: Merge a deprecated type into another type
      description: |
        Migrate all relationships using a deprecated type to a target type.
        This is the recommended way to handle type removal:
        1. Deprecate the source type
        2. Merge into the target type (or VOID for effective deletion)
        3. Optionally hard-delete the now-empty deprecated type

        The merge operation:
        - Updates all relationships using sourceTypeId to use targetTypeId
        - Publishes events for each affected relationship
        - Returns count of migrated relationships
        - Fails if source is not deprecated (safety check)
      operationId: mergeRelationshipType
      tags:
      - Relationship Type Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MergeRelationshipTypeRequest'
      responses:
        '200':
          description: Merge completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MergeRelationshipTypeResponse'
        '404':
          description: Source or target relationship type not found
        '400':
          description: Source type must be deprecated before merging
        '409':
          description: Cannot merge into a deprecated type

  /relationship-type/seed:
    post:
      summary: Seed relationship types from configuration
      description: |
        Idempotent operation to seed relationship types from provided data.
        Creates types that don't exist, optionally updates existing types.
        Typically called at service startup with YAML-defined types.
      operationId: seedRelationshipTypes
      tags:
      - Relationship Type Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeedRelationshipTypesRequest'
      responses:
        '200':
          description: Seed operation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeedRelationshipTypesResponse'
        '400':
          description: Invalid seed data

components:
  schemas:
    # ============================================================
    # Relationship Instance Models
    # ============================================================

    # Request Models
    CreateRelationshipRequest:
      description: Request to create a new relationship between two entities
      type: object
      additionalProperties: false
      required:
      - entity1Id
      - entity1Type
      - entity2Id
      - entity2Type
      - relationshipTypeId
      - startedAt
      properties:
        entity1Id:
          type: string
          format: uuid
          description: ID of the first entity in the relationship
        entity1Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          description: Type of the first entity in the relationship
        entity2Id:
          type: string
          format: uuid
          description: ID of the second entity in the relationship
        entity2Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          description: Type of the second entity in the relationship
        relationshipTypeId:
          type: string
          format: uuid
          description: Relationship type ID defining the kind of relationship
        startedAt:
          type: string
          format: date-time
          description: In-game timestamp when relationship started
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Type-specific relationship data (JSON)

    GetRelationshipRequest:
      description: Request to retrieve a specific relationship by its ID
      type: object
      additionalProperties: false
      required:
      - relationshipId
      properties:
        relationshipId:
          type: string
          format: uuid
          description: ID of the relationship to retrieve

    ListRelationshipsByEntityRequest:
      description: Request to list all relationships for a specific entity with optional filters
      type: object
      additionalProperties: false
      required:
      - entityId
      - entityType
      properties:
        entityId:
          type: string
          format: uuid
          description: ID of the entity to get relationships for
        entityType:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          description: Type of the entity to get relationships for
        relationshipTypeId:
          type: string
          format: uuid
          nullable: true
          description: Optional filter by relationship type
        otherEntityType:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          nullable: true
          description: Optional filter by the other entity's type
        includeEnded:
          type: boolean
          default: false
          description: Include relationships that have ended
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number for paginated results (1-based)
        pageSize:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Number of results per page (max 100)

    GetRelationshipsBetweenRequest:
      description: Request to get all relationships between two specific entities
      type: object
      additionalProperties: false
      required:
      - entity1Id
      - entity1Type
      - entity2Id
      - entity2Type
      properties:
        entity1Id:
          type: string
          format: uuid
          description: ID of the first entity to check relationships for
        entity1Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          description: Type of the first entity
        entity2Id:
          type: string
          format: uuid
          description: ID of the second entity to check relationships for
        entity2Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          description: Type of the second entity
        relationshipTypeId:
          type: string
          format: uuid
          nullable: true
          description: Optional filter by relationship type
        includeEnded:
          type: boolean
          default: false
          description: Include relationships that have ended

    ListRelationshipsByTypeRequest:
      description: Request to list all relationships of a specific relationship type
      type: object
      additionalProperties: false
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: Relationship type to filter by
        entity1Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          nullable: true
          description: Optional filter by entity1 type
        entity2Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          nullable: true
          description: Optional filter by entity2 type
        includeEnded:
          type: boolean
          default: false
          description: Include relationships that have ended
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number for paginated results (1-based)
        pageSize:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Number of results per page (max 100)

    UpdateRelationshipRequest:
      description: Request to update the metadata or type of an existing relationship
      type: object
      additionalProperties: false
      required:
      - relationshipId
      properties:
        relationshipId:
          type: string
          format: uuid
          description: ID of the relationship to update
        relationshipTypeId:
          type: string
          format: uuid
          nullable: true
          description: Update relationship type (used for type merge migrations)
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Updated type-specific relationship data

    EndRelationshipRequest:
      description: Request to end an existing relationship with an optional timestamp and reason
      type: object
      additionalProperties: false
      required:
      - relationshipId
      properties:
        relationshipId:
          type: string
          format: uuid
          description: ID of the relationship to end
        endedAt:
          type: string
          format: date-time
          description: In-game timestamp when relationship ended (defaults to now)
        reason:
          type: string
          nullable: true
          maxLength: 500
          description: Optional reason for ending the relationship

    # Response Models
    RelationshipResponse:
      description: Complete details of a relationship between two entities
      type: object
      additionalProperties: false
      required:
      - relationshipId
      - entity1Id
      - entity1Type
      - entity2Id
      - entity2Type
      - relationshipTypeId
      - startedAt
      - createdAt
      properties:
        relationshipId:
          type: string
          format: uuid
          description: Unique identifier of the relationship
        entity1Id:
          type: string
          format: uuid
          description: ID of the first entity in the relationship
        entity1Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          description: Type of the first entity in the relationship
        entity2Id:
          type: string
          format: uuid
          description: ID of the second entity in the relationship
        entity2Type:
          $ref: 'common-api.yaml#/components/schemas/EntityType'
          description: Type of the second entity in the relationship
        relationshipTypeId:
          type: string
          format: uuid
          description: Relationship type ID defining the kind of relationship
        startedAt:
          type: string
          format: date-time
          description: In-game timestamp when relationship started
        endedAt:
          type: string
          format: date-time
          nullable: true
          description: In-game timestamp when relationship ended, null if still active
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Type-specific relationship data
        createdAt:
          type: string
          format: date-time
          description: System timestamp when the relationship record was created
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: System timestamp when the relationship record was last updated

    RelationshipListResponse:
      description: Paginated list of relationships with metadata for navigation
      type: object
      additionalProperties: false
      required:
      - relationships
      - totalCount
      - page
      - pageSize
      properties:
        relationships:
          type: array
          items:
            $ref: '#/components/schemas/RelationshipResponse'
          description: List of relationships matching the query
        totalCount:
          type: integer
          description: Total number of relationships matching the query
        page:
          type: integer
          description: Current page number (1-based)
        pageSize:
          type: integer
          description: Number of results per page
        hasNextPage:
          type: boolean
          description: Whether there are more results on the next page
        hasPreviousPage:
          type: boolean
          description: Whether there are results on the previous page

    # ============================================================
    # Relationship Type Models
    # ============================================================

    # Request Models
    GetRelationshipTypeRequest:
      description: Request to retrieve a relationship type by its unique identifier
      type: object
      additionalProperties: false
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: Unique identifier of the relationship type

    GetRelationshipTypeByCodeRequest:
      description: Request to retrieve a relationship type by its unique code string
      type: object
      additionalProperties: false
      required:
      - code
      properties:
        code:
          type: string
          minLength: 1
          maxLength: 50
          pattern: '^[A-Z][A-Z0-9_]*$'
          description: Unique code for the relationship type (e.g., "SON", "MOTHER", "FRIEND")

    ListRelationshipTypesRequest:
      description: Request to list relationship types with optional filtering by category, hierarchy, and deprecation status
      type: object
      additionalProperties: false
      properties:
        category:
          type: string
          nullable: true
          description: Filter by category (e.g., "FAMILY", "SOCIAL", "ECONOMIC") (null to include all)
        includeChildren:
          type: boolean
          default: true
          description: Whether to include child types in the response
        rootsOnly:
          type: boolean
          default: false
          description: Only return types with no parent (root types)
        includeDeprecated:
          type: boolean
          default: false
          description: Whether to include deprecated types in the response

    GetChildRelationshipTypesRequest:
      description: Request to retrieve all child relationship types for a given parent type
      type: object
      additionalProperties: false
      required:
      - parentTypeId
      properties:
        parentTypeId:
          type: string
          format: uuid
          description: ID of the parent relationship type
        recursive:
          type: boolean
          default: false
          description: Include all descendants, not just direct children

    MatchesHierarchyRequest:
      description: Request to check if a relationship type matches or descends from an ancestor type in the hierarchy
      type: object
      additionalProperties: false
      required:
      - typeId
      - ancestorTypeId
      properties:
        typeId:
          type: string
          format: uuid
          description: The relationship type to check
        ancestorTypeId:
          type: string
          format: uuid
          description: The potential ancestor type

    GetAncestorsRequest:
      description: Request to retrieve all ancestor types in the hierarchy chain from a relationship type up to the root
      type: object
      additionalProperties: false
      required:
      - typeId
      properties:
        typeId:
          type: string
          format: uuid
          description: The relationship type to get ancestors for

    CreateRelationshipTypeRequest:
      description: Request to create a new relationship type with code, name, and optional hierarchy and inverse settings
      type: object
      additionalProperties: false
      required:
      - code
      - name
      properties:
        code:
          type: string
          minLength: 1
          maxLength: 50
          pattern: '^[A-Z][A-Z0-9_]*$'
          description: Unique code for the relationship type (e.g., "SON", "MOTHER")
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Display name for the relationship type
        description:
          type: string
          maxLength: 500
          nullable: true
          description: Description of the relationship type (null if not provided)
        category:
          type: string
          maxLength: 50
          nullable: true
          description: Category for grouping (e.g., "FAMILY", "SOCIAL", "ECONOMIC") (null if not categorized)
        parentTypeId:
          type: string
          format: uuid
          nullable: true
          description: Parent type ID for hierarchy (null for root types)
        inverseTypeCode:
          type: string
          maxLength: 50
          nullable: true
          description: Code of the inverse relationship (e.g., "PARENT" for "CHILD")
        isBidirectional:
          type: boolean
          default: false
          description: Whether the relationship is the same in both directions (e.g., "SIBLING")
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional metadata for the relationship type

    UpdateRelationshipTypeRequest:
      description: Request to update an existing relationship type's properties such as name, description, category, or hierarchy
      type: object
      additionalProperties: false
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to update
        name:
          type: string
          minLength: 1
          maxLength: 100
          nullable: true
          description: Display name for the relationship type
        description:
          type: string
          maxLength: 500
          nullable: true
          description: Description of the relationship type
        category:
          type: string
          maxLength: 50
          nullable: true
          description: Category for grouping
        parentTypeId:
          type: string
          format: uuid
          nullable: true
          description: Parent type ID for hierarchy
        inverseTypeCode:
          type: string
          maxLength: 50
          nullable: true
          description: Code of the inverse relationship
        isBidirectional:
          type: boolean
          nullable: true
          description: Whether the relationship is bidirectional
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional metadata

    DeleteRelationshipTypeRequest:
      description: Request to permanently delete a relationship type (typically after deprecation and merge)
      type: object
      additionalProperties: false
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to delete

    DeprecateRelationshipTypeRequest:
      description: Request to deprecate a relationship type, preventing its use for new relationships while preserving existing ones
      type: object
      additionalProperties: false
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to deprecate
        reason:
          type: string
          maxLength: 500
          nullable: true
          description: Optional reason for deprecation (for audit purposes)

    UndeprecateRelationshipTypeRequest:
      description: Request to restore a deprecated relationship type back to active status
      type: object
      additionalProperties: false
      required:
      - relationshipTypeId
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: ID of the relationship type to restore

    MergeRelationshipTypeRequest:
      description: Request to migrate all relationships from a deprecated source type to a target type
      type: object
      additionalProperties: false
      required:
      - sourceTypeId
      - targetTypeId
      properties:
        sourceTypeId:
          type: string
          format: uuid
          description: ID of the deprecated type to merge from (must be deprecated)
        targetTypeId:
          type: string
          format: uuid
          description: ID of the type to merge into (can be VOID for effective deletion)
        deleteAfterMerge:
          type: boolean
          default: false
          description: If true, hard-delete the source type after successful merge

    SeedRelationshipTypesRequest:
      description: Request to bulk seed relationship types from configuration, typically used at startup
      type: object
      additionalProperties: false
      required:
      - types
      properties:
        types:
          type: array
          items:
            $ref: '#/components/schemas/SeedRelationshipType'
          description: List of relationship types to seed
        updateExisting:
          type: boolean
          default: false
          description: Whether to update types that already exist

    SeedRelationshipType:
      description: A relationship type definition used for seeding, with code-based parent and inverse references
      type: object
      additionalProperties: false
      required:
      - code
      - name
      properties:
        code:
          type: string
          description: Unique code for the relationship type
        name:
          type: string
          description: Display name for the relationship type
        description:
          type: string
          nullable: true
          description: Human-readable description of the relationship type (null if not provided)
        category:
          type: string
          nullable: true
          description: Category for grouping relationship types (null if not categorized)
        parentTypeCode:
          type: string
          nullable: true
          description: Code of the parent type (resolved during seeding) (null for root types)
        inverseTypeCode:
          type: string
          nullable: true
          description: Code of the inverse relationship (null if not applicable)
        isBidirectional:
          type: boolean
          default: false
          description: Whether the relationship is the same in both directions
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional custom metadata for the relationship type (null if none)

    # Response Models
    RelationshipTypeResponse:
      description: Complete representation of a relationship type including hierarchy, inverse, and deprecation information
      type: object
      additionalProperties: false
      required:
      - relationshipTypeId
      - code
      - name
      - isBidirectional
      - isDeprecated
      - depth
      - createdAt
      - updatedAt
      properties:
        relationshipTypeId:
          type: string
          format: uuid
          description: Unique identifier of the relationship type
        code:
          type: string
          description: Unique code for the relationship type (e.g., "SON", "MOTHER")
        name:
          type: string
          description: Human-readable display name for the relationship type
        description:
          type: string
          nullable: true
          description: Detailed description of the relationship type
        category:
          type: string
          nullable: true
          description: Category for grouping relationship types (e.g., "FAMILY", "SOCIAL")
        parentTypeId:
          type: string
          format: uuid
          nullable: true
          description: ID of the parent type in the hierarchy (null for root types)
        parentTypeCode:
          type: string
          nullable: true
          description: Code of the parent type (for convenience)
        inverseTypeId:
          type: string
          format: uuid
          nullable: true
          description: ID of the inverse relationship type (e.g., PARENT is inverse of CHILD)
        inverseTypeCode:
          type: string
          nullable: true
          description: Code of the inverse relationship type (for convenience)
        isBidirectional:
          type: boolean
          description: Whether the relationship is the same in both directions (e.g., SIBLING)
        isDeprecated:
          type: boolean
          description: Whether this type is deprecated and cannot be used for new relationships
        deprecatedAt:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when this type was deprecated
        deprecationReason:
          type: string
          nullable: true
          description: Optional reason for deprecation
        depth:
          type: integer
          description: Depth in the hierarchy (0 for root types)
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional custom metadata for the relationship type
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the relationship type was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the relationship type was last updated

    RelationshipTypeListResponse:
      description: Response containing a list of relationship types with total count
      type: object
      additionalProperties: false
      required:
      - types
      - totalCount
      properties:
        types:
          type: array
          items:
            $ref: '#/components/schemas/RelationshipTypeResponse'
          description: List of relationship types matching the query
        totalCount:
          type: integer
          description: Total number of relationship types returned

    MatchesHierarchyResponse:
      description: Response indicating whether a type matches an ancestor in the hierarchy and the depth between them
      type: object
      additionalProperties: false
      required:
      - matches
      properties:
        matches:
          type: boolean
          description: True if typeId equals or descends from ancestorTypeId
        depth:
          type: integer
          description: Number of levels between the types (0 if same, -1 if no match)

    SeedRelationshipTypesResponse:
      description: Response summarizing the results of a bulk seed operation with counts of created, updated, and skipped types
      type: object
      additionalProperties: false
      required:
      - created
      - updated
      - skipped
      - errors
      properties:
        created:
          type: integer
          description: Number of new types created
        updated:
          type: integer
          description: Number of existing types updated
        skipped:
          type: integer
          description: Number of types skipped (already exist, updateExisting=false)
        errors:
          type: array
          items:
            type: string
          description: List of error messages for types that failed to seed

    MergeRelationshipTypeResponse:
      description: Response summarizing the results of a merge operation including the number of relationships migrated and any failures
      type: object
      additionalProperties: false
      required:
      - sourceTypeId
      - targetTypeId
      - relationshipsMigrated
      - relationshipsFailed
      - sourceDeleted
      properties:
        sourceTypeId:
          type: string
          format: uuid
          description: ID of the deprecated type that was merged from
        targetTypeId:
          type: string
          format: uuid
          description: ID of the type that relationships were merged into
        relationshipsMigrated:
          type: integer
          description: Number of relationships successfully updated to use the target type
        relationshipsFailed:
          type: integer
          description: Number of relationships that failed to migrate
        sourceDeleted:
          type: boolean
          description: Whether the source type was hard-deleted after merge
        migrationErrors:
          type: array
          items:
            $ref: '#/components/schemas/MigrationError'
          description: Details of individual migration failures (limited to first 100)

    MigrationError:
      description: Details of a single relationship that failed to migrate
      type: object
      additionalProperties: false
      required:
      - relationshipId
      - error
      properties:
        relationshipId:
          type: string
          format: uuid
          description: ID of the relationship that failed to migrate
        error:
          type: string
          description: Error message explaining why the migration failed
