openapi: 3.0.0
info:
  title: Inventory Service Events
  version: 1.0.0
  description: |
    Event models for Inventory service pub/sub via MassTransit.
    Lifecycle events are auto-generated from x-lifecycle definition.

    **Topic Naming**: Uses kebab-case for multi-word entities (inventory-container, inventory-item).

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.

  x-event-subscriptions: []

  x-event-publications:
    # Container lifecycle (auto-generated from x-lifecycle)
    - topic: inventory-container.created
      event: InventoryContainerCreatedEvent
      description: Published when a container is created
    - topic: inventory-container.updated
      event: InventoryContainerUpdatedEvent
      description: Published when a container is updated
    - topic: inventory-container.deleted
      event: InventoryContainerDeletedEvent
      description: Published when a container is deleted

    # Item placement events
    - topic: inventory-item.placed
      event: InventoryItemPlacedEvent
      description: Published when an item is placed in a container
    - topic: inventory-item.removed
      event: InventoryItemRemovedEvent
      description: Published when an item is removed from a container
    - topic: inventory-item.moved
      event: InventoryItemMovedEvent
      description: Published when an item moves between slots or containers
    - topic: inventory-item.transferred
      event: InventoryItemTransferredEvent
      description: Published when item ownership transfers

    # Stack events
    - topic: inventory-item.stacked
      event: InventoryItemStackedEvent
      description: Published when items are stacked together
    - topic: inventory-item.split
      event: InventoryItemSplitEvent
      description: Published when a stack is split

    # Capacity events
    - topic: inventory-container.full
      event: InventoryContainerFullEvent
      description: Published when container reaches capacity

x-lifecycle:
  InventoryContainer:
    model:
      containerId: { type: string, format: uuid, primary: true, required: true, description: "Container unique identifier" }
      ownerId: { type: string, format: uuid, required: true, description: "Owner entity ID" }
      ownerType: { $ref: 'inventory-api.yaml#/components/schemas/ContainerOwnerType', required: true, description: "Owner type (character, account, location, etc.)" }
      containerType: { type: string, required: true, description: "Game-defined container type" }
      constraintModel: { $ref: 'inventory-api.yaml#/components/schemas/ContainerConstraintModel', required: true, description: "Container capacity constraint model" }
      isEquipmentSlot: { type: boolean, required: true, description: "Whether this is an equipment slot" }
      equipmentSlotName: { type: string, nullable: true, description: "Equipment slot name if isEquipmentSlot is true" }
      maxSlots: { type: integer, nullable: true, description: "Maximum slot count for slot-based constraints" }
      usedSlots: { type: integer, nullable: true, description: "Current number of used slots" }
      maxWeight: { type: number, format: double, nullable: true, description: "Maximum weight capacity" }
      gridWidth: { type: integer, nullable: true, description: "Grid width for grid-based containers" }
      gridHeight: { type: integer, nullable: true, description: "Grid height for grid-based containers" }
      maxVolume: { type: number, format: double, nullable: true, description: "Maximum volume for volumetric containers" }
      currentVolume: { type: number, format: double, nullable: true, description: "Current volume used" }
      parentContainerId: { type: string, format: uuid, nullable: true, description: "Parent container ID for nested containers" }
      nestingDepth: { type: integer, required: true, description: "Depth level in container hierarchy" }
      canContainContainers: { type: boolean, required: true, description: "Whether this container can hold other containers" }
      maxNestingDepth: { type: integer, nullable: true, description: "Maximum allowed nesting depth for child containers" }
      selfWeight: { type: number, format: double, required: true, description: "Weight of the empty container itself" }
      weightContribution: { $ref: 'inventory-api.yaml#/components/schemas/WeightContribution', required: true, description: "How container weight propagates to parent" }
      slotCost: { type: integer, required: true, description: "Number of slots this container uses in its parent" }
      parentGridWidth: { type: integer, nullable: true, description: "Width this container occupies in parent grid" }
      parentGridHeight: { type: integer, nullable: true, description: "Height this container occupies in parent grid" }
      parentVolume: { type: number, format: double, nullable: true, description: "Volume this container occupies in parent" }
      contentsWeight: { type: number, format: double, required: true, description: "Total weight of direct contents" }
      totalWeight: { type: number, format: double, required: true, description: "Total weight including self and contents" }
      allowedCategories: { type: array, items: { type: string }, nullable: true, description: "Item categories allowed in this container" }
      forbiddenCategories: { type: array, items: { type: string }, nullable: true, description: "Item categories forbidden from this container" }
      allowedTags: { type: array, items: { type: string }, nullable: true, description: "Required tags for items in this container" }
      tags: { type: array, items: { type: string }, nullable: true, description: "Container tags for categorization" }
      metadata: { type: object, nullable: true, description: "Game-specific container metadata" }
      realmId: { type: string, format: uuid, nullable: true, description: "Realm ID this container belongs to" }
      createdAt: { type: string, format: date-time, required: true, description: "When the container was created" }
      modifiedAt: { type: string, format: date-time, nullable: true, description: "When the container was last modified" }
    sensitive: []

components:
  schemas:
    # Non-lifecycle events

    InventoryItemPlacedEvent:
      type: object
      description: Event when an item is placed in a container
      additionalProperties: false
      required:
      - eventId
      - timestamp
      - instanceId
      - templateId
      - containerId
      - ownerId
      - ownerType
      - quantity
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        instanceId:
          type: string
          format: uuid
          description: Placed item instance ID
        templateId:
          type: string
          format: uuid
          description: Item template ID
        containerId:
          type: string
          format: uuid
          description: Container the item was placed in
        ownerId:
          type: string
          format: uuid
          description: Container owner ID
        ownerType:
          $ref: 'inventory-api.yaml#/components/schemas/ContainerOwnerType'
          description: Container owner type
        quantity:
          type: number
          format: double
          description: Quantity placed
        slotIndex:
          type: integer
          nullable: true
          description: Slot position if applicable
        slotX:
          type: integer
          nullable: true
          description: Grid X position if applicable
        slotY:
          type: integer
          nullable: true
          description: Grid Y position if applicable

    InventoryItemRemovedEvent:
      type: object
      description: Event when an item is removed from a container
      additionalProperties: false
      required:
      - eventId
      - timestamp
      - instanceId
      - templateId
      - containerId
      - ownerId
      - ownerType
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        instanceId:
          type: string
          format: uuid
          description: Removed item instance ID
        templateId:
          type: string
          format: uuid
          description: Item template ID
        containerId:
          type: string
          format: uuid
          description: Container the item was removed from
        ownerId:
          type: string
          format: uuid
          description: Container owner ID
        ownerType:
          $ref: 'inventory-api.yaml#/components/schemas/ContainerOwnerType'
          description: Container owner type
        reason:
          type: string
          nullable: true
          description: Reason for removal

    InventoryItemMovedEvent:
      type: object
      description: Event when an item moves between slots or containers
      additionalProperties: false
      required:
      - eventId
      - timestamp
      - instanceId
      - templateId
      - sourceContainerId
      - targetContainerId
      - quantity
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        instanceId:
          type: string
          format: uuid
          description: Moved item instance ID
        templateId:
          type: string
          format: uuid
          description: Item template ID
        sourceContainerId:
          type: string
          format: uuid
          description: Previous container ID
        targetContainerId:
          type: string
          format: uuid
          description: New container ID
        sourceContainerType:
          type: string
          nullable: true
          description: Previous container type
        targetContainerType:
          type: string
          nullable: true
          description: New container type
        quantity:
          type: number
          format: double
          description: Quantity moved
        previousSlotIndex:
          type: integer
          nullable: true
          description: Previous slot
        newSlotIndex:
          type: integer
          nullable: true
          description: New slot
        previousSlotX:
          type: integer
          nullable: true
          description: Previous grid X
        previousSlotY:
          type: integer
          nullable: true
          description: Previous grid Y
        newSlotX:
          type: integer
          nullable: true
          description: New grid X
        newSlotY:
          type: integer
          nullable: true
          description: New grid Y

    InventoryItemTransferredEvent:
      type: object
      description: Event when item ownership transfers
      additionalProperties: false
      required:
      - eventId
      - timestamp
      - instanceId
      - templateId
      - sourceContainerId
      - sourceOwnerId
      - sourceOwnerType
      - targetContainerId
      - targetOwnerId
      - targetOwnerType
      - quantityTransferred
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        instanceId:
          type: string
          format: uuid
          description: Transferred item instance ID
        templateId:
          type: string
          format: uuid
          description: Item template ID
        sourceContainerId:
          type: string
          format: uuid
          description: Previous container ID
        sourceOwnerId:
          type: string
          format: uuid
          description: Previous owner ID
        sourceOwnerType:
          $ref: 'inventory-api.yaml#/components/schemas/ContainerOwnerType'
          description: Previous owner type
        targetContainerId:
          type: string
          format: uuid
          description: New container ID
        targetOwnerId:
          type: string
          format: uuid
          description: New owner ID
        targetOwnerType:
          $ref: 'inventory-api.yaml#/components/schemas/ContainerOwnerType'
          description: New owner type
        quantityTransferred:
          type: number
          format: double
          description: Quantity transferred

    InventoryItemStackedEvent:
      type: object
      description: Event when items are stacked together
      additionalProperties: false
      required:
      - eventId
      - timestamp
      - sourceInstanceId
      - targetInstanceId
      - templateId
      - containerId
      - quantityAdded
      - newTotalQuantity
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        sourceInstanceId:
          type: string
          format: uuid
          description: Source stack that was merged (destroyed)
        targetInstanceId:
          type: string
          format: uuid
          description: Target stack that received items
        templateId:
          type: string
          format: uuid
          description: Item template ID
        containerId:
          type: string
          format: uuid
          description: Container where merge occurred
        quantityAdded:
          type: number
          format: double
          description: Quantity added to target
        newTotalQuantity:
          type: number
          format: double
          description: New total in target stack

    InventoryItemSplitEvent:
      type: object
      description: Event when a stack is split
      additionalProperties: false
      required:
      - eventId
      - timestamp
      - originalInstanceId
      - newInstanceId
      - templateId
      - containerId
      - quantitySplit
      - originalRemaining
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        originalInstanceId:
          type: string
          format: uuid
          description: Original stack ID
        newInstanceId:
          type: string
          format: uuid
          description: New stack ID created
        templateId:
          type: string
          format: uuid
          description: Item template ID
        containerId:
          type: string
          format: uuid
          description: Container where split occurred
        quantitySplit:
          type: number
          format: double
          description: Quantity moved to new stack
        originalRemaining:
          type: number
          format: double
          description: Quantity remaining in original

    InventoryContainerFullEvent:
      type: object
      description: Event when container reaches capacity
      additionalProperties: false
      required:
      - eventId
      - timestamp
      - containerId
      - ownerId
      - ownerType
      - containerType
      - constraintType
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        containerId:
          type: string
          format: uuid
          description: Full container ID
        ownerId:
          type: string
          format: uuid
          description: Container owner ID
        ownerType:
          $ref: 'inventory-api.yaml#/components/schemas/ContainerOwnerType'
          description: Container owner type
        containerType:
          type: string
          description: Container type
        constraintType:
          $ref: 'inventory-api.yaml#/components/schemas/ConstraintLimitType'
          description: Which constraint was reached (slots, weight, volume)
