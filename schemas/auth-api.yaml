openapi: 3.0.0
info:
  title: Bannou Auth Service API
  description: |
    Authentication and session management service (Internet-facing).

    **POST-Only API Pattern**: This API uses POST for all WebSocket-routable operations.
    Path parameters are passed in request bodies instead of URLs.

    **Exceptions**: OAuth endpoints (`/auth/oauth/*`) retain path parameters because they
    are browser-facing redirect flows, not WebSocket-routed. The browser navigates to
    these URLs directly for OAuth provider authentication.

    See docs/BANNOU_DESIGN.md for architectural rationale.
  version: 4.0.0
  # NOTE: Event subscriptions and publications are in auth-events.yaml
servers:
- url: http://localhost:5012
  description: Bannou service endpoint

paths:
  /auth/login:
    post:
      summary: Login with email/password
      operationId: login
      tags:
      - Authentication
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
        '429':
          description: Too many login attempts

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/LoginRequest\"\
        ,\n  \"$defs\": {\n    \"LoginRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"email\"\
        ,\n        \"password\"\n      ],\n      \"properties\": {\n        \"email\": {\n          \"type\": \"string\",\n\
        \          \"format\": \"email\"\n        },\n        \"password\": {\n          \"type\": \"string\",\n         \
        \ \"format\": \"password\"\n        },\n        \"rememberMe\": {\n          \"type\": \"boolean\",\n          \"\
        default\": false\n        },\n        \"deviceInfo\": {\n          \"$ref\": \"#/$defs/DeviceInfo\"\n        }\n \
        \     }\n    },\n    \"DeviceInfo\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"deviceType\"\
        : {\n          \"type\": \"string\",\n          \"enum\": [\n            \"desktop\",\n            \"mobile\",\n \
        \           \"tablet\",\n            \"console\"\n          ]\n        },\n        \"platform\": {\n          \"type\"\
        : \"string\"\n        },\n        \"browser\": {\n          \"type\": \"string\",\n          \"nullable\": true\n\
        \        },\n        \"appVersion\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        }\n\
        \      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AuthResponse\"\
        ,\n  \"$defs\": {\n    \"AuthResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"accountId\"\
        ,\n        \"accessToken\",\n        \"refreshToken\",\n        \"expiresIn\",\n        \"connectUrl\"\n      ],\n\
        \      \"properties\": {\n        \"accountId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\
        \n        },\n        \"accessToken\": {\n          \"type\": \"string\"\n        },\n        \"refreshToken\": {\n\
        \          \"type\": \"string\"\n        },\n        \"expiresIn\": {\n          \"type\": \"integer\",\n        \
        \  \"description\": \"Seconds until access token expires\"\n        },\n        \"connectUrl\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uri\",\n          \"description\": \"WebSocket endpoint for Connect service\"\
        \n        },\n        \"roles\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\":
        \"string\"\n          }\n        },\n        \"requiresTwoFactor\": {\n          \"type\": \"boolean\",\n        \
        \  \"default\": false\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Login with email/password\",\n  \"description\": \"\",\n  \"tags\": [\n \
        \   \"Authentication\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"login\"\n}"
  /auth/register:
    post:
      summary: Register new user account
      operationId: register
      tags:
      - Authentication
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '200':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          description: Invalid request data
        '409':
          description: Username already exists

  # OAuth endpoints use path parameters because they are browser-facing redirect flows.
  # These are NOT routed through WebSocket and are accessed directly via browser navigation.
      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RegisterRequest\"\
        ,\n  \"$defs\": {\n    \"RegisterRequest\": {\n      \"type\": \"object\",\n      \"description\": \"Request to register
        a new user account\",\n      \"required\": [\n        \"username\",\n        \"password\"\n      ],\n      \"properties\"\
        : {\n        \"username\": {\n          \"type\": \"string\",\n          \"description\": \"Unique username for the
        account\",\n          \"minLength\": 3,\n          \"maxLength\": 32,\n          \"pattern\": \"^[a-zA-Z0-9_]+$\"\
        ,\n          \"example\": \"gameuser123\"\n        },\n        \"password\": {\n          \"type\": \"string\",\n\
        \          \"description\": \"Password for the account (will be hashed)\",\n          \"minLength\": 8,\n        \
        \  \"format\": \"password\",\n          \"example\": \"SecurePassword123!\"\n        },\n        \"email\": {\n  \
        \        \"type\": \"string\",\n          \"format\": \"email\",\n          \"description\": \"Optional email for
        account recovery\",\n          \"example\": \"user@example.com\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RegisterResponse\"\
        ,\n  \"$defs\": {\n    \"RegisterResponse\": {\n      \"type\": \"object\",\n      \"description\": \"Response from
        successful user registration\",\n      \"required\": [\n        \"accessToken\",\n        \"connectUrl\"\n      ],\n\
        \      \"properties\": {\n        \"accessToken\": {\n          \"type\": \"string\",\n          \"description\":
        \"JWT access token for immediate authentication\",\n          \"example\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJnYW1ldXNlcjEyMyIsImlhdCI6MTY0MDk5NTIwMCwiZXhwIjoxNjQwOTk4ODAwfQ.signature\"\
        \n        },\n        \"refreshToken\": {\n          \"type\": \"string\",\n          \"description\": \"Refresh token
        for obtaining new access tokens\",\n          \"nullable\": true,\n          \"example\": \"refresh_token_abc123xyz789\"\
        \n        },\n        \"connectUrl\": {\n          \"type\": \"string\",\n          \"format\": \"uri\",\n       \
        \   \"description\": \"WebSocket endpoint for Connect service\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Register new user account\",\n  \"description\": \"\",\n  \"tags\": [\n \
        \   \"Authentication\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"register\"\n}"
  /auth/oauth/{provider}/init:
    get:
      summary: Initialize OAuth2 flow (browser redirect)
      description: |
        Browser-facing endpoint for initiating OAuth flows. The user's browser navigates
        to this URL directly, which then redirects to the OAuth provider.

        **Note**: This endpoint uses GET with path parameters because it's a browser
        redirect flow, not a WebSocket-routed API call.
      operationId: initOAuth
      tags:
      - OAuth
      x-permissions:
      - role: anonymous
        states: {}
      parameters:
      - name: provider
        in: path
        required: true
        schema:
          $ref: '#/components/schemas/Provider'
      - name: redirectUri
        in: query
        required: true
        schema:
          type: string
          format: uri
      - name: state
        in: query
        schema:
          type: string
      responses:
        '302':
          description: Redirect to OAuth provider
      x-manual-implementation: true  # Returns 302 redirect, not JSON - requires manual controller

      x-request-schema-json: '{}'
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n  \"summary\": \"Initialize OAuth2 flow (browser redirect)\",\n  \"description\": \"Browser-facing
        endpoint for initiating OAuth flows. The user's browser navigates\\nto this URL directly, which then redirects to
        the OAuth provider.\\n\\n**Note**: This endpoint uses GET with path parameters because it's a browser\\nredirect flow,
        not a WebSocket-routed API call.\\n\",\n  \"tags\": [\n    \"OAuth\"\n  ],\n  \"deprecated\": false,\n  \"operationId\"\
        : \"initOAuth\"\n}"
  /auth/oauth/{provider}/callback:
    post:
      summary: Complete OAuth2 flow (browser redirect callback)
      description: |
        Browser-facing callback endpoint for OAuth providers. The OAuth provider redirects
        the user's browser back to this URL after authentication.

        **Note**: This endpoint uses path parameters because the callback URL is registered
        with OAuth providers and cannot be changed without updating provider configurations.
      operationId: completeOAuth
      tags:
      - OAuth
      x-permissions:
      - role: anonymous
        states: {}
      parameters:
      - name: provider
        in: path
        required: true
        schema:
          $ref: '#/components/schemas/Provider'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OAuthCallbackRequest'
      responses:
        '200':
          description: OAuth authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/OAuthCallbackRequest\"\
        ,\n  \"$defs\": {\n    \"OAuthCallbackRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        code\"\n      ],\n      \"properties\": {\n        \"code\": {\n          \"type\": \"string\"\n        },\n     \
        \   \"state\": {\n          \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"deviceInfo\"\
        : {\n          \"$ref\": \"#/$defs/DeviceInfo\"\n        }\n      }\n    },\n    \"DeviceInfo\": {\n      \"type\"\
        : \"object\",\n      \"properties\": {\n        \"deviceType\": {\n          \"type\": \"string\",\n          \"enum\"\
        : [\n            \"desktop\",\n            \"mobile\",\n            \"tablet\",\n            \"console\"\n       \
        \   ]\n        },\n        \"platform\": {\n          \"type\": \"string\"\n        },\n        \"browser\": {\n \
        \         \"type\": \"string\",\n          \"nullable\": true\n        },\n        \"appVersion\": {\n          \"\
        type\": \"string\",\n          \"nullable\": true\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AuthResponse\"\
        ,\n  \"$defs\": {\n    \"AuthResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"accountId\"\
        ,\n        \"accessToken\",\n        \"refreshToken\",\n        \"expiresIn\",\n        \"connectUrl\"\n      ],\n\
        \      \"properties\": {\n        \"accountId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\
        \n        },\n        \"accessToken\": {\n          \"type\": \"string\"\n        },\n        \"refreshToken\": {\n\
        \          \"type\": \"string\"\n        },\n        \"expiresIn\": {\n          \"type\": \"integer\",\n        \
        \  \"description\": \"Seconds until access token expires\"\n        },\n        \"connectUrl\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uri\",\n          \"description\": \"WebSocket endpoint for Connect service\"\
        \n        },\n        \"roles\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\":
        \"string\"\n          }\n        },\n        \"requiresTwoFactor\": {\n          \"type\": \"boolean\",\n        \
        \  \"default\": false\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Complete OAuth2 flow (browser redirect callback)\",\n  \"description\": \"\
        Browser-facing callback endpoint for OAuth providers. The OAuth provider redirects\\nthe user's browser back to this
        URL after authentication.\\n\\n**Note**: This endpoint uses path parameters because the callback URL is registered\\
        nwith OAuth providers and cannot be changed without updating provider configurations.\\n\",\n  \"tags\": [\n    \"\
        OAuth\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"completeOAuth\"\n}"
  /auth/steam/verify:
    post:
      summary: Verify Steam Session Ticket
      description: |
        Validates a Steam Session Ticket obtained from the game client via ISteamUser::GetAuthTicketForWebApi().
        The server validates the ticket with Steam's Web API and retrieves the SteamID from Steam's response.
        NEVER trust client-provided SteamID - it must come from Steam's authenticated response.
      operationId: verifySteamAuth
      tags:
      - Steam
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SteamVerifyRequest'
      responses:
        '200':
          description: Steam authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid or expired Steam ticket
        '500':
          description: Steam API unavailable or internal error

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/SteamVerifyRequest\"\
        ,\n  \"$defs\": {\n    \"SteamVerifyRequest\": {\n      \"type\": \"object\",\n      \"description\": \"Request to
        verify a Steam Session Ticket. The ticket is obtained client-side via\\nISteamUser::GetAuthTicketForWebApi(\\\"bannou\\\
        \"). SteamID is NOT included because\\nit must be obtained from Steam's Web API response (never trust client-provided
        SteamID).\\n\",\n      \"required\": [\n        \"ticket\"\n      ],\n      \"properties\": {\n        \"ticket\"\
        : {\n          \"type\": \"string\",\n          \"description\": \"Hex-encoded Steam Session Ticket from ISteamUser::GetAuthTicketForWebApi().\\
        nClient converts ticket bytes to hex string: BitConverter.ToString(ticketData).Replace(\\\"-\\\", \\\"\\\")\\n\",\n\
        \          \"example\": \"140000006A7B3C8E...\"\n        },\n        \"deviceInfo\": {\n          \"$ref\": \"#/$defs/DeviceInfo\"\
        \n        }\n      }\n    },\n    \"DeviceInfo\": {\n      \"type\": \"object\",\n      \"properties\": {\n      \
        \  \"deviceType\": {\n          \"type\": \"string\",\n          \"enum\": [\n            \"desktop\",\n         \
        \   \"mobile\",\n            \"tablet\",\n            \"console\"\n          ]\n        },\n        \"platform\":
        {\n          \"type\": \"string\"\n        },\n        \"browser\": {\n          \"type\": \"string\",\n         \
        \ \"nullable\": true\n        },\n        \"appVersion\": {\n          \"type\": \"string\",\n          \"nullable\"\
        : true\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AuthResponse\"\
        ,\n  \"$defs\": {\n    \"AuthResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"accountId\"\
        ,\n        \"accessToken\",\n        \"refreshToken\",\n        \"expiresIn\",\n        \"connectUrl\"\n      ],\n\
        \      \"properties\": {\n        \"accountId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\
        \n        },\n        \"accessToken\": {\n          \"type\": \"string\"\n        },\n        \"refreshToken\": {\n\
        \          \"type\": \"string\"\n        },\n        \"expiresIn\": {\n          \"type\": \"integer\",\n        \
        \  \"description\": \"Seconds until access token expires\"\n        },\n        \"connectUrl\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uri\",\n          \"description\": \"WebSocket endpoint for Connect service\"\
        \n        },\n        \"roles\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\":
        \"string\"\n          }\n        },\n        \"requiresTwoFactor\": {\n          \"type\": \"boolean\",\n        \
        \  \"default\": false\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Verify Steam Session Ticket\",\n  \"description\": \"Validates a Steam Session
        Ticket obtained from the game client via ISteamUser::GetAuthTicketForWebApi().\\nThe server validates the ticket with
        Steam's Web API and retrieves the SteamID from Steam's response.\\nNEVER trust client-provided SteamID - it must come
        from Steam's authenticated response.\\n\",\n  \"tags\": [\n    \"Steam\"\n  ],\n  \"deprecated\": false,\n  \"operationId\"\
        : \"verifySteamAuth\"\n}"
  /auth/refresh:
    post:
      summary: Refresh access token
      operationId: refreshToken
      tags:
      - Tokens
      x-permissions:
      - role: user
        states: {}
      parameters:
      - name: jwt
        in: header
        required: true
        schema:
          type: string
        description: Current JWT access token for refresh
        x-from-authorization: bearer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/RefreshRequest\"\
        ,\n  \"$defs\": {\n    \"RefreshRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"refreshToken\"\
        \n      ],\n      \"properties\": {\n        \"refreshToken\": {\n          \"type\": \"string\"\n        }\n    \
        \  }\n    }\n  }\n}"
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/AuthResponse\"\
        ,\n  \"$defs\": {\n    \"AuthResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"accountId\"\
        ,\n        \"accessToken\",\n        \"refreshToken\",\n        \"expiresIn\",\n        \"connectUrl\"\n      ],\n\
        \      \"properties\": {\n        \"accountId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\"\
        \n        },\n        \"accessToken\": {\n          \"type\": \"string\"\n        },\n        \"refreshToken\": {\n\
        \          \"type\": \"string\"\n        },\n        \"expiresIn\": {\n          \"type\": \"integer\",\n        \
        \  \"description\": \"Seconds until access token expires\"\n        },\n        \"connectUrl\": {\n          \"type\"\
        : \"string\",\n          \"format\": \"uri\",\n          \"description\": \"WebSocket endpoint for Connect service\"\
        \n        },\n        \"roles\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\":
        \"string\"\n          }\n        },\n        \"requiresTwoFactor\": {\n          \"type\": \"boolean\",\n        \
        \  \"default\": false\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Refresh access token\",\n  \"description\": \"\",\n  \"tags\": [\n    \"\
        Tokens\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"refreshToken\"\n}"
  /auth/validate:
    post:
      summary: Validate access token
      operationId: validateToken
      tags:
      - Tokens
      x-permissions:
      - role: user
        states: {}
      parameters:
      - name: jwt
        in: header
        required: true
        schema:
          type: string
        description: JWT access token for validation
        x-from-authorization: bearer
      responses:
        '200':
          description: Token is valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateTokenResponse'
        '401':
          description: Invalid or missing token
        '403':
          description: Token expired or malformed

      x-request-schema-json: '{}'
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/ValidateTokenResponse\"\
        ,\n  \"$defs\": {\n    \"ValidateTokenResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        valid\",\n        \"accountId\",\n        \"sessionId\"\n      ],\n      \"properties\": {\n        \"valid\": {\n\
        \          \"type\": \"boolean\"\n        },\n        \"accountId\": {\n          \"type\": \"string\",\n        \
        \  \"format\": \"uuid\"\n        },\n        \"sessionId\": {\n          \"type\": \"string\",\n          \"description\"\
        : \"Session identifier for WebSocket connections and service routing\"\n        },\n        \"roles\": {\n       \
        \   \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n    \
        \    \"authorizations\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\
        \n          },\n          \"description\": \"Authorization strings from active subscriptions.\\nFormat: \\\"{stubName}:{state}\\\
        \" (e.g., \\\"arcadia:authorized\\\")\\n\"\n        },\n        \"remainingTime\": {\n          \"type\": \"integer\"\
        ,\n          \"description\": \"Seconds until expiration\"\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Validate access token\",\n  \"description\": \"\",\n  \"tags\": [\n    \"\
        Tokens\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"validateToken\"\n}"
  /auth/logout:
    post:
      summary: Logout and invalidate tokens
      operationId: logout
      tags:
      - Authentication
      x-permissions:
      - role: user
        states: {}
      parameters:
      - name: jwt
        in: header
        required: true
        schema:
          type: string
        description: JWT access token for session identification
        x-from-authorization: bearer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '200':
          description: Logged out successfully

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/LogoutRequest\"\
        ,\n  \"$defs\": {\n    \"LogoutRequest\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"allSessions\"\
        : {\n          \"type\": \"boolean\",\n          \"default\": false,\n          \"description\": \"Logout from all
        sessions/devices\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n  \"summary\": \"Logout and invalidate tokens\",\n  \"description\": \"\",\n  \"tags\": [\n\
        \    \"Authentication\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"logout\"\n}"
  /auth/sessions/list:
    post:
      summary: Get active sessions for account
      operationId: getSessions
      tags:
      - Sessions
      x-permissions:
      - role: user
        states: {}
      parameters:
      - name: jwt
        in: header
        required: true
        schema:
          type: string
        description: JWT access token for session identification
        x-from-authorization: bearer
      responses:
        '200':
          description: Active sessions retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionsResponse'

      x-request-schema-json: '{}'
      x-response-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/SessionsResponse\"\
        ,\n  \"$defs\": {\n    \"SessionsResponse\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"sessions\"\
        \n      ],\n      \"properties\": {\n        \"sessions\": {\n          \"type\": \"array\",\n          \"items\"\
        : {\n            \"$ref\": \"#/$defs/SessionInfo\"\n          }\n        }\n      }\n    },\n    \"SessionInfo\":
        {\n      \"type\": \"object\",\n      \"required\": [\n        \"sessionId\",\n        \"createdAt\",\n        \"\
        lastActive\"\n      ],\n      \"properties\": {\n        \"sessionId\": {\n          \"type\": \"string\"\n      \
        \  },\n        \"deviceInfo\": {\n          \"$ref\": \"#/$defs/DeviceInfo\"\n        },\n        \"createdAt\": {\n\
        \          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n        \"lastActive\": {\n   \
        \       \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n        \"ipAddress\": {\n       \
        \   \"type\": \"string\"\n        },\n        \"location\": {\n          \"type\": \"string\",\n          \"nullable\"\
        : true\n        }\n      }\n    },\n    \"DeviceInfo\": {\n      \"type\": \"object\",\n      \"properties\": {\n\
        \        \"deviceType\": {\n          \"type\": \"string\",\n          \"enum\": [\n            \"desktop\",\n   \
        \         \"mobile\",\n            \"tablet\",\n            \"console\"\n          ]\n        },\n        \"platform\"\
        : {\n          \"type\": \"string\"\n        },\n        \"browser\": {\n          \"type\": \"string\",\n       \
        \   \"nullable\": true\n        },\n        \"appVersion\": {\n          \"type\": \"string\",\n          \"nullable\"\
        : true\n        }\n      }\n    }\n  }\n}"
      x-endpoint-info-json: "{\n  \"summary\": \"Get active sessions for account\",\n  \"description\": \"\",\n  \"tags\"\
        : [\n    \"Sessions\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"getSessions\"\n}"
  /auth/sessions/terminate:
    post:
      summary: Terminate specific session
      operationId: terminateSession
      tags:
      - Sessions
      x-permissions:
      - role: user
        states: {}
      parameters:
      - name: jwt
        in: header
        required: true
        schema:
          type: string
        description: JWT access token for session identification
        x-from-authorization: bearer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TerminateSessionRequest'
      responses:
        '204':
          description: Session terminated
        '404':
          description: Session not found

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/TerminateSessionRequest\"\
        ,\n  \"$defs\": {\n    \"TerminateSessionRequest\": {\n      \"type\": \"object\",\n      \"description\": \"Request
        to terminate a specific session\",\n      \"required\": [\n        \"sessionId\"\n      ],\n      \"properties\":
        {\n        \"sessionId\": {\n          \"type\": \"string\",\n          \"format\": \"uuid\",\n          \"description\"\
        : \"ID of the session to terminate\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n  \"summary\": \"Terminate specific session\",\n  \"description\": \"\",\n  \"tags\": [\n\
        \    \"Sessions\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"terminateSession\"\n}"
  /auth/password/reset:
    post:
      summary: Request password reset
      operationId: requestPasswordReset
      tags:
      - Password
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetRequest'
      responses:
        '200':
          description: Reset email sent if account exists

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/PasswordResetRequest\"\
        ,\n  \"$defs\": {\n    \"PasswordResetRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"\
        email\"\n      ],\n      \"properties\": {\n        \"email\": {\n          \"type\": \"string\",\n          \"format\"\
        : \"email\"\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n  \"summary\": \"Request password reset\",\n  \"description\": \"\",\n  \"tags\": [\n    \"\
        Password\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"requestPasswordReset\"\n}"
  /auth/password/confirm:
    post:
      summary: Confirm password reset with token
      operationId: confirmPasswordReset
      tags:
      - Password
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetConfirmRequest'
      responses:
        '200':
          description: Password reset successfully

      x-request-schema-json: "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$ref\": \"#/$defs/PasswordResetConfirmRequest\"\
        ,\n  \"$defs\": {\n    \"PasswordResetConfirmRequest\": {\n      \"type\": \"object\",\n      \"required\": [\n  \
        \      \"token\",\n        \"newPassword\"\n      ],\n      \"properties\": {\n        \"token\": {\n          \"\
        type\": \"string\"\n        },\n        \"newPassword\": {\n          \"type\": \"string\",\n          \"format\"\
        : \"password\",\n          \"minLength\": 8\n        }\n      }\n    }\n  }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n  \"summary\": \"Confirm password reset with token\",\n  \"description\": \"\",\n  \"tags\"\
        : [\n    \"Password\"\n  ],\n  \"deprecated\": false,\n  \"operationId\": \"confirmPasswordReset\"\n}"
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Provider:
      type: string
      enum: [google, discord, twitch]
      description: OAuth provider type

    InitOAuthResponse:
      type: object
      description: Response containing the OAuth authorization URL for redirect
      required:
      - authorizationUrl
      properties:
        authorizationUrl:
          type: string
          format: uri
          description: The OAuth provider authorization URL to redirect the user to

    # Request Models for POST-only pattern
    TerminateSessionRequest:
      type: object
      description: Request to terminate a specific session
      required:
      - sessionId
      properties:
        sessionId:
          type: string
          format: uuid
          description: ID of the session to terminate

    LoginRequest:
      type: object
      required:
      - email
      - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        rememberMe:
          type: boolean
          default: false
        deviceInfo:
          $ref: '#/components/schemas/DeviceInfo'

    RegisterRequest:
      type: object
      description: Request to register a new user account
      required:
      - username
      - password
      properties:
        username:
          type: string
          description: Unique username for the account
          minLength: 3
          maxLength: 32
          pattern: '^[a-zA-Z0-9_]+$'
          example: "gameuser123"
        password:
          type: string
          description: Password for the account (will be hashed)
          minLength: 8
          format: password
          example: "SecurePassword123!"
        email:
          type: string
          format: email
          description: Optional email for account recovery
          example: "user@example.com"

    RegisterResponse:
      type: object
      description: Response from successful user registration
      required:
      - accessToken
      - connectUrl
      properties:
        accessToken:
          type: string
          description: JWT access token for immediate authentication
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJnYW1ldXNlcjEyMyIsImlhdCI6MTY0MDk5NTIwMCwiZXhwIjoxNjQwOTk4ODAwfQ.signature"
        refreshToken:
          type: string
          description: Refresh token for obtaining new access tokens
          nullable: true
          example: "refresh_token_abc123xyz789"
        connectUrl:
          type: string
          format: uri
          description: WebSocket endpoint for Connect service

    LoginResponse:
      type: object
      description: Response from successful user login
      required:
      - accessToken
      properties:
        accessToken:
          type: string
          description: JWT access token for authentication
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJnYW1ldXNlcjEyMyIsImlhdCI6MTY0MDk5NTIwMCwiZXhwIjoxNjQwOTk4ODAwfQ.signature"
        refreshToken:
          type: string
          description: Refresh token for obtaining new access tokens
          nullable: true
          example: "refresh_token_def456uvw012"

    AuthResponse:
      type: object
      required:
      - accountId
      - accessToken
      - refreshToken
      - expiresIn
      - connectUrl
      properties:
        accountId:
          type: string
          format: uuid
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresIn:
          type: integer
          description: Seconds until access token expires
        connectUrl:
          type: string
          format: uri
          description: WebSocket endpoint for Connect service
        roles:
          type: array
          items:
            type: string
        requiresTwoFactor:
          type: boolean
          default: false

    OAuthCallbackRequest:
      type: object
      required:
      - code
      properties:
        code:
          type: string
        state:
          type: string
          nullable: true
        deviceInfo:
          $ref: '#/components/schemas/DeviceInfo'

    SteamVerifyRequest:
      type: object
      description: |
        Request to verify a Steam Session Ticket. The ticket is obtained client-side via
        ISteamUser::GetAuthTicketForWebApi("bannou"). SteamID is NOT included because
        it must be obtained from Steam's Web API response (never trust client-provided SteamID).
      required:
      - ticket
      properties:
        ticket:
          type: string
          description: |
            Hex-encoded Steam Session Ticket from ISteamUser::GetAuthTicketForWebApi().
            Client converts ticket bytes to hex string: BitConverter.ToString(ticketData).Replace("-", "")
          example: "140000006A7B3C8E..."
        deviceInfo:
          $ref: '#/components/schemas/DeviceInfo'

    RefreshRequest:
      type: object
      required:
      - refreshToken
      properties:
        refreshToken:
          type: string

    ValidateTokenResponse:
      type: object
      required:
      - valid
      - accountId
      - sessionId
      properties:
        valid:
          type: boolean
        accountId:
          type: string
          format: uuid
        sessionId:
          type: string
          description: Session identifier for WebSocket connections and service routing
        roles:
          type: array
          items:
            type: string
        authorizations:
          type: array
          items:
            type: string
          description: |
            Authorization strings from active subscriptions.
            Format: "{stubName}:{state}" (e.g., "arcadia:authorized")
        remainingTime:
          type: integer
          description: Seconds until expiration

    LogoutRequest:
      type: object
      properties:
        allSessions:
          type: boolean
          default: false
          description: Logout from all sessions/devices

    SessionsResponse:
      type: object
      required:
      - sessions
      properties:
        sessions:
          type: array
          items:
            $ref: '#/components/schemas/SessionInfo'

    SessionInfo:
      type: object
      required:
      - sessionId
      - createdAt
      - lastActive
      properties:
        sessionId:
          type: string
        deviceInfo:
          $ref: '#/components/schemas/DeviceInfo'
        createdAt:
          type: string
          format: date-time
        lastActive:
          type: string
          format: date-time
        ipAddress:
          type: string
        location:
          type: string
          nullable: true

    DeviceInfo:
      type: object
      properties:
        deviceType:
          type: string
          enum: [desktop, mobile, tablet, console]
        platform:
          type: string
        browser:
          type: string
          nullable: true
        appVersion:
          type: string
          nullable: true

    PasswordResetRequest:
      type: object
      required:
      - email
      properties:
        email:
          type: string
          format: email

    PasswordResetConfirmRequest:
      type: object
      required:
      - token
      - newPassword
      properties:
        token:
          type: string
        newPassword:
          type: string
          format: password
          minLength: 8

    OAuthProvidersResponse:
      type: object
      description: List of available OAuth providers
      required:
      - providers
      properties:
        providers:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "steam"
              displayName:
                type: string
                example: "Steam"
              authUrl:
                type: string
                format: uri
                example: "https://steamcommunity.com/openid/login"

    RoutingPreferenceResponse:
      type: object
      description: Response from routing preference update
      properties:
        success:
          type: boolean
          description: Whether the routing preference was updated successfully
          example: true
        preferredInstance:
          type: string
          description: The preferred Connect service instance ID
          example: "connect-omega-01"

    # NOTE: Event models (SessionInvalidatedEvent, SessionUpdatedEvent) are defined in auth-events.yaml
    # and generated separately. They are NOT part of the HTTP API.

