openapi: 3.0.3
info:
  title: Orchestrator API
  version: 3.0.0
  description: |
    **Central intelligence for Bannou environment management and service orchestration.**

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    The orchestrator service provides comprehensive environment lifecycle management:
    - **Environment Provisioning**: Deploy complete environments via API (replaces Makefile/docker-compose)
    - **Dynamic Service Topology**: Reconfigure which services run on which containers at runtime
    - **Multi-Backend Support**: Docker Compose, Docker Swarm, Portainer, and Kubernetes
    - **Infrastructure Health**: Monitor Redis, RabbitMQ, and custom services
    - **Smart Service Management**: Restart, scale, and configure services based on health metrics
    - **Deployment Presets**: Testing is configured via deployment presets (e.g., http-tests, edge-tests)

    **Backend Priority** (automatic detection):
    1. Kubernetes (most enterprise)
    2. Portainer (API abstraction over Compose/Swarm)
    3. Docker Swarm (cluster orchestration)
    4. Docker Compose (single-host containers)

    **Architecture**: The orchestrator uses DIRECT connections to Redis, RabbitMQ,
    and container APIs for its own infrastructure monitoring. It ALSO runs as a plugin within
    bannou so other services can call its APIs via mesh
    service invocation through lib-mesh.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before modifying this schema. Optional reference types require `nullable: true`.

servers:
- url: http://localhost:5012
  description: Service endpoint for service-to-service invocation (orchestrator runs as plugin within bannou)

paths:
  /orchestrator/health/infrastructure:
    post:
      summary: Check infrastructure component health
      description: |
        Validates connectivity and health of core infrastructure components:
        - Redis (direct connection via StackExchange.Redis)
        - RabbitMQ (direct connection via RabbitMQ.Client)
        - 
      operationId: GetInfrastructureHealth
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InfrastructureHealthRequest'
      responses:
        '200':
          description: Infrastructure health status (check response body for component health)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InfrastructureHealthResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/InfrastructureHealthRequest\"\
        ,\n    \"$defs\": {\n        \"InfrastructureHealthRequest\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Request to check infrastructure health (empty body
        allowed)\",\n            \"properties\": {\n                \"components\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n      \
        \              \"description\": \"Optional filter for specific components (redis, rabbitmq, placement)\",\n      \
        \              \"nullable\": true\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/InfrastructureHealthResponse\"\
        ,\n    \"$defs\": {\n        \"InfrastructureHealthResponse\": {\n            \"description\": \"Response containing
        overall infrastructure health status and individual component details\",\n            \"type\": \"object\",\n    \
        \        \"additionalProperties\": false,\n            \"required\": [\n                \"healthy\",\n           \
        \     \"timestamp\",\n                \"components\"\n            ],\n            \"properties\": {\n            \
        \    \"healthy\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Overall infrastructure
        health status\"\n                },\n                \"timestamp\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"description\": \"When health check was performed\"\
        \n                },\n                \"components\": {\n                    \"type\": \"array\",\n              \
        \      \"items\": {\n                        \"$ref\": \"#/$defs/ComponentHealth\"\n                    },\n     \
        \               \"description\": \"Individual component health status\"\n                }\n            }\n      \
        \  },\n        \"ComponentHealth\": {\n            \"description\": \"Health status information for a single infrastructure
        component (Redis, RabbitMQ, etc.)\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"name\",\n                \"status\",\n                \"lastSeen\"\
        \n            ],\n            \"properties\": {\n                \"name\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Component name (redis, rabbitmq, placement)\"\n                },\n    \
        \            \"status\": {\n                    \"type\": \"string\",\n                    \"enum\": [\n         \
        \               \"healthy\",\n                        \"degraded\",\n                        \"unavailable\"\n   \
        \                 ],\n                    \"description\": \"Component health status\"\n                },\n     \
        \           \"lastSeen\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"Last successful connection time\"\n                },\n                \"\
        message\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n               \
        \     \"description\": \"Additional status information (null if no additional context needed)\"\n                },\n\
        \                \"metrics\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Component-specific metrics (e.g., ping time)\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Check infrastructure component health\",\n    \"description\": \"Validates
        connectivity and health of core infrastructure components:\\n- Redis (direct connection via StackExchange.Redis)\\
        n- RabbitMQ (direct connection via RabbitMQ.Client)\\n- \\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n  \
        \  \"operationId\": \"GetInfrastructureHealth\"\n}"
  /orchestrator/health/services:
    post:
      summary: Get health status of all services
      description: |
        Retrieves health information from all services via Redis heartbeat monitoring.
        Uses existing ServiceHeartbeatEvent schema from common-events.yaml.
      operationId: GetServicesHealth
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceHealthRequest'
      responses:
        '200':
          description: Service health report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceHealthReport'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceHealthRequest\"\
        ,\n    \"$defs\": {\n        \"ServiceHealthRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get service health status (empty body allowed)\",\n          \
        \  \"properties\": {\n                \"serviceFilter\": {\n                    \"type\": \"string\",\n          \
        \          \"description\": \"Optional filter by service name\",\n                    \"nullable\": true\n       \
        \         }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceHealthReport\"\
        ,\n    \"$defs\": {\n        \"ServiceHealthReport\": {\n            \"description\": \"Aggregated health report for
        all services based on heartbeat monitoring\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"timestamp\",\n                \"totalServices\",\n      \
        \          \"healthPercentage\",\n                \"healthyServices\",\n                \"unhealthyServices\"\n  \
        \          ],\n            \"properties\": {\n                \"timestamp\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"When report was generated\"\
        \n                },\n                \"totalServices\": {\n                    \"type\": \"integer\",\n         \
        \           \"description\": \"Total number of services\"\n                },\n                \"healthPercentage\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"\
        description\": \"Percentage of healthy services (0-100)\"\n                },\n                \"healthyServices\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/ServiceHealthStatus\"\n                    },\n                    \"description\": \"Services with recent
        heartbeats\"\n                },\n                \"unhealthyServices\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ServiceHealthStatus\"\n         \
        \           },\n                    \"description\": \"Services with expired heartbeats\"\n                }\n   \
        \         }\n        },\n        \"ServiceHealthStatus\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Service health status from heartbeat monitoring.\\nUses ServiceHeartbeatEvent
        schema from common-events.yaml.\\n\",\n            \"required\": [\n                \"serviceId\",\n             \
        \   \"appId\",\n                \"status\",\n                \"lastSeen\"\n            ],\n            \"properties\"\
        : {\n                \"serviceId\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Service ID (e.g., \\\"behavior\\\", \\\"account\\\")\"\n                },\n                \"appId\": {\n   \
        \                 \"type\": \"string\",\n                    \"description\": \"App-id for mesh routing (e.g., \\\"\
        bannou\\\", \\\"npc-omega-01\\\")\"\n                },\n                \"status\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Service status from heartbeat\"\n                },\n      \
        \          \"lastSeen\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"Last heartbeat timestamp\"\n                },\n                \"capacity\"\
        : {\n                    \"description\": \"Current capacity metrics including load and available slots\",\n     \
        \               \"$ref\": \"#/$defs/Capacity\",\n                    \"nullable\": true\n                },\n    \
        \            \"metadata\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"nullable\": true,\n                    \"description\": \"Additional service metadata
        (null if not provided)\"\n                }\n            }\n        },\n        \"Capacity\": {\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Service capacity metrics
        from heartbeat monitoring including connection counts and resource usage\",\n            \"properties\": {\n     \
        \           \"maxConnections\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Maximum number of connections this service can handle\"\n                },\n                \"currentConnections\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Current number of active connections\"\
        \n                },\n                \"cpuUsage\": {\n                    \"type\": \"number\",\n               \
        \     \"format\": \"float\",\n                    \"description\": \"CPU usage as a percentage (0.0 to 1.0)\"\n  \
        \              },\n                \"memoryUsage\": {\n                    \"type\": \"number\",\n               \
        \     \"format\": \"float\",\n                    \"description\": \"Memory usage as a percentage (0.0 to 1.0)\"\n\
        \                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get health status of all services\",\n    \"description\": \"Retrieves
        health information from all services via Redis heartbeat monitoring.\\nUses existing ServiceHeartbeatEvent schema
        from common-events.yaml.\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"GetServicesHealth\"\
        \n}"
  /orchestrator/services/restart:
    post:
      summary: Restart service with optional configuration
      description: |
        Performs intelligent service restart based on health metrics.
        Only restarts if truly necessary (e.g., 5+ minute degradation).

        Supports optional environment variable updates during restart.
      operationId: RestartService
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceRestartRequest'
      responses:
        '200':
          description: Service restarted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceRestartResult'
        '400':
          description: Invalid restart request
        '409':
          description: Service restart not needed (healthy status)

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceRestartRequest\"\
        ,\n    \"$defs\": {\n        \"ServiceRestartRequest\": {\n            \"description\": \"Request to restart a specific
        service with optional configuration updates\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"serviceName\"\n            ],\n            \"properties\"\
        : {\n                \"serviceName\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Name of service to restart\"\n                },\n                \"environment\": {\n                    \"type\"\
        : \"object\",\n                    \"additionalProperties\": {\n                        \"type\": \"string\"\n   \
        \                 },\n                    \"description\": \"Optional environment variable updates\"\n           \
        \     },\n                \"force\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Force restart even if healthy (default false)\"\n                },\n                \"timeout\": {\n        \
        \            \"type\": \"integer\",\n                    \"description\": \"Timeout for service to become healthy
        (seconds, default 120)\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceRestartResult\"\
        ,\n    \"$defs\": {\n        \"ServiceRestartResult\": {\n            \"description\": \"Result of a service restart
        operation including timing and status information\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\",\n                \"serviceName\",\n          \
        \      \"duration\"\n            ],\n            \"properties\": {\n                \"success\": {\n             \
        \       \"type\": \"boolean\",\n                    \"description\": \"Restart success status\"\n                },\n\
        \                \"serviceName\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Service that was restarted\"\n                },\n                \"duration\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Time taken to restart and become healthy\"\n               \
        \ },\n                \"previousStatus\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Service status before restart\"\n                },\n                \"currentStatus\": {\n                  \
        \  \"type\": \"string\",\n                    \"description\": \"Service status after restart\"\n                },\n\
        \                \"message\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Restart result message\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Restart service with optional configuration\",\n    \"description\": \"\
        Performs intelligent service restart based on health metrics.\\nOnly restarts if truly necessary (e.g., 5+ minute
        degradation).\\n\\nSupports optional environment variable updates during restart.\\n\",\n    \"tags\": [],\n    \"\
        deprecated\": false,\n    \"operationId\": \"RestartService\"\n}"
  /orchestrator/services/should-restart:
    post:
      summary: Check if service needs restart
      description: |
        Evaluates service health and determines if restart is necessary.

        Restart logic:
        - Healthy: No restart needed
        - Degraded < 5 min: No restart needed
        - Degraded > 5 min: Restart recommended
        - Unavailable: Restart needed
      operationId: ShouldRestartService
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShouldRestartServiceRequest'
      responses:
        '200':
          description: Restart recommendation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestartRecommendation'

  # ============================================================================
  # ENVIRONMENT MANAGEMENT APIs
  # ============================================================================

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ShouldRestartServiceRequest\"\
        ,\n    \"$defs\": {\n        \"ShouldRestartServiceRequest\": {\n            \"description\": \"Request to evaluate
        whether a service should be restarted based on health metrics\",\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"required\": [\n                \"serviceName\"\n            ],\n   \
        \         \"properties\": {\n                \"serviceName\": {\n                    \"type\": \"string\",\n     \
        \               \"description\": \"Name of service to evaluate\"\n                }\n            }\n        }\n  \
        \  }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RestartRecommendation\"\
        ,\n    \"$defs\": {\n        \"RestartRecommendation\": {\n            \"description\": \"Recommendation on whether
        a service should be restarted with supporting rationale\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"shouldRestart\",\n                \"serviceName\",\n    \
        \            \"currentStatus\",\n                \"reason\"\n            ],\n            \"properties\": {\n     \
        \           \"shouldRestart\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether restart is recommended\"\n                },\n                \"serviceName\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"Service being evaluated\"\n                },\n  \
        \              \"currentStatus\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Current service health status\"\n                },\n                \"lastSeen\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"Last heartbeat
        timestamp\"\n                },\n                \"degradedDuration\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"How long service has been degraded
        (null if not degraded)\"\n                },\n                \"reason\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Explanation for recommendation\"\n                }\n            }\n   \
        \     }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Check if service needs restart\",\n    \"description\": \"Evaluates service
        health and determines if restart is necessary.\\n\\nRestart logic:\\n- Healthy: No restart needed\\n- Degraded < 5
        min: No restart needed\\n- Degraded > 5 min: Restart recommended\\n- Unavailable: Restart needed\\n\",\n    \"tags\"\
        : [],\n    \"deprecated\": false,\n    \"operationId\": \"ShouldRestartService\"\n}"
  /orchestrator/backends/list:
    post:
      summary: Detect available container orchestration backends
      description: |
        Detects which container orchestration backends are available on this system.
        Returns availability status and capabilities for each backend.

        **Priority Order** (for automatic selection):
        1. Kubernetes - Full cluster orchestration with operators
        2. Portainer - API abstraction over Compose/Swarm with web UI
        3. Docker Swarm - Native Docker cluster orchestration
        4. Docker Compose - Single-host container management

        Detection methods:
        - Kubernetes: Check for kubectl and cluster connectivity
        - Portainer: Check for Portainer API endpoint
        - Swarm: Check `docker info` for swarm mode
        - Compose: Check for docker compose v2 availability
      operationId: GetBackends
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListBackendsRequest'
      responses:
        '200':
          description: Available backends with capabilities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackendsResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListBackendsRequest\"\
        ,\n    \"$defs\": {\n        \"ListBackendsRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to list available backends (empty body allowed)\",\n            \"\
        properties\": {\n                \"refresh\": {\n                    \"type\": \"boolean\",\n                    \"\
        default\": false,\n                    \"description\": \"Force refresh detection instead of using cached results\"\
        \n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/BackendsResponse\"\
        ,\n    \"$defs\": {\n        \"BackendsResponse\": {\n            \"description\": \"Response listing all detected
        container orchestration backends with recommended selection\",\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"required\": [\n                \"timestamp\",\n                \"backends\"\
        ,\n                \"recommended\"\n            ],\n            \"properties\": {\n                \"timestamp\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                   \
        \ \"description\": \"When detection was performed\"\n                },\n                \"backends\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/BackendInfo\"\
        \n                    },\n                    \"description\": \"All detected backends with status\"\n           \
        \     },\n                \"recommended\": {\n                    \"$ref\": \"#/$defs/BackendType\",\n           \
        \         \"description\": \"Highest priority available backend\"\n                },\n                \"activeBackend\"\
        : {\n                    \"$ref\": \"#/$defs/BackendType\",\n                    \"description\": \"Currently active
        backend (if environment deployed)\"\n                }\n            }\n        },\n        \"BackendInfo\": {\n  \
        \          \"description\": \"Information about a container orchestration backend including availability and capabilities\"\
        ,\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n\
        \                \"type\",\n                \"available\",\n                \"priority\"\n            ],\n       \
        \     \"properties\": {\n                \"type\": {\n                    \"$ref\": \"#/$defs/BackendType\",\n   \
        \                 \"description\": \"Backend type identifier\"\n                },\n                \"available\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this backend is currently
        available\"\n                },\n                \"priority\": {\n                    \"type\": \"integer\",\n   \
        \                 \"description\": \"Selection priority (1 = highest)\"\n                },\n                \"version\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Backend version (e.g., \\\"\
        1.28.0\\\" for Docker)\"\n                },\n                \"endpoint\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Backend API endpoint (if applicable)\"\n                },\n           \
        \     \"capabilities\": {\n                    \"type\": \"array\",\n                    \"items\": {\n          \
        \              \"type\": \"string\"\n                    },\n                    \"description\": \"Supported capabilities
        for this backend:\\n- live-topology: Can change service distribution without restart\\n- scaling: Can scale services
        horizontally\\n- rolling-update: Supports rolling deployments\\n- secrets: Native secrets management\\n- volumes:
        Persistent volume support\\n- networks: Custom network creation\\n\"\n                },\n                \"error\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Error message if detection
        failed\"\n                }\n            }\n        },\n        \"BackendType\": {\n            \"type\": \"string\"\
        ,\n            \"enum\": [\n                \"kubernetes\",\n                \"portainer\",\n                \"swarm\"\
        ,\n                \"compose\"\n            ],\n            \"description\": \"Container orchestration backend type.\\
        nPriority order: kubernetes > portainer > swarm > compose\\n\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Detect available container orchestration backends\",\n    \"description\"\
        : \"Detects which container orchestration backends are available on this system.\\nReturns availability status and
        capabilities for each backend.\\n\\n**Priority Order** (for automatic selection):\\n1. Kubernetes - Full cluster orchestration
        with operators\\n2. Portainer - API abstraction over Compose/Swarm with web UI\\n3. Docker Swarm - Native Docker cluster
        orchestration\\n4. Docker Compose - Single-host container management\\n\\nDetection methods:\\n- Kubernetes: Check
        for kubectl and cluster connectivity\\n- Portainer: Check for Portainer API endpoint\\n- Swarm: Check `docker info`
        for swarm mode\\n- Compose: Check for docker compose v2 availability\\n\",\n    \"tags\": [],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"GetBackends\"\n}"
  /orchestrator/presets/list:
    post:
      summary: List available deployment presets
      description: |
        Returns all available deployment presets from the orchestrator's preset directory.
        Presets define service combinations and configuration for specific use cases.

        Built-in presets:
        - `local-development`: All services in single container with mesh infrastructure
        - `local-testing`: Test environment with infrastructure services
        - `integration-http`: HTTP integration testing preset
        - `integration-edge`: WebSocket/edge testing preset
        - `split-auth-account`: Auth and Account in separate containers
        - `distributed-npc`: NPC processing distributed across nodes
      operationId: GetPresets
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListPresetsRequest'
      responses:
        '200':
          description: Available deployment presets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PresetsResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListPresetsRequest\"\
        ,\n    \"$defs\": {\n        \"ListPresetsRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to list available presets (empty body allowed)\",\n            \"\
        properties\": {\n                \"category\": {\n                    \"type\": \"string\",\n                    \"\
        enum\": [\n                        \"development\",\n                        \"testing\",\n                      \
        \  \"production\",\n                        \"custom\"\n                    ],\n                    \"description\"\
        : \"Optional filter by category\",\n                    \"nullable\": true\n                }\n            }\n   \
        \     }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/PresetsResponse\"\
        ,\n    \"$defs\": {\n        \"PresetsResponse\": {\n            \"description\": \"Response containing available
        deployment presets and the currently active preset\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"presets\"\n            ],\n            \"properties\": {\n\
        \                \"presets\": {\n                    \"type\": \"array\",\n                    \"items\": {\n    \
        \                    \"$ref\": \"#/$defs/DeploymentPreset\"\n                    },\n                    \"description\"\
        : \"Available deployment presets\"\n                },\n                \"activePreset\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Currently active preset name (if any)\"\n            \
        \    }\n            }\n        },\n        \"DeploymentPreset\": {\n            \"description\": \"Predefined deployment
        configuration defining service topology and environment settings\",\n            \"type\": \"object\",\n         \
        \   \"additionalProperties\": false,\n            \"required\": [\n                \"name\",\n                \"description\"\
        ,\n                \"topology\"\n            ],\n            \"properties\": {\n                \"name\": {\n    \
        \                \"type\": \"string\",\n                    \"description\": \"Unique preset identifier (e.g., \\\"\
        local-development\\\")\"\n                },\n                \"description\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Human-readable preset description\"\n                },\n      \
        \          \"category\": {\n                    \"type\": \"string\",\n                    \"enum\": [\n         \
        \               \"development\",\n                        \"testing\",\n                        \"production\",\n\
        \                        \"custom\"\n                    ],\n                    \"description\": \"Preset category\"\
        \n                },\n                \"topology\": {\n                    \"$ref\": \"#/$defs/ServiceTopology\",\n\
        \                    \"description\": \"Service topology defined by this preset\"\n                },\n          \
        \      \"environment\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Default environment variables for this preset\"\n                },\n                \"requiredBackends\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/BackendType\"\
        \n                    },\n                    \"description\": \"Backends that support this preset (empty = all)\"\
        \n                },\n                \"builtIn\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether this is a built-in preset\"\n                },\n                \"filePath\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Path to preset configuration file\"\
        \n                }\n            }\n        },\n        \"ServiceTopology\": {\n            \"description\": \"Service
        distribution topology defining which services run on which nodes\",\n            \"type\": \"object\",\n         \
        \   \"additionalProperties\": false,\n            \"required\": [\n                \"nodes\"\n            ],\n   \
        \         \"properties\": {\n                \"nodes\": {\n                    \"type\": \"array\",\n            \
        \        \"items\": {\n                        \"$ref\": \"#/$defs/TopologyNode\"\n                    },\n      \
        \              \"description\": \"Container/pod definitions with service assignments\"\n                },\n     \
        \           \"infrastructure\": {\n                    \"$ref\": \"#/$defs/InfrastructureConfig\",\n             \
        \       \"description\": \"Infrastructure service configuration\"\n                }\n            }\n        },\n\
        \        \"TopologyNode\": {\n            \"description\": \"A container or pod in the service topology with its assigned
        services and configuration\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n \
        \           \"required\": [\n                \"name\",\n                \"services\"\n            ],\n           \
        \ \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Node/container name (e.g., \\\"bannou-main\\\", \\\"bannou-auth\\\")\"\n                },\n    \
        \            \"services\": {\n                    \"type\": \"array\",\n                    \"items\": {\n       \
        \                 \"type\": \"string\"\n                    },\n                    \"description\": \"Services enabled
        on this node.\\nUses {SERVICE}_SERVICE_ENABLED=true pattern.\\nExample: [\\\"account\\\", \\\"auth\\\", \\\"permission\\\
        \"]\\n\"\n                },\n                \"replicas\": {\n                    \"type\": \"integer\",\n      \
        \              \"default\": 1,\n                    \"description\": \"Number of replicas for this node\"\n      \
        \          },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\",\n     \
        \               \"description\": \"Resource limits and requests for this node\"\n                },\n            \
        \    \"environment\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\":
        {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"Node-specific
        environment overrides\"\n                },\n                \"meshEnabled\": {\n                    \"type\": \"\
        boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether mesh routing is
        enabled\"\n                },\n                \"appId\": {\n                    \"type\": \"string\",\n         \
        \           \"description\": \"App-id override for mesh routing (default derives from node name)\"\n             \
        \   }\n            }\n        },\n        \"ResourceLimits\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Resource limits and requests for container scheduling\"\
        ,\n            \"properties\": {\n                \"cpuLimit\": {\n                    \"type\": \"string\",\n   \
        \                 \"description\": \"CPU limit (e.g., \\\"0.5\\\", \\\"2\\\")\"\n                },\n            \
        \    \"memoryLimit\": {\n                    \"type\": \"string\",\n                    \"description\": \"Memory
        limit (e.g., \\\"512m\\\", \\\"2g\\\")\"\n                },\n                \"cpuRequest\": {\n                \
        \    \"type\": \"string\",\n                    \"description\": \"CPU request (Kubernetes)\"\n                },\n\
        \                \"memoryRequest\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Memory request (Kubernetes)\"\n                }\n            }\n        },\n        \"InfrastructureConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Configuration for infrastructure services\",\n            \"properties\": {\n                \"redis\": {\n  \
        \                  \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"Redis configuration\"\
        \n                },\n                \"rabbitmq\": {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\"\
        ,\n                    \"description\": \"RabbitMQ configuration\"\n                },\n                \"mysql\"\
        : {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"MySQL configuration\"\
        \n                },\n                \"ingress\": {\n                    \"$ref\": \"#/$defs/IngressConfig\",\n \
        \                   \"description\": \"Ingress/reverse proxy configuration\"\n                }\n            }\n \
        \       },\n        \"InfraServiceConfig\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Configuration for an infrastructure service\",\n            \"properties\"\
        : {\n                \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"default\":
        true,\n                    \"description\": \"Whether this infrastructure service is enabled\"\n                },\n\
        \                \"image\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Docker image override\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests\"\n                },\n                \"environment\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"description\": \"Environment variables
        for this service\"\n                },\n                \"volumes\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Volume mounts\"\n                }\n            }\n        },\n        \"IngressConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Ingress/reverse proxy configuration\",\n            \"properties\": {\n                \"enabled\": {\n      \
        \              \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Whether ingress is enabled\"\n                },\n                \"type\": {\n                    \"type\": \"\
        string\",\n                    \"enum\": [\n                        \"openresty\",\n                        \"nginx\"\
        ,\n                        \"traefik\",\n                        \"none\"\n                    ],\n              \
        \      \"default\": \"openresty\",\n                    \"description\": \"Type of ingress/reverse proxy to use\"\n\
        \                },\n                \"ports\": {\n                    \"description\": \"Port configuration for HTTP
        and HTTPS traffic\",\n                    \"$ref\": \"#/$defs/Ports\"\n                },\n                \"ssl\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Whether SSL/TLS is enabled\"\n                }\n            }\n        },\n        \"Ports\": {\n           \
        \ \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Port configuration
        for ingress specifying HTTP and HTTPS port numbers\",\n            \"properties\": {\n                \"http\": {\n\
        \                    \"type\": \"integer\",\n                    \"default\": 80,\n                    \"description\"\
        : \"HTTP port number\"\n                },\n                \"https\": {\n                    \"type\": \"integer\"\
        ,\n                    \"default\": 443,\n                    \"description\": \"HTTPS port number\"\n           \
        \     }\n            }\n        },\n        \"BackendType\": {\n            \"type\": \"string\",\n            \"\
        enum\": [\n                \"kubernetes\",\n                \"portainer\",\n                \"swarm\",\n         \
        \       \"compose\"\n            ],\n            \"description\": \"Container orchestration backend type.\\nPriority
        order: kubernetes > portainer > swarm > compose\\n\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List available deployment presets\",\n    \"description\": \"Returns all
        available deployment presets from the orchestrator's preset directory.\\nPresets define service combinations and configuration
        for specific use cases.\\n\\nBuilt-in presets:\\n- `local-development`: All services in single container with mesh
        infrastructure\\n- `local-testing`: Test environment with infrastructure services\\n- `integration-http`: HTTP integration
        testing preset\\n- `integration-edge`: WebSocket/edge testing preset\\n- `split-auth-account`: Auth and Account in
        separate containers\\n- `distributed-npc`: NPC processing distributed across nodes\\n\",\n    \"tags\": [],\n    \"\
        deprecated\": false,\n    \"operationId\": \"GetPresets\"\n}"
  /orchestrator/deploy:
    post:
      summary: Deploy or update an environment
      description: |
        Deploys a complete environment using a preset or custom configuration.
        Supports graceful transitions, forced deployments, and clean rebuilds.

        **Deployment Modes**:
        - `graceful`: Wait for existing connections to drain before changing topology
        - `force`: Immediately apply changes (may interrupt active connections)
        - `clean`: Tear down completely and rebuild from scratch

        **Backend Selection**:
        - If `backend` not specified, uses highest-priority available backend
        - If `backend` specified but unavailable, returns error (no fallback)

        **Live Topology Changes**:
        Supports changing service distribution without full restart:
        - Move auth/account to separate container while keeping other services together
        - Scale specific services to additional nodes
        - Update environment variables without restart (where supported)
      operationId: Deploy
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeployRequest'
      responses:
        '200':
          description: Deployment initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeployResponse'
        '400':
          description: Invalid deployment configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Backend not available (when explicitly requested)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Deployment failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeployRequest\"\
        ,\n    \"$defs\": {\n        \"DeployRequest\": {\n            \"description\": \"Request to deploy or update an environment
        using a preset or custom topology\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"properties\": {\n                \"preset\": {\n                    \"type\": \"string\",\n       \
        \             \"nullable\": true,\n                    \"description\": \"Preset name to deploy (mutually exclusive
        with topology)\"\n                },\n                \"topology\": {\n                    \"allOf\": [\n        \
        \                {\n                            \"$ref\": \"#/$defs/ServiceTopology\"\n                        }\n\
        \                    ],\n                    \"nullable\": true,\n                    \"description\": \"Custom topology
        (mutually exclusive with preset)\"\n                },\n                \"backend\": {\n                    \"allOf\"\
        : [\n                        {\n                            \"$ref\": \"#/$defs/BackendType\"\n                  \
        \      }\n                    ],\n                    \"nullable\": true,\n                    \"description\": \"\
        Specific backend to use (fails if unavailable)\"\n                },\n                \"mode\": {\n              \
        \      \"$ref\": \"#/$defs/DeploymentMode\",\n                    \"default\": \"graceful\",\n                   \
        \ \"description\": \"How the deployment should be performed\"\n                },\n                \"environment\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                 \
        \   \"description\": \"Environment variable overrides\"\n                },\n                \"timeout\": {\n    \
        \                \"type\": \"integer\",\n                    \"default\": 300,\n                    \"description\"\
        : \"Deployment timeout in seconds\"\n                },\n                \"waitForHealthy\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Wait for
        all services to report healthy\"\n                },\n                \"dryRun\": {\n                    \"type\"\
        : \"boolean\",\n                    \"default\": false,\n                    \"description\": \"Preview what would
        be deployed without making changes\"\n                }\n            }\n        },\n        \"ServiceTopology\": {\n\
        \            \"description\": \"Service distribution topology defining which services run on which nodes\",\n    \
        \        \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n      \
        \          \"nodes\"\n            ],\n            \"properties\": {\n                \"nodes\": {\n              \
        \      \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/TopologyNode\"\
        \n                    },\n                    \"description\": \"Container/pod definitions with service assignments\"\
        \n                },\n                \"infrastructure\": {\n                    \"$ref\": \"#/$defs/InfrastructureConfig\"\
        ,\n                    \"description\": \"Infrastructure service configuration\"\n                }\n            }\n\
        \        },\n        \"TopologyNode\": {\n            \"description\": \"A container or pod in the service topology
        with its assigned services and configuration\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"services\"\n            ],\n \
        \           \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n          \
        \          \"description\": \"Node/container name (e.g., \\\"bannou-main\\\", \\\"bannou-auth\\\")\"\n           \
        \     },\n                \"services\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Services enabled on this node.\\nUses {SERVICE}_SERVICE_ENABLED=true pattern.\\nExample: [\\\"account\\\", \\\"auth\\\
        \", \\\"permission\\\"]\\n\"\n                },\n                \"replicas\": {\n                    \"type\": \"\
        integer\",\n                    \"default\": 1,\n                    \"description\": \"Number of replicas for this
        node\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests for this node\"\n                },\n     \
        \           \"environment\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Node-specific environment overrides\"\n                },\n                \"meshEnabled\": {\n                  \
        \  \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether
        mesh routing is enabled\"\n                },\n                \"appId\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"App-id override for mesh routing (default derives from node name)\"\n  \
        \              }\n            }\n        },\n        \"ResourceLimits\": {\n            \"type\": \"object\",\n  \
        \          \"additionalProperties\": false,\n            \"description\": \"Resource limits and requests for container
        scheduling\",\n            \"properties\": {\n                \"cpuLimit\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"CPU limit (e.g., \\\"0.5\\\", \\\"2\\\")\"\n                },\n       \
        \         \"memoryLimit\": {\n                    \"type\": \"string\",\n                    \"description\": \"Memory
        limit (e.g., \\\"512m\\\", \\\"2g\\\")\"\n                },\n                \"cpuRequest\": {\n                \
        \    \"type\": \"string\",\n                    \"description\": \"CPU request (Kubernetes)\"\n                },\n\
        \                \"memoryRequest\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Memory request (Kubernetes)\"\n                }\n            }\n        },\n        \"InfrastructureConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Configuration for infrastructure services\",\n            \"properties\": {\n                \"redis\": {\n  \
        \                  \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"Redis configuration\"\
        \n                },\n                \"rabbitmq\": {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\"\
        ,\n                    \"description\": \"RabbitMQ configuration\"\n                },\n                \"mysql\"\
        : {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"MySQL configuration\"\
        \n                },\n                \"ingress\": {\n                    \"$ref\": \"#/$defs/IngressConfig\",\n \
        \                   \"description\": \"Ingress/reverse proxy configuration\"\n                }\n            }\n \
        \       },\n        \"InfraServiceConfig\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Configuration for an infrastructure service\",\n            \"properties\"\
        : {\n                \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"default\":
        true,\n                    \"description\": \"Whether this infrastructure service is enabled\"\n                },\n\
        \                \"image\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Docker image override\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests\"\n                },\n                \"environment\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"description\": \"Environment variables
        for this service\"\n                },\n                \"volumes\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Volume mounts\"\n                }\n            }\n        },\n        \"IngressConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Ingress/reverse proxy configuration\",\n            \"properties\": {\n                \"enabled\": {\n      \
        \              \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Whether ingress is enabled\"\n                },\n                \"type\": {\n                    \"type\": \"\
        string\",\n                    \"enum\": [\n                        \"openresty\",\n                        \"nginx\"\
        ,\n                        \"traefik\",\n                        \"none\"\n                    ],\n              \
        \      \"default\": \"openresty\",\n                    \"description\": \"Type of ingress/reverse proxy to use\"\n\
        \                },\n                \"ports\": {\n                    \"description\": \"Port configuration for HTTP
        and HTTPS traffic\",\n                    \"$ref\": \"#/$defs/Ports\"\n                },\n                \"ssl\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Whether SSL/TLS is enabled\"\n                }\n            }\n        },\n        \"Ports\": {\n           \
        \ \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Port configuration
        for ingress specifying HTTP and HTTPS port numbers\",\n            \"properties\": {\n                \"http\": {\n\
        \                    \"type\": \"integer\",\n                    \"default\": 80,\n                    \"description\"\
        : \"HTTP port number\"\n                },\n                \"https\": {\n                    \"type\": \"integer\"\
        ,\n                    \"default\": 443,\n                    \"description\": \"HTTPS port number\"\n           \
        \     }\n            }\n        },\n        \"BackendType\": {\n            \"type\": \"string\",\n            \"\
        enum\": [\n                \"kubernetes\",\n                \"portainer\",\n                \"swarm\",\n         \
        \       \"compose\"\n            ],\n            \"description\": \"Container orchestration backend type.\\nPriority
        order: kubernetes > portainer > swarm > compose\\n\"\n        },\n        \"DeploymentMode\": {\n            \"type\"\
        : \"string\",\n            \"enum\": [\n                \"graceful\",\n                \"force\",\n              \
        \  \"clean\"\n            ],\n            \"description\": \"Deployment mode:\\n- graceful: Wait for connections to
        drain\\n- force: Apply immediately\\n- clean: Tear down and rebuild\\n\"\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeployResponse\"\
        ,\n    \"$defs\": {\n        \"DeployResponse\": {\n            \"description\": \"Result of a deployment operation
        including status and deployed service information\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\",\n                \"deploymentId\",\n         \
        \       \"backend\",\n                \"duration\"\n            ],\n            \"properties\": {\n              \
        \  \"success\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Deployment succeeded\"\
        \n                },\n                \"deploymentId\": {\n                    \"type\": \"string\",\n           \
        \         \"description\": \"Unique deployment identifier for tracking\"\n                },\n                \"backend\"\
        : {\n                    \"$ref\": \"#/$defs/BackendType\",\n                    \"description\": \"Container orchestration
        backend used for deployment\"\n                },\n                \"preset\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Preset used (if applicable)\"\n                },\n            \
        \    \"duration\": {\n                    \"type\": \"string\",\n                    \"description\": \"Time taken
        to deploy\"\n                },\n                \"topology\": {\n                    \"$ref\": \"#/$defs/ServiceTopology\"\
        ,\n                    \"description\": \"Final applied topology\"\n                },\n                \"services\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/DeployedService\"\n                    },\n                    \"description\": \"Status of deployed services\"\
        \n                },\n                \"warnings\": {\n                    \"type\": \"array\",\n                \
        \    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\"\
        : \"Non-fatal warnings during deployment\"\n                },\n                \"message\": {\n                 \
        \   \"type\": \"string\",\n                    \"description\": \"Human-readable deployment summary\"\n          \
        \      }\n            }\n        },\n        \"BackendType\": {\n            \"type\": \"string\",\n            \"\
        enum\": [\n                \"kubernetes\",\n                \"portainer\",\n                \"swarm\",\n         \
        \       \"compose\"\n            ],\n            \"description\": \"Container orchestration backend type.\\nPriority
        order: kubernetes > portainer > swarm > compose\\n\"\n        },\n        \"ServiceTopology\": {\n            \"description\"\
        : \"Service distribution topology defining which services run on which nodes\",\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"required\": [\n                \"nodes\"\n        \
        \    ],\n            \"properties\": {\n                \"nodes\": {\n                    \"type\": \"array\",\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/TopologyNode\"\n                   \
        \ },\n                    \"description\": \"Container/pod definitions with service assignments\"\n              \
        \  },\n                \"infrastructure\": {\n                    \"$ref\": \"#/$defs/InfrastructureConfig\",\n  \
        \                  \"description\": \"Infrastructure service configuration\"\n                }\n            }\n \
        \       },\n        \"TopologyNode\": {\n            \"description\": \"A container or pod in the service topology
        with its assigned services and configuration\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"services\"\n            ],\n \
        \           \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n          \
        \          \"description\": \"Node/container name (e.g., \\\"bannou-main\\\", \\\"bannou-auth\\\")\"\n           \
        \     },\n                \"services\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Services enabled on this node.\\nUses {SERVICE}_SERVICE_ENABLED=true pattern.\\nExample: [\\\"account\\\", \\\"auth\\\
        \", \\\"permission\\\"]\\n\"\n                },\n                \"replicas\": {\n                    \"type\": \"\
        integer\",\n                    \"default\": 1,\n                    \"description\": \"Number of replicas for this
        node\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests for this node\"\n                },\n     \
        \           \"environment\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Node-specific environment overrides\"\n                },\n                \"meshEnabled\": {\n                  \
        \  \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether
        mesh routing is enabled\"\n                },\n                \"appId\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"App-id override for mesh routing (default derives from node name)\"\n  \
        \              }\n            }\n        },\n        \"ResourceLimits\": {\n            \"type\": \"object\",\n  \
        \          \"additionalProperties\": false,\n            \"description\": \"Resource limits and requests for container
        scheduling\",\n            \"properties\": {\n                \"cpuLimit\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"CPU limit (e.g., \\\"0.5\\\", \\\"2\\\")\"\n                },\n       \
        \         \"memoryLimit\": {\n                    \"type\": \"string\",\n                    \"description\": \"Memory
        limit (e.g., \\\"512m\\\", \\\"2g\\\")\"\n                },\n                \"cpuRequest\": {\n                \
        \    \"type\": \"string\",\n                    \"description\": \"CPU request (Kubernetes)\"\n                },\n\
        \                \"memoryRequest\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Memory request (Kubernetes)\"\n                }\n            }\n        },\n        \"InfrastructureConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Configuration for infrastructure services\",\n            \"properties\": {\n                \"redis\": {\n  \
        \                  \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"Redis configuration\"\
        \n                },\n                \"rabbitmq\": {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\"\
        ,\n                    \"description\": \"RabbitMQ configuration\"\n                },\n                \"mysql\"\
        : {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"MySQL configuration\"\
        \n                },\n                \"ingress\": {\n                    \"$ref\": \"#/$defs/IngressConfig\",\n \
        \                   \"description\": \"Ingress/reverse proxy configuration\"\n                }\n            }\n \
        \       },\n        \"InfraServiceConfig\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Configuration for an infrastructure service\",\n            \"properties\"\
        : {\n                \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"default\":
        true,\n                    \"description\": \"Whether this infrastructure service is enabled\"\n                },\n\
        \                \"image\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Docker image override\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests\"\n                },\n                \"environment\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"description\": \"Environment variables
        for this service\"\n                },\n                \"volumes\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Volume mounts\"\n                }\n            }\n        },\n        \"IngressConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Ingress/reverse proxy configuration\",\n            \"properties\": {\n                \"enabled\": {\n      \
        \              \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Whether ingress is enabled\"\n                },\n                \"type\": {\n                    \"type\": \"\
        string\",\n                    \"enum\": [\n                        \"openresty\",\n                        \"nginx\"\
        ,\n                        \"traefik\",\n                        \"none\"\n                    ],\n              \
        \      \"default\": \"openresty\",\n                    \"description\": \"Type of ingress/reverse proxy to use\"\n\
        \                },\n                \"ports\": {\n                    \"description\": \"Port configuration for HTTP
        and HTTPS traffic\",\n                    \"$ref\": \"#/$defs/Ports\"\n                },\n                \"ssl\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Whether SSL/TLS is enabled\"\n                }\n            }\n        },\n        \"Ports\": {\n           \
        \ \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Port configuration
        for ingress specifying HTTP and HTTPS port numbers\",\n            \"properties\": {\n                \"http\": {\n\
        \                    \"type\": \"integer\",\n                    \"default\": 80,\n                    \"description\"\
        : \"HTTP port number\"\n                },\n                \"https\": {\n                    \"type\": \"integer\"\
        ,\n                    \"default\": 443,\n                    \"description\": \"HTTPS port number\"\n           \
        \     }\n            }\n        },\n        \"DeployedService\": {\n            \"description\": \"Status information
        for a single deployed service instance\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"status\",\n                \"\
        node\"\n            ],\n            \"properties\": {\n                \"name\": {\n                    \"type\":
        \"string\",\n                    \"description\": \"Service name\"\n                },\n                \"status\"\
        : {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"starting\"\
        ,\n                        \"running\",\n                        \"healthy\",\n                        \"unhealthy\"\
        ,\n                        \"stopped\"\n                    ],\n                    \"description\": \"Current status
        of the deployed service\"\n                },\n                \"node\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Node/container hosting this service\"\n                },\n            \
        \    \"containerId\": {\n                    \"type\": \"string\",\n                    \"description\": \"Container
        ID (Compose/Swarm)\"\n                },\n                \"podName\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Pod name (Kubernetes)\"\n                },\n                \"endpoints\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"description\": \"Exposed endpoints\"\n               \
        \ }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Deploy or update an environment\",\n    \"description\": \"Deploys a complete
        environment using a preset or custom configuration.\\nSupports graceful transitions, forced deployments, and clean
        rebuilds.\\n\\n**Deployment Modes**:\\n- `graceful`: Wait for existing connections to drain before changing topology\\
        n- `force`: Immediately apply changes (may interrupt active connections)\\n- `clean`: Tear down completely and rebuild
        from scratch\\n\\n**Backend Selection**:\\n- If `backend` not specified, uses highest-priority available backend\\
        n- If `backend` specified but unavailable, returns error (no fallback)\\n\\n**Live Topology Changes**:\\nSupports
        changing service distribution without full restart:\\n- Move auth/account to separate container while keeping other
        services together\\n- Scale specific services to additional nodes\\n- Update environment variables without restart
        (where supported)\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"Deploy\"\n}"
  /orchestrator/service-routing:
    post:
      summary: Get current service-to-app-id routing mappings
      description: |
        Returns the current service-to-app-id routing mappings used for mesh service invocation through lib-mesh.
        This is the authoritative source of truth for how services are routed in the current deployment.

        In development, all services route to "bannou" by default. In production, services may be
        distributed across multiple app-ids based on deployment topology.

        **Use Cases**:
        - Services querying routing on startup
        - Debugging service communication issues
        - Monitoring deployment topology
      operationId: GetServiceRouting
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetServiceRoutingRequest'
      responses:
        '200':
          description: Service routing mappings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceRoutingResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetServiceRoutingRequest\"\
        ,\n    \"$defs\": {\n        \"GetServiceRoutingRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get service routing mappings (empty body allowed)\",\n       \
        \     \"properties\": {\n                \"serviceFilter\": {\n                    \"type\": \"string\",\n       \
        \             \"description\": \"Optional filter by service name prefix\",\n                    \"nullable\": true\n\
        \                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceRoutingResponse\"\
        ,\n    \"$defs\": {\n        \"ServiceRoutingResponse\": {\n            \"description\": \"Response containing service-to-app-id
        routing mappings for mesh invocation\",\n            \"type\": \"object\",\n            \"additionalProperties\":
        false,\n            \"required\": [\n                \"mappings\",\n                \"defaultAppId\",\n          \
        \      \"generatedAt\"\n            ],\n            \"properties\": {\n                \"mappings\": {\n         \
        \           \"type\": \"object\",\n                    \"additionalProperties\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"description\": \"Map of service names to Bannou app-id
        routing destinations.\\nExample: { \\\"account\\\": \\\"bannou\\\", \\\"behavior\\\": \\\"npc-processing-01\\\" }\\\
        n\"\n                },\n                \"defaultAppId\": {\n                    \"type\": \"string\",\n        \
        \            \"description\": \"Default app-id used when no specific mapping exists\",\n                    \"default\"\
        : \"bannou\"\n                },\n                \"generatedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"description\": \"When this routing information
        was generated\"\n                },\n                \"totalServices\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Total number of services with routing mappings\",\n                    \"\
        minimum\": 0\n                },\n                \"deploymentId\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Current deployment identifier (if environment is deployed)\",\n          \
        \          \"nullable\": true\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get current service-to-app-id routing mappings\",\n    \"description\"\
        : \"Returns the current service-to-app-id routing mappings used for mesh service invocation through lib-mesh.\\nThis
        is the authoritative source of truth for how services are routed in the current deployment.\\n\\nIn development, all
        services route to \\\"bannou\\\" by default. In production, services may be\\ndistributed across multiple app-ids
        based on deployment topology.\\n\\n**Use Cases**:\\n- Services querying routing on startup\\n- Debugging service communication
        issues\\n- Monitoring deployment topology\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"GetServiceRouting\"\n}"
  /orchestrator/status:
    post:
      summary: Get current environment status
      description: |
        Returns comprehensive status of the current deployment including:
        - Active backend and deployment configuration
        - Service topology (which services on which containers)
        - Container health and resource usage
        - Infrastructure component status
        - Active preset and any customizations
      operationId: GetStatus
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetStatusRequest'
      responses:
        '200':
          description: Current environment status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentStatus'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetStatusRequest\"\
        ,\n    \"$defs\": {\n        \"GetStatusRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get environment status (empty body allowed)\",\n            \"\
        properties\": {\n                \"includeResources\": {\n                    \"type\": \"boolean\",\n           \
        \         \"default\": true,\n                    \"description\": \"Include resource usage metrics\"\n          \
        \      }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/EnvironmentStatus\"\
        ,\n    \"$defs\": {\n        \"EnvironmentStatus\": {\n            \"description\": \"Current status of the deployed
        environment including topology and resource usage\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"deployed\",\n                \"timestamp\"\n            ],\n\
        \            \"properties\": {\n                \"deployed\": {\n                    \"type\": \"boolean\",\n    \
        \                \"description\": \"Whether an environment is currently deployed\"\n                },\n         \
        \       \"timestamp\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When this status was generated\"\n                },\n                \"\
        deploymentId\": {\n                    \"type\": \"string\",\n                    \"description\": \"Current deployment
        identifier\"\n                },\n                \"backend\": {\n                    \"$ref\": \"#/$defs/BackendType\"\
        ,\n                    \"description\": \"Container orchestration backend in use\"\n                },\n         \
        \       \"preset\": {\n                    \"type\": \"string\",\n                    \"description\": \"Active preset
        name\"\n                },\n                \"topology\": {\n                    \"$ref\": \"#/$defs/ServiceTopology\"\
        ,\n                    \"description\": \"Current topology configuration\"\n                },\n                \"\
        services\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/DeployedService\"\n                    },\n                    \"description\": \"All deployed
        services with status\"\n                },\n                \"infrastructure\": {\n                    \"$ref\": \"\
        #/$defs/InfrastructureHealthResponse\",\n                    \"description\": \"Infrastructure component health\"\n\
        \                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceUsage\",\n\
        \                    \"description\": \"Overall resource usage\"\n                },\n                \"uptime\":
        {\n                    \"type\": \"string\",\n                    \"description\": \"Time since deployment\"\n   \
        \             }\n            }\n        },\n        \"BackendType\": {\n            \"type\": \"string\",\n      \
        \      \"enum\": [\n                \"kubernetes\",\n                \"portainer\",\n                \"swarm\",\n\
        \                \"compose\"\n            ],\n            \"description\": \"Container orchestration backend type.\\
        nPriority order: kubernetes > portainer > swarm > compose\\n\"\n        },\n        \"ServiceTopology\": {\n     \
        \       \"description\": \"Service distribution topology defining which services run on which nodes\",\n         \
        \   \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n           \
        \     \"nodes\"\n            ],\n            \"properties\": {\n                \"nodes\": {\n                   \
        \ \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/TopologyNode\"\
        \n                    },\n                    \"description\": \"Container/pod definitions with service assignments\"\
        \n                },\n                \"infrastructure\": {\n                    \"$ref\": \"#/$defs/InfrastructureConfig\"\
        ,\n                    \"description\": \"Infrastructure service configuration\"\n                }\n            }\n\
        \        },\n        \"TopologyNode\": {\n            \"description\": \"A container or pod in the service topology
        with its assigned services and configuration\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"services\"\n            ],\n \
        \           \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n          \
        \          \"description\": \"Node/container name (e.g., \\\"bannou-main\\\", \\\"bannou-auth\\\")\"\n           \
        \     },\n                \"services\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Services enabled on this node.\\nUses {SERVICE}_SERVICE_ENABLED=true pattern.\\nExample: [\\\"account\\\", \\\"auth\\\
        \", \\\"permission\\\"]\\n\"\n                },\n                \"replicas\": {\n                    \"type\": \"\
        integer\",\n                    \"default\": 1,\n                    \"description\": \"Number of replicas for this
        node\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests for this node\"\n                },\n     \
        \           \"environment\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Node-specific environment overrides\"\n                },\n                \"meshEnabled\": {\n                  \
        \  \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether
        mesh routing is enabled\"\n                },\n                \"appId\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"App-id override for mesh routing (default derives from node name)\"\n  \
        \              }\n            }\n        },\n        \"ResourceLimits\": {\n            \"type\": \"object\",\n  \
        \          \"additionalProperties\": false,\n            \"description\": \"Resource limits and requests for container
        scheduling\",\n            \"properties\": {\n                \"cpuLimit\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"CPU limit (e.g., \\\"0.5\\\", \\\"2\\\")\"\n                },\n       \
        \         \"memoryLimit\": {\n                    \"type\": \"string\",\n                    \"description\": \"Memory
        limit (e.g., \\\"512m\\\", \\\"2g\\\")\"\n                },\n                \"cpuRequest\": {\n                \
        \    \"type\": \"string\",\n                    \"description\": \"CPU request (Kubernetes)\"\n                },\n\
        \                \"memoryRequest\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Memory request (Kubernetes)\"\n                }\n            }\n        },\n        \"InfrastructureConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Configuration for infrastructure services\",\n            \"properties\": {\n                \"redis\": {\n  \
        \                  \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"Redis configuration\"\
        \n                },\n                \"rabbitmq\": {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\"\
        ,\n                    \"description\": \"RabbitMQ configuration\"\n                },\n                \"mysql\"\
        : {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"MySQL configuration\"\
        \n                },\n                \"ingress\": {\n                    \"$ref\": \"#/$defs/IngressConfig\",\n \
        \                   \"description\": \"Ingress/reverse proxy configuration\"\n                }\n            }\n \
        \       },\n        \"InfraServiceConfig\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Configuration for an infrastructure service\",\n            \"properties\"\
        : {\n                \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"default\":
        true,\n                    \"description\": \"Whether this infrastructure service is enabled\"\n                },\n\
        \                \"image\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Docker image override\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests\"\n                },\n                \"environment\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"description\": \"Environment variables
        for this service\"\n                },\n                \"volumes\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Volume mounts\"\n                }\n            }\n        },\n        \"IngressConfig\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Ingress/reverse proxy configuration\",\n            \"properties\": {\n                \"enabled\": {\n      \
        \              \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Whether ingress is enabled\"\n                },\n                \"type\": {\n                    \"type\": \"\
        string\",\n                    \"enum\": [\n                        \"openresty\",\n                        \"nginx\"\
        ,\n                        \"traefik\",\n                        \"none\"\n                    ],\n              \
        \      \"default\": \"openresty\",\n                    \"description\": \"Type of ingress/reverse proxy to use\"\n\
        \                },\n                \"ports\": {\n                    \"description\": \"Port configuration for HTTP
        and HTTPS traffic\",\n                    \"$ref\": \"#/$defs/Ports\"\n                },\n                \"ssl\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Whether SSL/TLS is enabled\"\n                }\n            }\n        },\n        \"Ports\": {\n           \
        \ \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Port configuration
        for ingress specifying HTTP and HTTPS port numbers\",\n            \"properties\": {\n                \"http\": {\n\
        \                    \"type\": \"integer\",\n                    \"default\": 80,\n                    \"description\"\
        : \"HTTP port number\"\n                },\n                \"https\": {\n                    \"type\": \"integer\"\
        ,\n                    \"default\": 443,\n                    \"description\": \"HTTPS port number\"\n           \
        \     }\n            }\n        },\n        \"DeployedService\": {\n            \"description\": \"Status information
        for a single deployed service instance\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"status\",\n                \"\
        node\"\n            ],\n            \"properties\": {\n                \"name\": {\n                    \"type\":
        \"string\",\n                    \"description\": \"Service name\"\n                },\n                \"status\"\
        : {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"starting\"\
        ,\n                        \"running\",\n                        \"healthy\",\n                        \"unhealthy\"\
        ,\n                        \"stopped\"\n                    ],\n                    \"description\": \"Current status
        of the deployed service\"\n                },\n                \"node\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Node/container hosting this service\"\n                },\n            \
        \    \"containerId\": {\n                    \"type\": \"string\",\n                    \"description\": \"Container
        ID (Compose/Swarm)\"\n                },\n                \"podName\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Pod name (Kubernetes)\"\n                },\n                \"endpoints\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"description\": \"Exposed endpoints\"\n               \
        \ }\n            }\n        },\n        \"InfrastructureHealthResponse\": {\n            \"description\": \"Response
        containing overall infrastructure health status and individual component details\",\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"required\": [\n                \"healthy\",\n     \
        \           \"timestamp\",\n                \"components\"\n            ],\n            \"properties\": {\n      \
        \          \"healthy\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Overall
        infrastructure health status\"\n                },\n                \"timestamp\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When health
        check was performed\"\n                },\n                \"components\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ComponentHealth\"\n             \
        \       },\n                    \"description\": \"Individual component health status\"\n                }\n     \
        \       }\n        },\n        \"ComponentHealth\": {\n            \"description\": \"Health status information for
        a single infrastructure component (Redis, RabbitMQ, etc.)\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"status\",\n                \"\
        lastSeen\"\n            ],\n            \"properties\": {\n                \"name\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Component name (redis, rabbitmq, placement)\"\n            \
        \    },\n                \"status\": {\n                    \"type\": \"string\",\n                    \"enum\": [\n\
        \                        \"healthy\",\n                        \"degraded\",\n                        \"unavailable\"\
        \n                    ],\n                    \"description\": \"Component health status\"\n                },\n \
        \               \"lastSeen\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"Last successful connection time\"\n                },\n                \"\
        message\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n               \
        \     \"description\": \"Additional status information (null if no additional context needed)\"\n                },\n\
        \                \"metrics\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Component-specific metrics (e.g., ping time)\"\n                }\n\
        \            }\n        },\n        \"ResourceUsage\": {\n            \"description\": \"System resource utilization
        metrics including CPU, memory, disk, and network\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"properties\": {\n                \"cpuPercent\": {\n                    \"type\": \"number\"\
        ,\n                    \"format\": \"float\",\n                    \"description\": \"Total CPU usage percentage\"\
        \n                },\n                \"memoryUsedMb\": {\n                    \"type\": \"integer\",\n          \
        \          \"description\": \"Total memory used (MB)\"\n                },\n                \"memoryTotalMb\": {\n\
        \                    \"type\": \"integer\",\n                    \"description\": \"Total memory available (MB)\"\n\
        \                },\n                \"diskUsedGb\": {\n                    \"type\": \"number\",\n              \
        \      \"format\": \"float\",\n                    \"description\": \"Disk space used (GB)\"\n                },\n\
        \                \"networkInMb\": {\n                    \"type\": \"number\",\n                    \"format\": \"\
        float\",\n                    \"description\": \"Network input (MB)\"\n                },\n                \"networkOutMb\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"\
        description\": \"Network output (MB)\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get current environment status\",\n    \"description\": \"Returns comprehensive
        status of the current deployment including:\\n- Active backend and deployment configuration\\n- Service topology (which
        services on which containers)\\n- Container health and resource usage\\n- Infrastructure component status\\n- Active
        preset and any customizations\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"GetStatus\"\
        \n}"
  /orchestrator/teardown:
    post:
      summary: Tear down the current environment
      description: |
        Tears down all containers and services in the current deployment.
        Optionally preserves volumes and networks for faster redeployment.

        **Teardown Modes**:
        - `graceful`: Signal shutdown and wait for clean exit
        - `force`: Immediately stop all containers (SIGKILL)
        - `preserve-data`: Keep volumes and networks, only remove containers
      operationId: Teardown
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeardownRequest'
      responses:
        '200':
          description: Teardown completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeardownResponse'
        '500':
          description: Teardown failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TeardownRequest\"\
        ,\n    \"$defs\": {\n        \"TeardownRequest\": {\n            \"description\": \"Request to tear down a deployed
        environment with options for data preservation\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"properties\": {\n                \"dryRun\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": false,\n                    \"description\": \"When true, simulates teardown without
        actually stopping or removing containers.\\nReturns what would be torn down. ALWAYS use dryRun=true first to preview
        the impact.\\n\"\n                },\n                \"mode\": {\n                    \"$ref\": \"#/$defs/TeardownMode\"\
        ,\n                    \"default\": \"graceful\",\n                    \"description\": \"How the teardown should
        be performed\"\n                },\n                \"timeout\": {\n                    \"type\": \"integer\",\n \
        \                   \"default\": 60,\n                    \"description\": \"Graceful shutdown timeout in seconds\"\
        \n                },\n                \"removeVolumes\": {\n                    \"type\": \"boolean\",\n         \
        \           \"default\": false,\n                    \"description\": \"Also remove associated volumes\"\n       \
        \         },\n                \"removeNetworks\": {\n                    \"type\": \"boolean\",\n                \
        \    \"default\": false,\n                    \"description\": \"Also remove associated networks\"\n             \
        \   },\n                \"includeInfrastructure\": {\n                    \"type\": \"boolean\",\n               \
        \     \"default\": false,\n                    \"description\": \"When true, also removes support infrastructure (Redis,
        RabbitMQ, MySQL, etc.).\\nThis is determined by scanning compose files or finding containers in the same\\nDocker
        swarm/Kubernetes namespace as bannou services. USE WITH EXTREME CAUTION -\\nthis will destroy all data and require
        a full re-deployment.\\n\"\n                }\n            }\n        },\n        \"TeardownMode\": {\n          \
        \  \"type\": \"string\",\n            \"enum\": [\n                \"graceful\",\n                \"force\",\n   \
        \             \"preserve-data\"\n            ],\n            \"description\": \"Teardown mode:\\n- graceful: Signal
        shutdown, wait for clean exit\\n- force: Immediately stop (SIGKILL)\\n- preserve-data: Keep volumes/networks, remove
        containers\\n\"\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TeardownResponse\"\
        ,\n    \"$defs\": {\n        \"TeardownResponse\": {\n            \"description\": \"Result of an environment teardown
        including removed resources and any errors\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\",\n                \"duration\"\n            ],\n\
        \            \"properties\": {\n                \"success\": {\n                    \"type\": \"boolean\",\n     \
        \               \"description\": \"Whether teardown completed successfully\"\n                },\n               \
        \ \"duration\": {\n                    \"type\": \"string\",\n                    \"description\": \"Time taken to
        complete teardown\"\n                },\n                \"stoppedContainers\": {\n                    \"type\": \"\
        array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n\
        \                    \"description\": \"Container IDs that were stopped\"\n                },\n                \"\
        removedVolumes\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"description\": \"Volumes that were removed\"\
        \n                },\n                \"removedNetworks\": {\n                    \"type\": \"array\",\n         \
        \           \"items\": {\n                        \"type\": \"string\"\n                    },\n                 \
        \   \"description\": \"Networks that were removed\"\n                },\n                \"removedInfrastructure\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"description\": \"Infrastructure services that were removed
        (Redis, RabbitMQ, MySQL, etc.)\"\n                },\n                \"errors\": {\n                    \"type\"\
        : \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                   \
        \ },\n                    \"description\": \"Non-fatal errors during teardown\"\n                },\n            \
        \    \"message\": {\n                    \"type\": \"string\",\n                    \"description\": \"Human-readable
        teardown summary\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Tear down the current environment\",\n    \"description\": \"Tears down
        all containers and services in the current deployment.\\nOptionally preserves volumes and networks for faster redeployment.\\
        n\\n**Teardown Modes**:\\n- `graceful`: Signal shutdown and wait for clean exit\\n- `force`: Immediately stop all
        containers (SIGKILL)\\n- `preserve-data`: Keep volumes and networks, only remove containers\\n\",\n    \"tags\": [],\n\
        \    \"deprecated\": false,\n    \"operationId\": \"Teardown\"\n}"
  /orchestrator/clean:
    post:
      summary: Clean up unused resources
      description: |
        Prunes unused Docker resources to reclaim disk space and clean up
        orphaned containers, networks, volumes, and images.

        Equivalent to running various `docker system prune` commands.

        **Clean Targets**:
        - `containers`: Remove stopped containers
        - `networks`: Remove unused networks
        - `volumes`: Remove unused volumes (CAUTION: data loss)
        - `images`: Remove dangling images
        - `all`: All of the above
      operationId: Clean
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CleanRequest'
      responses:
        '200':
          description: Cleanup completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CleanResponse'
        '500':
          description: Cleanup failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CleanRequest\"\
        ,\n    \"$defs\": {\n        \"CleanRequest\": {\n            \"description\": \"Request to clean up Docker resources
        such as containers, volumes, and images\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"targets\"\n            ],\n            \"properties\": {\n\
        \                \"targets\": {\n                    \"type\": \"array\",\n                    \"items\": {\n    \
        \                    \"$ref\": \"#/$defs/CleanTarget\"\n                    },\n                    \"description\"\
        : \"Resources to clean (or \\\"all\\\")\"\n                },\n                \"force\": {\n                    \"\
        type\": \"boolean\",\n                    \"default\": false,\n                    \"description\": \"Force removal
        without confirmation\"\n                },\n                \"olderThan\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Only clean resources older than
        (e.g., \\\"24h\\\", \\\"7d\\\")\"\n                },\n                \"labelFilter\": {\n                    \"\
        type\": \"object\",\n                    \"additionalProperties\": {\n                        \"type\": \"string\"\
        \n                    },\n                    \"nullable\": true,\n                    \"description\": \"Only clean
        resources matching labels\"\n                }\n            }\n        },\n        \"CleanTarget\": {\n          \
        \  \"type\": \"string\",\n            \"enum\": [\n                \"containers\",\n                \"networks\",\n\
        \                \"volumes\",\n                \"images\",\n                \"all\"\n            ],\n            \"\
        description\": \"Type of resource to clean\"\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CleanResponse\"\
        ,\n    \"$defs\": {\n        \"CleanResponse\": {\n            \"description\": \"Result of a cleanup operation including
        reclaimed space and removed resource counts\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\"\n            ],\n            \"properties\": {\n\
        \                \"success\": {\n                    \"type\": \"boolean\",\n                    \"description\":
        \"Whether cleanup completed successfully\"\n                },\n                \"reclaimedSpaceMb\": {\n        \
        \            \"type\": \"integer\",\n                    \"description\": \"Disk space reclaimed (MB)\"\n        \
        \        },\n                \"removedContainers\": {\n                    \"type\": \"integer\",\n              \
        \      \"description\": \"Number of containers removed\"\n                },\n                \"removedNetworks\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of networks removed\"\
        \n                },\n                \"removedVolumes\": {\n                    \"type\": \"integer\",\n        \
        \            \"description\": \"Number of volumes removed\"\n                },\n                \"removedImages\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of images removed\"\
        \n                },\n                \"errors\": {\n                    \"type\": \"array\",\n                  \
        \  \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\"\
        : \"Non-fatal errors during cleanup\"\n                },\n                \"message\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Human-readable cleanup summary\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Clean up unused resources\",\n    \"description\": \"Prunes unused Docker
        resources to reclaim disk space and clean up\\norphaned containers, networks, volumes, and images.\\n\\nEquivalent
        to running various `docker system prune` commands.\\n\\n**Clean Targets**:\\n- `containers`: Remove stopped containers\\
        n- `networks`: Remove unused networks\\n- `volumes`: Remove unused volumes (CAUTION: data loss)\\n- `images`: Remove
        dangling images\\n- `all`: All of the above\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"Clean\"\n}"
  /orchestrator/logs:
    post:
      summary: Get service/container logs
      description: |
        Retrieves logs from services or containers with filtering options.
        Supports real-time streaming via WebSocket upgrade.
      operationId: GetLogs
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetLogsRequest'
      responses:
        '200':
          description: Log output
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogsResponse'
            text/plain:
              schema:
                type: string
        '101':
          description: Switching to WebSocket for streaming (when follow=true)
        '404':
          description: Service or container not found

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetLogsRequest\"\
        ,\n    \"$defs\": {\n        \"GetLogsRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get service/container logs\",\n            \"properties\": {\n\
        \                \"service\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Service name to get logs for\",\n                    \"nullable\": true\n                },\n                \"container\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Container ID or name (alternative
        to service)\",\n                    \"nullable\": true\n                },\n                \"since\": {\n       \
        \             \"type\": \"string\",\n                    \"description\": \"Return logs since timestamp (RFC3339 or
        relative like \\\"5m\\\")\",\n                    \"nullable\": true\n                },\n                \"until\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Return logs until timestamp\"\
        ,\n                    \"nullable\": true\n                },\n                \"tail\": {\n                    \"\
        type\": \"integer\",\n                    \"default\": 100,\n                    \"description\": \"Number of lines
        from end of logs\"\n                },\n                \"follow\": {\n                    \"type\": \"boolean\",\n\
        \                    \"default\": false,\n                    \"description\": \"Stream logs in real-time (WebSocket
        upgrade)\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/LogsResponse\"\
        ,\n    \"$defs\": {\n        \"LogsResponse\": {\n            \"description\": \"Response containing log entries from
        a service or container\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n     \
        \       \"required\": [\n                \"logs\"\n            ],\n            \"properties\": {\n               \
        \ \"service\": {\n                    \"type\": \"string\",\n                    \"description\": \"Service name (if
        queried by service)\"\n                },\n                \"container\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Container ID/name\"\n                },\n                \"logs\": {\n \
        \                   \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/LogEntry\"\
        \n                    },\n                    \"description\": \"Log entries matching the query\"\n              \
        \  },\n                \"truncated\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether output was truncated\"\n                }\n            }\n        },\n        \"LogEntry\": {\n      \
        \      \"description\": \"A single log entry with timestamp, stream, and message content\",\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n                \"timestamp\"\
        ,\n                \"message\"\n            ],\n            \"properties\": {\n                \"timestamp\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"\
        description\": \"When this log entry was recorded\"\n                },\n                \"stream\": {\n         \
        \           \"type\": \"string\",\n                    \"enum\": [\n                        \"stdout\",\n        \
        \                \"stderr\"\n                    ],\n                    \"description\": \"Output stream type (stdout
        or stderr)\"\n                },\n                \"message\": {\n                    \"type\": \"string\",\n    \
        \                \"description\": \"Log message content\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get service/container logs\",\n    \"description\": \"Retrieves logs from
        services or containers with filtering options.\\nSupports real-time streaming via WebSocket upgrade.\\n\",\n    \"\
        tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"GetLogs\"\n}"
  /orchestrator/topology:
    post:
      summary: Update service topology without full redeploy
      description: |
        Changes which services run on which containers without tearing down
        the entire environment. Enables live topology changes.

        **Use Cases**:
        - Move auth service to dedicated container for scaling
        - Consolidate services during low-traffic periods
        - Split services for debugging/isolation
        - Add new service nodes to running environment
      operationId: UpdateTopology
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TopologyUpdateRequest'
      responses:
        '200':
          description: Topology update applied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TopologyUpdateResponse'
        '400':
          description: Invalid topology configuration
        '409':
          description: Topology change conflicts with current state
        '500':
          description: Topology update failed

  # ============================================================================
  # CONTAINER MANAGEMENT APIs (Self-Service Restart Pattern)
  # ============================================================================

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TopologyUpdateRequest\"\
        ,\n    \"$defs\": {\n        \"TopologyUpdateRequest\": {\n            \"description\": \"Request to apply incremental
        changes to the current service topology\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"changes\"\n            ],\n            \"properties\": {\n\
        \                \"changes\": {\n                    \"type\": \"array\",\n                    \"items\": {\n    \
        \                    \"$ref\": \"#/$defs/TopologyChange\"\n                    },\n                    \"description\"\
        : \"List of topology changes to apply\"\n                },\n                \"mode\": {\n                    \"$ref\"\
        : \"#/$defs/DeploymentMode\",\n                    \"default\": \"graceful\",\n                    \"description\"\
        : \"How the topology update should be performed\"\n                },\n                \"timeout\": {\n          \
        \          \"type\": \"integer\",\n                    \"default\": 120,\n                    \"description\": \"\
        Timeout for topology update\"\n                }\n            }\n        },\n        \"TopologyChange\": {\n     \
        \       \"description\": \"A single topology modification such as adding a node, moving a service, or scaling\",\n\
        \            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n  \
        \              \"action\"\n            ],\n            \"properties\": {\n                \"action\": {\n        \
        \            \"type\": \"string\",\n                    \"enum\": [\n                        \"add-node\",\n     \
        \                   \"remove-node\",\n                        \"move-service\",\n                        \"scale\"\
        ,\n                        \"update-env\"\n                    ],\n                    \"description\": \"Type of
        topology change\"\n                },\n                \"nodeName\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Target node name\"\n                },\n                \"services\": {\n\
        \                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"\
        string\"\n                    },\n                    \"description\": \"Services affected by this change\"\n    \
        \            },\n                \"replicas\": {\n                    \"type\": \"integer\",\n                   \
        \ \"description\": \"New replica count (for scale action)\"\n                },\n                \"environment\":
        {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                  \
        \      \"type\": \"string\"\n                    },\n                    \"description\": \"Environment updates (for
        update-env action)\"\n                },\n                \"nodeConfig\": {\n                    \"$ref\": \"#/$defs/TopologyNode\"\
        ,\n                    \"description\": \"Full node config (for add-node action)\"\n                }\n          \
        \  }\n        },\n        \"TopologyNode\": {\n            \"description\": \"A container or pod in the service topology
        with its assigned services and configuration\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"name\",\n                \"services\"\n            ],\n \
        \           \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n          \
        \          \"description\": \"Node/container name (e.g., \\\"bannou-main\\\", \\\"bannou-auth\\\")\"\n           \
        \     },\n                \"services\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Services enabled on this node.\\nUses {SERVICE}_SERVICE_ENABLED=true pattern.\\nExample: [\\\"account\\\", \\\"auth\\\
        \", \\\"permission\\\"]\\n\"\n                },\n                \"replicas\": {\n                    \"type\": \"\
        integer\",\n                    \"default\": 1,\n                    \"description\": \"Number of replicas for this
        node\"\n                },\n                \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\"\
        ,\n                    \"description\": \"Resource limits and requests for this node\"\n                },\n     \
        \           \"environment\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Node-specific environment overrides\"\n                },\n                \"meshEnabled\": {\n                  \
        \  \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether
        mesh routing is enabled\"\n                },\n                \"appId\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"App-id override for mesh routing (default derives from node name)\"\n  \
        \              }\n            }\n        },\n        \"ResourceLimits\": {\n            \"type\": \"object\",\n  \
        \          \"additionalProperties\": false,\n            \"description\": \"Resource limits and requests for container
        scheduling\",\n            \"properties\": {\n                \"cpuLimit\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"CPU limit (e.g., \\\"0.5\\\", \\\"2\\\")\"\n                },\n       \
        \         \"memoryLimit\": {\n                    \"type\": \"string\",\n                    \"description\": \"Memory
        limit (e.g., \\\"512m\\\", \\\"2g\\\")\"\n                },\n                \"cpuRequest\": {\n                \
        \    \"type\": \"string\",\n                    \"description\": \"CPU request (Kubernetes)\"\n                },\n\
        \                \"memoryRequest\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Memory request (Kubernetes)\"\n                }\n            }\n        },\n        \"DeploymentMode\": {\n \
        \           \"type\": \"string\",\n            \"enum\": [\n                \"graceful\",\n                \"force\"\
        ,\n                \"clean\"\n            ],\n            \"description\": \"Deployment mode:\\n- graceful: Wait for
        connections to drain\\n- force: Apply immediately\\n- clean: Tear down and rebuild\\n\"\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TopologyUpdateResponse\"\
        ,\n    \"$defs\": {\n        \"TopologyUpdateResponse\": {\n            \"description\": \"Result of a topology update
        including applied changes and the new topology state\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\",\n                \"appliedChanges\"\n        \
        \    ],\n            \"properties\": {\n                \"success\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether all topology changes were applied successfully\"\n             \
        \   },\n                \"appliedChanges\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/AppliedChange\"\n                    },\n                    \"description\"\
        : \"Details of each applied change\"\n                },\n                \"topology\": {\n                    \"\
        $ref\": \"#/$defs/ServiceTopology\",\n                    \"description\": \"New topology after changes\"\n      \
        \          },\n                \"duration\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Time taken to apply topology changes\"\n                },\n                \"warnings\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\
        \n                    },\n                    \"description\": \"Non-fatal warnings during topology update\"\n   \
        \             },\n                \"message\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Human-readable update summary\"\n                }\n            }\n        },\n        \"AppliedChange\"\
        : {\n            \"description\": \"Details of a single topology change that was applied, including success status\"\
        ,\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n\
        \                \"action\",\n                \"success\"\n            ],\n            \"properties\": {\n       \
        \         \"action\": {\n                    \"type\": \"string\",\n                    \"description\": \"Type of
        topology change that was applied\"\n                },\n                \"target\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Node or service affected\"\n                },\n           \
        \     \"success\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this
        specific change was applied successfully\"\n                },\n                \"error\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"Error message if failed\"\n                }\n   \
        \         }\n        },\n        \"ServiceTopology\": {\n            \"description\": \"Service distribution topology
        defining which services run on which nodes\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"nodes\"\n            ],\n            \"properties\": {\n\
        \                \"nodes\": {\n                    \"type\": \"array\",\n                    \"items\": {\n      \
        \                  \"$ref\": \"#/$defs/TopologyNode\"\n                    },\n                    \"description\"\
        : \"Container/pod definitions with service assignments\"\n                },\n                \"infrastructure\":
        {\n                    \"$ref\": \"#/$defs/InfrastructureConfig\",\n                    \"description\": \"Infrastructure
        service configuration\"\n                }\n            }\n        },\n        \"TopologyNode\": {\n            \"\
        description\": \"A container or pod in the service topology with its assigned services and configuration\",\n    \
        \        \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n      \
        \          \"name\",\n                \"services\"\n            ],\n            \"properties\": {\n              \
        \  \"name\": {\n                    \"type\": \"string\",\n                    \"description\": \"Node/container name
        (e.g., \\\"bannou-main\\\", \\\"bannou-auth\\\")\"\n                },\n                \"services\": {\n        \
        \            \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n\
        \                    },\n                    \"description\": \"Services enabled on this node.\\nUses {SERVICE}_SERVICE_ENABLED=true
        pattern.\\nExample: [\\\"account\\\", \\\"auth\\\", \\\"permission\\\"]\\n\"\n                },\n               \
        \ \"replicas\": {\n                    \"type\": \"integer\",\n                    \"default\": 1,\n             \
        \       \"description\": \"Number of replicas for this node\"\n                },\n                \"resources\":
        {\n                    \"$ref\": \"#/$defs/ResourceLimits\",\n                    \"description\": \"Resource limits
        and requests for this node\"\n                },\n                \"environment\": {\n                    \"type\"\
        : \"object\",\n                    \"additionalProperties\": {\n                        \"type\": \"string\"\n   \
        \                 },\n                    \"description\": \"Node-specific environment overrides\"\n             \
        \   },\n                \"meshEnabled\": {\n                    \"type\": \"boolean\",\n                    \"default\"\
        : true,\n                    \"description\": \"Whether mesh routing is enabled\"\n                },\n          \
        \      \"appId\": {\n                    \"type\": \"string\",\n                    \"description\": \"App-id override
        for mesh routing (default derives from node name)\"\n                }\n            }\n        },\n        \"ResourceLimits\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Resource limits and requests for container scheduling\",\n            \"properties\": {\n                \"cpuLimit\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"CPU limit (e.g., \\\"0.5\\\"\
        , \\\"2\\\")\"\n                },\n                \"memoryLimit\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Memory limit (e.g., \\\"512m\\\", \\\"2g\\\")\"\n                },\n    \
        \            \"cpuRequest\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        CPU request (Kubernetes)\"\n                },\n                \"memoryRequest\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Memory request (Kubernetes)\"\n                }\n         \
        \   }\n        },\n        \"InfrastructureConfig\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Configuration for infrastructure services\",\n            \"properties\"\
        : {\n                \"redis\": {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\",\n               \
        \     \"description\": \"Redis configuration\"\n                },\n                \"rabbitmq\": {\n            \
        \        \"$ref\": \"#/$defs/InfraServiceConfig\",\n                    \"description\": \"RabbitMQ configuration\"\
        \n                },\n                \"mysql\": {\n                    \"$ref\": \"#/$defs/InfraServiceConfig\",\n\
        \                    \"description\": \"MySQL configuration\"\n                },\n                \"ingress\": {\n\
        \                    \"$ref\": \"#/$defs/IngressConfig\",\n                    \"description\": \"Ingress/reverse
        proxy configuration\"\n                }\n            }\n        },\n        \"InfraServiceConfig\": {\n         \
        \   \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Configuration
        for an infrastructure service\",\n            \"properties\": {\n                \"enabled\": {\n                \
        \    \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether
        this infrastructure service is enabled\"\n                },\n                \"image\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Docker image override\"\n                },\n        \
        \        \"resources\": {\n                    \"$ref\": \"#/$defs/ResourceLimits\",\n                    \"description\"\
        : \"Resource limits and requests\"\n                },\n                \"environment\": {\n                    \"\
        type\": \"object\",\n                    \"additionalProperties\": {\n                        \"type\": \"string\"\
        \n                    },\n                    \"description\": \"Environment variables for this service\"\n      \
        \          },\n                \"volumes\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Volume mounts\"\n                }\n            }\n        },\n        \"IngressConfig\": {\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Ingress/reverse proxy
        configuration\",\n            \"properties\": {\n                \"enabled\": {\n                    \"type\": \"\
        boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether ingress is enabled\"\
        \n                },\n                \"type\": {\n                    \"type\": \"string\",\n                   \
        \ \"enum\": [\n                        \"openresty\",\n                        \"nginx\",\n                      \
        \  \"traefik\",\n                        \"none\"\n                    ],\n                    \"default\": \"openresty\"\
        ,\n                    \"description\": \"Type of ingress/reverse proxy to use\"\n                },\n           \
        \     \"ports\": {\n                    \"description\": \"Port configuration for HTTP and HTTPS traffic\",\n    \
        \                \"$ref\": \"#/$defs/Ports\"\n                },\n                \"ssl\": {\n                   \
        \ \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\": \"Whether
        SSL/TLS is enabled\"\n                }\n            }\n        },\n        \"Ports\": {\n            \"type\": \"\
        object\",\n            \"additionalProperties\": false,\n            \"description\": \"Port configuration for ingress
        specifying HTTP and HTTPS port numbers\",\n            \"properties\": {\n                \"http\": {\n          \
        \          \"type\": \"integer\",\n                    \"default\": 80,\n                    \"description\": \"HTTP
        port number\"\n                },\n                \"https\": {\n                    \"type\": \"integer\",\n    \
        \                \"default\": 443,\n                    \"description\": \"HTTPS port number\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Update service topology without full redeploy\",\n    \"description\":
        \"Changes which services run on which containers without tearing down\\nthe entire environment. Enables live topology
        changes.\\n\\n**Use Cases**:\\n- Move auth service to dedicated container for scaling\\n- Consolidate services during
        low-traffic periods\\n- Split services for debugging/isolation\\n- Add new service nodes to running environment\\\
        n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"UpdateTopology\"\n}"
  /orchestrator/containers/request-restart:
    post:
      summary: Request container restart (self-service pattern)
      description: |
        Plugins call this endpoint to request restart of their own container.
        This is part of the self-service configuration update pattern where
        plugins decide if they care about config changes and request restarts.

        **Flow**:
        1. Orchestrator publishes ConfigurationChangedEvent with changed keys
        2. Plugins check if any changed keys match their dependencies
        3. Plugins that care call this endpoint to request restart
        4. Orchestrator performs rolling restart of requested containers

        **Priority Levels**:
        - `graceful`: Rolling update, wait for healthy before cycling next instance
        - `immediate`: Rolling update but don't wait for connection drain
        - `force`: Kill all instances simultaneously (causes downtime)
      operationId: RequestContainerRestart
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContainerRestartRequestBody'
      responses:
        '200':
          description: Restart request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerRestartResponse'
        '400':
          description: Invalid restart request
        '404':
          description: Container not found

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ContainerRestartRequestBody\"\
        ,\n    \"$defs\": {\n        \"ContainerRestartRequestBody\": {\n            \"description\": \"Request body for restarting
        a container by its app-id\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n  \
        \          \"required\": [\n                \"appName\",\n                \"reason\"\n            ],\n           \
        \ \"properties\": {\n                \"appName\": {\n                    \"type\": \"string\",\n                 \
        \   \"description\": \"Container's app-id for mesh routing (e.g., \\\"bannou\\\", \\\"npc-omega\\\")\"\n         \
        \       },\n                \"reason\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Why restart is needed (for logging/auditing)\",\n                    \"example\": \"configuration_change\"\n \
        \               },\n                \"priority\": {\n                    \"$ref\": \"#/$defs/RestartPriority\",\n\
        \                    \"description\": \"Urgency level for the restart\"\n                },\n                \"shutdownGracePeriod\"\
        : {\n                    \"type\": \"integer\",\n                    \"default\": 30,\n                    \"description\"\
        : \"Seconds to allow graceful shutdown before force-kill\"\n                }\n            }\n        },\n       \
        \ \"RestartPriority\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"graceful\"\
        ,\n                \"immediate\",\n                \"force\"\n            ],\n            \"description\": \"Restart
        urgency level:\\n- graceful: Rolling update, wait for healthy before cycling next instance\\n- immediate: Rolling
        update but don't wait for connection drain\\n- force: Kill all instances simultaneously (causes downtime)\\n\"\n \
        \       }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ContainerRestartResponse\"\
        ,\n    \"$defs\": {\n        \"ContainerRestartResponse\": {\n            \"description\": \"Response after accepting
        a container restart request with scheduling details\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"accepted\",\n                \"appName\"\n            ],\n\
        \            \"properties\": {\n                \"accepted\": {\n                    \"type\": \"boolean\",\n    \
        \                \"description\": \"Whether the restart request was accepted\"\n                },\n             \
        \   \"appName\": {\n                    \"type\": \"string\",\n                    \"description\": \"Container that
        will be restarted\"\n                },\n                \"scheduledFor\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"When restart is scheduled
        (may be queued)\"\n                },\n                \"currentInstances\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Number of running instances\"\n                },\n                \"restartStrategy\"\
        : {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"rolling\"\
        ,\n                        \"simultaneous\"\n                    ],\n                    \"description\": \"How restart
        will be performed\"\n                },\n                \"message\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Additional information\"\n                }\n            }\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Request container restart (self-service pattern)\",\n    \"description\"\
        : \"Plugins call this endpoint to request restart of their own container.\\nThis is part of the self-service configuration
        update pattern where\\nplugins decide if they care about config changes and request restarts.\\n\\n**Flow**:\\n1.
        Orchestrator publishes ConfigurationChangedEvent with changed keys\\n2. Plugins check if any changed keys match their
        dependencies\\n3. Plugins that care call this endpoint to request restart\\n4. Orchestrator performs rolling restart
        of requested containers\\n\\n**Priority Levels**:\\n- `graceful`: Rolling update, wait for healthy before cycling
        next instance\\n- `immediate`: Rolling update but don't wait for connection drain\\n- `force`: Kill all instances
        simultaneously (causes downtime)\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"RequestContainerRestart\"\
        \n}"
  /orchestrator/containers/status:
    post:
      summary: Get container health and restart history
      description: |
        Returns detailed status of a container including health, restart history,
        running plugins, and current configuration.
      operationId: GetContainerStatus
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetContainerStatusRequest'
      responses:
        '200':
          description: Container status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerStatus'
        '404':
          description: Container not found

  # ============================================================================
  # CONFIGURATION MANAGEMENT APIs
  # ============================================================================

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetContainerStatusRequest\"\
        ,\n    \"$defs\": {\n        \"GetContainerStatusRequest\": {\n            \"description\": \"Request to retrieve
        the current status of a specific container\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"appName\"\n            ],\n            \"properties\": {\n\
        \                \"appName\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Container's app-id for mesh routing\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ContainerStatus\"\
        ,\n    \"$defs\": {\n        \"ContainerStatus\": {\n            \"description\": \"Current status of a container
        including health, restart history, and running plugins\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"appName\",\n                \"status\",\n               \
        \ \"timestamp\"\n            ],\n            \"properties\": {\n                \"appName\": {\n                 \
        \   \"type\": \"string\",\n                    \"description\": \"Container's app-id for mesh routing\"\n        \
        \        },\n                \"status\": {\n                    \"type\": \"string\",\n                    \"enum\"\
        : [\n                        \"running\",\n                        \"starting\",\n                        \"stopping\"\
        ,\n                        \"stopped\",\n                        \"unhealthy\"\n                    ],\n         \
        \           \"description\": \"Current container status\"\n                },\n                \"timestamp\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"\
        description\": \"When this status was captured\"\n                },\n                \"instances\": {\n         \
        \           \"type\": \"integer\",\n                    \"description\": \"Number of running instances\"\n       \
        \         },\n                \"plugins\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"\
        Plugins running in this container\"\n                },\n                \"lastRestart\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When container
        was last restarted\"\n                },\n                \"restartCount\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Number of restarts in last 24 hours\"\n                },\n            \
        \    \"restartHistory\": {\n                    \"type\": \"array\",\n                    \"items\": {\n         \
        \               \"$ref\": \"#/$defs/RestartHistoryEntry\"\n                    },\n                    \"description\"\
        : \"Recent restart history\"\n                },\n                \"healthChecks\": {\n                    \"description\"\
        : \"Health check configuration and current health status results\",\n                    \"$ref\": \"#/$defs/HealthChecks\"\
        \n                },\n                \"labels\": {\n                    \"type\": \"object\",\n                 \
        \   \"additionalProperties\": {\n                        \"type\": \"string\"\n                    },\n          \
        \          \"description\": \"Container labels for metadata and management\"\n                }\n            }\n \
        \       },\n        \"RestartHistoryEntry\": {\n            \"description\": \"Record of a past container restart
        including reason, timing, and outcome\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"timestamp\",\n                \"reason\"\n            ],\n\
        \            \"properties\": {\n                \"timestamp\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"date-time\",\n                    \"description\": \"When the restart occurred\"\n\
        \                },\n                \"reason\": {\n                    \"type\": \"string\",\n                  \
        \  \"description\": \"Why the restart was triggered\"\n                },\n                \"priority\": {\n     \
        \               \"$ref\": \"#/$defs/RestartPriority\",\n                    \"description\": \"Priority level used
        for the restart\"\n                },\n                \"duration\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Time taken to restart\"\n                },\n                \"success\":
        {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether the restart completed
        successfully\"\n                },\n                \"error\": {\n                    \"type\": \"string\",\n    \
        \                \"description\": \"Error message if restart failed\"\n                }\n            }\n        },\n\
        \        \"RestartPriority\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"graceful\"\
        ,\n                \"immediate\",\n                \"force\"\n            ],\n            \"description\": \"Restart
        urgency level:\\n- graceful: Rolling update, wait for healthy before cycling next instance\\n- immediate: Rolling
        update but don't wait for connection drain\\n- force: Kill all instances simultaneously (causes downtime)\\n\"\n \
        \       },\n        \"HealthChecks\": {\n            \"type\": \"object\",\n            \"additionalProperties\":
        false,\n            \"description\": \"Health check information for a container including last check status and failure
        tracking\",\n            \"properties\": {\n                \"lastCheck\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"When the last health check
        was performed\"\n                },\n                \"status\": {\n                    \"type\": \"string\",\n  \
        \                  \"description\": \"Result of the last health check\"\n                },\n                \"consecutiveFailures\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of consecutive health
        check failures\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get container health and restart history\",\n    \"description\": \"Returns
        detailed status of a container including health, restart history,\\nrunning plugins, and current configuration.\\\
        n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"GetContainerStatus\"\n}"
  /orchestrator/config/rollback:
    post:
      summary: Rollback to previous configuration
      description: |
        Quickly rollback to the previous configuration without waiting for CI.
        Swaps currentConfig with previousConfig and publishes ConfigurationChangedEvent
        with the reverted keys so services can request restart.

        **Note**: This is a quick fix. GitHub secrets should still be corrected
        to prevent re-breaking on next orchestrator deploy.
      operationId: RollbackConfiguration
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigRollbackRequest'
      responses:
        '200':
          description: Rollback completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigRollbackResponse'
        '400':
          description: No previous configuration to rollback to
        '500':
          description: Rollback failed

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConfigRollbackRequest\"\
        ,\n    \"$defs\": {\n        \"ConfigRollbackRequest\": {\n            \"description\": \"Request to rollback configuration
        to the previous version\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n    \
        \        \"required\": [\n                \"reason\"\n            ],\n            \"properties\": {\n            \
        \    \"reason\": {\n                    \"type\": \"string\",\n                    \"description\": \"Why rollback
        is needed (for auditing)\",\n                    \"example\": \"auth.jwt_secret broke authentication\"\n         \
        \       }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConfigRollbackResponse\"\
        ,\n    \"$defs\": {\n        \"ConfigRollbackResponse\": {\n            \"description\": \"Result of a configuration
        rollback including version changes and affected keys\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"success\",\n                \"previousVersion\",\n      \
        \          \"currentVersion\"\n            ],\n            \"properties\": {\n                \"success\": {\n   \
        \                 \"type\": \"boolean\",\n                    \"description\": \"Whether rollback completed successfully\"\
        \n                },\n                \"previousVersion\": {\n                    \"type\": \"integer\",\n       \
        \             \"description\": \"Config version before rollback\"\n                },\n                \"currentVersion\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Config version after rollback
        (now active)\"\n                },\n                \"changedKeys\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Keys that were reverted\"\n                },\n                \"message\": {\n  \
        \                  \"type\": \"string\",\n                    \"description\": \"Human-readable rollback summary\"\
        \n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Rollback to previous configuration\",\n    \"description\": \"Quickly rollback
        to the previous configuration without waiting for CI.\\nSwaps currentConfig with previousConfig and publishes ConfigurationChangedEvent\\
        nwith the reverted keys so services can request restart.\\n\\n**Note**: This is a quick fix. GitHub secrets should
        still be corrected\\nto prevent re-breaking on next orchestrator deploy.\\n\",\n    \"tags\": [],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"RollbackConfiguration\"\n}"
  /orchestrator/config/version:
    post:
      summary: Get current configuration version and metadata
      description: |
        Returns the current configuration version, last update time,
        and summary of configuration state (not actual values for security).
      operationId: GetConfigVersion
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetConfigVersionRequest'
      responses:
        '200':
          description: Configuration version info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigVersionResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetConfigVersionRequest\"\
        ,\n    \"$defs\": {\n        \"GetConfigVersionRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get configuration version (empty body allowed)\",\n          \
        \  \"properties\": {\n                \"includeKeyPrefixes\": {\n                    \"type\": \"boolean\",\n    \
        \                \"default\": true,\n                    \"description\": \"Include list of configuration key prefixes\"\
        \n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConfigVersionResponse\"\
        ,\n    \"$defs\": {\n        \"ConfigVersionResponse\": {\n            \"description\": \"Current configuration version
        information with metadata about available keys\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"version\",\n                \"timestamp\"\n            ],\n\
        \            \"properties\": {\n                \"version\": {\n                    \"type\": \"integer\",\n     \
        \               \"description\": \"Current configuration version number\"\n                },\n                \"\
        timestamp\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n      \
        \              \"description\": \"When current config was applied\"\n                },\n                \"hasPreviousConfig\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether a previous config
        is available for rollback\"\n                },\n                \"keyCount\": {\n                    \"type\": \"\
        integer\",\n                    \"description\": \"Number of configuration keys (not values for security)\"\n    \
        \            },\n                \"keyPrefixes\": {\n                    \"type\": \"array\",\n                  \
        \  \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\"\
        : \"Configuration key prefixes present (e.g., \\\"auth\\\", \\\"database\\\")\"\n                }\n            }\n\
        \        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get current configuration version and metadata\",\n    \"description\"\
        : \"Returns the current configuration version, last update time,\\nand summary of configuration state (not actual
        values for security).\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"GetConfigVersion\"\
        \n}"

  # ============================================================
  # PROCESSING POOL MANAGEMENT
  # Manage pools of dedicated processing instances for heavy operations
  # ============================================================

  /orchestrator/processing-pool/acquire:
    post:
      summary: Acquire a processor from a pool
      description: |
        Requests an available processor instance from the specified pool type.
        Returns the app-id of an available processor or 429 if none available.
        The processor is marked as busy until explicitly released.
      operationId: AcquireProcessor
      x-permissions:
      - role: service
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcquireProcessorRequest'
      responses:
        '200':
          description: Processor acquired successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcquireProcessorResponse'
        '429':
          description: No processors available (all busy or pool at capacity)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PoolBusyResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AcquireProcessorRequest\"\
        ,\n    \"$defs\": {\n        \"AcquireProcessorRequest\": {\n            \"description\": \"Request to acquire a processor
        instance from a processing pool\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"poolType\"\n            ],\n            \"properties\": {\n      \
        \          \"poolType\": {\n                    \"type\": \"string\",\n                    \"description\": \"Type
        of processing pool (e.g., \\\"asset-processor\\\", \\\"texture-processor\\\")\"\n                },\n            \
        \    \"priority\": {\n                    \"type\": \"integer\",\n                    \"default\": 0,\n          \
        \          \"description\": \"Request priority (higher = more urgent)\"\n                },\n                \"timeoutSeconds\"\
        : {\n                    \"type\": \"integer\",\n                    \"default\": 300,\n                    \"description\"\
        : \"How long the lease is valid for\"\n                },\n                \"metadata\": {\n                    \"\
        type\": \"object\",\n                    \"additionalProperties\": true,\n                    \"nullable\": true,\n\
        \                    \"description\": \"Optional metadata about the processing job (null if not needed)\"\n      \
        \          }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AcquireProcessorResponse\"\
        ,\n    \"$defs\": {\n        \"AcquireProcessorResponse\": {\n            \"description\": \"Response with acquired
        processor details including lease information\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"processorId\",\n                \"appId\",\n            \
        \    \"leaseId\",\n                \"expiresAt\"\n            ],\n            \"properties\": {\n                \"\
        processorId\": {\n                    \"type\": \"string\",\n                    \"description\": \"Unique identifier
        for this processor instance\"\n                },\n                \"appId\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"App-id for mesh service invocation to this processor\"\n       \
        \         },\n                \"leaseId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"description\": \"Unique lease identifier (used for release)\"\n               \
        \ },\n                \"expiresAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"description\": \"When the lease expires (must release before this)\"\n   \
        \             }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Acquire a processor from a pool\",\n    \"description\": \"Requests an
        available processor instance from the specified pool type.\\nReturns the app-id of an available processor or 429 if
        none available.\\nThe processor is marked as busy until explicitly released.\\n\",\n    \"tags\": [],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"AcquireProcessor\"\n}"
  /orchestrator/processing-pool/release:
    post:
      summary: Release a processor back to the pool
      description: |
        Releases a previously acquired processor, making it available for other requests.
        Should be called when processing is complete or on error cleanup.
      operationId: ReleaseProcessor
      x-permissions:
      - role: service
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReleaseProcessorRequest'
      responses:
        '200':
          description: Processor released successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseProcessorResponse'
        '404':
          description: Processor or lease not found

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReleaseProcessorRequest\"\
        ,\n    \"$defs\": {\n        \"ReleaseProcessorRequest\": {\n            \"description\": \"Request to release a processor
        back to the pool after processing completes\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"leaseId\"\n            ],\n            \"properties\": {\n\
        \                \"leaseId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"The lease ID returned from AcquireProcessor\"\n                },\n    \
        \            \"success\": {\n                    \"type\": \"boolean\",\n                    \"default\": true,\n\
        \                    \"description\": \"Whether the processing completed successfully\"\n                },\n    \
        \            \"metrics\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Optional processing metrics (duration, items processed, etc.)\"\n\
        \                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReleaseProcessorResponse\"\
        ,\n    \"$defs\": {\n        \"ReleaseProcessorResponse\": {\n            \"description\": \"Confirmation that a processor
        was released back to the pool\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"released\"\n            ],\n            \"properties\": {\n      \
        \          \"released\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether
        the processor was successfully released\"\n                },\n                \"processorId\": {\n              \
        \      \"type\": \"string\",\n                    \"description\": \"ID of the released processor\"\n            \
        \    }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Release a processor back to the pool\",\n    \"description\": \"Releases
        a previously acquired processor, making it available for other requests.\\nShould be called when processing is complete
        or on error cleanup.\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"ReleaseProcessor\"\
        \n}"
  /orchestrator/processing-pool/status:
    post:
      summary: Get processing pool status
      description: |
        Returns current status of a processing pool including:
        - Total instances (running and available)
        - Current utilization
        - Queue depth (waiting requests)
        - Recent processing metrics
      operationId: GetPoolStatus
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetPoolStatusRequest'
      responses:
        '200':
          description: Pool status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PoolStatusResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetPoolStatusRequest\"\
        ,\n    \"$defs\": {\n        \"GetPoolStatusRequest\": {\n            \"description\": \"Request to retrieve status
        and metrics for a processing pool\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"poolType\"\n            ],\n            \"properties\": {\n      \
        \          \"poolType\": {\n                    \"type\": \"string\",\n                    \"description\": \"Type
        of processing pool to query\"\n                },\n                \"includeMetrics\": {\n                    \"type\"\
        : \"boolean\",\n                    \"default\": true,\n                    \"description\": \"Include recent processing
        metrics\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/PoolStatusResponse\"\
        ,\n    \"$defs\": {\n        \"PoolStatusResponse\": {\n            \"description\": \"Current status of a processing
        pool including instance counts and utilization\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"poolType\",\n                \"totalInstances\",\n      \
        \          \"availableInstances\",\n                \"busyInstances\",\n                \"utilization\"\n        \
        \    ],\n            \"properties\": {\n                \"poolType\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Pool type\"\n                },\n                \"totalInstances\": {\n\
        \                    \"type\": \"integer\",\n                    \"description\": \"Total processor instances in the
        pool\"\n                },\n                \"availableInstances\": {\n                    \"type\": \"integer\",\n\
        \                    \"description\": \"Instances ready to accept work\"\n                },\n                \"busyInstances\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Instances currently processing\"\
        \n                },\n                \"queueDepth\": {\n                    \"type\": \"integer\",\n            \
        \        \"description\": \"Number of requests waiting for a processor\"\n                },\n                \"utilization\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"\
        description\": \"Current utilization percentage (0.0 to 1.0)\"\n                },\n                \"minInstances\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Minimum configured instances\"\
        \n                },\n                \"maxInstances\": {\n                    \"type\": \"integer\",\n          \
        \          \"description\": \"Maximum configured instances\"\n                },\n                \"scaleUpThreshold\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"\
        description\": \"Utilization threshold for auto-scale-up\"\n                },\n                \"recentMetrics\"\
        : {\n                    \"$ref\": \"#/$defs/PoolMetrics\",\n                    \"description\": \"Recent processing
        statistics\"\n                }\n            }\n        },\n        \"PoolMetrics\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Processing pool performance metrics\"\
        ,\n            \"properties\": {\n                \"jobsCompleted1h\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Jobs completed in the last hour\"\n                },\n                \"\
        jobsFailed1h\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Jobs failed
        in the last hour\"\n                },\n                \"avgProcessingTimeMs\": {\n                    \"type\":
        \"integer\",\n                    \"description\": \"Average processing time in milliseconds\"\n                },\n\
        \                \"lastScaleEvent\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"description\": \"When the pool was last scaled\"\n                }\n    \
        \        }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get processing pool status\",\n    \"description\": \"Returns current status
        of a processing pool including:\\n- Total instances (running and available)\\n- Current utilization\\n- Queue depth
        (waiting requests)\\n- Recent processing metrics\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"GetPoolStatus\"\n}"
  /orchestrator/processing-pool/scale:
    post:
      summary: Scale a processing pool
      description: |
        Manually adjust the size of a processing pool.
        Can scale up (add instances) or scale down (remove idle instances).
        Respects min/max constraints from pool configuration.
      operationId: ScalePool
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScalePoolRequest'
      responses:
        '200':
          description: Pool scaled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScalePoolResponse'
        '400':
          description: Invalid scale request (exceeds limits)

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ScalePoolRequest\"\
        ,\n    \"$defs\": {\n        \"ScalePoolRequest\": {\n            \"description\": \"Request to scale a processing
        pool to a target number of instances\",\n            \"type\": \"object\",\n            \"additionalProperties\":
        false,\n            \"required\": [\n                \"poolType\",\n                \"targetInstances\"\n        \
        \    ],\n            \"properties\": {\n                \"poolType\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Type of processing pool to scale\"\n                },\n               \
        \ \"targetInstances\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n      \
        \              \"description\": \"Desired number of instances\"\n                },\n                \"force\": {\n\
        \                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Force scale even if it would interrupt processing\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ScalePoolResponse\"\
        ,\n    \"$defs\": {\n        \"ScalePoolResponse\": {\n            \"description\": \"Result of a pool scaling operation
        with before and after instance counts\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"poolType\",\n                \"previousInstances\",\n   \
        \             \"currentInstances\"\n            ],\n            \"properties\": {\n                \"poolType\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Pool type that was scaled\"\n \
        \               },\n                \"previousInstances\": {\n                    \"type\": \"integer\",\n       \
        \             \"description\": \"Instance count before scaling\"\n                },\n                \"currentInstances\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Instance count after scaling\"\
        \n                },\n                \"scaledUp\": {\n                    \"type\": \"integer\",\n              \
        \      \"description\": \"Number of instances added\"\n                },\n                \"scaledDown\": {\n   \
        \                 \"type\": \"integer\",\n                    \"description\": \"Number of instances removed\"\n \
        \               },\n                \"message\": {\n                    \"type\": \"string\",\n                  \
        \  \"description\": \"Status message\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Scale a processing pool\",\n    \"description\": \"Manually adjust the
        size of a processing pool.\\nCan scale up (add instances) or scale down (remove idle instances).\\nRespects min/max
        constraints from pool configuration.\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"\
        ScalePool\"\n}"
  /orchestrator/processing-pool/cleanup:
    post:
      summary: Cleanup idle processing pool instances
      description: |
        Scales pool back to minimum instances by removing idle processors.
        Used for resource reclamation during low-activity periods.
      operationId: CleanupPool
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CleanupPoolRequest'
      responses:
        '200':
          description: Cleanup completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CleanupPoolResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CleanupPoolRequest\"\
        ,\n    \"$defs\": {\n        \"CleanupPoolRequest\": {\n            \"description\": \"Request to clean up idle processor
        instances from a pool\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n      \
        \      \"required\": [\n                \"poolType\"\n            ],\n            \"properties\": {\n            \
        \    \"poolType\": {\n                    \"type\": \"string\",\n                    \"description\": \"Type of processing
        pool to cleanup\"\n                },\n                \"preserveMinimum\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": true,\n                    \"description\": \"Keep at least minInstances running\"\
        \n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CleanupPoolResponse\"\
        ,\n    \"$defs\": {\n        \"CleanupPoolResponse\": {\n            \"description\": \"Result of a pool cleanup operation
        with removed instance count\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"poolType\",\n                \"instancesRemoved\"\n            ],\n\
        \            \"properties\": {\n                \"poolType\": {\n                    \"type\": \"string\",\n     \
        \               \"description\": \"Pool type that was cleaned up\"\n                },\n                \"instancesRemoved\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of idle instances removed\"\
        \n                },\n                \"currentInstances\": {\n                    \"type\": \"integer\",\n      \
        \              \"description\": \"Instance count after cleanup\"\n                },\n                \"message\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Status message\"\n        \
        \        }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Cleanup idle processing pool instances\",\n    \"description\": \"Scales
        pool back to minimum instances by removing idle processors.\\nUsed for resource reclamation during low-activity periods.\\\
        n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"CleanupPool\"\n}"
components:
  schemas:
    # Request Models for POST-only pattern
    InfrastructureHealthRequest:
      type: object
      additionalProperties: false
      description: Request to check infrastructure health (empty body allowed)
      properties:
        components:
          type: array
          items:
            type: string
          description: Optional filter for specific components (redis, rabbitmq, placement)
          nullable: true

    ServiceHealthRequest:
      type: object
      additionalProperties: false
      description: Request to get service health status (empty body allowed)
      properties:
        serviceFilter:
          type: string
          description: Optional filter by service name
          nullable: true

    GetServiceRoutingRequest:
      type: object
      additionalProperties: false
      description: Request to get service routing mappings (empty body allowed)
      properties:
        serviceFilter:
          type: string
          description: Optional filter by service name prefix
          nullable: true

    ServiceRoutingResponse:
      description: Response containing service-to-app-id routing mappings for mesh invocation
      type: object
      additionalProperties: false
      required:
      - mappings
      - defaultAppId
      - generatedAt
      properties:
        mappings:
          type: object
          additionalProperties:
            type: string
          description: |
            Map of service names to Bannou app-id routing destinations.
            Example: { "account": "bannou", "behavior": "npc-processing-01" }
        defaultAppId:
          type: string
          description: Default app-id used when no specific mapping exists
          default: "bannou"
        generatedAt:
          type: string
          format: date-time
          description: When this routing information was generated
        totalServices:
          type: integer
          description: Total number of services with routing mappings
          minimum: 0
        deploymentId:
          type: string
          description: Current deployment identifier (if environment is deployed)
          nullable: true

    ListBackendsRequest:
      type: object
      additionalProperties: false
      description: Request to list available backends (empty body allowed)
      properties:
        refresh:
          type: boolean
          default: false
          description: Force refresh detection instead of using cached results

    ListPresetsRequest:
      type: object
      additionalProperties: false
      description: Request to list available presets (empty body allowed)
      properties:
        category:
          type: string
          enum: [development, testing, production, custom]
          description: Optional filter by category
          nullable: true

    GetStatusRequest:
      type: object
      additionalProperties: false
      description: Request to get environment status (empty body allowed)
      properties:
        includeResources:
          type: boolean
          default: true
          description: Include resource usage metrics

    GetLogsRequest:
      type: object
      additionalProperties: false
      description: Request to get service/container logs
      properties:
        service:
          type: string
          description: Service name to get logs for
          nullable: true
        container:
          type: string
          description: Container ID or name (alternative to service)
          nullable: true
        since:
          type: string
          description: Return logs since timestamp (RFC3339 or relative like "5m")
          nullable: true
        until:
          type: string
          description: Return logs until timestamp
          nullable: true
        tail:
          type: integer
          default: 100
          description: Number of lines from end of logs
        follow:
          type: boolean
          default: false
          description: Stream logs in real-time (WebSocket upgrade)

    ContainerRestartRequestBody:
      description: Request body for restarting a container by its app-id
      type: object
      additionalProperties: false
      required:
      - appName
      - reason
      properties:
        appName:
          type: string
          description: Container's app-id for mesh routing (e.g., "bannou", "npc-omega")
        reason:
          type: string
          description: Why restart is needed (for logging/auditing)
          example: "configuration_change"
        priority:
          $ref: '#/components/schemas/RestartPriority'
          description: Urgency level for the restart
        shutdownGracePeriod:
          type: integer
          default: 30
          description: Seconds to allow graceful shutdown before force-kill

    GetContainerStatusRequest:
      description: Request to retrieve the current status of a specific container
      type: object
      additionalProperties: false
      required:
      - appName
      properties:
        appName:
          type: string
          description: Container's app-id for mesh routing

    GetConfigVersionRequest:
      type: object
      additionalProperties: false
      description: Request to get configuration version (empty body allowed)
      properties:
        includeKeyPrefixes:
          type: boolean
          default: true
          description: Include list of configuration key prefixes

    InfrastructureHealthResponse:
      description: Response containing overall infrastructure health status and individual component details
      type: object
      additionalProperties: false
      required:
      - healthy
      - timestamp
      - components
      properties:
        healthy:
          type: boolean
          description: Overall infrastructure health status
        timestamp:
          type: string
          format: date-time
          description: When health check was performed
        components:
          type: array
          items:
            $ref: '#/components/schemas/ComponentHealth'
          description: Individual component health status

    ComponentHealth:
      description: Health status information for a single infrastructure component (Redis, RabbitMQ, etc.)
      type: object
      additionalProperties: false
      required:
      - name
      - status
      - lastSeen
      properties:
        name:
          type: string
          description: Component name (redis, rabbitmq, placement)
        status:
          type: string
          enum: [healthy, degraded, unavailable]
          description: Component health status
        lastSeen:
          type: string
          format: date-time
          description: Last successful connection time
        message:
          type: string
          nullable: true
          description: Additional status information (null if no additional context needed)
        metrics:
          type: object
          additionalProperties: true
          description: Component-specific metrics (e.g., ping time)

    Capacity:
      type: object
      additionalProperties: false
      description: Service capacity metrics from heartbeat monitoring including connection counts and resource usage
      properties:
        maxConnections:
          type: integer
          description: Maximum number of connections this service can handle
        currentConnections:
          type: integer
          description: Current number of active connections
        cpuUsage:
          type: number
          format: float
          description: CPU usage as a percentage (0.0 to 1.0)
        memoryUsage:
          type: number
          format: float
          description: Memory usage as a percentage (0.0 to 1.0)

    HealthChecks:
      type: object
      additionalProperties: false
      description: Health check information for a container including last check status and failure tracking
      properties:
        lastCheck:
          type: string
          format: date-time
          description: When the last health check was performed
        status:
          type: string
          description: Result of the last health check
        consecutiveFailures:
          type: integer
          description: Number of consecutive health check failures

    ServiceHealthReport:
      description: Aggregated health report for all services based on heartbeat monitoring
      type: object
      additionalProperties: false
      required:
      - timestamp
      - totalServices
      - healthPercentage
      - healthyServices
      - unhealthyServices
      properties:
        timestamp:
          type: string
          format: date-time
          description: When report was generated
        totalServices:
          type: integer
          description: Total number of services
        healthPercentage:
          type: number
          format: float
          description: Percentage of healthy services (0-100)
        healthyServices:
          type: array
          items:
            $ref: '#/components/schemas/ServiceHealthStatus'
          description: Services with recent heartbeats
        unhealthyServices:
          type: array
          items:
            $ref: '#/components/schemas/ServiceHealthStatus'
          description: Services with expired heartbeats

    ServiceHealthStatus:
      type: object
      additionalProperties: false
      description: |
        Service health status from heartbeat monitoring.
        Uses ServiceHeartbeatEvent schema from common-events.yaml.
      required:
      - serviceId
      - appId
      - status
      - lastSeen
      properties:
        serviceId:
          type: string
          description: Service ID (e.g., "behavior", "account")
        appId:
          type: string
          description: App-id for mesh routing (e.g., "bannou", "npc-omega-01")
        status:
          type: string
          description: Service status from heartbeat
        lastSeen:
          type: string
          format: date-time
          description: Last heartbeat timestamp
        capacity:
          description: Current capacity metrics including load and available slots
          $ref: '#/components/schemas/Capacity'
          nullable: true
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional service metadata (null if not provided)

    TestExecutionRequest:
      type: object
      additionalProperties: false
      description: Request to execute a specific type of test
      required:
      - testType
      properties:
        testType:
          type: string
          enum: [infrastructure, http, edge]
          description: Type of tests to execute
        plugin:
          type: string
          description: Specific plugin to test (for http tests)
        configuration:
          type: object
          additionalProperties: true
          description: Additional test configuration parameters
        timeout:
          type: integer
          description: Test timeout in seconds (default 300)

    TestExecutionResult:
      description: Result of executing a test suite including overall status and individual test outcomes
      type: object
      additionalProperties: false
      required:
      - success
      - testType
      - duration
      properties:
        success:
          type: boolean
          description: Overall test success status
        testType:
          type: string
          description: Type of tests executed
        duration:
          type: string
          description: Total execution time
        results:
          type: array
          items:
            $ref: '#/components/schemas/TestResult'
          description: Individual test results
        summary:
          type: string
          description: Human-readable test summary
        error:
          type: string
          description: Error message if test execution failed

    TestResult:
      description: Outcome of a single test case including pass/fail status and optional error details
      type: object
      additionalProperties: false
      required:
      - name
      - passed
      properties:
        name:
          type: string
          description: Test name
        passed:
          type: boolean
          description: Test pass/fail status
        duration:
          type: string
          description: Test execution time
        message:
          type: string
          description: Test result message
        stackTrace:
          type: string
          description: Stack trace if test failed

    ServiceRestartRequest:
      description: Request to restart a specific service with optional configuration updates
      type: object
      additionalProperties: false
      required:
      - serviceName
      properties:
        serviceName:
          type: string
          description: Name of service to restart
        environment:
          type: object
          additionalProperties:
            type: string
          description: Optional environment variable updates
        force:
          type: boolean
          description: Force restart even if healthy (default false)
        timeout:
          type: integer
          description: Timeout for service to become healthy (seconds, default 120)

    ServiceRestartResult:
      description: Result of a service restart operation including timing and status information
      type: object
      additionalProperties: false
      required:
      - success
      - serviceName
      - duration
      properties:
        success:
          type: boolean
          description: Restart success status
        serviceName:
          type: string
          description: Service that was restarted
        duration:
          type: string
          description: Time taken to restart and become healthy
        previousStatus:
          type: string
          description: Service status before restart
        currentStatus:
          type: string
          description: Service status after restart
        message:
          type: string
          description: Restart result message

    ShouldRestartServiceRequest:
      description: Request to evaluate whether a service should be restarted based on health metrics
      type: object
      additionalProperties: false
      required:
      - serviceName
      properties:
        serviceName:
          type: string
          description: Name of service to evaluate

    RestartRecommendation:
      description: Recommendation on whether a service should be restarted with supporting rationale
      type: object
      additionalProperties: false
      required:
      - shouldRestart
      - serviceName
      - currentStatus
      - reason
      properties:
        shouldRestart:
          type: boolean
          description: Whether restart is recommended
        serviceName:
          type: string
          description: Service being evaluated
        currentStatus:
          type: string
          description: Current service health status
        lastSeen:
          type: string
          format: date-time
          description: Last heartbeat timestamp
        degradedDuration:
          type: string
          nullable: true
          description: How long service has been degraded (null if not degraded)
        reason:
          type: string
          description: Explanation for recommendation

    # ==========================================================================
    # ENVIRONMENT MANAGEMENT SCHEMAS
    # ==========================================================================

    BackendType:
      type: string
      enum: [kubernetes, portainer, swarm, compose]
      description: |
        Container orchestration backend type.
        Priority order: kubernetes > portainer > swarm > compose

    BackendInfo:
      description: Information about a container orchestration backend including availability and capabilities
      type: object
      additionalProperties: false
      required:
      - type
      - available
      - priority
      properties:
        type:
          $ref: '#/components/schemas/BackendType'
          description: Backend type identifier
        available:
          type: boolean
          description: Whether this backend is currently available
        priority:
          type: integer
          description: Selection priority (1 = highest)
        version:
          type: string
          description: Backend version (e.g., "1.28.0" for Docker)
        endpoint:
          type: string
          description: Backend API endpoint (if applicable)
        capabilities:
          type: array
          items:
            type: string
          description: |
            Supported capabilities for this backend:
            - live-topology: Can change service distribution without restart
            - scaling: Can scale services horizontally
            - rolling-update: Supports rolling deployments
            - secrets: Native secrets management
            - volumes: Persistent volume support
            - networks: Custom network creation
        error:
          type: string
          description: Error message if detection failed

    BackendsResponse:
      description: Response listing all detected container orchestration backends with recommended selection
      type: object
      additionalProperties: false
      required:
      - timestamp
      - backends
      - recommended
      properties:
        timestamp:
          type: string
          format: date-time
          description: When detection was performed
        backends:
          type: array
          items:
            $ref: '#/components/schemas/BackendInfo'
          description: All detected backends with status
        recommended:
          $ref: '#/components/schemas/BackendType'
          description: Highest priority available backend
        activeBackend:
          $ref: '#/components/schemas/BackendType'
          description: Currently active backend (if environment deployed)

    DeploymentPreset:
      description: Predefined deployment configuration defining service topology and environment settings
      type: object
      additionalProperties: false
      required:
      - name
      - description
      - topology
      properties:
        name:
          type: string
          description: Unique preset identifier (e.g., "local-development")
        description:
          type: string
          description: Human-readable preset description
        category:
          type: string
          enum: [development, testing, production, custom]
          description: Preset category
        topology:
          $ref: '#/components/schemas/ServiceTopology'
          description: Service topology defined by this preset
        environment:
          type: object
          additionalProperties:
            type: string
          description: Default environment variables for this preset
        requiredBackends:
          type: array
          items:
            $ref: '#/components/schemas/BackendType'
          description: Backends that support this preset (empty = all)
        builtIn:
          type: boolean
          description: Whether this is a built-in preset
        filePath:
          type: string
          description: Path to preset configuration file

    PresetsResponse:
      description: Response containing available deployment presets and the currently active preset
      type: object
      additionalProperties: false
      required:
      - presets
      properties:
        presets:
          type: array
          items:
            $ref: '#/components/schemas/DeploymentPreset'
          description: Available deployment presets
        activePreset:
          type: string
          description: Currently active preset name (if any)

    ServiceTopology:
      description: Service distribution topology defining which services run on which nodes
      type: object
      additionalProperties: false
      required:
      - nodes
      properties:
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/TopologyNode'
          description: Container/pod definitions with service assignments
        infrastructure:
          $ref: '#/components/schemas/InfrastructureConfig'
          description: Infrastructure service configuration

    TopologyNode:
      description: A container or pod in the service topology with its assigned services and configuration
      type: object
      additionalProperties: false
      required:
      - name
      - services
      properties:
        name:
          type: string
          description: Node/container name (e.g., "bannou-main", "bannou-auth")
        services:
          type: array
          items:
            type: string
          description: |
            Services enabled on this node.
            Uses {SERVICE}_SERVICE_ENABLED=true pattern.
            Example: ["account", "auth", "permission"]
        replicas:
          type: integer
          default: 1
          description: Number of replicas for this node
        resources:
          $ref: '#/components/schemas/ResourceLimits'
          description: Resource limits and requests for this node
        environment:
          type: object
          additionalProperties:
            type: string
          description: Node-specific environment overrides
        meshEnabled:
          type: boolean
          default: true
          description: Whether mesh routing is enabled
        appId:
          type: string
          description: App-id override for mesh routing (default derives from node name)

    InfrastructureConfig:
      type: object
      additionalProperties: false
      description: Configuration for infrastructure services
      properties:
        redis:
          $ref: '#/components/schemas/InfraServiceConfig'
          description: Redis configuration
        rabbitmq:
          $ref: '#/components/schemas/InfraServiceConfig'
          description: RabbitMQ configuration
        mysql:
          $ref: '#/components/schemas/InfraServiceConfig'
          description: MySQL configuration
        ingress:
          $ref: '#/components/schemas/IngressConfig'
          description: Ingress/reverse proxy configuration

    InfraServiceConfig:
      type: object
      additionalProperties: false
      description: Configuration for an infrastructure service
      properties:
        enabled:
          type: boolean
          default: true
          description: Whether this infrastructure service is enabled
        image:
          type: string
          description: Docker image override
        resources:
          $ref: '#/components/schemas/ResourceLimits'
          description: Resource limits and requests
        environment:
          type: object
          additionalProperties:
            type: string
          description: Environment variables for this service
        volumes:
          type: array
          items:
            type: string
          description: Volume mounts

    IngressConfig:
      type: object
      additionalProperties: false
      description: Ingress/reverse proxy configuration
      properties:
        enabled:
          type: boolean
          default: true
          description: Whether ingress is enabled
        type:
          type: string
          enum: [openresty, nginx, traefik, none]
          default: openresty
          description: Type of ingress/reverse proxy to use
        ports:
          description: Port configuration for HTTP and HTTPS traffic
          $ref: '#/components/schemas/Ports'
        ssl:
          type: boolean
          default: false
          description: Whether SSL/TLS is enabled

    Ports:
      type: object
      additionalProperties: false
      description: Port configuration for ingress specifying HTTP and HTTPS port numbers
      properties:
        http:
          type: integer
          default: 80
          description: HTTP port number
        https:
          type: integer
          default: 443
          description: HTTPS port number

    ResourceLimits:
      type: object
      additionalProperties: false
      description: Resource limits and requests for container scheduling
      properties:
        cpuLimit:
          type: string
          description: CPU limit (e.g., "0.5", "2")
        memoryLimit:
          type: string
          description: Memory limit (e.g., "512m", "2g")
        cpuRequest:
          type: string
          description: CPU request (Kubernetes)
        memoryRequest:
          type: string
          description: Memory request (Kubernetes)

    DeploymentMode:
      type: string
      enum: [graceful, force, clean]
      description: |
        Deployment mode:
        - graceful: Wait for connections to drain
        - force: Apply immediately
        - clean: Tear down and rebuild

    DeployRequest:
      description: Request to deploy or update an environment using a preset or custom topology
      type: object
      additionalProperties: false
      properties:
        preset:
          type: string
          nullable: true
          description: Preset name to deploy (mutually exclusive with topology)
        topology:
          allOf:
          - $ref: '#/components/schemas/ServiceTopology'
          nullable: true
          description: Custom topology (mutually exclusive with preset)
        backend:
          allOf:
          - $ref: '#/components/schemas/BackendType'
          nullable: true
          description: Specific backend to use (fails if unavailable)
        mode:
          $ref: '#/components/schemas/DeploymentMode'
          default: graceful
          description: How the deployment should be performed
        environment:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Environment variable overrides
        timeout:
          type: integer
          default: 300
          description: Deployment timeout in seconds
        waitForHealthy:
          type: boolean
          default: true
          description: Wait for all services to report healthy
        dryRun:
          type: boolean
          default: false
          description: Preview what would be deployed without making changes

    DeployResponse:
      description: Result of a deployment operation including status and deployed service information
      type: object
      additionalProperties: false
      required:
      - success
      - deploymentId
      - backend
      - duration
      properties:
        success:
          type: boolean
          description: Deployment succeeded
        deploymentId:
          type: string
          description: Unique deployment identifier for tracking
        backend:
          $ref: '#/components/schemas/BackendType'
          description: Container orchestration backend used for deployment
        preset:
          type: string
          description: Preset used (if applicable)
        duration:
          type: string
          description: Time taken to deploy
        topology:
          $ref: '#/components/schemas/ServiceTopology'
          description: Final applied topology
        services:
          type: array
          items:
            $ref: '#/components/schemas/DeployedService'
          description: Status of deployed services
        warnings:
          type: array
          items:
            type: string
          description: Non-fatal warnings during deployment
        message:
          type: string
          description: Human-readable deployment summary

    DeployedService:
      description: Status information for a single deployed service instance
      type: object
      additionalProperties: false
      required:
      - name
      - status
      - node
      properties:
        name:
          type: string
          description: Service name
        status:
          type: string
          enum: [starting, running, healthy, unhealthy, stopped]
          description: Current status of the deployed service
        node:
          type: string
          description: Node/container hosting this service
        containerId:
          type: string
          description: Container ID (Compose/Swarm)
        podName:
          type: string
          description: Pod name (Kubernetes)
        endpoints:
          type: array
          items:
            type: string
          description: Exposed endpoints

    EnvironmentStatus:
      description: Current status of the deployed environment including topology and resource usage
      type: object
      additionalProperties: false
      required:
      - deployed
      - timestamp
      properties:
        deployed:
          type: boolean
          description: Whether an environment is currently deployed
        timestamp:
          type: string
          format: date-time
          description: When this status was generated
        deploymentId:
          type: string
          description: Current deployment identifier
        backend:
          $ref: '#/components/schemas/BackendType'
          description: Container orchestration backend in use
        preset:
          type: string
          description: Active preset name
        topology:
          $ref: '#/components/schemas/ServiceTopology'
          description: Current topology configuration
        services:
          type: array
          items:
            $ref: '#/components/schemas/DeployedService'
          description: All deployed services with status
        infrastructure:
          $ref: '#/components/schemas/InfrastructureHealthResponse'
          description: Infrastructure component health
        resources:
          $ref: '#/components/schemas/ResourceUsage'
          description: Overall resource usage
        uptime:
          type: string
          description: Time since deployment

    ResourceUsage:
      description: System resource utilization metrics including CPU, memory, disk, and network
      type: object
      additionalProperties: false
      properties:
        cpuPercent:
          type: number
          format: float
          description: Total CPU usage percentage
        memoryUsedMb:
          type: integer
          description: Total memory used (MB)
        memoryTotalMb:
          type: integer
          description: Total memory available (MB)
        diskUsedGb:
          type: number
          format: float
          description: Disk space used (GB)
        networkInMb:
          type: number
          format: float
          description: Network input (MB)
        networkOutMb:
          type: number
          format: float
          description: Network output (MB)

    TeardownMode:
      type: string
      enum: [graceful, force, preserve-data]
      description: |
        Teardown mode:
        - graceful: Signal shutdown, wait for clean exit
        - force: Immediately stop (SIGKILL)
        - preserve-data: Keep volumes/networks, remove containers

    TeardownRequest:
      description: Request to tear down a deployed environment with options for data preservation
      type: object
      additionalProperties: false
      properties:
        dryRun:
          type: boolean
          default: false
          description: |
            When true, simulates teardown without actually stopping or removing containers.
            Returns what would be torn down. ALWAYS use dryRun=true first to preview the impact.
        mode:
          $ref: '#/components/schemas/TeardownMode'
          default: graceful
          description: How the teardown should be performed
        timeout:
          type: integer
          default: 60
          description: Graceful shutdown timeout in seconds
        removeVolumes:
          type: boolean
          default: false
          description: Also remove associated volumes
        removeNetworks:
          type: boolean
          default: false
          description: Also remove associated networks
        includeInfrastructure:
          type: boolean
          default: false
          description: |
            When true, also removes support infrastructure (Redis, RabbitMQ, MySQL, etc.).
            This is determined by scanning compose files or finding containers in the same
            Docker swarm/Kubernetes namespace as bannou services. USE WITH EXTREME CAUTION -
            this will destroy all data and require a full re-deployment.

    TeardownResponse:
      description: Result of an environment teardown including removed resources and any errors
      type: object
      additionalProperties: false
      required:
      - success
      - duration
      properties:
        success:
          type: boolean
          description: Whether teardown completed successfully
        duration:
          type: string
          description: Time taken to complete teardown
        stoppedContainers:
          type: array
          items:
            type: string
          description: Container IDs that were stopped
        removedVolumes:
          type: array
          items:
            type: string
          description: Volumes that were removed
        removedNetworks:
          type: array
          items:
            type: string
          description: Networks that were removed
        removedInfrastructure:
          type: array
          items:
            type: string
          description: Infrastructure services that were removed (Redis, RabbitMQ, MySQL, etc.)
        errors:
          type: array
          items:
            type: string
          description: Non-fatal errors during teardown
        message:
          type: string
          description: Human-readable teardown summary

    CleanTarget:
      type: string
      enum: [containers, networks, volumes, images, all]
      description: Type of resource to clean

    CleanRequest:
      description: Request to clean up Docker resources such as containers, volumes, and images
      type: object
      additionalProperties: false
      required:
      - targets
      properties:
        targets:
          type: array
          items:
            $ref: '#/components/schemas/CleanTarget'
          description: Resources to clean (or "all")
        force:
          type: boolean
          default: false
          description: Force removal without confirmation
        olderThan:
          type: string
          nullable: true
          description: Only clean resources older than (e.g., "24h", "7d")
        labelFilter:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Only clean resources matching labels

    CleanResponse:
      description: Result of a cleanup operation including reclaimed space and removed resource counts
      type: object
      additionalProperties: false
      required:
      - success
      properties:
        success:
          type: boolean
          description: Whether cleanup completed successfully
        reclaimedSpaceMb:
          type: integer
          description: Disk space reclaimed (MB)
        removedContainers:
          type: integer
          description: Number of containers removed
        removedNetworks:
          type: integer
          description: Number of networks removed
        removedVolumes:
          type: integer
          description: Number of volumes removed
        removedImages:
          type: integer
          description: Number of images removed
        errors:
          type: array
          items:
            type: string
          description: Non-fatal errors during cleanup
        message:
          type: string
          description: Human-readable cleanup summary

    LogsResponse:
      description: Response containing log entries from a service or container
      type: object
      additionalProperties: false
      required:
      - logs
      properties:
        service:
          type: string
          description: Service name (if queried by service)
        container:
          type: string
          description: Container ID/name
        logs:
          type: array
          items:
            $ref: '#/components/schemas/LogEntry'
          description: Log entries matching the query
        truncated:
          type: boolean
          description: Whether output was truncated

    LogEntry:
      description: A single log entry with timestamp, stream, and message content
      type: object
      additionalProperties: false
      required:
      - timestamp
      - message
      properties:
        timestamp:
          type: string
          format: date-time
          description: When this log entry was recorded
        stream:
          type: string
          enum: [stdout, stderr]
          description: Output stream type (stdout or stderr)
        message:
          type: string
          description: Log message content

    TopologyUpdateRequest:
      description: Request to apply incremental changes to the current service topology
      type: object
      additionalProperties: false
      required:
      - changes
      properties:
        changes:
          type: array
          items:
            $ref: '#/components/schemas/TopologyChange'
          description: List of topology changes to apply
        mode:
          $ref: '#/components/schemas/DeploymentMode'
          default: graceful
          description: How the topology update should be performed
        timeout:
          type: integer
          default: 120
          description: Timeout for topology update

    TopologyChange:
      description: A single topology modification such as adding a node, moving a service, or scaling
      type: object
      additionalProperties: false
      required:
      - action
      properties:
        action:
          type: string
          enum: [add-node, remove-node, move-service, scale, update-env]
          description: Type of topology change
        nodeName:
          type: string
          description: Target node name
        services:
          type: array
          items:
            type: string
          description: Services affected by this change
        replicas:
          type: integer
          description: New replica count (for scale action)
        environment:
          type: object
          additionalProperties:
            type: string
          description: Environment updates (for update-env action)
        nodeConfig:
          $ref: '#/components/schemas/TopologyNode'
          description: Full node config (for add-node action)

    TopologyUpdateResponse:
      description: Result of a topology update including applied changes and the new topology state
      type: object
      additionalProperties: false
      required:
      - success
      - appliedChanges
      properties:
        success:
          type: boolean
          description: Whether all topology changes were applied successfully
        appliedChanges:
          type: array
          items:
            $ref: '#/components/schemas/AppliedChange'
          description: Details of each applied change
        topology:
          $ref: '#/components/schemas/ServiceTopology'
          description: New topology after changes
        duration:
          type: string
          description: Time taken to apply topology changes
        warnings:
          type: array
          items:
            type: string
          description: Non-fatal warnings during topology update
        message:
          type: string
          description: Human-readable update summary

    AppliedChange:
      description: Details of a single topology change that was applied, including success status
      type: object
      additionalProperties: false
      required:
      - action
      - success
      properties:
        action:
          type: string
          description: Type of topology change that was applied
        target:
          type: string
          description: Node or service affected
        success:
          type: boolean
          description: Whether this specific change was applied successfully
        error:
          type: string
          description: Error message if failed

    ErrorResponse:
      description: Standard error response with code, message, and optional additional details
      type: object
      additionalProperties: false
      required:
      - error
      - message
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          additionalProperties: true
          description: Additional error context

    # ==========================================================================
    # EVENT SCHEMAS (for RabbitMQ pub/sub)
    # ==========================================================================

    DeploymentEvent:
      type: object
      additionalProperties: false
      description: |
        Published when deployment state changes.
        Topic: bannou-deployment-events
      required:
      - eventId
      - timestamp
      - action
      - deploymentId
      properties:
        eventId:
          type: string
          description: Unique identifier for this event
        timestamp:
          type: string
          format: date-time
          description: When this event occurred
        action:
          type: string
          enum: [started, completed, failed, topology-changed]
          description: Type of deployment action that triggered this event
        deploymentId:
          type: string
          description: Unique identifier for the deployment
        preset:
          type: string
          nullable: true
          description: Preset name used for deployment (if applicable)
        backend:
          $ref: '#/components/schemas/BackendType'
          description: Container orchestration backend used
        changes:
          type: array
          items:
            type: string
          description: Summary of changes made
        error:
          type: string
          nullable: true
          description: Error message if failed

    ServiceRestartEvent:
      type: object
      additionalProperties: false
      description: |
        Published when a service is restarted.
        Topic: bannou-service-lifecycle
      required:
      - eventId
      - serviceName
      - reason
      properties:
        eventId:
          type: string
          description: Unique identifier for this event
        serviceName:
          type: string
          description: Name of the service that was restarted
        reason:
          type: string
          description: Reason for the restart
        forced:
          type: boolean
          description: Whether restart was forced without waiting for graceful shutdown
        newEnvironment:
          type: object
          additionalProperties:
            type: string
          description: Environment variables updated during restart

    ConfigurationChangedEvent:
      type: object
      additionalProperties: false
      description: |
        Published by orchestrator when configuration or secrets change.
        All containers receive this event via RabbitMQ. Plugins decide if they care
        based on the changedKeys prefixes and request restart if needed.
        Topic: bannou-configuration-events
      required:
      - eventId
      - timestamp
      - configVersion
      - changedKeys
      properties:
        eventId:
          type: string
          description: Unique identifier for this event instance
        timestamp:
          type: string
          format: date-time
          description: When this configuration change occurred
        configVersion:
          type: integer
          description: Monotonically increasing version number
        changedKeys:
          type: array
          items:
            type: string
          description: |
            Configuration keys that changed (not values for security).
            Key prefixes indicate scope:
            - "auth.*" - Authentication-related
            - "database.*" - Database connections
            - "mesh.*" - Mesh components (typically global impact)
            - "connect.*" - WebSocket/connection settings

    # ==========================================================================
    # CONTAINER MANAGEMENT SCHEMAS
    # ==========================================================================

    RestartPriority:
      type: string
      enum: [graceful, immediate, force]
      description: |
        Restart urgency level:
        - graceful: Rolling update, wait for healthy before cycling next instance
        - immediate: Rolling update but don't wait for connection drain
        - force: Kill all instances simultaneously (causes downtime)

    ContainerRestartRequest:
      type: object
      additionalProperties: false
      description: Request to restart a container
      required:
      - reason
      properties:
        reason:
          type: string
          description: Why restart is needed (for logging/auditing)
          example: "configuration_change"
        priority:
          $ref: '#/components/schemas/RestartPriority'
          default: graceful
          description: Urgency level for the restart
        shutdownGracePeriod:
          type: integer
          default: 30
          description: Seconds to allow graceful shutdown before force-kill

    ContainerRestartResponse:
      description: Response after accepting a container restart request with scheduling details
      type: object
      additionalProperties: false
      required:
      - accepted
      - appName
      properties:
        accepted:
          type: boolean
          description: Whether the restart request was accepted
        appName:
          type: string
          description: Container that will be restarted
        scheduledFor:
          type: string
          format: date-time
          description: When restart is scheduled (may be queued)
        currentInstances:
          type: integer
          description: Number of running instances
        restartStrategy:
          type: string
          enum: [rolling, simultaneous]
          description: How restart will be performed
        message:
          type: string
          description: Additional information

    ContainerStatus:
      description: Current status of a container including health, restart history, and running plugins
      type: object
      additionalProperties: false
      required:
      - appName
      - status
      - timestamp
      properties:
        appName:
          type: string
          description: Container's app-id for mesh routing
        status:
          type: string
          enum: [running, starting, stopping, stopped, unhealthy]
          description: Current container status
        timestamp:
          type: string
          format: date-time
          description: When this status was captured
        instances:
          type: integer
          description: Number of running instances
        plugins:
          type: array
          items:
            type: string
          description: Plugins running in this container
        lastRestart:
          type: string
          format: date-time
          description: When container was last restarted
        restartCount:
          type: integer
          description: Number of restarts in last 24 hours
        restartHistory:
          type: array
          items:
            $ref: '#/components/schemas/RestartHistoryEntry'
          description: Recent restart history
        healthChecks:
          description: Health check configuration and current health status results
          $ref: '#/components/schemas/HealthChecks'
        labels:
          type: object
          additionalProperties:
            type: string
          description: Container labels for metadata and management

    RestartHistoryEntry:
      description: Record of a past container restart including reason, timing, and outcome
      type: object
      additionalProperties: false
      required:
      - timestamp
      - reason
      properties:
        timestamp:
          type: string
          format: date-time
          description: When the restart occurred
        reason:
          type: string
          description: Why the restart was triggered
        priority:
          $ref: '#/components/schemas/RestartPriority'
          description: Priority level used for the restart
        duration:
          type: string
          description: Time taken to restart
        success:
          type: boolean
          description: Whether the restart completed successfully
        error:
          type: string
          description: Error message if restart failed

    # ==========================================================================
    # CONFIGURATION MANAGEMENT SCHEMAS
    # ==========================================================================

    ConfigRollbackRequest:
      description: Request to rollback configuration to the previous version
      type: object
      additionalProperties: false
      required:
      - reason
      properties:
        reason:
          type: string
          description: Why rollback is needed (for auditing)
          example: "auth.jwt_secret broke authentication"

    ConfigRollbackResponse:
      description: Result of a configuration rollback including version changes and affected keys
      type: object
      additionalProperties: false
      required:
      - success
      - previousVersion
      - currentVersion
      properties:
        success:
          type: boolean
          description: Whether rollback completed successfully
        previousVersion:
          type: integer
          description: Config version before rollback
        currentVersion:
          type: integer
          description: Config version after rollback (now active)
        changedKeys:
          type: array
          items:
            type: string
          description: Keys that were reverted
        message:
          type: string
          description: Human-readable rollback summary

    ConfigVersionResponse:
      description: Current configuration version information with metadata about available keys
      type: object
      additionalProperties: false
      required:
      - version
      - timestamp
      properties:
        version:
          type: integer
          description: Current configuration version number
        timestamp:
          type: string
          format: date-time
          description: When current config was applied
        hasPreviousConfig:
          type: boolean
          description: Whether a previous config is available for rollback
        keyCount:
          type: integer
          description: Number of configuration keys (not values for security)
        keyPrefixes:
          type: array
          items:
            type: string
          description: Configuration key prefixes present (e.g., "auth", "database")

    # ============================================================
    # PROCESSING POOL MODELS
    # ============================================================

    AcquireProcessorRequest:
      description: Request to acquire a processor instance from a processing pool
      type: object
      additionalProperties: false
      required:
      - poolType
      properties:
        poolType:
          type: string
          description: Type of processing pool (e.g., "asset-processor", "texture-processor")
        priority:
          type: integer
          default: 0
          description: Request priority (higher = more urgent)
        timeoutSeconds:
          type: integer
          default: 300
          description: How long the lease is valid for
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Optional metadata about the processing job (null if not needed)

    AcquireProcessorResponse:
      description: Response with acquired processor details including lease information
      type: object
      additionalProperties: false
      required:
      - processorId
      - appId
      - leaseId
      - expiresAt
      properties:
        processorId:
          type: string
          description: Unique identifier for this processor instance
        appId:
          type: string
          description: App-id for mesh service invocation to this processor
        leaseId:
          type: string
          format: uuid
          description: Unique lease identifier (used for release)
        expiresAt:
          type: string
          format: date-time
          description: When the lease expires (must release before this)

    PoolBusyResponse:
      description: Response when all processors in a pool are busy with queue position and wait estimate
      type: object
      additionalProperties: false
      required:
      - poolType
      - queuePosition
      - estimatedWaitSeconds
      properties:
        poolType:
          type: string
          description: Pool type that is busy
        queuePosition:
          type: integer
          description: Position in the wait queue (0 = not queued)
        estimatedWaitSeconds:
          type: integer
          description: Estimated wait time until a processor is available
        message:
          type: string
          description: Human-readable status message

    ReleaseProcessorRequest:
      description: Request to release a processor back to the pool after processing completes
      type: object
      additionalProperties: false
      required:
      - leaseId
      properties:
        leaseId:
          type: string
          format: uuid
          description: The lease ID returned from AcquireProcessor
        success:
          type: boolean
          default: true
          description: Whether the processing completed successfully
        metrics:
          type: object
          additionalProperties: true
          description: Optional processing metrics (duration, items processed, etc.)

    ReleaseProcessorResponse:
      description: Confirmation that a processor was released back to the pool
      type: object
      additionalProperties: false
      required:
      - released
      properties:
        released:
          type: boolean
          description: Whether the processor was successfully released
        processorId:
          type: string
          description: ID of the released processor

    GetPoolStatusRequest:
      description: Request to retrieve status and metrics for a processing pool
      type: object
      additionalProperties: false
      required:
      - poolType
      properties:
        poolType:
          type: string
          description: Type of processing pool to query
        includeMetrics:
          type: boolean
          default: true
          description: Include recent processing metrics

    PoolStatusResponse:
      description: Current status of a processing pool including instance counts and utilization
      type: object
      additionalProperties: false
      required:
      - poolType
      - totalInstances
      - availableInstances
      - busyInstances
      - utilization
      properties:
        poolType:
          type: string
          description: Pool type
        totalInstances:
          type: integer
          description: Total processor instances in the pool
        availableInstances:
          type: integer
          description: Instances ready to accept work
        busyInstances:
          type: integer
          description: Instances currently processing
        queueDepth:
          type: integer
          description: Number of requests waiting for a processor
        utilization:
          type: number
          format: float
          description: Current utilization percentage (0.0 to 1.0)
        minInstances:
          type: integer
          description: Minimum configured instances
        maxInstances:
          type: integer
          description: Maximum configured instances
        scaleUpThreshold:
          type: number
          format: float
          description: Utilization threshold for auto-scale-up
        recentMetrics:
          $ref: '#/components/schemas/PoolMetrics'
          description: Recent processing statistics

    PoolMetrics:
      type: object
      additionalProperties: false
      description: Processing pool performance metrics
      properties:
        jobsCompleted1h:
          type: integer
          description: Jobs completed in the last hour
        jobsFailed1h:
          type: integer
          description: Jobs failed in the last hour
        avgProcessingTimeMs:
          type: integer
          description: Average processing time in milliseconds
        lastScaleEvent:
          type: string
          format: date-time
          description: When the pool was last scaled

    ScalePoolRequest:
      description: Request to scale a processing pool to a target number of instances
      type: object
      additionalProperties: false
      required:
      - poolType
      - targetInstances
      properties:
        poolType:
          type: string
          description: Type of processing pool to scale
        targetInstances:
          type: integer
          minimum: 0
          description: Desired number of instances
        force:
          type: boolean
          default: false
          description: Force scale even if it would interrupt processing

    ScalePoolResponse:
      description: Result of a pool scaling operation with before and after instance counts
      type: object
      additionalProperties: false
      required:
      - poolType
      - previousInstances
      - currentInstances
      properties:
        poolType:
          type: string
          description: Pool type that was scaled
        previousInstances:
          type: integer
          description: Instance count before scaling
        currentInstances:
          type: integer
          description: Instance count after scaling
        scaledUp:
          type: integer
          description: Number of instances added
        scaledDown:
          type: integer
          description: Number of instances removed
        message:
          type: string
          description: Status message

    CleanupPoolRequest:
      description: Request to clean up idle processor instances from a pool
      type: object
      additionalProperties: false
      required:
      - poolType
      properties:
        poolType:
          type: string
          description: Type of processing pool to cleanup
        preserveMinimum:
          type: boolean
          default: true
          description: Keep at least minInstances running

    CleanupPoolResponse:
      description: Result of a pool cleanup operation with removed instance count
      type: object
      additionalProperties: false
      required:
      - poolType
      - instancesRemoved
      properties:
        poolType:
          type: string
          description: Pool type that was cleaned up
        instancesRemoved:
          type: integer
          description: Number of idle instances removed
        currentInstances:
          type: integer
          description: Instance count after cleanup
        message:
          type: string
          description: Status message

