openapi: 3.0.3
info:
  title: Actor Service API
  version: 1.0.0
  description: |
    Distributed actor management and execution for NPC brains, event coordinators,
    and other long-running behavior loops. Actors output behavioral state (feelings,
    goals, memories) to characters - NOT physics data.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before modifying this schema. Optional reference types require `nullable: true`.

servers:
- url: http://localhost:5012

paths:
  # === Actor Templates ===
  /actor/template/create:
    post:
      operationId: CreateActorTemplate
      summary: Create an actor template (category definition)
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateActorTemplateRequest'
      responses:
        '200':
          description: Template created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActorTemplateResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateActorTemplateRequest\"\
        ,\n    \"$defs\": {\n        \"CreateActorTemplateRequest\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Request to create a new actor template definition\"\
        ,\n            \"required\": [\n                \"category\",\n                \"behaviorRef\"\n            ],\n \
        \           \"properties\": {\n                \"category\": {\n                    \"type\": \"string\",\n      \
        \              \"description\": \"Category identifier (e.g., \\\"npc-brain\\\", \\\"world-admin\\\", \\\"cron-cleanup\\\
        \")\"\n                },\n                \"behaviorRef\": {\n                    \"type\": \"string\",\n       \
        \             \"description\": \"Reference to behavior in lib-assets (e.g., \\\"asset://behaviors/npc-brain-v1\\\"\
        )\"\n                },\n                \"configuration\": {\n                    \"type\": \"object\",\n       \
        \             \"additionalProperties\": true,\n                    \"nullable\": true,\n                    \"description\"\
        : \"Default configuration passed to behavior execution\"\n                },\n                \"autoSpawn\": {\n \
        \                   \"description\": \"Auto-spawn configuration for instantiate-on-access\",\n                   \
        \ \"nullable\": true,\n                    \"$ref\": \"#/$defs/AutoSpawnConfig\"\n                },\n           \
        \     \"tickIntervalMs\": {\n                    \"type\": \"integer\",\n                    \"default\": 1000,\n\
        \                    \"description\": \"Milliseconds between behavior loop iterations\"\n                },\n    \
        \            \"autoSaveIntervalSeconds\": {\n                    \"type\": \"integer\",\n                    \"default\"\
        : 60,\n                    \"description\": \"Seconds between automatic state saves (0 to disable)\"\n           \
        \     },\n                \"maxInstancesPerNode\": {\n                    \"type\": \"integer\",\n               \
        \     \"default\": 100,\n                    \"description\": \"Maximum actors of this category per pool node\"\n\
        \                }\n            }\n        },\n        \"AutoSpawnConfig\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"Configuration for instantiate-on-access
        behavior\",\n            \"properties\": {\n                \"enabled\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": false,\n                    \"description\": \"If true, accessing a non-existent
        actor creates it\"\n                },\n                \"idPattern\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Regex pattern for actor IDs that
        trigger auto-spawn.\\nExamples: \\\"npc-.*\\\" matches \\\"npc-grok\\\", \\\"npc-merchant-123\\\"\\n\"\n         \
        \       },\n                \"maxInstances\": {\n                    \"type\": \"integer\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Maximum auto-spawned instances (0 = unlimited)\"\n     \
        \           },\n                \"characterIdCaptureGroup\": {\n                    \"type\": \"integer\",\n     \
        \               \"minimum\": 1,\n                    \"nullable\": true,\n                    \"description\": \"\
        1-based regex capture group index for extracting CharacterId from actor ID.\\nExample: With idPattern \\\"npc-brain-([a-f0-9-]+)\\\
        \" and characterIdCaptureGroup: 1,\\nactor ID \\\"npc-brain-abc-123-def\\\" extracts \\\"abc-123-def\\\" as CharacterId
        (parsed as GUID).\\n\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ActorTemplateResponse\"\
        ,\n    \"$defs\": {\n        \"ActorTemplateResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing actor template details\",\n            \"required\":
        [\n                \"templateId\",\n                \"category\",\n                \"behaviorRef\",\n            \
        \    \"tickIntervalMs\",\n                \"autoSaveIntervalSeconds\",\n                \"maxInstancesPerNode\",\n\
        \                \"createdAt\",\n                \"updatedAt\"\n            ],\n            \"properties\": {\n  \
        \              \"templateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Unique template identifier\"\n                },\n                \"category\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Category identifier\"\n   \
        \             },\n                \"behaviorRef\": {\n                    \"type\": \"string\",\n                \
        \    \"description\": \"Reference to behavior in lib-assets\"\n                },\n                \"configuration\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": true,\n            \
        \        \"nullable\": true,\n                    \"description\": \"Default configuration passed to behavior execution\"\
        \n                },\n                \"autoSpawn\": {\n                    \"description\": \"Auto-spawn configuration
        for instantiate-on-access\",\n                    \"nullable\": true,\n                    \"$ref\": \"#/$defs/AutoSpawnConfig\"\
        \n                },\n                \"tickIntervalMs\": {\n                    \"type\": \"integer\",\n        \
        \            \"description\": \"Milliseconds between behavior loop iterations\"\n                },\n            \
        \    \"autoSaveIntervalSeconds\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Seconds between automatic state saves\"\n                },\n                \"maxInstancesPerNode\": {\n    \
        \                \"type\": \"integer\",\n                    \"description\": \"Maximum actors of this category per
        pool node\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"description\": \"When the template was created\"\
        \n                },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the template was last updated\"\n \
        \               }\n            }\n        },\n        \"AutoSpawnConfig\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"Configuration for instantiate-on-access
        behavior\",\n            \"properties\": {\n                \"enabled\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": false,\n                    \"description\": \"If true, accessing a non-existent
        actor creates it\"\n                },\n                \"idPattern\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Regex pattern for actor IDs that
        trigger auto-spawn.\\nExamples: \\\"npc-.*\\\" matches \\\"npc-grok\\\", \\\"npc-merchant-123\\\"\\n\"\n         \
        \       },\n                \"maxInstances\": {\n                    \"type\": \"integer\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Maximum auto-spawned instances (0 = unlimited)\"\n     \
        \           },\n                \"characterIdCaptureGroup\": {\n                    \"type\": \"integer\",\n     \
        \               \"minimum\": 1,\n                    \"nullable\": true,\n                    \"description\": \"\
        1-based regex capture group index for extracting CharacterId from actor ID.\\nExample: With idPattern \\\"npc-brain-([a-f0-9-]+)\\\
        \" and characterIdCaptureGroup: 1,\\nactor ID \\\"npc-brain-abc-123-def\\\" extracts \\\"abc-123-def\\\" as CharacterId
        (parsed as GUID).\\n\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Create an actor template (category definition)\",\n    \"description\"\
        : \"\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"CreateActorTemplate\"\n}"
  /actor/template/get:
    post:
      operationId: GetActorTemplate
      summary: Get an actor template by ID or category
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetActorTemplateRequest'
      responses:
        '200':
          description: Template retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActorTemplateResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetActorTemplateRequest\"\
        ,\n    \"$defs\": {\n        \"GetActorTemplateRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get an actor template by ID or category\",\n            \"properties\"\
        : {\n                \"templateId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Template ID to retrieve\"\
        \n                },\n                \"category\": {\n                    \"type\": \"string\",\n               \
        \     \"nullable\": true,\n                    \"description\": \"Or retrieve by category name\"\n               \
        \ }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ActorTemplateResponse\"\
        ,\n    \"$defs\": {\n        \"ActorTemplateResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing actor template details\",\n            \"required\":
        [\n                \"templateId\",\n                \"category\",\n                \"behaviorRef\",\n            \
        \    \"tickIntervalMs\",\n                \"autoSaveIntervalSeconds\",\n                \"maxInstancesPerNode\",\n\
        \                \"createdAt\",\n                \"updatedAt\"\n            ],\n            \"properties\": {\n  \
        \              \"templateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Unique template identifier\"\n                },\n                \"category\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Category identifier\"\n   \
        \             },\n                \"behaviorRef\": {\n                    \"type\": \"string\",\n                \
        \    \"description\": \"Reference to behavior in lib-assets\"\n                },\n                \"configuration\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": true,\n            \
        \        \"nullable\": true,\n                    \"description\": \"Default configuration passed to behavior execution\"\
        \n                },\n                \"autoSpawn\": {\n                    \"description\": \"Auto-spawn configuration
        for instantiate-on-access\",\n                    \"nullable\": true,\n                    \"$ref\": \"#/$defs/AutoSpawnConfig\"\
        \n                },\n                \"tickIntervalMs\": {\n                    \"type\": \"integer\",\n        \
        \            \"description\": \"Milliseconds between behavior loop iterations\"\n                },\n            \
        \    \"autoSaveIntervalSeconds\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Seconds between automatic state saves\"\n                },\n                \"maxInstancesPerNode\": {\n    \
        \                \"type\": \"integer\",\n                    \"description\": \"Maximum actors of this category per
        pool node\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"description\": \"When the template was created\"\
        \n                },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the template was last updated\"\n \
        \               }\n            }\n        },\n        \"AutoSpawnConfig\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"Configuration for instantiate-on-access
        behavior\",\n            \"properties\": {\n                \"enabled\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": false,\n                    \"description\": \"If true, accessing a non-existent
        actor creates it\"\n                },\n                \"idPattern\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Regex pattern for actor IDs that
        trigger auto-spawn.\\nExamples: \\\"npc-.*\\\" matches \\\"npc-grok\\\", \\\"npc-merchant-123\\\"\\n\"\n         \
        \       },\n                \"maxInstances\": {\n                    \"type\": \"integer\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Maximum auto-spawned instances (0 = unlimited)\"\n     \
        \           },\n                \"characterIdCaptureGroup\": {\n                    \"type\": \"integer\",\n     \
        \               \"minimum\": 1,\n                    \"nullable\": true,\n                    \"description\": \"\
        1-based regex capture group index for extracting CharacterId from actor ID.\\nExample: With idPattern \\\"npc-brain-([a-f0-9-]+)\\\
        \" and characterIdCaptureGroup: 1,\\nactor ID \\\"npc-brain-abc-123-def\\\" extracts \\\"abc-123-def\\\" as CharacterId
        (parsed as GUID).\\n\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get an actor template by ID or category\",\n    \"description\": \"\",\n\
        \    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"GetActorTemplate\"\n}"
  /actor/template/list:
    post:
      operationId: ListActorTemplates
      summary: List all actor templates
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListActorTemplatesRequest'
      responses:
        '200':
          description: Templates listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListActorTemplatesResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListActorTemplatesRequest\"\
        ,\n    \"$defs\": {\n        \"ListActorTemplatesRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to list actor templates with pagination\",\n            \"properties\"\
        : {\n                \"limit\": {\n                    \"type\": \"integer\",\n                    \"default\": 100,\n\
        \                    \"description\": \"Maximum number of templates to return\"\n                },\n            \
        \    \"offset\": {\n                    \"type\": \"integer\",\n                    \"default\": 0,\n            \
        \        \"description\": \"Number of templates to skip\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListActorTemplatesResponse\"\
        ,\n    \"$defs\": {\n        \"ListActorTemplatesResponse\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Response containing a list of actor templates\",\n\
        \            \"required\": [\n                \"templates\",\n                \"total\"\n            ],\n        \
        \    \"properties\": {\n                \"templates\": {\n                    \"type\": \"array\",\n             \
        \       \"description\": \"List of actor templates\",\n                    \"items\": {\n                        \"\
        $ref\": \"#/$defs/ActorTemplateResponse\"\n                    }\n                },\n                \"total\": {\n\
        \                    \"type\": \"integer\",\n                    \"description\": \"Total number of templates available\"\
        \n                }\n            }\n        },\n        \"ActorTemplateResponse\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Response containing actor template
        details\",\n            \"required\": [\n                \"templateId\",\n                \"category\",\n        \
        \        \"behaviorRef\",\n                \"tickIntervalMs\",\n                \"autoSaveIntervalSeconds\",\n   \
        \             \"maxInstancesPerNode\",\n                \"createdAt\",\n                \"updatedAt\"\n          \
        \  ],\n            \"properties\": {\n                \"templateId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique template identifier\"\n\
        \                },\n                \"category\": {\n                    \"type\": \"string\",\n                \
        \    \"description\": \"Category identifier\"\n                },\n                \"behaviorRef\": {\n          \
        \          \"type\": \"string\",\n                    \"description\": \"Reference to behavior in lib-assets\"\n \
        \               },\n                \"configuration\": {\n                    \"type\": \"object\",\n            \
        \        \"additionalProperties\": true,\n                    \"nullable\": true,\n                    \"description\"\
        : \"Default configuration passed to behavior execution\"\n                },\n                \"autoSpawn\": {\n \
        \                   \"description\": \"Auto-spawn configuration for instantiate-on-access\",\n                   \
        \ \"nullable\": true,\n                    \"$ref\": \"#/$defs/AutoSpawnConfig\"\n                },\n           \
        \     \"tickIntervalMs\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Milliseconds
        between behavior loop iterations\"\n                },\n                \"autoSaveIntervalSeconds\": {\n         \
        \           \"type\": \"integer\",\n                    \"description\": \"Seconds between automatic state saves\"\
        \n                },\n                \"maxInstancesPerNode\": {\n                    \"type\": \"integer\",\n   \
        \                 \"description\": \"Maximum actors of this category per pool node\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the template was created\"\n                },\n                \"\
        updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n      \
        \              \"description\": \"When the template was last updated\"\n                }\n            }\n       \
        \ },\n        \"AutoSpawnConfig\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"description\": \"Configuration for instantiate-on-access behavior\",\n            \"properties\": {\n\
        \                \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n\
        \                    \"description\": \"If true, accessing a non-existent actor creates it\"\n                },\n\
        \                \"idPattern\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Regex pattern for actor IDs that trigger auto-spawn.\\nExamples: \\\"npc-.*\\\
        \" matches \\\"npc-grok\\\", \\\"npc-merchant-123\\\"\\n\"\n                },\n                \"maxInstances\":
        {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Maximum auto-spawned instances (0 = unlimited)\"\n                },\n                \"characterIdCaptureGroup\"\
        : {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n                    \"nullable\"\
        : true,\n                    \"description\": \"1-based regex capture group index for extracting CharacterId from
        actor ID.\\nExample: With idPattern \\\"npc-brain-([a-f0-9-]+)\\\" and characterIdCaptureGroup: 1,\\nactor ID \\\"\
        npc-brain-abc-123-def\\\" extracts \\\"abc-123-def\\\" as CharacterId (parsed as GUID).\\n\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List all actor templates\",\n    \"description\": \"\",\n    \"tags\":
        [],\n    \"deprecated\": false,\n    \"operationId\": \"ListActorTemplates\"\n}"
  /actor/template/update:
    post:
      operationId: UpdateActorTemplate
      summary: Update an actor template
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateActorTemplateRequest'
      responses:
        '200':
          description: Template updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActorTemplateResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/UpdateActorTemplateRequest\"\
        ,\n    \"$defs\": {\n        \"UpdateActorTemplateRequest\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Request to update an existing actor template\",\n \
        \           \"required\": [\n                \"templateId\"\n            ],\n            \"properties\": {\n     \
        \           \"templateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the template to update\"\n                },\n                \"behaviorRef\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"New behavior reference (triggers behavior.updated subscription)\"\n                },\n                \"configuration\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": true,\n            \
        \        \"nullable\": true,\n                    \"description\": \"Updated configuration settings\"\n          \
        \      },\n                \"autoSpawn\": {\n                    \"description\": \"Updated auto-spawn configuration\"\
        ,\n                    \"nullable\": true,\n                    \"$ref\": \"#/$defs/AutoSpawnConfig\"\n          \
        \      },\n                \"tickIntervalMs\": {\n                    \"type\": \"integer\",\n                   \
        \ \"nullable\": true,\n                    \"description\": \"Updated tick interval in milliseconds\"\n          \
        \      },\n                \"autoSaveIntervalSeconds\": {\n                    \"type\": \"integer\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Updated auto-save interval in seconds\"\n \
        \               }\n            }\n        },\n        \"AutoSpawnConfig\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"Configuration for instantiate-on-access
        behavior\",\n            \"properties\": {\n                \"enabled\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": false,\n                    \"description\": \"If true, accessing a non-existent
        actor creates it\"\n                },\n                \"idPattern\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Regex pattern for actor IDs that
        trigger auto-spawn.\\nExamples: \\\"npc-.*\\\" matches \\\"npc-grok\\\", \\\"npc-merchant-123\\\"\\n\"\n         \
        \       },\n                \"maxInstances\": {\n                    \"type\": \"integer\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Maximum auto-spawned instances (0 = unlimited)\"\n     \
        \           },\n                \"characterIdCaptureGroup\": {\n                    \"type\": \"integer\",\n     \
        \               \"minimum\": 1,\n                    \"nullable\": true,\n                    \"description\": \"\
        1-based regex capture group index for extracting CharacterId from actor ID.\\nExample: With idPattern \\\"npc-brain-([a-f0-9-]+)\\\
        \" and characterIdCaptureGroup: 1,\\nactor ID \\\"npc-brain-abc-123-def\\\" extracts \\\"abc-123-def\\\" as CharacterId
        (parsed as GUID).\\n\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ActorTemplateResponse\"\
        ,\n    \"$defs\": {\n        \"ActorTemplateResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing actor template details\",\n            \"required\":
        [\n                \"templateId\",\n                \"category\",\n                \"behaviorRef\",\n            \
        \    \"tickIntervalMs\",\n                \"autoSaveIntervalSeconds\",\n                \"maxInstancesPerNode\",\n\
        \                \"createdAt\",\n                \"updatedAt\"\n            ],\n            \"properties\": {\n  \
        \              \"templateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Unique template identifier\"\n                },\n                \"category\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Category identifier\"\n   \
        \             },\n                \"behaviorRef\": {\n                    \"type\": \"string\",\n                \
        \    \"description\": \"Reference to behavior in lib-assets\"\n                },\n                \"configuration\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": true,\n            \
        \        \"nullable\": true,\n                    \"description\": \"Default configuration passed to behavior execution\"\
        \n                },\n                \"autoSpawn\": {\n                    \"description\": \"Auto-spawn configuration
        for instantiate-on-access\",\n                    \"nullable\": true,\n                    \"$ref\": \"#/$defs/AutoSpawnConfig\"\
        \n                },\n                \"tickIntervalMs\": {\n                    \"type\": \"integer\",\n        \
        \            \"description\": \"Milliseconds between behavior loop iterations\"\n                },\n            \
        \    \"autoSaveIntervalSeconds\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Seconds between automatic state saves\"\n                },\n                \"maxInstancesPerNode\": {\n    \
        \                \"type\": \"integer\",\n                    \"description\": \"Maximum actors of this category per
        pool node\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"description\": \"When the template was created\"\
        \n                },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the template was last updated\"\n \
        \               }\n            }\n        },\n        \"AutoSpawnConfig\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"Configuration for instantiate-on-access
        behavior\",\n            \"properties\": {\n                \"enabled\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": false,\n                    \"description\": \"If true, accessing a non-existent
        actor creates it\"\n                },\n                \"idPattern\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Regex pattern for actor IDs that
        trigger auto-spawn.\\nExamples: \\\"npc-.*\\\" matches \\\"npc-grok\\\", \\\"npc-merchant-123\\\"\\n\"\n         \
        \       },\n                \"maxInstances\": {\n                    \"type\": \"integer\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Maximum auto-spawned instances (0 = unlimited)\"\n     \
        \           },\n                \"characterIdCaptureGroup\": {\n                    \"type\": \"integer\",\n     \
        \               \"minimum\": 1,\n                    \"nullable\": true,\n                    \"description\": \"\
        1-based regex capture group index for extracting CharacterId from actor ID.\\nExample: With idPattern \\\"npc-brain-([a-f0-9-]+)\\\
        \" and characterIdCaptureGroup: 1,\\nactor ID \\\"npc-brain-abc-123-def\\\" extracts \\\"abc-123-def\\\" as CharacterId
        (parsed as GUID).\\n\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Update an actor template\",\n    \"description\": \"\",\n    \"tags\":
        [],\n    \"deprecated\": false,\n    \"operationId\": \"UpdateActorTemplate\"\n}"
  /actor/template/delete:
    post:
      operationId: DeleteActorTemplate
      summary: Delete an actor template
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteActorTemplateRequest'
      responses:
        '200':
          description: Template deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteActorTemplateResponse'

  # === Actor Instances ===
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteActorTemplateRequest\"\
        ,\n    \"$defs\": {\n        \"DeleteActorTemplateRequest\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Request to delete an actor template\",\n          \
        \  \"required\": [\n                \"templateId\"\n            ],\n            \"properties\": {\n              \
        \  \"templateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n     \
        \               \"description\": \"ID of the template to delete\"\n                },\n                \"forceStopActors\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"If true, stops all running actors using this template\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteActorTemplateResponse\"\
        ,\n    \"$defs\": {\n        \"DeleteActorTemplateResponse\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Response confirming template deletion\",\n        \
        \    \"required\": [\n                \"deleted\",\n                \"stoppedActorCount\"\n            ],\n      \
        \      \"properties\": {\n                \"deleted\": {\n                    \"type\": \"boolean\",\n           \
        \         \"description\": \"Whether the template was successfully deleted\"\n                },\n               \
        \ \"stoppedActorCount\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Number
        of running actors that were stopped\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Delete an actor template\",\n    \"description\": \"\",\n    \"tags\":
        [],\n    \"deprecated\": false,\n    \"operationId\": \"DeleteActorTemplate\"\n}"
  /actor/spawn:
    post:
      operationId: SpawnActor
      summary: Spawn a new actor from a template
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SpawnActorRequest'
      responses:
        '200':
          description: Actor spawned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActorInstanceResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/SpawnActorRequest\"\
        ,\n    \"$defs\": {\n        \"SpawnActorRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to spawn a new actor from a template\",\n            \"required\"\
        : [\n                \"templateId\"\n            ],\n            \"properties\": {\n                \"templateId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Template to instantiate from\"\n                },\n                \"actorId\": {\n            \
        \        \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Optional
        custom actor ID (auto-generated if not provided)\"\n                },\n                \"configurationOverrides\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": true,\n            \
        \        \"nullable\": true,\n                    \"description\": \"Override template defaults\"\n              \
        \  },\n                \"initialState\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"nullable\": true,\n                    \"description\": \"Initial state passed to behavior\"\
        \n                },\n                \"characterId\": {\n                    \"type\": \"string\",\n            \
        \        \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Optional
        character ID for NPC brain actors\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ActorInstanceResponse\"\
        ,\n    \"$defs\": {\n        \"ActorInstanceResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing actor instance details\",\n            \"required\":
        [\n                \"actorId\",\n                \"templateId\",\n                \"category\",\n                \"\
        status\",\n                \"startedAt\",\n                \"loopIterations\"\n            ],\n            \"properties\"\
        : {\n                \"actorId\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Unique actor identifier\"\n                },\n                \"templateId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Template this actor
        was instantiated from\"\n                },\n                \"category\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Actor category from template\"\n                },\n                \"nodeId\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Pool node running this actor (null in bannou mode)\"\n                },\n                \"nodeAppId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Pool node's app-id for direct messaging\"\n                },\n                \"status\": {\n               \
        \     \"description\": \"Current actor lifecycle state\",\n                    \"$ref\": \"#/$defs/ActorStatus\"\n\
        \                },\n                \"characterId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Associated
        character ID (for NPC brains)\"\n                },\n                \"startedAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the actor
        started running\"\n                },\n                \"lastHeartbeat\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"Last heartbeat timestamp from the actor\"\n                },\n                \"loopIterations\"\
        : {\n                    \"type\": \"integer\",\n                    \"format\": \"int64\",\n                    \"\
        description\": \"Number of behavior loop iterations executed\"\n                }\n            }\n        },\n   \
        \     \"ActorStatus\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"pending\"\
        ,\n                \"starting\",\n                \"running\",\n                \"paused\",\n                \"stopping\"\
        ,\n                \"stopped\",\n                \"error\"\n            ],\n            \"description\": \"Current
        actor lifecycle state\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Spawn a new actor from a template\",\n    \"description\": \"\",\n    \"\
        tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"SpawnActor\"\n}"
  /actor/get:
    post:
      operationId: GetActor
      summary: Get actor instance (instantiate-on-access if template allows)
      description: |
        If the actor exists, returns its current state.
        If the actor doesn't exist but a matching template has auto-spawn enabled,
        instantiates the actor and returns it.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetActorRequest'
      responses:
        '200':
          description: Actor retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActorInstanceResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetActorRequest\"\
        ,\n    \"$defs\": {\n        \"GetActorRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get an actor instance by ID\",\n            \"required\": [\n\
        \                \"actorId\"\n            ],\n            \"properties\": {\n                \"actorId\": {\n    \
        \                \"type\": \"string\",\n                    \"description\": \"Actor ID to retrieve\"\n          \
        \      }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ActorInstanceResponse\"\
        ,\n    \"$defs\": {\n        \"ActorInstanceResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing actor instance details\",\n            \"required\":
        [\n                \"actorId\",\n                \"templateId\",\n                \"category\",\n                \"\
        status\",\n                \"startedAt\",\n                \"loopIterations\"\n            ],\n            \"properties\"\
        : {\n                \"actorId\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Unique actor identifier\"\n                },\n                \"templateId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Template this actor
        was instantiated from\"\n                },\n                \"category\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Actor category from template\"\n                },\n                \"nodeId\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Pool node running this actor (null in bannou mode)\"\n                },\n                \"nodeAppId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Pool node's app-id for direct messaging\"\n                },\n                \"status\": {\n               \
        \     \"description\": \"Current actor lifecycle state\",\n                    \"$ref\": \"#/$defs/ActorStatus\"\n\
        \                },\n                \"characterId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Associated
        character ID (for NPC brains)\"\n                },\n                \"startedAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the actor
        started running\"\n                },\n                \"lastHeartbeat\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"Last heartbeat timestamp from the actor\"\n                },\n                \"loopIterations\"\
        : {\n                    \"type\": \"integer\",\n                    \"format\": \"int64\",\n                    \"\
        description\": \"Number of behavior loop iterations executed\"\n                }\n            }\n        },\n   \
        \     \"ActorStatus\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"pending\"\
        ,\n                \"starting\",\n                \"running\",\n                \"paused\",\n                \"stopping\"\
        ,\n                \"stopped\",\n                \"error\"\n            ],\n            \"description\": \"Current
        actor lifecycle state\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get actor instance (instantiate-on-access if template allows)\",\n    \"\
        description\": \"If the actor exists, returns its current state.\\nIf the actor doesn't exist but a matching template
        has auto-spawn enabled,\\ninstantiates the actor and returns it.\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"GetActor\"\n}"
  /actor/stop:
    post:
      operationId: StopActor
      summary: Stop a running actor
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StopActorRequest'
      responses:
        '200':
          description: Actor stopped successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StopActorResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/StopActorRequest\"\
        ,\n    \"$defs\": {\n        \"StopActorRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to stop a running actor\",\n            \"required\": [\n       \
        \         \"actorId\"\n            ],\n            \"properties\": {\n                \"actorId\": {\n           \
        \         \"type\": \"string\",\n                    \"description\": \"ID of the actor to stop\"\n              \
        \  },\n                \"graceful\": {\n                    \"type\": \"boolean\",\n                    \"default\"\
        : true,\n                    \"description\": \"If true, allows behavior to complete current iteration\"\n       \
        \         }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/StopActorResponse\"\
        ,\n    \"$defs\": {\n        \"StopActorResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response confirming actor stop operation\",\n            \"required\": [\n\
        \                \"stopped\",\n                \"finalStatus\"\n            ],\n            \"properties\": {\n  \
        \              \"stopped\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"\
        Whether the actor was successfully stopped\"\n                },\n                \"finalStatus\": {\n           \
        \         \"description\": \"Final status of the actor after stopping\",\n                    \"$ref\": \"#/$defs/ActorStatus\"\
        \n                }\n            }\n        },\n        \"ActorStatus\": {\n            \"type\": \"string\",\n  \
        \          \"enum\": [\n                \"pending\",\n                \"starting\",\n                \"running\",\n\
        \                \"paused\",\n                \"stopping\",\n                \"stopped\",\n                \"error\"\
        \n            ],\n            \"description\": \"Current actor lifecycle state\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Stop a running actor\",\n    \"description\": \"\",\n    \"tags\": [],\n\
        \    \"deprecated\": false,\n    \"operationId\": \"StopActor\"\n}"
  /actor/list:
    post:
      operationId: ListActors
      summary: List actors with optional filters
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListActorsRequest'
      responses:
        '200':
          description: Actors listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListActorsResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListActorsRequest\"\
        ,\n    \"$defs\": {\n        \"ListActorsRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to list actor instances with optional filters\",\n            \"\
        properties\": {\n                \"category\": {\n                    \"type\": \"string\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Filter by category\"\n                },\n             \
        \   \"nodeId\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n          \
        \          \"description\": \"Filter by pool node\"\n                },\n                \"status\": {\n         \
        \           \"description\": \"Filter by actor status\",\n                    \"$ref\": \"#/$defs/ActorStatus\"\n\
        \                },\n                \"characterId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Filter
        by associated character\"\n                },\n                \"limit\": {\n                    \"type\": \"integer\"\
        ,\n                    \"default\": 100,\n                    \"description\": \"Maximum number of actors to return\"\
        \n                },\n                \"offset\": {\n                    \"type\": \"integer\",\n                \
        \    \"default\": 0,\n                    \"description\": \"Number of actors to skip\"\n                }\n     \
        \       }\n        },\n        \"ActorStatus\": {\n            \"type\": \"string\",\n            \"enum\": [\n  \
        \              \"pending\",\n                \"starting\",\n                \"running\",\n                \"paused\"\
        ,\n                \"stopping\",\n                \"stopped\",\n                \"error\"\n            ],\n      \
        \      \"description\": \"Current actor lifecycle state\"\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListActorsResponse\"\
        ,\n    \"$defs\": {\n        \"ListActorsResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing a list of actor instances\",\n            \"required\"\
        : [\n                \"actors\",\n                \"total\"\n            ],\n            \"properties\": {\n     \
        \           \"actors\": {\n                    \"type\": \"array\",\n                    \"description\": \"List of
        actor instances\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ActorInstanceResponse\"\
        \n                    }\n                },\n                \"total\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Total number of actors matching the filter\"\n                }\n      \
        \      }\n        },\n        \"ActorInstanceResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing actor instance details\",\n            \"required\":
        [\n                \"actorId\",\n                \"templateId\",\n                \"category\",\n                \"\
        status\",\n                \"startedAt\",\n                \"loopIterations\"\n            ],\n            \"properties\"\
        : {\n                \"actorId\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Unique actor identifier\"\n                },\n                \"templateId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Template this actor
        was instantiated from\"\n                },\n                \"category\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Actor category from template\"\n                },\n                \"nodeId\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Pool node running this actor (null in bannou mode)\"\n                },\n                \"nodeAppId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Pool node's app-id for direct messaging\"\n                },\n                \"status\": {\n               \
        \     \"description\": \"Current actor lifecycle state\",\n                    \"$ref\": \"#/$defs/ActorStatus\"\n\
        \                },\n                \"characterId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Associated
        character ID (for NPC brains)\"\n                },\n                \"startedAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the actor
        started running\"\n                },\n                \"lastHeartbeat\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"Last heartbeat timestamp from the actor\"\n                },\n                \"loopIterations\"\
        : {\n                    \"type\": \"integer\",\n                    \"format\": \"int64\",\n                    \"\
        description\": \"Number of behavior loop iterations executed\"\n                }\n            }\n        },\n   \
        \     \"ActorStatus\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"pending\"\
        ,\n                \"starting\",\n                \"running\",\n                \"paused\",\n                \"stopping\"\
        ,\n                \"stopped\",\n                \"error\"\n            ],\n            \"description\": \"Current
        actor lifecycle state\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List actors with optional filters\",\n    \"description\": \"\",\n    \"\
        tags\": [],\n    \"deprecated\": false,\n    \"operationId\": \"ListActors\"\n}"
  /actor/inject-perception:
    post:
      operationId: InjectPerception
      summary: Inject a perception event into an actor's queue (testing)
      description: |
        Injects a perception event directly into the actor's perception queue
        for testing purposes. Useful for testing actor behavior without a
        full game server setup.
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InjectPerceptionRequest'
      responses:
        '200':
          description: Perception injected successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InjectPerceptionResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/InjectPerceptionRequest\"\
        ,\n    \"$defs\": {\n        \"InjectPerceptionRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to inject a perception event into an actor's queue\",\n         \
        \   \"required\": [\n                \"actorId\",\n                \"perception\"\n            ],\n            \"\
        properties\": {\n                \"actorId\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Target actor to inject perception into\"\n                },\n                \"perception\": {\n\
        \                    \"description\": \"Perception data to inject\",\n                    \"$ref\": \"#/$defs/PerceptionData\"\
        \n                }\n            }\n        },\n        \"PerceptionData\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"Data representing a perception event
        for an actor\",\n            \"required\": [\n                \"perceptionType\",\n                \"sourceId\"\n\
        \            ],\n            \"properties\": {\n                \"perceptionType\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Perception type (visual, auditory, tactile, etc.)\"\n      \
        \          },\n                \"sourceId\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"ID of the entity causing this perception\"\n                },\n                \"sourceType\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Type of source (character, npc, object, environment)\"\n                },\n                \"data\": {\n    \
        \                \"type\": \"object\",\n                    \"additionalProperties\": true,\n                    \"\
        nullable\": true,\n                    \"description\": \"Perception-specific data\"\n                },\n       \
        \         \"urgency\": {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n\
        \                    \"minimum\": 0,\n                    \"maximum\": 1,\n                    \"default\": 0.5,\n\
        \                    \"description\": \"How urgent this perception is (0-1)\"\n                }\n            }\n\
        \        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/InjectPerceptionResponse\"\
        ,\n    \"$defs\": {\n        \"InjectPerceptionResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response confirming perception injection\",\n            \"required\": [\n\
        \                \"queued\",\n                \"queueDepth\"\n            ],\n            \"properties\": {\n    \
        \            \"queued\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether
        the perception was successfully queued\"\n                },\n                \"queueDepth\": {\n                \
        \    \"type\": \"integer\",\n                    \"description\": \"Current depth of the perception queue\"\n    \
        \            }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Inject a perception event into an actor's queue (testing)\",\n    \"description\"\
        : \"Injects a perception event directly into the actor's perception queue\\nfor testing purposes. Useful for testing
        actor behavior without a\\nfull game server setup.\\n\",\n    \"tags\": [],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"InjectPerception\"\n}"
components:
  schemas:
    # === Actor Templates ===
    CreateActorTemplateRequest:
      type: object
      additionalProperties: false
      description: Request to create a new actor template definition
      required:
      - category
      - behaviorRef
      properties:
        category:
          type: string
          description: Category identifier (e.g., "npc-brain", "world-admin", "cron-cleanup")
        behaviorRef:
          type: string
          description: Reference to behavior in lib-assets (e.g., "asset://behaviors/npc-brain-v1")
        configuration:
          type: object
          additionalProperties: true
          nullable: true
          description: Default configuration passed to behavior execution
        autoSpawn:
          description: Auto-spawn configuration for instantiate-on-access
          nullable: true
          $ref: '#/components/schemas/AutoSpawnConfig'
        tickIntervalMs:
          type: integer
          default: 1000
          description: Milliseconds between behavior loop iterations
        autoSaveIntervalSeconds:
          type: integer
          default: 60
          description: Seconds between automatic state saves (0 to disable)
        maxInstancesPerNode:
          type: integer
          default: 100
          description: Maximum actors of this category per pool node

    AutoSpawnConfig:
      type: object
      additionalProperties: false
      description: Configuration for instantiate-on-access behavior
      properties:
        enabled:
          type: boolean
          default: false
          description: If true, accessing a non-existent actor creates it
        idPattern:
          type: string
          nullable: true
          description: |
            Regex pattern for actor IDs that trigger auto-spawn.
            Examples: "npc-.*" matches "npc-grok", "npc-merchant-123"
        maxInstances:
          type: integer
          nullable: true
          description: Maximum auto-spawned instances (0 = unlimited)
        characterIdCaptureGroup:
          type: integer
          minimum: 1
          nullable: true
          description: |
            1-based regex capture group index for extracting CharacterId from actor ID.
            Example: With idPattern "npc-brain-([a-f0-9-]+)" and characterIdCaptureGroup: 1,
            actor ID "npc-brain-abc-123-def" extracts "abc-123-def" as CharacterId (parsed as GUID).

    ActorTemplateResponse:
      type: object
      additionalProperties: false
      description: Response containing actor template details
      # NRT: Response properties server always sets (Rule 4)
      required:
      - templateId
      - category
      - behaviorRef
      - tickIntervalMs
      - autoSaveIntervalSeconds
      - maxInstancesPerNode
      - createdAt
      - updatedAt
      properties:
        templateId:
          type: string
          format: uuid
          description: Unique template identifier
        category:
          type: string
          description: Category identifier
        behaviorRef:
          type: string
          description: Reference to behavior in lib-assets
        configuration:
          type: object
          additionalProperties: true
          nullable: true
          description: Default configuration passed to behavior execution
        autoSpawn:
          description: Auto-spawn configuration for instantiate-on-access
          nullable: true
          $ref: '#/components/schemas/AutoSpawnConfig'
        tickIntervalMs:
          type: integer
          description: Milliseconds between behavior loop iterations
        autoSaveIntervalSeconds:
          type: integer
          description: Seconds between automatic state saves
        maxInstancesPerNode:
          type: integer
          description: Maximum actors of this category per pool node
        createdAt:
          type: string
          format: date-time
          description: When the template was created
        updatedAt:
          type: string
          format: date-time
          description: When the template was last updated

    GetActorTemplateRequest:
      type: object
      additionalProperties: false
      description: Request to get an actor template by ID or category
      properties:
        templateId:
          type: string
          format: uuid
          nullable: true
          description: Template ID to retrieve
        category:
          type: string
          nullable: true
          description: Or retrieve by category name

    ListActorTemplatesRequest:
      type: object
      additionalProperties: false
      description: Request to list actor templates with pagination
      properties:
        limit:
          type: integer
          default: 100
          description: Maximum number of templates to return
        offset:
          type: integer
          default: 0
          description: Number of templates to skip

    ListActorTemplatesResponse:
      type: object
      additionalProperties: false
      description: Response containing a list of actor templates
      # NRT: Response properties server always sets (Rule 4)
      required:
      - templates
      - total
      properties:
        templates:
          type: array
          description: List of actor templates
          items:
            $ref: '#/components/schemas/ActorTemplateResponse'
        total:
          type: integer
          description: Total number of templates available

    UpdateActorTemplateRequest:
      type: object
      additionalProperties: false
      description: Request to update an existing actor template
      required:
      - templateId
      properties:
        templateId:
          type: string
          format: uuid
          description: ID of the template to update
        behaviorRef:
          type: string
          nullable: true
          description: New behavior reference (triggers behavior.updated subscription)
        configuration:
          type: object
          additionalProperties: true
          nullable: true
          description: Updated configuration settings
        autoSpawn:
          description: Updated auto-spawn configuration
          nullable: true
          $ref: '#/components/schemas/AutoSpawnConfig'
        tickIntervalMs:
          type: integer
          nullable: true
          description: Updated tick interval in milliseconds
        autoSaveIntervalSeconds:
          type: integer
          nullable: true
          description: Updated auto-save interval in seconds

    DeleteActorTemplateRequest:
      type: object
      additionalProperties: false
      description: Request to delete an actor template
      required:
      - templateId
      properties:
        templateId:
          type: string
          format: uuid
          description: ID of the template to delete
        forceStopActors:
          type: boolean
          default: false
          description: If true, stops all running actors using this template

    DeleteActorTemplateResponse:
      type: object
      additionalProperties: false
      description: Response confirming template deletion
      # NRT: Response properties server always sets (Rule 4)
      required:
      - deleted
      - stoppedActorCount
      properties:
        deleted:
          type: boolean
          description: Whether the template was successfully deleted
        stoppedActorCount:
          type: integer
          description: Number of running actors that were stopped

    # === Actor Instances ===
    SpawnActorRequest:
      type: object
      additionalProperties: false
      description: Request to spawn a new actor from a template
      required:
      - templateId
      properties:
        templateId:
          type: string
          format: uuid
          description: Template to instantiate from
        actorId:
          type: string
          nullable: true
          description: Optional custom actor ID (auto-generated if not provided)
        configurationOverrides:
          type: object
          additionalProperties: true
          nullable: true
          description: Override template defaults
        initialState:
          type: object
          additionalProperties: true
          nullable: true
          description: Initial state passed to behavior
        characterId:
          type: string
          format: uuid
          nullable: true
          description: Optional character ID for NPC brain actors

    GetActorRequest:
      type: object
      additionalProperties: false
      description: Request to get an actor instance by ID
      required:
      - actorId
      properties:
        actorId:
          type: string
          description: Actor ID to retrieve

    ActorInstanceResponse:
      type: object
      additionalProperties: false
      description: Response containing actor instance details
      # NRT: Response properties server always sets (Rule 4)
      required:
      - actorId
      - templateId
      - category
      - status
      - startedAt
      - loopIterations
      properties:
        actorId:
          type: string
          description: Unique actor identifier
        templateId:
          type: string
          format: uuid
          description: Template this actor was instantiated from
        category:
          type: string
          description: Actor category from template
        nodeId:
          type: string
          nullable: true
          description: Pool node running this actor (null in bannou mode)
        nodeAppId:
          type: string
          nullable: true
          description: Pool node's app-id for direct messaging
        status:
          description: Current actor lifecycle state
          $ref: '#/components/schemas/ActorStatus'
        characterId:
          type: string
          format: uuid
          nullable: true
          description: Associated character ID (for NPC brains)
        startedAt:
          type: string
          format: date-time
          description: When the actor started running
        lastHeartbeat:
          type: string
          format: date-time
          nullable: true
          description: Last heartbeat timestamp from the actor
        loopIterations:
          type: integer
          format: int64
          description: Number of behavior loop iterations executed

    ActorStatus:
      type: string
      enum:
      - pending
      - starting
      - running
      - paused
      - stopping
      - stopped
      - error
      description: Current actor lifecycle state

    StopActorRequest:
      type: object
      additionalProperties: false
      description: Request to stop a running actor
      required:
      - actorId
      properties:
        actorId:
          type: string
          description: ID of the actor to stop
        graceful:
          type: boolean
          default: true
          description: If true, allows behavior to complete current iteration

    StopActorResponse:
      type: object
      additionalProperties: false
      description: Response confirming actor stop operation
      # NRT: Response properties server always sets (Rule 4)
      required:
      - stopped
      - finalStatus
      properties:
        stopped:
          type: boolean
          description: Whether the actor was successfully stopped
        finalStatus:
          description: Final status of the actor after stopping
          $ref: '#/components/schemas/ActorStatus'

    ListActorsRequest:
      type: object
      additionalProperties: false
      description: Request to list actor instances with optional filters
      properties:
        category:
          type: string
          nullable: true
          description: Filter by category
        nodeId:
          type: string
          nullable: true
          description: Filter by pool node
        status:
          description: Filter by actor status
          $ref: '#/components/schemas/ActorStatus'
        characterId:
          type: string
          format: uuid
          nullable: true
          description: Filter by associated character
        limit:
          type: integer
          default: 100
          description: Maximum number of actors to return
        offset:
          type: integer
          default: 0
          description: Number of actors to skip

    ListActorsResponse:
      type: object
      additionalProperties: false
      description: Response containing a list of actor instances
      # NRT: Response properties server always sets (Rule 4)
      required:
      - actors
      - total
      properties:
        actors:
          type: array
          description: List of actor instances
          items:
            $ref: '#/components/schemas/ActorInstanceResponse'
        total:
          type: integer
          description: Total number of actors matching the filter

    # === Perception Injection (Testing) ===
    InjectPerceptionRequest:
      type: object
      additionalProperties: false
      description: Request to inject a perception event into an actor's queue
      required:
      - actorId
      - perception
      properties:
        actorId:
          type: string
          description: Target actor to inject perception into
        perception:
          description: Perception data to inject
          $ref: '#/components/schemas/PerceptionData'

    PerceptionData:
      type: object
      additionalProperties: false
      description: |
        Data representing a perception event for an actor.

        Spatial context can be provided in two ways (hybrid approach):
        1. Typed: Use the optional spatialContext field for structured spatial data
        2. Schema-less: Use perceptionType="spatial" with data containing spatial info

        The typed approach is recommended when game server has structured spatial data.
        The schema-less approach allows flexibility for game-specific spatial formats.
      required:
      - perceptionType
      - sourceId
      properties:
        perceptionType:
          type: string
          description: |
            Perception type. Common values: visual, auditory, tactile, olfactory,
            proprioceptive, spatial. Use "spatial" for schema-less spatial data in 'data' field.
        sourceId:
          type: string
          description: ID of the entity causing this perception
        sourceType:
          type: string
          nullable: true
          description: Type of source (character, npc, object, environment)
        data:
          type: object
          additionalProperties: true
          nullable: true
          description: |
            Perception-specific data. For perceptionType="spatial", this can contain
            game-specific spatial context in any format the game server defines.
        urgency:
          type: number
          format: float
          minimum: 0
          maximum: 1
          default: 0.5
          description: How urgent this perception is (0-1)
        spatialContext:
          $ref: '#/components/schemas/SpatialContext'
          nullable: true
          description: |
            Optional typed spatial context from game server's local spatial state.
            Provides structured information about terrain, nearby objects, hazards, etc.
            Alternative to using perceptionType="spatial" with schema-less data.

    SpatialContext:
      type: object
      additionalProperties: true
      description: |
        Spatial context derived from game server's authoritative spatial state.
        Included in perception events to give NPC actors awareness of their environment
        without requiring direct map subscriptions.

        Note: additionalProperties=true allows game-specific extensions.
      properties:
        terrainType:
          type: string
          nullable: true
          description: Terrain type at character position (grass, stone, water, etc.)
        elevation:
          type: number
          format: float
          nullable: true
          description: Elevation at character position
        nearbyObjects:
          type: array
          nullable: true
          description: Objects within perception radius
          items:
            $ref: '#/components/schemas/NearbyObject'
        hazardsInRange:
          type: array
          nullable: true
          description: Active hazards within detection range
          items:
            $ref: '#/components/schemas/HazardInfo'
        pathableDirections:
          type: array
          nullable: true
          description: Directions the character can move (for navigation awareness)
          items:
            type: string
            description: Cardinal or relative direction (north, south, east, west, forward, etc.)
        coverNearby:
          type: boolean
          nullable: true
          description: Whether cover is available within close range
        indoors:
          type: boolean
          nullable: true
          description: Whether character is currently indoors/under roof

    NearbyObject:
      type: object
      additionalProperties: true
      description: Information about a nearby object perceived by the character
      properties:
        objectId:
          type: string
          format: uuid
          description: Unique identifier of the object
        objectType:
          type: string
          description: Type of object (boulder_cluster, tree, building, etc.)
        distance:
          type: number
          format: float
          description: Distance from character in game units
        direction:
          type: string
          description: Relative direction (north, south, east, west, above, below, etc.)
        position:
          $ref: '#/components/schemas/Position3D'
          nullable: true
          description: Optional absolute position

    HazardInfo:
      type: object
      additionalProperties: true
      description: Information about a hazard in range
      properties:
        hazardType:
          type: string
          description: Type of hazard (fire, poison, radiation, deep_water, etc.)
        distance:
          type: number
          format: float
          description: Distance to hazard edge
        severity:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Hazard severity (0-1)
        direction:
          type: string
          nullable: true
          description: Direction to hazard center

    Position3D:
      type: object
      additionalProperties: false
      description: 3D position in world coordinates
      required:
      - x
      - y
      - z
      properties:
        x:
          type: number
          format: float
          description: X coordinate
        y:
          type: number
          format: float
          description: Y coordinate (typically vertical)
        z:
          type: number
          format: float
          description: Z coordinate

    InjectPerceptionResponse:
      type: object
      additionalProperties: false
      description: Response confirming perception injection
      # NRT: Response properties server always sets (Rule 4)
      required:
      - queued
      - queueDepth
      properties:
        queued:
          type: boolean
          description: Whether the perception was successfully queued
        queueDepth:
          type: integer
          description: Current depth of the perception queue
