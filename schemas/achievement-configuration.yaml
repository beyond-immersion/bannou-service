openapi: 3.0.3
info:
  title: Achievement Service Configuration
  description: |
    Configuration schema for Achievement service.
    Properties are bound to environment variables with BANNOU_ prefix.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before
    modifying this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    # State Store Configuration
    DefinitionStoreName:
      type: string
      description: Name of the state store for achievement definitions (MySQL recommended)
      default: "achievement-definition"
      env: ACHIEVEMENT_DEFINITION_STORE_NAME
    ProgressStoreName:
      type: string
      description: Name of the state store for progress tracking (Redis for hot data)
      default: "achievement-progress"
      env: ACHIEVEMENT_PROGRESS_STORE_NAME
    UnlockStoreName:
      type: string
      description: Name of the state store for unlock records (MySQL for persistence)
      default: "achievement-unlock"
      env: ACHIEVEMENT_UNLOCK_STORE_NAME
    # Platform Sync Configuration (all optional - platform sync disabled when not configured)
    SteamApiKey:
      type: string
      nullable: true  # NRT: Optional - Steam sync disabled when not configured
      description: Steam Web API key for achievement sync (optional - Steam sync disabled if not set)
      env: ACHIEVEMENT_STEAM_API_KEY
    SteamAppId:
      type: string
      nullable: true  # NRT: Optional - Steam sync disabled when not configured
      description: Steam App ID for achievement mapping (optional - Steam sync disabled if not set)
      env: ACHIEVEMENT_STEAM_APP_ID
    XboxClientId:
      type: string
      nullable: true  # NRT: Optional - Xbox sync disabled when not configured (stub - not implemented)
      description: Xbox Live client ID (optional - not implemented)
      env: ACHIEVEMENT_XBOX_CLIENT_ID
    XboxClientSecret:
      type: string
      nullable: true  # NRT: Optional - Xbox sync disabled when not configured (stub - not implemented)
      description: Xbox Live client secret (optional - not implemented)
      env: ACHIEVEMENT_XBOX_CLIENT_SECRET
    PlayStationClientId:
      type: string
      nullable: true  # NRT: Optional - PlayStation sync disabled when not configured (stub - not implemented)
      description: PlayStation Network client ID (optional - not implemented)
      env: ACHIEVEMENT_PLAYSTATION_CLIENT_ID
    PlayStationClientSecret:
      type: string
      nullable: true  # NRT: Optional - PlayStation sync disabled when not configured (stub - not implemented)
      description: PlayStation Network client secret (optional - not implemented)
      env: ACHIEVEMENT_PLAYSTATION_CLIENT_SECRET
    # Sync Behavior Configuration
    MockPlatformSync:
      type: boolean
      description: Enable mock mode for platform sync (returns success without real API calls)
      default: false
      env: ACHIEVEMENT_MOCK_PLATFORM_SYNC
    AutoSyncOnUnlock:
      type: boolean
      description: Automatically sync achievements to platforms when unlocked
      default: true
      env: ACHIEVEMENT_AUTO_SYNC_ON_UNLOCK
    SyncRetryAttempts:
      type: integer
      description: Number of retry attempts for failed platform syncs
      default: 3
      env: ACHIEVEMENT_SYNC_RETRY_ATTEMPTS
    SyncRetryDelaySeconds:
      type: integer
      description: Delay between sync retry attempts in seconds
      default: 60
      env: ACHIEVEMENT_SYNC_RETRY_DELAY_SECONDS
    # Progress Tracking Configuration
    ProgressCacheTtlSeconds:
      type: integer
      description: TTL in seconds for cached progress data
      default: 300
      env: ACHIEVEMENT_PROGRESS_CACHE_TTL_SECONDS
    # Rarity Calculation Configuration
    RarityCalculationIntervalMinutes:
      type: integer
      description: How often to recalculate achievement rarity percentages
      default: 60
      env: ACHIEVEMENT_RARITY_CALCULATION_INTERVAL_MINUTES
    RareThresholdPercent:
      type: number
      format: double
      description: Threshold percentage below which an achievement is considered rare
      default: 5.0
      env: ACHIEVEMENT_RARE_THRESHOLD_PERCENT
    RarityThresholdEarnedCount:
      type: integer
      description: Minimum earned count for an achievement to be considered common (below this is rare regardless of percentage)
      default: 100
      env: ACHIEVEMENT_RARITY_THRESHOLD_EARNED_COUNT
