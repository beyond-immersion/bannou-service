openapi: 3.0.4
info:
  title: Music Service Configuration
  description: |
    Configuration schema for Music service.
    Properties are bound to environment variables with MUSIC_ prefix.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    # Cache Configuration
    CompositionCacheTtlSeconds:
      type: integer
      description: TTL in seconds for cached deterministic compositions
      default: 86400
      env: MUSIC_COMPOSITION_CACHE_TTL_SECONDS

    # Generation Defaults
    DefaultTicksPerBeat:
      type: integer
      description: Default MIDI ticks per beat (PPQN) for composition rendering
      default: 480
      env: MUSIC_DEFAULT_TICKS_PER_BEAT

    DefaultChordsPerBar:
      type: integer
      description: Default number of chords per bar in generated progressions
      default: 1
      env: MUSIC_DEFAULT_CHORDS_PER_BAR

    DefaultVoiceCount:
      type: integer
      description: Default number of voices for chord voicing
      default: 4
      env: MUSIC_DEFAULT_VOICE_COUNT

    DefaultBeatsPerChord:
      type: number
      description: Default beats per chord in progression generation
      default: 4.0
      env: MUSIC_DEFAULT_BEATS_PER_CHORD

    # Melody Defaults
    DefaultMelodySyncopation:
      type: number
      description: Default syncopation amount for melody generation (0.0-1.0)
      default: 0.2
      env: MUSIC_DEFAULT_MELODY_SYNCOPATION

    DefaultMelodyDensity:
      type: number
      description: Default note density for melody generation (0.0-1.0)
      default: 0.7
      env: MUSIC_DEFAULT_MELODY_DENSITY

    # Default Emotional State
    DefaultEmotionalTension:
      type: number
      description: Default tension value for emotional state (0.0-1.0)
      default: 0.2
      env: MUSIC_DEFAULT_EMOTIONAL_TENSION

    DefaultEmotionalBrightness:
      type: number
      description: Default brightness value for emotional state (0.0-1.0)
      default: 0.5
      env: MUSIC_DEFAULT_EMOTIONAL_BRIGHTNESS

    DefaultEmotionalEnergy:
      type: number
      description: Default energy value for emotional state (0.0-1.0)
      default: 0.5
      env: MUSIC_DEFAULT_EMOTIONAL_ENERGY

    DefaultEmotionalWarmth:
      type: number
      description: Default warmth value for emotional state (0.0-1.0)
      default: 0.5
      env: MUSIC_DEFAULT_EMOTIONAL_WARMTH

    DefaultEmotionalStability:
      type: number
      description: Default stability value for emotional state (0.0-1.0)
      default: 0.8
      env: MUSIC_DEFAULT_EMOTIONAL_STABILITY

    DefaultEmotionalValence:
      type: number
      description: Default valence value for emotional state (0.0-1.0)
      default: 0.5
      env: MUSIC_DEFAULT_EMOTIONAL_VALENCE

    # Contour Detection (T21 compliant - no hardcoded magic numbers)
    ContourTensionThreshold:
      type: number
      format: double
      default: 0.2
      minimum: 0.05
      maximum: 0.5
      description: |
        Tension delta threshold for determining ascending/descending contour.
        If final tension exceeds initial by this amount, contour is ascending.
        If it's below initial by this amount, contour is descending.
      env: MUSIC_CONTOUR_TENSION_THRESHOLD

    ContourDefaultTension:
      type: number
      format: double
      default: 0.5
      minimum: 0
      maximum: 1
      description: |
        Default initial tension used when no section provides a value.
      env: MUSIC_CONTOUR_DEFAULT_TENSION

    # Density Calculation (T21 compliant - no hardcoded magic numbers)
    DensityMinimum:
      type: number
      format: double
      default: 0.4
      minimum: 0.1
      maximum: 0.8
      description: |
        Minimum melody density (floor value before energy scaling).
      env: MUSIC_DENSITY_MINIMUM

    DensityEnergyMultiplier:
      type: number
      format: double
      default: 0.5
      minimum: 0.1
      maximum: 0.8
      description: |
        Multiplier applied to energy for density calculation.
        Final density = DensityMinimum + (energy * DensityEnergyMultiplier).
      env: MUSIC_DENSITY_ENERGY_MULTIPLIER
