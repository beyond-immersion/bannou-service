openapi: 3.0.0
info:
  title: Bannou Character History Service API
  description: |
    Historical event participation and backstory management for characters.

    **Machine-Readable**: All data is structured for behavior system consumption,
    not player-facing narrative. Backstory elements are key-value pairs that
    influence NPC decision-making.

    **Fully Optional**: Games not using character history incur zero overhead.
    This service is completely independent from the core Character service.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    **Historical Events**: Characters can participate in realm-wide or world events.
    Participation is tracked with roles (LEADER, COMBATANT, VICTIM, etc.) and
    significance ratings that affect behavior system weighting.

    **Backstory Elements**: Structured key-value elements that define character background:
    - ORIGIN: Where the character is from
    - OCCUPATION: Past or current profession
    - TRAINING: Skills and education received
    - TRAUMA: Past traumatic experiences
    - ACHIEVEMENT: Notable accomplishments
    - SECRET: Hidden knowledge or past
    - GOAL: Life ambitions
    - FEAR: Deep-seated fears
    - BELIEF: Core values and principles

    **Compression Integration**: When a character is compressed (archived after death),
    history records are summarized into the CharacterArchive and then deleted.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before modifying
    this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)

paths:
  /character-history/record-participation:
    post:
      summary: Record character participation in a historical event
      operationId: recordParticipation
      tags:
      - Historical Events
      description: |
        Records that a character participated in a historical event. Events are
        identified by eventId (typically managed by a game-specific event system).
        The significance rating affects how strongly this event influences behavior.
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecordParticipationRequest'
      responses:
        '200':
          description: Participation recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoricalParticipation'
        '400':
          description: Invalid participation data
        '409':
          description: Participation already recorded for this character and event

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RecordParticipationRequest\"\
        ,\n    \"$defs\": {\n        \"RecordParticipationRequest\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Request payload for recording event participation\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\",\n                \"eventId\",\n                \"eventName\"\
        ,\n                \"eventCategory\",\n                \"role\",\n                \"eventDate\"\n            ],\n\
        \            \"properties\": {\n                \"characterId\": {\n                    \"type\": \"string\",\n  \
        \                  \"format\": \"uuid\",\n                    \"description\": \"ID of the character who participated\"\
        \n                },\n                \"eventId\": {\n                    \"type\": \"string\",\n                \
        \    \"format\": \"uuid\",\n                    \"description\": \"ID of the historical event\"\n                },\n\
        \                \"eventName\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n\
        \                    \"maxLength\": 200,\n                    \"description\": \"Name of the event\"\n           \
        \     },\n                \"eventCategory\": {\n                    \"$ref\": \"#/$defs/EventCategory\",\n       \
        \             \"description\": \"Category of the event\"\n                },\n                \"role\": {\n      \
        \              \"$ref\": \"#/$defs/ParticipationRole\",\n                    \"description\": \"How the character
        participated\"\n                },\n                \"eventDate\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"description\": \"In-game date when the event
        occurred\"\n                },\n                \"significance\": {\n                    \"type\": \"number\",\n \
        \                   \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\"\
        : 1.0,\n                    \"default\": 0.5,\n                    \"description\": \"How significant this event was
        for the character\"\n                },\n                \"metadata\": {\n                    \"type\": \"object\"\
        ,\n                    \"additionalProperties\": true,\n                    \"nullable\": true,\n                \
        \    \"description\": \"Optional event-specific details\"\n                }\n            }\n        },\n        \"\
        EventCategory\": {\n            \"type\": \"string\",\n            \"description\": \"Categories of historical events
        that characters can participate in\",\n            \"enum\": [\n                \"WAR\",\n                \"NATURAL_DISASTER\"\
        ,\n                \"POLITICAL\",\n                \"ECONOMIC\",\n                \"RELIGIOUS\",\n               \
        \ \"CULTURAL\",\n                \"PERSONAL\"\n            ]\n        },\n        \"ParticipationRole\": {\n     \
        \       \"type\": \"string\",\n            \"description\": \"How the character participated in the historical event\"\
        ,\n            \"enum\": [\n                \"LEADER\",\n                \"COMBATANT\",\n                \"VICTIM\"\
        ,\n                \"WITNESS\",\n                \"BENEFICIARY\",\n                \"CONSPIRATOR\",\n            \
        \    \"HERO\",\n                \"SURVIVOR\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/HistoricalParticipation\"\
        ,\n    \"$defs\": {\n        \"HistoricalParticipation\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Record of a character's participation in a historical event\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"participationId\",\n                \"characterId\",\n           \
        \     \"eventId\",\n                \"eventName\",\n                \"eventCategory\",\n                \"role\",\n\
        \                \"eventDate\",\n                \"createdAt\"\n            ],\n            \"properties\": {\n  \
        \              \"participationId\": {\n                    \"type\": \"string\",\n                    \"format\":
        \"uuid\",\n                    \"description\": \"Unique ID for this participation record\"\n                },\n\
        \                \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"description\": \"ID of the character who participated\"\n                },\n     \
        \           \"eventId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"ID of the historical event\"\n                },\n                \"eventName\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Name of the event (for display
        and summarization)\"\n                },\n                \"eventCategory\": {\n                    \"$ref\": \"#/$defs/EventCategory\"\
        ,\n                    \"description\": \"Category of the historical event\"\n                },\n               \
        \ \"role\": {\n                    \"$ref\": \"#/$defs/ParticipationRole\",\n                    \"description\":
        \"How the character participated\"\n                },\n                \"eventDate\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"In-game date
        when the event occurred\"\n                },\n                \"significance\": {\n                    \"type\":
        \"number\",\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n                 \
        \   \"maximum\": 1.0,\n                    \"default\": 0.5,\n                    \"description\": \"How significant
        this event was for the character (0.0 to 1.0).\\nAffects behavior system weighting of this memory.\\n\"\n        \
        \        },\n                \"metadata\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"nullable\": true,\n                    \"description\": \"Event-specific details for
        behavior decisions\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"When this record was created\"\
        \n                }\n            }\n        },\n        \"EventCategory\": {\n            \"type\": \"string\",\n\
        \            \"description\": \"Categories of historical events that characters can participate in\",\n          \
        \  \"enum\": [\n                \"WAR\",\n                \"NATURAL_DISASTER\",\n                \"POLITICAL\",\n\
        \                \"ECONOMIC\",\n                \"RELIGIOUS\",\n                \"CULTURAL\",\n                \"\
        PERSONAL\"\n            ]\n        },\n        \"ParticipationRole\": {\n            \"type\": \"string\",\n     \
        \       \"description\": \"How the character participated in the historical event\",\n            \"enum\": [\n  \
        \              \"LEADER\",\n                \"COMBATANT\",\n                \"VICTIM\",\n                \"WITNESS\"\
        ,\n                \"BENEFICIARY\",\n                \"CONSPIRATOR\",\n                \"HERO\",\n               \
        \ \"SURVIVOR\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Record character participation in a historical event\",\n    \"description\"\
        : \"Records that a character participated in a historical event. Events are\\nidentified by eventId (typically managed
        by a game-specific event system).\\nThe significance rating affects how strongly this event influences behavior.\\\
        n\",\n    \"tags\": [\n        \"Historical Events\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"\
        recordParticipation\"\n}"
  /character-history/get-participation:
    post:
      summary: Get all historical events a character participated in
      operationId: getParticipation
      tags:
      - Historical Events
      description: |
        Retrieves all historical event participation records for a character.
        Supports filtering by event category and minimum significance.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetParticipationRequest'
      responses:
        '200':
          description: Participation records retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParticipationListResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetParticipationRequest\"\
        ,\n    \"$defs\": {\n        \"GetParticipationRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request payload for getting a character's event participation\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n   \
        \             \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the character to get participation for\"\n                },\n   \
        \             \"eventCategory\": {\n                    \"$ref\": \"#/$defs/EventCategory\",\n                   \
        \ \"nullable\": true,\n                    \"description\": \"Filter by event category\"\n                },\n   \
        \             \"minimumSignificance\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\": 1.0,\n                    \"\
        nullable\": true,\n                    \"description\": \"Filter by minimum significance\"\n                },\n \
        \               \"page\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n   \
        \                 \"default\": 1,\n                    \"description\": \"Page number for pagination (1-based)\"\n\
        \                },\n                \"pageSize\": {\n                    \"type\": \"integer\",\n               \
        \     \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"default\": 20,\n             \
        \       \"description\": \"Number of results per page\"\n                }\n            }\n        },\n        \"\
        EventCategory\": {\n            \"type\": \"string\",\n            \"description\": \"Categories of historical events
        that characters can participate in\",\n            \"enum\": [\n                \"WAR\",\n                \"NATURAL_DISASTER\"\
        ,\n                \"POLITICAL\",\n                \"ECONOMIC\",\n                \"RELIGIOUS\",\n               \
        \ \"CULTURAL\",\n                \"PERSONAL\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ParticipationListResponse\"\
        ,\n    \"$defs\": {\n        \"ParticipationListResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Paginated list of participation records\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"participations\",\n                \"totalCount\",\n                \"page\",\n           \
        \     \"pageSize\"\n            ],\n            \"properties\": {\n                \"participations\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/HistoricalParticipation\"\
        \n                    },\n                    \"description\": \"List of participation records\"\n               \
        \ },\n                \"totalCount\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Total number of matching records\"\n                },\n                \"page\": {\n                    \"type\"\
        : \"integer\",\n                    \"description\": \"Current page number (1-based)\"\n                },\n     \
        \           \"pageSize\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Number
        of results per page\"\n                },\n                \"hasNextPage\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether there are more results after this page\"\n                },\n \
        \               \"hasPreviousPage\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether there are results before this page\"\n                }\n            }\n        },\n        \"HistoricalParticipation\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Record of a character's participation in a
        historical event\",\n            \"additionalProperties\": false,\n            \"required\": [\n                \"\
        participationId\",\n                \"characterId\",\n                \"eventId\",\n                \"eventName\"\
        ,\n                \"eventCategory\",\n                \"role\",\n                \"eventDate\",\n               \
        \ \"createdAt\"\n            ],\n            \"properties\": {\n                \"participationId\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Unique ID for this participation record\"\n                },\n                \"characterId\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\":
        \"ID of the character who participated\"\n                },\n                \"eventId\": {\n                   \
        \ \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"ID of the
        historical event\"\n                },\n                \"eventName\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Name of the event (for display and summarization)\"\n                },\n\
        \                \"eventCategory\": {\n                    \"$ref\": \"#/$defs/EventCategory\",\n                \
        \    \"description\": \"Category of the historical event\"\n                },\n                \"role\": {\n    \
        \                \"$ref\": \"#/$defs/ParticipationRole\",\n                    \"description\": \"How the character
        participated\"\n                },\n                \"eventDate\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"description\": \"In-game date when the event
        occurred\"\n                },\n                \"significance\": {\n                    \"type\": \"number\",\n \
        \                   \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\"\
        : 1.0,\n                    \"default\": 0.5,\n                    \"description\": \"How significant this event was
        for the character (0.0 to 1.0).\\nAffects behavior system weighting of this memory.\\n\"\n                },\n   \
        \             \"metadata\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"nullable\": true,\n                    \"description\": \"Event-specific details for
        behavior decisions\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"When this record was created\"\
        \n                }\n            }\n        },\n        \"EventCategory\": {\n            \"type\": \"string\",\n\
        \            \"description\": \"Categories of historical events that characters can participate in\",\n          \
        \  \"enum\": [\n                \"WAR\",\n                \"NATURAL_DISASTER\",\n                \"POLITICAL\",\n\
        \                \"ECONOMIC\",\n                \"RELIGIOUS\",\n                \"CULTURAL\",\n                \"\
        PERSONAL\"\n            ]\n        },\n        \"ParticipationRole\": {\n            \"type\": \"string\",\n     \
        \       \"description\": \"How the character participated in the historical event\",\n            \"enum\": [\n  \
        \              \"LEADER\",\n                \"COMBATANT\",\n                \"VICTIM\",\n                \"WITNESS\"\
        ,\n                \"BENEFICIARY\",\n                \"CONSPIRATOR\",\n                \"HERO\",\n               \
        \ \"SURVIVOR\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get all historical events a character participated in\",\n    \"description\"\
        : \"Retrieves all historical event participation records for a character.\\nSupports filtering by event category and
        minimum significance.\\n\",\n    \"tags\": [\n        \"Historical Events\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"getParticipation\"\n}"
  /character-history/get-event-participants:
    post:
      summary: Get all characters who participated in a historical event
      operationId: getEventParticipants
      tags:
      - Historical Events
      description: |
        Retrieves all characters who participated in a specific historical event.
        Useful for generating event summaries or finding related characters.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetEventParticipantsRequest'
      responses:
        '200':
          description: Participants retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParticipationListResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetEventParticipantsRequest\"\
        ,\n    \"$defs\": {\n        \"GetEventParticipantsRequest\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Request payload for getting participants of an event\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"eventId\"\n            ],\n            \"properties\": {\n       \
        \         \"eventId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n \
        \                   \"description\": \"ID of the historical event\"\n                },\n                \"role\"\
        : {\n                    \"$ref\": \"#/$defs/ParticipationRole\",\n                    \"nullable\": true,\n     \
        \               \"description\": \"Filter by participation role\"\n                },\n                \"page\": {\n\
        \                    \"type\": \"integer\",\n                    \"minimum\": 1,\n                    \"default\"\
        : 1,\n                    \"description\": \"Page number for pagination (1-based)\"\n                },\n        \
        \        \"pageSize\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n      \
        \              \"maximum\": 100,\n                    \"default\": 20,\n                    \"description\": \"Number
        of results per page\"\n                }\n            }\n        },\n        \"ParticipationRole\": {\n          \
        \  \"type\": \"string\",\n            \"description\": \"How the character participated in the historical event\"\
        ,\n            \"enum\": [\n                \"LEADER\",\n                \"COMBATANT\",\n                \"VICTIM\"\
        ,\n                \"WITNESS\",\n                \"BENEFICIARY\",\n                \"CONSPIRATOR\",\n            \
        \    \"HERO\",\n                \"SURVIVOR\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ParticipationListResponse\"\
        ,\n    \"$defs\": {\n        \"ParticipationListResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Paginated list of participation records\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"participations\",\n                \"totalCount\",\n                \"page\",\n           \
        \     \"pageSize\"\n            ],\n            \"properties\": {\n                \"participations\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/HistoricalParticipation\"\
        \n                    },\n                    \"description\": \"List of participation records\"\n               \
        \ },\n                \"totalCount\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Total number of matching records\"\n                },\n                \"page\": {\n                    \"type\"\
        : \"integer\",\n                    \"description\": \"Current page number (1-based)\"\n                },\n     \
        \           \"pageSize\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Number
        of results per page\"\n                },\n                \"hasNextPage\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether there are more results after this page\"\n                },\n \
        \               \"hasPreviousPage\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether there are results before this page\"\n                }\n            }\n        },\n        \"HistoricalParticipation\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Record of a character's participation in a
        historical event\",\n            \"additionalProperties\": false,\n            \"required\": [\n                \"\
        participationId\",\n                \"characterId\",\n                \"eventId\",\n                \"eventName\"\
        ,\n                \"eventCategory\",\n                \"role\",\n                \"eventDate\",\n               \
        \ \"createdAt\"\n            ],\n            \"properties\": {\n                \"participationId\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Unique ID for this participation record\"\n                },\n                \"characterId\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\":
        \"ID of the character who participated\"\n                },\n                \"eventId\": {\n                   \
        \ \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"ID of the
        historical event\"\n                },\n                \"eventName\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Name of the event (for display and summarization)\"\n                },\n\
        \                \"eventCategory\": {\n                    \"$ref\": \"#/$defs/EventCategory\",\n                \
        \    \"description\": \"Category of the historical event\"\n                },\n                \"role\": {\n    \
        \                \"$ref\": \"#/$defs/ParticipationRole\",\n                    \"description\": \"How the character
        participated\"\n                },\n                \"eventDate\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"description\": \"In-game date when the event
        occurred\"\n                },\n                \"significance\": {\n                    \"type\": \"number\",\n \
        \                   \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\"\
        : 1.0,\n                    \"default\": 0.5,\n                    \"description\": \"How significant this event was
        for the character (0.0 to 1.0).\\nAffects behavior system weighting of this memory.\\n\"\n                },\n   \
        \             \"metadata\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"nullable\": true,\n                    \"description\": \"Event-specific details for
        behavior decisions\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"When this record was created\"\
        \n                }\n            }\n        },\n        \"EventCategory\": {\n            \"type\": \"string\",\n\
        \            \"description\": \"Categories of historical events that characters can participate in\",\n          \
        \  \"enum\": [\n                \"WAR\",\n                \"NATURAL_DISASTER\",\n                \"POLITICAL\",\n\
        \                \"ECONOMIC\",\n                \"RELIGIOUS\",\n                \"CULTURAL\",\n                \"\
        PERSONAL\"\n            ]\n        },\n        \"ParticipationRole\": {\n            \"type\": \"string\",\n     \
        \       \"description\": \"How the character participated in the historical event\",\n            \"enum\": [\n  \
        \              \"LEADER\",\n                \"COMBATANT\",\n                \"VICTIM\",\n                \"WITNESS\"\
        ,\n                \"BENEFICIARY\",\n                \"CONSPIRATOR\",\n                \"HERO\",\n               \
        \ \"SURVIVOR\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get all characters who participated in a historical event\",\n    \"description\"\
        : \"Retrieves all characters who participated in a specific historical event.\\nUseful for generating event summaries
        or finding related characters.\\n\",\n    \"tags\": [\n        \"Historical Events\"\n    ],\n    \"deprecated\":
        false,\n    \"operationId\": \"getEventParticipants\"\n}"
  /character-history/delete-participation:
    post:
      summary: Delete a participation record
      operationId: deleteParticipation
      tags:
      - Historical Events
      description: |
        Removes a specific participation record. Used during character compression
        or to correct erroneous records.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteParticipationRequest'
      responses:
        '200':
          description: Participation deleted successfully
        '404':
          description: Participation record not found

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteParticipationRequest\"\
        ,\n    \"$defs\": {\n        \"DeleteParticipationRequest\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Request payload for deleting a participation record\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"participationId\"\n            ],\n            \"properties\": {\n\
        \                \"participationId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"description\": \"ID of the participation record to delete\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n    \"summary\": \"Delete a participation record\",\n    \"description\": \"Removes a specific
        participation record. Used during character compression\\nor to correct erroneous records.\\n\",\n    \"tags\": [\n\
        \        \"Historical Events\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"deleteParticipation\"\n\
        }"
  /character-history/get-backstory:
    post:
      summary: Get machine-readable backstory elements for behavior system
      operationId: getBackstory
      tags:
      - Backstory
      description: |
        Retrieves structured backstory elements for a character. These elements
        are machine-readable key-value pairs used by the behavior system for
        decision-making, not narrative text for players.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetBackstoryRequest'
      responses:
        '200':
          description: Backstory retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackstoryResponse'
        '404':
          description: No backstory defined for this character

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetBackstoryRequest\"\
        ,\n    \"$defs\": {\n        \"GetBackstoryRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request payload for getting a character's backstory\",\n            \"additionalProperties\": false,\n       \
        \     \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n          \
        \      \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"ID of the character to get backstory for\"\n                },\n         \
        \       \"elementTypes\": {\n                    \"type\": \"array\",\n                    \"items\": {\n        \
        \                \"$ref\": \"#/$defs/BackstoryElementType\"\n                    },\n                    \"nullable\"\
        : true,\n                    \"description\": \"Filter by element types (null for all)\"\n                },\n   \
        \             \"minimumStrength\": {\n                    \"type\": \"number\",\n                    \"format\": \"\
        float\",\n                    \"minimum\": 0.0,\n                    \"maximum\": 1.0,\n                    \"nullable\"\
        : true,\n                    \"description\": \"Filter by minimum strength\"\n                }\n            }\n \
        \       },\n        \"BackstoryElementType\": {\n            \"type\": \"string\",\n            \"description\": \"\
        Types of backstory elements. Each type represents a different aspect\\nof the character's background that influences
        behavior.\\n\",\n            \"enum\": [\n                \"ORIGIN\",\n                \"OCCUPATION\",\n         \
        \       \"TRAINING\",\n                \"TRAUMA\",\n                \"ACHIEVEMENT\",\n                \"SECRET\",\n\
        \                \"GOAL\",\n                \"FEAR\",\n                \"BELIEF\"\n            ]\n        }\n    }\n\
        }"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/BackstoryResponse\"\
        ,\n    \"$defs\": {\n        \"BackstoryResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Complete backstory data for a character\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"characterId\",\n                \"elements\"\n            ],\n            \"properties\": {\n\
        \                \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"description\": \"ID of the character this backstory belongs to\"\n                },\n\
        \                \"elements\": {\n                    \"type\": \"array\",\n                    \"items\": {\n   \
        \                     \"$ref\": \"#/$defs/BackstoryElement\"\n                    },\n                    \"description\"\
        : \"All backstory elements for this character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"When this backstory was first created\"\n                },\n    \
        \            \"updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When this backstory was last modified\"\
        \n                }\n            }\n        },\n        \"BackstoryElement\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"A machine-readable backstory element for behavior system consumption\",\n      \
        \      \"additionalProperties\": false,\n            \"required\": [\n                \"elementType\",\n         \
        \       \"key\",\n                \"value\"\n            ],\n            \"properties\": {\n                \"elementType\"\
        : {\n                    \"$ref\": \"#/$defs/BackstoryElementType\",\n                    \"description\": \"Category
        of this backstory element\"\n                },\n                \"key\": {\n                    \"type\": \"string\"\
        ,\n                    \"minLength\": 1,\n                    \"maxLength\": 100,\n                    \"description\"\
        : \"Machine-readable key (e.g., \\\"homeland\\\", \\\"trained_by\\\", \\\"past_job\\\").\\nUsed by behavior system
        to query specific aspects.\\n\"\n                },\n                \"value\": {\n                    \"type\": \"\
        string\",\n                    \"minLength\": 1,\n                    \"maxLength\": 500,\n                    \"\
        description\": \"Machine-readable value (e.g., \\\"northlands\\\", \\\"knights_guild\\\", \\\"blacksmith\\\").\\nReferenced
        in behavior rules.\\n\"\n                },\n                \"strength\": {\n                    \"type\": \"number\"\
        ,\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\"\
        : 1.0,\n                    \"default\": 0.5,\n                    \"description\": \"How strongly this element affects
        behavior (0.0 to 1.0).\\nHigher strength = greater influence on decisions.\\n\"\n                },\n            \
        \    \"relatedEntityId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Optional related entity (location,
        organization, character)\"\n                },\n                \"relatedEntityType\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Type of the related
        entity (if any)\"\n                }\n            }\n        },\n        \"BackstoryElementType\": {\n           \
        \ \"type\": \"string\",\n            \"description\": \"Types of backstory elements. Each type represents a different
        aspect\\nof the character's background that influences behavior.\\n\",\n            \"enum\": [\n                \"\
        ORIGIN\",\n                \"OCCUPATION\",\n                \"TRAINING\",\n                \"TRAUMA\",\n         \
        \       \"ACHIEVEMENT\",\n                \"SECRET\",\n                \"GOAL\",\n                \"FEAR\",\n    \
        \            \"BELIEF\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get machine-readable backstory elements for behavior system\",\n    \"\
        description\": \"Retrieves structured backstory elements for a character. These elements\\nare machine-readable key-value
        pairs used by the behavior system for\\ndecision-making, not narrative text for players.\\n\",\n    \"tags\": [\n\
        \        \"Backstory\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"getBackstory\"\n}"
  /character-history/set-backstory:
    post:
      summary: Set backstory elements for a character
      operationId: setBackstory
      tags:
      - Backstory
      description: |
        Creates or updates backstory elements for a character. Can either replace
        all existing elements or merge with them based on the replaceExisting flag.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetBackstoryRequest'
      responses:
        '200':
          description: Backstory saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackstoryResponse'
        '400':
          description: Invalid backstory data

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/SetBackstoryRequest\"\
        ,\n    \"$defs\": {\n        \"SetBackstoryRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request payload for setting a character's backstory\",\n            \"additionalProperties\": false,\n       \
        \     \"required\": [\n                \"characterId\",\n                \"elements\"\n            ],\n          \
        \  \"properties\": {\n                \"characterId\": {\n                    \"type\": \"string\",\n            \
        \        \"format\": \"uuid\",\n                    \"description\": \"ID of the character to set backstory for\"\n\
        \                },\n                \"elements\": {\n                    \"type\": \"array\",\n                 \
        \   \"items\": {\n                        \"$ref\": \"#/$defs/BackstoryElement\"\n                    },\n       \
        \             \"minItems\": 1,\n                    \"description\": \"Backstory elements to set\"\n             \
        \   },\n                \"replaceExisting\": {\n                    \"type\": \"boolean\",\n                    \"\
        default\": false,\n                    \"description\": \"If true, replace all existing elements.\\nIf false, merge
        with existing (update matching type+key pairs).\\n\"\n                }\n            }\n        },\n        \"BackstoryElement\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"A machine-readable backstory element for behavior
        system consumption\",\n            \"additionalProperties\": false,\n            \"required\": [\n               \
        \ \"elementType\",\n                \"key\",\n                \"value\"\n            ],\n            \"properties\"\
        : {\n                \"elementType\": {\n                    \"$ref\": \"#/$defs/BackstoryElementType\",\n       \
        \             \"description\": \"Category of this backstory element\"\n                },\n                \"key\"\
        : {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n                    \"maxLength\"\
        : 100,\n                    \"description\": \"Machine-readable key (e.g., \\\"homeland\\\", \\\"trained_by\\\", \\\
        \"past_job\\\").\\nUsed by behavior system to query specific aspects.\\n\"\n                },\n                \"\
        value\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n                   \
        \ \"maxLength\": 500,\n                    \"description\": \"Machine-readable value (e.g., \\\"northlands\\\", \\\
        \"knights_guild\\\", \\\"blacksmith\\\").\\nReferenced in behavior rules.\\n\"\n                },\n             \
        \   \"strength\": {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n     \
        \               \"minimum\": 0.0,\n                    \"maximum\": 1.0,\n                    \"default\": 0.5,\n\
        \                    \"description\": \"How strongly this element affects behavior (0.0 to 1.0).\\nHigher strength
        = greater influence on decisions.\\n\"\n                },\n                \"relatedEntityId\": {\n             \
        \       \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Optional related entity (location, organization, character)\"\n          \
        \      },\n                \"relatedEntityType\": {\n                    \"type\": \"string\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"Type of the related entity (if any)\"\n          \
        \      }\n            }\n        },\n        \"BackstoryElementType\": {\n            \"type\": \"string\",\n    \
        \        \"description\": \"Types of backstory elements. Each type represents a different aspect\\nof the character's
        background that influences behavior.\\n\",\n            \"enum\": [\n                \"ORIGIN\",\n               \
        \ \"OCCUPATION\",\n                \"TRAINING\",\n                \"TRAUMA\",\n                \"ACHIEVEMENT\",\n\
        \                \"SECRET\",\n                \"GOAL\",\n                \"FEAR\",\n                \"BELIEF\"\n \
        \           ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/BackstoryResponse\"\
        ,\n    \"$defs\": {\n        \"BackstoryResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Complete backstory data for a character\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"characterId\",\n                \"elements\"\n            ],\n            \"properties\": {\n\
        \                \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"description\": \"ID of the character this backstory belongs to\"\n                },\n\
        \                \"elements\": {\n                    \"type\": \"array\",\n                    \"items\": {\n   \
        \                     \"$ref\": \"#/$defs/BackstoryElement\"\n                    },\n                    \"description\"\
        : \"All backstory elements for this character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"When this backstory was first created\"\n                },\n    \
        \            \"updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When this backstory was last modified\"\
        \n                }\n            }\n        },\n        \"BackstoryElement\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"A machine-readable backstory element for behavior system consumption\",\n      \
        \      \"additionalProperties\": false,\n            \"required\": [\n                \"elementType\",\n         \
        \       \"key\",\n                \"value\"\n            ],\n            \"properties\": {\n                \"elementType\"\
        : {\n                    \"$ref\": \"#/$defs/BackstoryElementType\",\n                    \"description\": \"Category
        of this backstory element\"\n                },\n                \"key\": {\n                    \"type\": \"string\"\
        ,\n                    \"minLength\": 1,\n                    \"maxLength\": 100,\n                    \"description\"\
        : \"Machine-readable key (e.g., \\\"homeland\\\", \\\"trained_by\\\", \\\"past_job\\\").\\nUsed by behavior system
        to query specific aspects.\\n\"\n                },\n                \"value\": {\n                    \"type\": \"\
        string\",\n                    \"minLength\": 1,\n                    \"maxLength\": 500,\n                    \"\
        description\": \"Machine-readable value (e.g., \\\"northlands\\\", \\\"knights_guild\\\", \\\"blacksmith\\\").\\nReferenced
        in behavior rules.\\n\"\n                },\n                \"strength\": {\n                    \"type\": \"number\"\
        ,\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\"\
        : 1.0,\n                    \"default\": 0.5,\n                    \"description\": \"How strongly this element affects
        behavior (0.0 to 1.0).\\nHigher strength = greater influence on decisions.\\n\"\n                },\n            \
        \    \"relatedEntityId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Optional related entity (location,
        organization, character)\"\n                },\n                \"relatedEntityType\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Type of the related
        entity (if any)\"\n                }\n            }\n        },\n        \"BackstoryElementType\": {\n           \
        \ \"type\": \"string\",\n            \"description\": \"Types of backstory elements. Each type represents a different
        aspect\\nof the character's background that influences behavior.\\n\",\n            \"enum\": [\n                \"\
        ORIGIN\",\n                \"OCCUPATION\",\n                \"TRAINING\",\n                \"TRAUMA\",\n         \
        \       \"ACHIEVEMENT\",\n                \"SECRET\",\n                \"GOAL\",\n                \"FEAR\",\n    \
        \            \"BELIEF\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Set backstory elements for a character\",\n    \"description\": \"Creates
        or updates backstory elements for a character. Can either replace\\nall existing elements or merge with them based
        on the replaceExisting flag.\\n\",\n    \"tags\": [\n        \"Backstory\"\n    ],\n    \"deprecated\": false,\n \
        \   \"operationId\": \"setBackstory\"\n}"
  /character-history/add-backstory-element:
    post:
      summary: Add a single backstory element
      operationId: addBackstoryElement
      tags:
      - Backstory
      description: |
        Adds a single backstory element to a character's existing backstory.
        If an element with the same type and key exists, it will be updated.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddBackstoryElementRequest'
      responses:
        '200':
          description: Element added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackstoryResponse'
        '400':
          description: Invalid element data

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AddBackstoryElementRequest\"\
        ,\n    \"$defs\": {\n        \"AddBackstoryElementRequest\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Request payload for adding a single backstory element\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\",\n                \"element\"\n            ],\n    \
        \        \"properties\": {\n                \"characterId\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"uuid\",\n                    \"description\": \"ID of the character to add element to\"\
        \n                },\n                \"element\": {\n                    \"$ref\": \"#/$defs/BackstoryElement\",\n\
        \                    \"description\": \"The backstory element to add\"\n                }\n            }\n       \
        \ },\n        \"BackstoryElement\": {\n            \"type\": \"object\",\n            \"description\": \"A machine-readable
        backstory element for behavior system consumption\",\n            \"additionalProperties\": false,\n            \"\
        required\": [\n                \"elementType\",\n                \"key\",\n                \"value\"\n           \
        \ ],\n            \"properties\": {\n                \"elementType\": {\n                    \"$ref\": \"#/$defs/BackstoryElementType\"\
        ,\n                    \"description\": \"Category of this backstory element\"\n                },\n             \
        \   \"key\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n               \
        \     \"maxLength\": 100,\n                    \"description\": \"Machine-readable key (e.g., \\\"homeland\\\", \\\
        \"trained_by\\\", \\\"past_job\\\").\\nUsed by behavior system to query specific aspects.\\n\"\n                },\n\
        \                \"value\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n\
        \                    \"maxLength\": 500,\n                    \"description\": \"Machine-readable value (e.g., \\\"\
        northlands\\\", \\\"knights_guild\\\", \\\"blacksmith\\\").\\nReferenced in behavior rules.\\n\"\n               \
        \ },\n                \"strength\": {\n                    \"type\": \"number\",\n                    \"format\":
        \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\": 1.0,\n                    \"default\"\
        : 0.5,\n                    \"description\": \"How strongly this element affects behavior (0.0 to 1.0).\\nHigher strength
        = greater influence on decisions.\\n\"\n                },\n                \"relatedEntityId\": {\n             \
        \       \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Optional related entity (location, organization, character)\"\n          \
        \      },\n                \"relatedEntityType\": {\n                    \"type\": \"string\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"Type of the related entity (if any)\"\n          \
        \      }\n            }\n        },\n        \"BackstoryElementType\": {\n            \"type\": \"string\",\n    \
        \        \"description\": \"Types of backstory elements. Each type represents a different aspect\\nof the character's
        background that influences behavior.\\n\",\n            \"enum\": [\n                \"ORIGIN\",\n               \
        \ \"OCCUPATION\",\n                \"TRAINING\",\n                \"TRAUMA\",\n                \"ACHIEVEMENT\",\n\
        \                \"SECRET\",\n                \"GOAL\",\n                \"FEAR\",\n                \"BELIEF\"\n \
        \           ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/BackstoryResponse\"\
        ,\n    \"$defs\": {\n        \"BackstoryResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Complete backstory data for a character\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"characterId\",\n                \"elements\"\n            ],\n            \"properties\": {\n\
        \                \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"description\": \"ID of the character this backstory belongs to\"\n                },\n\
        \                \"elements\": {\n                    \"type\": \"array\",\n                    \"items\": {\n   \
        \                     \"$ref\": \"#/$defs/BackstoryElement\"\n                    },\n                    \"description\"\
        : \"All backstory elements for this character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"When this backstory was first created\"\n                },\n    \
        \            \"updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When this backstory was last modified\"\
        \n                }\n            }\n        },\n        \"BackstoryElement\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"A machine-readable backstory element for behavior system consumption\",\n      \
        \      \"additionalProperties\": false,\n            \"required\": [\n                \"elementType\",\n         \
        \       \"key\",\n                \"value\"\n            ],\n            \"properties\": {\n                \"elementType\"\
        : {\n                    \"$ref\": \"#/$defs/BackstoryElementType\",\n                    \"description\": \"Category
        of this backstory element\"\n                },\n                \"key\": {\n                    \"type\": \"string\"\
        ,\n                    \"minLength\": 1,\n                    \"maxLength\": 100,\n                    \"description\"\
        : \"Machine-readable key (e.g., \\\"homeland\\\", \\\"trained_by\\\", \\\"past_job\\\").\\nUsed by behavior system
        to query specific aspects.\\n\"\n                },\n                \"value\": {\n                    \"type\": \"\
        string\",\n                    \"minLength\": 1,\n                    \"maxLength\": 500,\n                    \"\
        description\": \"Machine-readable value (e.g., \\\"northlands\\\", \\\"knights_guild\\\", \\\"blacksmith\\\").\\nReferenced
        in behavior rules.\\n\"\n                },\n                \"strength\": {\n                    \"type\": \"number\"\
        ,\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\"\
        : 1.0,\n                    \"default\": 0.5,\n                    \"description\": \"How strongly this element affects
        behavior (0.0 to 1.0).\\nHigher strength = greater influence on decisions.\\n\"\n                },\n            \
        \    \"relatedEntityId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Optional related entity (location,
        organization, character)\"\n                },\n                \"relatedEntityType\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Type of the related
        entity (if any)\"\n                }\n            }\n        },\n        \"BackstoryElementType\": {\n           \
        \ \"type\": \"string\",\n            \"description\": \"Types of backstory elements. Each type represents a different
        aspect\\nof the character's background that influences behavior.\\n\",\n            \"enum\": [\n                \"\
        ORIGIN\",\n                \"OCCUPATION\",\n                \"TRAINING\",\n                \"TRAUMA\",\n         \
        \       \"ACHIEVEMENT\",\n                \"SECRET\",\n                \"GOAL\",\n                \"FEAR\",\n    \
        \            \"BELIEF\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Add a single backstory element\",\n    \"description\": \"Adds a single
        backstory element to a character's existing backstory.\\nIf an element with the same type and key exists, it will
        be updated.\\n\",\n    \"tags\": [\n        \"Backstory\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"addBackstoryElement\"\n}"
  /character-history/delete-backstory:
    post:
      summary: Delete all backstory for a character
      operationId: deleteBackstory
      tags:
      - Backstory
      description: |
        Removes all backstory elements for a character. Used during character
        compression or deletion.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteBackstoryRequest'
      responses:
        '200':
          description: Backstory deleted successfully
        '404':
          description: No backstory found for this character

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteBackstoryRequest\"\
        ,\n    \"$defs\": {\n        \"DeleteBackstoryRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request payload for deleting a character's backstory\",\n            \"additionalProperties\": false,\n      \
        \      \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n         \
        \       \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"ID of the character to delete backstory for\"\n                }\n       \
        \     }\n        }\n    }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n    \"summary\": \"Delete all backstory for a character\",\n    \"description\": \"Removes
        all backstory elements for a character. Used during character\\ncompression or deletion.\\n\",\n    \"tags\": [\n\
        \        \"Backstory\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"deleteBackstory\"\n}"
  /character-history/delete-all:
    post:
      summary: Delete all history data for a character
      operationId: deleteAllHistory
      tags:
      - History Management
      description: |
        Removes all history data (participation records and backstory) for a
        character. Used during character compression after summarization.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteAllHistoryRequest'
      responses:
        '200':
          description: All history deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteAllHistoryResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteAllHistoryRequest\"\
        ,\n    \"$defs\": {\n        \"DeleteAllHistoryRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request payload for deleting all history data for a character\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n   \
        \             \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the character to delete history for\"\n                }\n       \
        \     }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteAllHistoryResponse\"\
        ,\n    \"$defs\": {\n        \"DeleteAllHistoryResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Result of deleting all history data\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"characterId\",\n                \"participationsDeleted\",\n                \"backstoryDeleted\"\
        \n            ],\n            \"properties\": {\n                \"characterId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"ID of the character
        whose history was deleted\"\n                },\n                \"participationsDeleted\": {\n                  \
        \  \"type\": \"integer\",\n                    \"description\": \"Number of participation records deleted\"\n    \
        \            },\n                \"backstoryDeleted\": {\n                    \"type\": \"boolean\",\n           \
        \         \"description\": \"Whether backstory was deleted\"\n                }\n            }\n        }\n    }\n\
        }"
      x-endpoint-info-json: "{\n    \"summary\": \"Delete all history data for a character\",\n    \"description\": \"Removes
        all history data (participation records and backstory) for a\\ncharacter. Used during character compression after
        summarization.\\n\",\n    \"tags\": [\n        \"History Management\"\n    ],\n    \"deprecated\": false,\n    \"\
        operationId\": \"deleteAllHistory\"\n}"
  /character-history/summarize:
    post:
      summary: Generate text summaries for character compression
      operationId: summarizeHistory
      tags:
      - History Management
      description: |
        Generates text summaries of a character's backstory and historical
        participation for inclusion in the CharacterArchive. Called during
        character compression before history data is deleted.
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SummarizeHistoryRequest'
      responses:
        '200':
          description: Summaries generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistorySummaryResponse'

      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/SummarizeHistoryRequest\"\
        ,\n    \"$defs\": {\n        \"SummarizeHistoryRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request payload for generating history summaries\",\n            \"additionalProperties\": false,\n          \
        \  \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n             \
        \   \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n   \
        \                 \"description\": \"ID of the character to summarize history for\"\n                },\n        \
        \        \"maxBackstoryPoints\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n\
        \                    \"maximum\": 20,\n                    \"default\": 5,\n                    \"description\": \"\
        Maximum number of key backstory points to include\"\n                },\n                \"maxLifeEvents\": {\n  \
        \                  \"type\": \"integer\",\n                    \"minimum\": 1,\n                    \"maximum\": 20,\n\
        \                    \"default\": 10,\n                    \"description\": \"Maximum number of major life events
        to include\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/HistorySummaryResponse\"\
        ,\n    \"$defs\": {\n        \"HistorySummaryResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Generated text summaries for character compression\",\n            \"additionalProperties\": false,\n        \
        \    \"required\": [\n                \"characterId\",\n                \"keyBackstoryPoints\",\n                \"\
        majorLifeEvents\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n           \
        \         \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"\
        ID of the character summarized\"\n                },\n                \"keyBackstoryPoints\": {\n                \
        \    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n      \
        \              },\n                    \"description\": \"Key backstory elements as text summaries.\\ne.g., [\\\"\
        Trained by Knights Guild\\\", \\\"Born in the Northlands\\\"]\\n\"\n                },\n                \"majorLifeEvents\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"description\": \"Major historical events as text summaries.\\
        ne.g., [\\\"Fought in the Battle of Stormgate (Hero)\\\", \\\"Survived the Great Flood\\\"]\\n\"\n               \
        \ }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Generate text summaries for character compression\",\n    \"description\"\
        : \"Generates text summaries of a character's backstory and historical\\nparticipation for inclusion in the CharacterArchive.
        Called during\\ncharacter compression before history data is deleted.\\n\",\n    \"tags\": [\n        \"History Management\"\
        \n    ],\n    \"deprecated\": false,\n    \"operationId\": \"summarizeHistory\"\n}"
components:
  schemas:
    # Enums
    EventCategory:
      type: string
      description: Categories of historical events that characters can participate in
      enum:
      - WAR
      - NATURAL_DISASTER
      - POLITICAL
      - ECONOMIC
      - RELIGIOUS
      - CULTURAL
      - PERSONAL

    ParticipationRole:
      type: string
      description: How the character participated in the historical event
      enum:
      - LEADER
      - COMBATANT
      - VICTIM
      - WITNESS
      - BENEFICIARY
      - CONSPIRATOR
      - HERO
      - SURVIVOR

    BackstoryElementType:
      type: string
      description: |
        Types of backstory elements. Each type represents a different aspect
        of the character's background that influences behavior.
      enum:
      - ORIGIN
      - OCCUPATION
      - TRAINING
      - TRAUMA
      - ACHIEVEMENT
      - SECRET
      - GOAL
      - FEAR
      - BELIEF

    # Core Models
    HistoricalParticipation:
      type: object
      description: Record of a character's participation in a historical event
      additionalProperties: false
      required:
      - participationId
      - characterId
      - eventId
      - eventName
      - eventCategory
      - role
      - eventDate
      - createdAt
      properties:
        participationId:
          type: string
          format: uuid
          description: Unique ID for this participation record
        characterId:
          type: string
          format: uuid
          description: ID of the character who participated
        eventId:
          type: string
          format: uuid
          description: ID of the historical event
        eventName:
          type: string
          description: Name of the event (for display and summarization)
        eventCategory:
          $ref: '#/components/schemas/EventCategory'
          description: Category of the historical event
        role:
          $ref: '#/components/schemas/ParticipationRole'
          description: How the character participated
        eventDate:
          type: string
          format: date-time
          description: In-game date when the event occurred
        significance:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          default: 0.5
          description: |
            How significant this event was for the character (0.0 to 1.0).
            Affects behavior system weighting of this memory.
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Event-specific details for behavior decisions
        createdAt:
          type: string
          format: date-time
          description: When this record was created

    BackstoryElement:
      type: object
      description: A machine-readable backstory element for behavior system consumption
      additionalProperties: false
      required:
      - elementType
      - key
      - value
      properties:
        elementType:
          $ref: '#/components/schemas/BackstoryElementType'
          description: Category of this backstory element
        key:
          type: string
          minLength: 1
          maxLength: 100
          description: |
            Machine-readable key (e.g., "homeland", "trained_by", "past_job").
            Used by behavior system to query specific aspects.
        value:
          type: string
          minLength: 1
          maxLength: 500
          description: |
            Machine-readable value (e.g., "northlands", "knights_guild", "blacksmith").
            Referenced in behavior rules.
        strength:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          default: 0.5
          description: |
            How strongly this element affects behavior (0.0 to 1.0).
            Higher strength = greater influence on decisions.
        relatedEntityId:
          type: string
          format: uuid
          nullable: true
          description: Optional related entity (location, organization, character)
        relatedEntityType:
          type: string
          nullable: true
          description: Type of the related entity (if any)

    BackstoryResponse:
      type: object
      description: Complete backstory data for a character
      additionalProperties: false
      required:
      - characterId
      - elements
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character this backstory belongs to
        elements:
          type: array
          items:
            $ref: '#/components/schemas/BackstoryElement'
          description: All backstory elements for this character
        createdAt:
          type: string
          format: date-time
          nullable: true
          description: When this backstory was first created
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: When this backstory was last modified

    # Request Models
    RecordParticipationRequest:
      type: object
      description: Request payload for recording event participation
      additionalProperties: false
      required:
      - characterId
      - eventId
      - eventName
      - eventCategory
      - role
      - eventDate
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character who participated
        eventId:
          type: string
          format: uuid
          description: ID of the historical event
        eventName:
          type: string
          minLength: 1
          maxLength: 200
          description: Name of the event
        eventCategory:
          $ref: '#/components/schemas/EventCategory'
          description: Category of the event
        role:
          $ref: '#/components/schemas/ParticipationRole'
          description: How the character participated
        eventDate:
          type: string
          format: date-time
          description: In-game date when the event occurred
        significance:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          default: 0.5
          description: How significant this event was for the character
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Optional event-specific details

    GetParticipationRequest:
      type: object
      description: Request payload for getting a character's event participation
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to get participation for
        eventCategory:
          $ref: '#/components/schemas/EventCategory'
          nullable: true
          description: Filter by event category
        minimumSignificance:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          nullable: true
          description: Filter by minimum significance
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number for pagination (1-based)
        pageSize:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Number of results per page

    GetEventParticipantsRequest:
      type: object
      description: Request payload for getting participants of an event
      additionalProperties: false
      required:
      - eventId
      properties:
        eventId:
          type: string
          format: uuid
          description: ID of the historical event
        role:
          $ref: '#/components/schemas/ParticipationRole'
          nullable: true
          description: Filter by participation role
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number for pagination (1-based)
        pageSize:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Number of results per page

    DeleteParticipationRequest:
      type: object
      description: Request payload for deleting a participation record
      additionalProperties: false
      required:
      - participationId
      properties:
        participationId:
          type: string
          format: uuid
          description: ID of the participation record to delete

    GetBackstoryRequest:
      type: object
      description: Request payload for getting a character's backstory
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to get backstory for
        elementTypes:
          type: array
          items:
            $ref: '#/components/schemas/BackstoryElementType'
          nullable: true
          description: Filter by element types (null for all)
        minimumStrength:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          nullable: true
          description: Filter by minimum strength

    SetBackstoryRequest:
      type: object
      description: Request payload for setting a character's backstory
      additionalProperties: false
      required:
      - characterId
      - elements
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to set backstory for
        elements:
          type: array
          items:
            $ref: '#/components/schemas/BackstoryElement'
          minItems: 1
          description: Backstory elements to set
        replaceExisting:
          type: boolean
          default: false
          description: |
            If true, replace all existing elements.
            If false, merge with existing (update matching type+key pairs).

    AddBackstoryElementRequest:
      type: object
      description: Request payload for adding a single backstory element
      additionalProperties: false
      required:
      - characterId
      - element
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to add element to
        element:
          $ref: '#/components/schemas/BackstoryElement'
          description: The backstory element to add

    DeleteBackstoryRequest:
      type: object
      description: Request payload for deleting a character's backstory
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to delete backstory for

    DeleteAllHistoryRequest:
      type: object
      description: Request payload for deleting all history data for a character
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to delete history for

    SummarizeHistoryRequest:
      type: object
      description: Request payload for generating history summaries
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to summarize history for
        maxBackstoryPoints:
          type: integer
          minimum: 1
          maximum: 20
          default: 5
          description: Maximum number of key backstory points to include
        maxLifeEvents:
          type: integer
          minimum: 1
          maximum: 20
          default: 10
          description: Maximum number of major life events to include

    # Response Models
    ParticipationListResponse:
      type: object
      description: Paginated list of participation records
      additionalProperties: false
      required:
      - participations
      - totalCount
      - page
      - pageSize
      properties:
        participations:
          type: array
          items:
            $ref: '#/components/schemas/HistoricalParticipation'
          description: List of participation records
        totalCount:
          type: integer
          description: Total number of matching records
        page:
          type: integer
          description: Current page number (1-based)
        pageSize:
          type: integer
          description: Number of results per page
        hasNextPage:
          type: boolean
          description: Whether there are more results after this page
        hasPreviousPage:
          type: boolean
          description: Whether there are results before this page

    DeleteAllHistoryResponse:
      type: object
      description: Result of deleting all history data
      additionalProperties: false
      required:
      - characterId
      - participationsDeleted
      - backstoryDeleted
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character whose history was deleted
        participationsDeleted:
          type: integer
          description: Number of participation records deleted
        backstoryDeleted:
          type: boolean
          description: Whether backstory was deleted

    HistorySummaryResponse:
      type: object
      description: Generated text summaries for character compression
      additionalProperties: false
      required:
      - characterId
      - keyBackstoryPoints
      - majorLifeEvents
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character summarized
        keyBackstoryPoints:
          type: array
          items:
            type: string
          description: |
            Key backstory elements as text summaries.
            e.g., ["Trained by Knights Guild", "Born in the Northlands"]
        majorLifeEvents:
          type: array
          items:
            type: string
          description: |
            Major historical events as text summaries.
            e.g., ["Fought in the Battle of Stormgate (Hero)", "Survived the Great Flood"]
