openapi: 3.0.0
info:
  title: Gardener Service Configuration
  description: |
    Configuration properties for the Gardener service (L4 GameFeatures).
    Controls void orchestration, scenario selection algorithm, scenario lifecycle,
    bond features, deployment phase defaults, seed integration, and background workers.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0

x-service-configuration:
  properties:
    # =========================================================================
    # Void Orchestration
    # =========================================================================

    VoidTickIntervalMs:
      type: integer
      env: GARDENER_VOID_TICK_INTERVAL_MS
      minimum: 1000
      maximum: 60000
      default: 5000
      description: Milliseconds between void orchestrator evaluation cycles

    MaxActivePoisPerVoid:
      type: integer
      env: GARDENER_MAX_ACTIVE_POIS_PER_VOID
      minimum: 1
      maximum: 50
      default: 8
      description: Maximum concurrent POIs per player void instance

    PoiDefaultTtlMinutes:
      type: integer
      env: GARDENER_POI_DEFAULT_TTL_MINUTES
      minimum: 1
      maximum: 120
      default: 10
      description: Default time-to-live in minutes for spawned POIs before expiration

    PoiSpawnRadiusMin:
      type: number
      format: float
      env: GARDENER_POI_SPAWN_RADIUS_MIN
      default: 50.0
      description: Minimum distance from player to spawn a POI in void space units

    PoiSpawnRadiusMax:
      type: number
      format: float
      env: GARDENER_POI_SPAWN_RADIUS_MAX
      default: 200.0
      description: Maximum distance from player to spawn a POI in void space units

    MinPoiSpacing:
      type: number
      format: float
      env: GARDENER_MIN_POI_SPACING
      default: 30.0
      description: Minimum distance between any two POIs in void space units

    # =========================================================================
    # Scenario Selection Algorithm Weights
    # =========================================================================

    AffinityWeight:
      type: number
      format: float
      env: GARDENER_AFFINITY_WEIGHT
      minimum: 0.0
      maximum: 1.0
      default: 0.4
      description: Weight for domain affinity in scenario scoring algorithm

    DiversityWeight:
      type: number
      format: float
      env: GARDENER_DIVERSITY_WEIGHT
      minimum: 0.0
      maximum: 1.0
      default: 0.3
      description: Weight for category diversity in scenario scoring algorithm

    NarrativeWeight:
      type: number
      format: float
      env: GARDENER_NARRATIVE_WEIGHT
      minimum: 0.0
      maximum: 1.0
      default: 0.2
      description: Weight for drift-pattern narrative response in scenario scoring

    RandomWeight:
      type: number
      format: float
      env: GARDENER_RANDOM_WEIGHT
      minimum: 0.0
      maximum: 1.0
      default: 0.1
      description: Weight for randomness and discovery in scenario scoring

    RecentScenarioCooldownMinutes:
      type: integer
      env: GARDENER_RECENT_SCENARIO_COOLDOWN_MINUTES
      minimum: 0
      maximum: 1440
      default: 30
      description: Minutes before a completed scenario can be re-offered to the same player

    # =========================================================================
    # Scenario Instances
    # =========================================================================

    MaxConcurrentScenariosGlobal:
      type: integer
      env: GARDENER_MAX_CONCURRENT_SCENARIOS_GLOBAL
      minimum: 1
      default: 1000
      description: Maximum total active scenario instances across all players

    ScenarioTimeoutMinutes:
      type: integer
      env: GARDENER_SCENARIO_TIMEOUT_MINUTES
      minimum: 5
      maximum: 480
      default: 60
      description: Maximum scenario duration before forced completion in minutes

    AbandonDetectionMinutes:
      type: integer
      env: GARDENER_ABANDON_DETECTION_MINUTES
      minimum: 1
      maximum: 60
      default: 5
      description: Minutes without player input before scenario is marked abandoned

    GrowthAwardMultiplier:
      type: number
      format: float
      env: GARDENER_GROWTH_AWARD_MULTIPLIER
      minimum: 0.0
      default: 1.0
      description: Global multiplier applied to all growth awards from scenario completion

    # =========================================================================
    # Bond Features
    # =========================================================================

    BondSharedVoidEnabled:
      type: boolean
      env: GARDENER_BOND_SHARED_VOID_ENABLED
      default: true
      description: Whether bonded players share a void instance with merged POIs

    BondScenarioPriority:
      type: number
      format: float
      env: GARDENER_BOND_SCENARIO_PRIORITY
      minimum: 1.0
      default: 1.5
      description: Scoring boost multiplier for bond-friendly scenarios when player is bonded

    # =========================================================================
    # Phase Defaults
    # =========================================================================

    DefaultPhase:
      $ref: 'gardener-api.yaml#/components/schemas/DeploymentPhase'
      env: GARDENER_DEFAULT_PHASE
      default: Alpha
      description: Starting deployment phase for new installations

    # =========================================================================
    # Seed Integration
    # =========================================================================

    SeedTypeCode:
      type: string
      env: GARDENER_SEED_TYPE_CODE
      default: guardian
      description: Which seed type code this gardener manages for player spirits

    # =========================================================================
    # Background Workers
    # =========================================================================

    ScenarioLifecycleWorkerIntervalSeconds:
      type: integer
      env: GARDENER_SCENARIO_LIFECYCLE_WORKER_INTERVAL_SECONDS
      minimum: 5
      maximum: 300
      default: 30
      description: Seconds between scenario lifecycle worker evaluation cycles

    BackgroundServiceStartupDelaySeconds:
      type: integer
      env: GARDENER_BACKGROUND_SERVICE_STARTUP_DELAY_SECONDS
      minimum: 0
      maximum: 60
      default: 5
      description: Seconds to wait before starting background workers after service initialization
