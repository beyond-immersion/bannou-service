openapi: 3.0.3
info:
  title: Escrow Service Configuration
  description: |
    Configuration schema for Escrow service.
    Properties are bound to environment variables with BANNOU_ prefix.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    defaultTimeout:
      type: string
      env: ESCROW_DEFAULT_TIMEOUT
      default: "P7D"
      description: Default escrow expiration if not specified (ISO 8601 duration)
    maxTimeout:
      type: string
      env: ESCROW_MAX_TIMEOUT
      default: "P30D"
      description: Maximum allowed escrow duration (ISO 8601 duration)
    expirationGracePeriod:
      type: string
      env: ESCROW_EXPIRATION_GRACE_PERIOD
      default: "PT1H"
      description: Grace period after expiration before auto-refund (ISO 8601 duration)
    tokenLength:
      type: integer
      env: ESCROW_TOKEN_LENGTH
      default: 32
      description: Token length in bytes (before encoding)
    expirationCheckInterval:
      type: string
      env: ESCROW_EXPIRATION_CHECK_INTERVAL
      default: "PT1M"
      description: How often to check for expired escrows (ISO 8601 duration)
    expirationBatchSize:
      type: integer
      env: ESCROW_EXPIRATION_BATCH_SIZE
      default: 100
      description: Batch size for expiration processing
    validationCheckInterval:
      type: string
      env: ESCROW_VALIDATION_CHECK_INTERVAL
      default: "PT5M"
      description: How often to validate held assets (ISO 8601 duration)
    maxParties:
      type: integer
      env: ESCROW_MAX_PARTIES
      default: 10
      description: Maximum parties per escrow
    maxAssetsPerDeposit:
      type: integer
      env: ESCROW_MAX_ASSETS_PER_DEPOSIT
      default: 50
      description: Maximum asset lines per deposit
    maxPendingPerParty:
      type: integer
      env: ESCROW_MAX_PENDING_PER_PARTY
      default: 100
      description: Maximum concurrent pending escrows per party

    idempotencyTtlHours:
      type: integer
      env: ESCROW_IDEMPOTENCY_TTL_HOURS
      default: 24
      description: TTL in hours for idempotency key storage

    maxConcurrencyRetries:
      type: integer
      env: ESCROW_MAX_CONCURRENCY_RETRIES
      default: 3
      description: Maximum retry attempts for optimistic concurrency operations

    defaultListLimit:
      type: integer
      env: ESCROW_DEFAULT_LIST_LIMIT
      default: 50
      description: Default limit for listing escrows when not specified

    defaultReleaseMode:
      $ref: 'escrow-api.yaml#/components/schemas/ReleaseMode'
      env: ESCROW_DEFAULT_RELEASE_MODE
      default: service_only
      description: Default release confirmation mode when not specified in request

    defaultRefundMode:
      $ref: 'escrow-api.yaml#/components/schemas/RefundMode'
      env: ESCROW_DEFAULT_REFUND_MODE
      default: immediate
      description: Default refund confirmation mode when not specified in request

    confirmationTimeoutSeconds:
      type: integer
      env: ESCROW_CONFIRMATION_TIMEOUT_SECONDS
      default: 300
      description: Timeout for party confirmations in seconds (default 5 minutes)

    confirmationTimeoutBehavior:
      type: string
      env: ESCROW_CONFIRMATION_TIMEOUT_BEHAVIOR
      default: auto_confirm
      description: What happens on confirmation timeout (auto_confirm/dispute/refund)

    confirmationTimeoutCheckIntervalSeconds:
      type: integer
      env: ESCROW_CONFIRMATION_TIMEOUT_CHECK_INTERVAL_SECONDS
      default: 30
      description: How often the background service checks for expired confirmations

    confirmationTimeoutBatchSize:
      type: integer
      env: ESCROW_CONFIRMATION_TIMEOUT_BATCH_SIZE
      default: 100
      description: Maximum escrows to process per timeout check cycle
