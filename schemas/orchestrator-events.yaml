openapi: 3.0.3
info:
  title: Orchestrator Service Events
  description: |
    Event models for Orchestrator service RabbitMQ pub/sub.
    Used for service discovery, health checks, and orchestration events.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
  x-event-subscriptions:
    # Service heartbeats from all bannou instances - used for deployment validation
    - topic: bannou.service-heartbeats
      event: ServiceHeartbeatEvent
      handler: HandleServiceHeartbeat
  x-event-publications:
    # Health check ping event
    - topic: orchestrator.health-ping
      event: OrchestratorHealthPingEvent
      description: Published to verify pub/sub path is active
    # Service mappings broadcast
    - topic: bannou.full-service-mappings
      event: FullServiceMappingsEvent
      description: Published to broadcast full service-to-appId mappings to mesh

paths: {}

components:
  schemas:
    # =========================================================================
    # Health Check Events
    # =========================================================================
    OrchestratorHealthPingEvent:
      allOf:
        - $ref: 'common-events.yaml#/components/schemas/BaseServiceEvent'
      type: object
      additionalProperties: false
      description: |
        Simple health ping event published to verify pub/sub path is active.
        Used by infrastructure health checks.
      required:
        - status
      properties:
        status:
          type: string
          enum: [ok, degraded, checking]
          description: Current health status
          default: ok
