openapi: 3.0.3
info:
  title: Save-Load Service API
  version: 1.0.0
  description: |
    Generic save/load system for game state persistence.
    Supports polymorphic ownership, versioned saves, and schema migration.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.

servers:
- url: http://localhost:5012

x-service-layer: GameFeatures

tags:
- name: Slots
  description: Save slot management
- name: Saves
  description: Save/load operations
- name: Versions
  description: Version management
- name: Query
  description: Search and filtering
- name: Migration
  description: Schema migration operations

paths:
  # ═══════════════════════════════════════════════════════════════════════════
  # SLOT MANAGEMENT
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/slot/create:
    post:
      tags: [Slots]
      operationId: CreateSlot
      summary: Create or configure a save slot
      description: |
        Creates a new save slot or updates configuration of an existing slot.
        Slots are auto-created on first save, but pre-creation allows setting
        custom configuration (max versions, retention policy, etc.).
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSlotRequest'
      responses:
        '200':
          description: Slot created or updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlotResponse'
        '400':
          description: Invalid request
        '409':
          description: Slot already exists with different owner

  /save-load/slot/get:
    post:
      tags: [Slots]
      operationId: GetSlot
      summary: Get slot metadata
      description: Returns slot configuration and version summary.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetSlotRequest'
      responses:
        '200':
          description: Slot found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlotResponse'
        '404':
          description: Slot not found

  /save-load/slot/list:
    post:
      tags: [Slots]
      operationId: ListSlots
      summary: List slots for owner
      description: Returns all slots owned by the specified entity.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListSlotsRequest'
      responses:
        '200':
          description: Slots listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListSlotsResponse'

  /save-load/slot/delete:
    post:
      tags: [Slots]
      operationId: DeleteSlot
      summary: Delete slot and all versions
      description: |
        Permanently deletes a slot and all save versions within it.
        This is irreversible. Requires owner access or admin role.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteSlotRequest'
      responses:
        '200':
          description: Slot deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteSlotResponse'
        '404':
          description: Slot not found
        '403':
          description: Not authorized to delete this slot

  /save-load/slot/rename:
    post:
      tags: [Slots]
      operationId: RenameSlot
      summary: Rename a save slot
      description: |
        Renames an existing slot without affecting its versions or data.
        The new name must not already exist for this owner.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RenameSlotRequest'
      responses:
        '200':
          description: Slot renamed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlotResponse'
        '404':
          description: Slot not found
        '409':
          description: Target name already exists

  /save-load/slot/bulk-delete:
    post:
      tags: [Slots]
      operationId: BulkDeleteSlots
      summary: Delete multiple slots at once
      description: |
        Deletes multiple slots and all their versions in a single operation.
        Useful for cleanup operations or account deletion.
      x-permissions:
      - role: admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkDeleteSlotsRequest'
      responses:
        '200':
          description: Slots deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkDeleteSlotsResponse'

  # ═══════════════════════════════════════════════════════════════════════════
  # SAVE/LOAD OPERATIONS
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/save:
    post:
      tags: [Saves]
      operationId: Save
      summary: Save data to slot
      description: |
        Creates a new version in the specified slot with the provided data.
        If the slot doesn't exist, it's auto-created with default configuration.

        Large saves (>1MB by default) are automatically compressed.
        Rolling version cleanup is applied based on slot configuration.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveRequest'
      responses:
        '200':
          description: Save successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveResponse'
        '400':
          description: Invalid request or data validation failed
        '413':
          description: Save data exceeds maximum size limit
        '403':
          description: Not authorized to save to this slot

  /save-load/load:
    post:
      tags: [Saves]
      operationId: Load
      summary: Load data from slot
      description: |
        Retrieves save data from the specified slot. By default, loads the
        latest version. Optionally specify a version number or checkpoint name.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoadRequest'
      responses:
        '200':
          description: Load successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadResponse'
        '404':
          description: Slot or version not found
        '403':
          description: Not authorized to load from this slot

  # ═══════════════════════════════════════════════════════════════════════════
  # DELTA SAVES (Incremental)
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/save-delta:
    post:
      tags: [Saves]
      operationId: SaveDelta
      summary: Save incremental changes from base version
      description: |
        Creates a new version by applying a delta (patch) to a base version.
        Significantly reduces storage for large saves with small incremental changes.

        Uses JSON Patch (RFC 6902) by default. The implementation is designed to
        allow swapping to binary diff algorithms (bsdiff/xdelta) if needed for
        specific use cases (e.g., binary game state).

        Delta versions store only the patch; full data is reconstructed on load.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveDeltaRequest'
      responses:
        '200':
          description: Delta save successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveDeltaResponse'
        '400':
          description: Invalid delta or base version not found
        '409':
          description: Base version has been deleted (cannot apply delta)
        '413':
          description: Delta too large (consider full save instead)

  /save-load/load-with-deltas:
    post:
      tags: [Saves]
      operationId: LoadWithDeltas
      summary: Load save reconstructing from delta chain
      description: |
        Loads save data, automatically reconstructing from delta chain if needed.
        Returns the full reconstructed data, not the raw delta.

        For performance, the service may cache reconstructed data or collapse
        delta chains during background cleanup.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoadRequest'
      responses:
        '200':
          description: Load successful (reconstructed if delta)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadResponse'
        '404':
          description: Slot or version not found
        '422':
          description: Delta chain broken (base version missing)

  /save-load/collapse-deltas:
    post:
      tags: [Saves]
      operationId: CollapseDeltas
      summary: Collapse delta chain into full snapshot
      description: |
        Collapses a chain of delta versions into a single full snapshot.
        Useful for reducing load latency or before deleting base versions.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollapseDeltasRequest'
      responses:
        '200':
          description: Delta chain collapsed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveResponse'
        '404':
          description: Slot or version not found

  # ═══════════════════════════════════════════════════════════════════════════
  # VERSION MANAGEMENT
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/version/list:
    post:
      tags: [Versions]
      operationId: ListVersions
      summary: List versions in slot
      description: Returns all versions in a slot with metadata.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListVersionsRequest'
      responses:
        '200':
          description: Versions listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListVersionsResponse'
        '404':
          description: Slot not found

  /save-load/version/pin:
    post:
      tags: [Versions]
      operationId: PinVersion
      summary: Pin a version as checkpoint
      description: |
        Pins a specific version, excluding it from rolling cleanup.
        Optionally assigns a checkpoint name for easy retrieval.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PinVersionRequest'
      responses:
        '200':
          description: Version pinned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionResponse'
        '404':
          description: Slot or version not found

  /save-load/version/unpin:
    post:
      tags: [Versions]
      operationId: UnpinVersion
      summary: Unpin a version
      description: Removes pin from a version, making it eligible for rolling cleanup.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnpinVersionRequest'
      responses:
        '200':
          description: Version unpinned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionResponse'
        '404':
          description: Slot or version not found

  /save-load/version/delete:
    post:
      tags: [Versions]
      operationId: DeleteVersion
      summary: Delete specific version
      description: |
        Permanently deletes a specific version from a slot.
        Cannot delete pinned versions; unpin first.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteVersionRequest'
      responses:
        '200':
          description: Version deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteVersionResponse'
        '404':
          description: Slot or version not found
        '409':
          description: Cannot delete pinned version

  # ═══════════════════════════════════════════════════════════════════════════
  # QUERY & SEARCH
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/query:
    post:
      tags: [Query]
      operationId: QuerySaves
      summary: Query saves with filters
      description: |
        Search and filter saves across slots. Supports filtering by owner,
        category, date range, metadata, and more. Paginated results.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuerySavesRequest'
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuerySavesResponse'

  # ═══════════════════════════════════════════════════════════════════════════
  # COPY & TRANSFER OPERATIONS
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/copy:
    post:
      tags: [Transfer]
      operationId: CopySave
      summary: Copy save to different slot or owner
      description: |
        Copies a save version to a different slot or owner.
        Can copy to same owner (different slot) or different owner (with admin).
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CopySaveRequest'
      responses:
        '200':
          description: Save copied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveResponse'
        '404':
          description: Source slot or version not found
        '403':
          description: Not authorized to copy to target

  /save-load/export:
    post:
      tags: [Transfer]
      operationId: ExportSaves
      summary: Export saves for backup/portability
      description: |
        Exports one or more slots with all versions as a downloadable archive.
        Returns a pre-signed URL to download the export bundle.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExportSavesRequest'
      responses:
        '200':
          description: Export prepared
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportSavesResponse'

  /save-load/import:
    post:
      tags: [Transfer]
      operationId: ImportSaves
      summary: Import saves from backup
      description: |
        Imports saves from a previously exported archive.
        Supports conflict resolution strategies for existing slots.
      x-permissions:
      - role: admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImportSavesRequest'
      responses:
        '200':
          description: Import completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportSavesResponse'
        '400':
          description: Invalid archive format

  # ═══════════════════════════════════════════════════════════════════════════
  # INTEGRITY & VALIDATION
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/verify:
    post:
      tags: [Validation]
      operationId: VerifyIntegrity
      summary: Verify save data integrity
      description: |
        Verifies the integrity of stored save data by comparing content hash
        against the stored SHA-256 hash. Detects corruption or tampering.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyIntegrityRequest'
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyIntegrityResponse'
        '404':
          description: Slot or version not found

  /save-load/version/promote:
    post:
      tags: [Versions]
      operationId: PromoteVersion
      summary: Promote old version to latest
      description: |
        Creates a new version from an existing older version, effectively
        "promoting" it to be the latest. Useful for rollback scenarios.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromoteVersionRequest'
      responses:
        '200':
          description: Version promoted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveResponse'
        '404':
          description: Slot or version not found

  # ═══════════════════════════════════════════════════════════════════════════
  # SCHEMA MIGRATION
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/migrate:
    post:
      tags: [Migration]
      operationId: MigrateSave
      summary: Migrate save to new schema version
      description: |
        Applies migration handlers to upgrade a save from one schema version
        to another. Creates a new version with the migrated data.
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MigrateSaveRequest'
      responses:
        '200':
          description: Migration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrateSaveResponse'
        '400':
          description: Migration failed or no path exists
        '404':
          description: Save not found

  /save-load/schema/register:
    post:
      tags: [Migration]
      operationId: RegisterSchema
      summary: Register a save data schema
      description: |
        Registers a JSON schema for validation of save data.
        Optionally includes migration handlers from previous versions.
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterSchemaRequest'
      responses:
        '200':
          description: Schema registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaResponse'

  /save-load/schema/list:
    post:
      tags: [Migration]
      operationId: ListSchemas
      summary: List registered schemas
      description: Returns all registered schemas for a game/namespace.
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListSchemasRequest'
      responses:
        '200':
          description: Schemas listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListSchemasResponse'

  # ═══════════════════════════════════════════════════════════════════════════
  # ADMIN OPERATIONS
  # ═══════════════════════════════════════════════════════════════════════════

  /save-load/admin/cleanup:
    post:
      tags: [Admin]
      operationId: AdminCleanup
      summary: Run cleanup for expired/orphaned saves
      description: |
        Triggers cleanup of expired versions and orphaned assets.
        Normally runs automatically, but can be triggered manually.
      x-permissions:
      - role: admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminCleanupRequest'
      responses:
        '200':
          description: Cleanup completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminCleanupResponse'

  /save-load/admin/stats:
    post:
      tags: [Admin]
      operationId: AdminStats
      summary: Get storage statistics
      description: Returns storage usage statistics by owner, category, etc.
      x-permissions:
      - role: admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminStatsRequest'
      responses:
        '200':
          description: Statistics returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminStatsResponse'

components:
  schemas:
    # ═══════════════════════════════════════════════════════════════════════════
    # ENUMS
    # ═══════════════════════════════════════════════════════════════════════════

    OwnerType:
      type: string
      enum: [ACCOUNT, CHARACTER, SESSION, REALM]
      description: Type of entity that owns this save slot

    SaveCategory:
      type: string
      enum: [QUICK_SAVE, AUTO_SAVE, MANUAL_SAVE, CHECKPOINT, STATE_SNAPSHOT]
      description: |
        Category of save with predefined behaviors.
        QUICK_SAVE: Single-slot fast save, overwritten frequently (max 1 version).
        AUTO_SAVE: System-triggered periodic saves (max 5 versions, rolling).
        MANUAL_SAVE: User-initiated named saves (max 10 versions, no auto-cleanup).
        CHECKPOINT: Progress markers (max 20 versions, rolling).
        STATE_SNAPSHOT: Full state captures for debugging (max 3 versions, rolling).

    CompressionType:
      type: string
      enum: [NONE, GZIP, BROTLI]
      description: Compression algorithm used for save data

    ConflictResolution:
      type: string
      enum: [SKIP, OVERWRITE, RENAME, FAIL]
      description: Strategy for handling conflicts during import

    JsonPatchOperation:
      type: object
      required: [op, path]
      description: |
        JSON Patch operation per RFC 6902.
        Uses JsonPatch.Net library (MIT licensed).
      properties:
        op:
          type: string
          enum: [add, remove, replace, move, copy, test]
          description: Operation type
        path:
          type: string
          description: JSON Pointer to target location
        from:
          type: string
          nullable: true
          description: Source path (for move/copy operations)
        value:
          description: Value to use (for add/replace/test operations)

    # ═══════════════════════════════════════════════════════════════════════════
    # SLOT MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    CreateSlotRequest:
      description: Request to create a new save slot for an entity.
      type: object
      required: [gameId, ownerId, ownerType, slotName, category]
      properties:
        gameId:
          type: string
          minLength: 1
          maxLength: 32
          pattern: '^[a-z][a-z0-9-]*$'
          description: Game identifier for namespace isolation (e.g., "game-1", "game-2")
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          minLength: 1
          maxLength: 64
          pattern: '^[a-z0-9]([a-z0-9-]*[a-z0-9])?$'
          description: Slot name (lowercase alphanumeric with hyphens, single char like "q" allowed)
        category:
          $ref: '#/components/schemas/SaveCategory'
          description: Save category determining retention and cleanup behavior
        maxVersions:
          type: integer
          nullable: true
          minimum: 1
          maximum: 100
          description: Override default max versions for this category (null = use category default)
        retentionDays:
          type: integer
          nullable: true
          minimum: 1
          description: Days to retain versions (null = indefinite)
        compressionType:
          allOf:
          - $ref: '#/components/schemas/CompressionType'
          nullable: true
          description: Compression algorithm to use for save data (null = use category default)
        tags:
          type: array
          nullable: true
          items:
            type: string
            maxLength: 32
          maxItems: 20
          description: Searchable tags for slot categorization (e.g., "boss-fight", "chapter-3")
        metadata:
          type: object
          nullable: true
          additionalProperties:
            type: string
          description: Custom key-value metadata for the slot

    GetSlotRequest:
      type: object
      description: Request to retrieve metadata for a specific save slot
      required: [gameId, ownerId, ownerType, slotName]
      properties:
        gameId:
          type: string
          minLength: 1
          maxLength: 32
          pattern: "^[a-z][a-z0-9-]*$"
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name

    ListSlotsRequest:
      type: object
      description: Request to list all save slots belonging to a specific owner
      required: [gameId, ownerId, ownerType]
      properties:
        gameId:
          type: string
          minLength: 1
          maxLength: 32
          pattern: "^[a-z][a-z0-9-]*$"
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns the save slots to list
        category:
          allOf:
          - $ref: '#/components/schemas/SaveCategory'
          nullable: true
          description: Optional filter by save category
        includeVersionCount:
          type: boolean
          default: true
          description: Include version count in response

    DeleteSlotRequest:
      type: object
      description: Request to permanently delete a save slot and all its versions
      required: [gameId, ownerId, ownerType, slotName]
      properties:
        gameId:
          type: string
          minLength: 1
          maxLength: 32
          pattern: "^[a-z][a-z0-9-]*$"
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name

    SlotResponse:
      type: object
      description: Complete metadata for a save slot including version statistics
      required: [slotId, ownerId, ownerType, slotName, category, createdAt]
      properties:
        slotId:
          type: string
          format: uuid
          description: Unique slot identifier
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name
        category:
          $ref: '#/components/schemas/SaveCategory'
          description: Save category determining retention and cleanup behavior
        maxVersions:
          type: integer
          description: Maximum versions to retain
        retentionDays:
          type: integer
          nullable: true
          description: Days to retain versions (null = indefinite)
        compressionType:
          $ref: '#/components/schemas/CompressionType'
          description: Compression algorithm used for save data
        versionCount:
          type: integer
          description: Current number of versions in slot
        latestVersion:
          type: integer
          nullable: true
          description: Latest version number (null if empty)
        totalSizeBytes:
          type: integer
          format: int64
          description: Total storage used by all versions
        createdAt:
          type: string
          format: date-time
          description: Slot creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last modification timestamp
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Custom key-value metadata

    ListSlotsResponse:
      type: object
      description: Response containing a list of save slots for an owner
      required: [slots]
      properties:
        slots:
          type: array
          items:
            $ref: '#/components/schemas/SlotResponse'
          description: List of slots
        totalCount:
          type: integer
          description: Total number of slots for owner

    DeleteSlotResponse:
      type: object
      description: Result of a slot deletion operation with cleanup statistics
      required: [deleted, versionsDeleted, bytesFreed]
      properties:
        deleted:
          type: boolean
          description: Whether slot was deleted
        versionsDeleted:
          type: integer
          description: Number of versions deleted
        bytesFreed:
          type: integer
          format: int64
          description: Storage freed in bytes

    # ═══════════════════════════════════════════════════════════════════════════
    # SAVE/LOAD MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    SaveRequest:
      type: object
      description: Request to save game state data to a slot with optional compression and metadata
      required: [gameId, ownerId, ownerType, slotName, data]
      properties:
        gameId:
          type: string
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name (auto-created if doesn't exist)
        category:
          allOf:
          - $ref: '#/components/schemas/SaveCategory'
          nullable: true
          description: Category for auto-created slots (defaults to MANUAL_SAVE)
        data:
          type: string
          format: byte
          description: Base64-encoded save data
        schemaVersion:
          type: string
          nullable: true
          description: Schema version identifier for migration tracking
        displayName:
          type: string
          nullable: true
          maxLength: 128
          description: Human-readable name for this save
        thumbnail:
          type: string
          format: byte
          nullable: true
          description: |
            Optional preview image (JPEG/WebP). Max size configurable
            (default 256KB). Used for save slot previews in game UI.
        deviceId:
          type: string
          maxLength: 64
          nullable: true
          description: |
            Optional device identifier for cloud save conflict detection.
            When provided, saves are prefixed/tagged with device info,
            enabling opt-in cross-device sync with collision awareness.
        metadata:
          type: object
          nullable: true
          additionalProperties:
            type: string
          description: Custom metadata (e.g., level, playtime, location)
        pinAsCheckpoint:
          type: string
          nullable: true
          maxLength: 64
          description: If provided, pin this version with checkpoint name

    SaveResponse:
      type: object
      description: Result of a save operation including version info and conflict detection
      required: [slotId, versionNumber, contentHash, sizeBytes, createdAt]
      properties:
        slotId:
          type: string
          format: uuid
          description: Slot identifier
        versionNumber:
          type: integer
          description: Assigned version number
        contentHash:
          type: string
          description: SHA-256 hash of save data
        sizeBytes:
          type: integer
          format: int64
          description: Size of save data in bytes
        compressedSizeBytes:
          type: integer
          format: int64
          description: Compressed size (if compression applied)
        compressionRatio:
          type: number
          format: double
          description: Compression ratio (0-1)
        pinned:
          type: boolean
          description: Whether version was pinned
        checkpointName:
          type: string
          nullable: true
          description: Checkpoint name if pinned
        thumbnailUrl:
          type: string
          format: uri
          nullable: true
          description: Pre-signed URL to retrieve thumbnail (if provided)
        conflictDetected:
          type: boolean
          description: |
            True if this save overwrote a version from a different device.
            Only relevant when deviceId is used for cloud sync.
        conflictingDeviceId:
          type: string
          nullable: true
          description: Device ID of the overwritten version (if conflict)
        conflictingVersion:
          type: integer
          nullable: true
          description: Version number that was overwritten (if conflict)
        createdAt:
          type: string
          format: date-time
          description: Save timestamp
        versionsCleanedUp:
          type: integer
          description: Number of old versions cleaned up by rolling policy
        uploadPending:
          type: boolean
          description: |
            True if async upload is enabled and data is queued for MinIO upload.
            Save is immediately loadable from Redis cache, but not yet durable.

    LoadRequest:
      type: object
      description: Request to load save data from a specific slot and version
      required: [gameId, ownerId, ownerType, slotName]
      properties:
        gameId:
          type: string
          minLength: 1
          maxLength: 32
          pattern: "^[a-z][a-z0-9-]*$"
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name
        versionNumber:
          type: integer
          nullable: true
          description: Specific version to load (defaults to latest)
        checkpointName:
          type: string
          nullable: true
          description: Load by checkpoint name instead of version number
        includeMetadata:
          type: boolean
          default: true
          description: Include version metadata in response

    LoadResponse:
      type: object
      description: Response containing loaded save data with integrity verification
      required: [slotId, versionNumber, data, contentHash]
      properties:
        slotId:
          type: string
          format: uuid
          description: Slot identifier
        versionNumber:
          type: integer
          description: Version number loaded
        data:
          type: string
          format: byte
          description: Base64-encoded save data (decompressed)
        contentHash:
          type: string
          description: SHA-256 hash for integrity verification
        schemaVersion:
          type: string
          nullable: true
          description: Schema version of this save
        displayName:
          type: string
          nullable: true
          description: Human-readable name
        pinned:
          type: boolean
          description: Whether this version is pinned
        checkpointName:
          type: string
          nullable: true
          description: Checkpoint name if pinned
        createdAt:
          type: string
          format: date-time
          description: Save timestamp
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Custom metadata

    # ═══════════════════════════════════════════════════════════════════════════
    # VERSION MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    ListVersionsRequest:
      type: object
      description: Request to list all versions within a save slot with pagination
      required: [ownerId, ownerType, slotName]
      properties:
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name
        offset:
          type: integer
          default: 0
          description: Pagination offset
        limit:
          type: integer
          default: 20
          maximum: 100
          description: Maximum results to return
        pinnedOnly:
          type: boolean
          default: false
          description: Only return pinned versions

    ListVersionsResponse:
      type: object
      description: Paginated list of save versions within a slot
      required: [versions, totalCount]
      properties:
        versions:
          type: array
          items:
            $ref: '#/components/schemas/VersionResponse'
          description: List of versions
        totalCount:
          type: integer
          description: Total version count in slot

    VersionResponse:
      type: object
      description: Metadata for a single save version including size and checkpoint info
      required: [versionNumber, contentHash, sizeBytes, createdAt]
      properties:
        versionNumber:
          type: integer
          description: Version number
        assetId:
          type: string
          format: uuid
          description: Reference to asset in lib-asset
        contentHash:
          type: string
          description: SHA-256 hash
        sizeBytes:
          type: integer
          format: int64
          description: Size in bytes
        compressedSizeBytes:
          type: integer
          format: int64
          description: Compressed size if applicable
        schemaVersion:
          type: string
          nullable: true
          description: Schema version
        displayName:
          type: string
          nullable: true
          description: Human-readable name
        pinned:
          type: boolean
          description: Whether version is pinned
        checkpointName:
          type: string
          nullable: true
          description: Checkpoint name if pinned
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Custom metadata

    PinVersionRequest:
      type: object
      description: Request to pin a save version as a checkpoint to prevent cleanup
      required: [ownerId, ownerType, slotName, versionNumber]
      properties:
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name
        versionNumber:
          type: integer
          description: Version to pin
        checkpointName:
          type: string
          maxLength: 64
          description: Optional checkpoint name for easy retrieval

    UnpinVersionRequest:
      type: object
      description: Request to unpin a previously pinned save version
      required: [ownerId, ownerType, slotName, versionNumber]
      properties:
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name
        versionNumber:
          type: integer
          description: Version to unpin

    DeleteVersionRequest:
      type: object
      description: Request to permanently delete a specific save version
      required: [ownerId, ownerType, slotName, versionNumber]
      properties:
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name
        versionNumber:
          type: integer
          description: Version to delete

    DeleteVersionResponse:
      type: object
      description: Result of a version deletion operation with storage freed
      required: [deleted, bytesFreed]
      properties:
        deleted:
          type: boolean
          description: Whether version was deleted
        bytesFreed:
          type: integer
          format: int64
          description: Storage freed in bytes

    # ═══════════════════════════════════════════════════════════════════════════
    # QUERY MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    QuerySavesRequest:
      type: object
      description: Advanced query for saves across multiple owners with filtering and sorting
      properties:
        ownerId:
          type: string
          format: uuid
          nullable: true
          description: Filter by owner ID
        ownerType:
          allOf:
          - $ref: '#/components/schemas/OwnerType'
          nullable: true
          description: Filter by owner type
        category:
          allOf:
          - $ref: '#/components/schemas/SaveCategory'
          nullable: true
          description: Filter by save category
        createdAfter:
          type: string
          format: date-time
          nullable: true
          description: Filter by creation date
        createdBefore:
          type: string
          format: date-time
          nullable: true
          description: Filter by creation date
        pinnedOnly:
          type: boolean
          nullable: true
          description: Only return pinned versions
        schemaVersion:
          type: string
          nullable: true
          description: Filter by schema version
        metadataFilter:
          type: object
          nullable: true
          additionalProperties:
            type: string
          description: Filter by metadata key-value pairs
        offset:
          type: integer
          default: 0
          description: Pagination offset
        limit:
          type: integer
          default: 20
          maximum: 100
          description: Maximum results
        sortBy:
          type: string
          enum: [created_at, size, version_number]
          default: created_at
          description: Sort field
        sortOrder:
          type: string
          enum: [asc, desc]
          default: desc
          description: Sort order

    QuerySavesResponse:
      type: object
      description: Paginated results from a save query operation
      required: [results, totalCount]
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/QueryResultItem'
          description: Query results
        totalCount:
          type: integer
          description: Total matching results

    QueryResultItem:
      type: object
      description: Single result item from a save query with slot and version metadata
      required: [slotId, slotName, ownerId, ownerType, category, versionNumber, createdAt]
      properties:
        slotId:
          type: string
          format: uuid
          description: Slot identifier
        slotName:
          type: string
          description: Slot name
        ownerId:
          type: string
          format: uuid
          description: Owner ID
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        category:
          $ref: '#/components/schemas/SaveCategory'
          description: Save category of the slot
        versionNumber:
          type: integer
          description: Version number
        sizeBytes:
          type: integer
          format: int64
          description: Size in bytes
        schemaVersion:
          type: string
          nullable: true
          description: Schema version
        displayName:
          type: string
          nullable: true
          description: Display name
        pinned:
          type: boolean
          description: Whether pinned
        checkpointName:
          type: string
          nullable: true
          description: Checkpoint name
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Custom metadata

    # ═══════════════════════════════════════════════════════════════════════════
    # MIGRATION MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    MigrateSaveRequest:
      type: object
      description: Request to migrate a save to a newer schema version
      required: [ownerId, ownerType, slotName, targetSchemaVersion]
      properties:
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Slot name
        versionNumber:
          type: integer
          description: Specific version to migrate (defaults to latest)
        targetSchemaVersion:
          type: string
          description: Target schema version to migrate to
        dryRun:
          type: boolean
          default: false
          description: Validate migration without saving

    MigrateSaveResponse:
      type: object
      description: Result of a schema migration operation with version path details
      required: [success, fromSchemaVersion, toSchemaVersion]
      properties:
        success:
          type: boolean
          description: Whether migration succeeded
        fromSchemaVersion:
          type: string
          description: Original schema version
        toSchemaVersion:
          type: string
          description: Target schema version
        newVersionNumber:
          type: integer
          nullable: true
          description: New version number (null if dry run)
        migrationPath:
          type: array
          items:
            type: string
          description: Migration path applied (list of versions)
        warnings:
          type: array
          items:
            type: string
          description: Non-fatal migration warnings

    RegisterSchemaRequest:
      type: object
      description: Request to register a new save data schema with optional migration rules
      required: [namespace, schemaVersion, schema]
      properties:
        namespace:
          type: string
          description: Schema namespace (e.g., game identifier)
        schemaVersion:
          type: string
          description: Schema version identifier
        schema:
          type: object
          description: JSON Schema definition for validation
        previousVersion:
          type: string
          nullable: true
          description: Previous version this migrates from
        migrationPatch:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/JsonPatchOperation'
          description: |
            JSON Patch (RFC 6902) operations to migrate from previousVersion.
            Uses JsonPatch.Net library (MIT licensed).

    SchemaResponse:
      type: object
      description: Registered schema definition with version lineage information
      required: [namespace, schemaVersion, createdAt]
      properties:
        namespace:
          type: string
          description: Schema namespace
        schemaVersion:
          type: string
          description: Schema version
        schema:
          type: object
          description: JSON Schema definition
        previousVersion:
          type: string
          nullable: true
          description: Previous version
        hasMigration:
          type: boolean
          description: Whether migration script is registered
        createdAt:
          type: string
          format: date-time
          description: Registration timestamp

    ListSchemasRequest:
      type: object
      description: Request to list all registered schemas for a namespace
      required: [namespace]
      properties:
        namespace:
          type: string
          description: Schema namespace to list

    ListSchemasResponse:
      type: object
      description: List of registered schemas with latest version indicator
      required: [schemas]
      properties:
        schemas:
          type: array
          items:
            $ref: '#/components/schemas/SchemaResponse'
          description: Registered schemas
        latestVersion:
          type: string
          nullable: true
          description: Latest schema version

    # ═══════════════════════════════════════════════════════════════════════════
    # ADMIN MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    AdminCleanupRequest:
      type: object
      description: Request for admin-triggered cleanup of expired or orphaned saves
      properties:
        dryRun:
          type: boolean
          default: true
          description: Preview cleanup without executing
        olderThanDays:
          type: integer
          description: Only cleanup versions older than N days
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Filter cleanup to specific owner type
        category:
          $ref: '#/components/schemas/SaveCategory'
          description: Filter cleanup to specific save category

    AdminCleanupResponse:
      type: object
      description: Result of admin cleanup operation with storage reclamation details
      required: [versionsDeleted, bytesFreed, dryRun]
      properties:
        versionsDeleted:
          type: integer
          description: Number of versions deleted
        slotsDeleted:
          type: integer
          description: Number of empty slots deleted
        bytesFreed:
          type: integer
          format: int64
          description: Storage freed in bytes
        dryRun:
          type: boolean
          description: Whether this was a preview

    AdminStatsRequest:
      type: object
      description: Request for aggregate storage statistics with optional grouping
      properties:
        groupBy:
          type: string
          enum: [owner_type, category, schema_version]
          description: Group statistics by field

    AdminStatsResponse:
      type: object
      description: Aggregate storage statistics with optional breakdown by category
      required: [totalSlots, totalVersions, totalSizeBytes]
      properties:
        totalSlots:
          type: integer
          description: Total slot count
        totalVersions:
          type: integer
          description: Total version count
        totalSizeBytes:
          type: integer
          format: int64
          description: Total storage used
        pinnedVersions:
          type: integer
          description: Number of pinned versions
        breakdown:
          type: array
          items:
            $ref: '#/components/schemas/StatsBreakdown'
          description: Breakdown by groupBy field

    StatsBreakdown:
      type: object
      description: Storage statistics for a single category in the breakdown
      required: [key, slots, versions, sizeBytes]
      properties:
        key:
          type: string
          description: Group key
        slots:
          type: integer
          description: Slot count
        versions:
          type: integer
          description: Version count
        sizeBytes:
          type: integer
          format: int64
          description: Storage used

    # ═══════════════════════════════════════════════════════════════════════════
    # ADDITIONAL ENDPOINT MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    RenameSlotRequest:
      type: object
      description: Request to rename an existing save slot
      required: [gameId, ownerId, ownerType, slotName, newSlotName]
      properties:
        gameId:
          type: string
          description: Game identifier
        ownerId:
          type: string
          format: uuid
          description: Entity ID that owns the slot
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Current slot name
        newSlotName:
          type: string
          minLength: 1
          maxLength: 64
          pattern: '^[a-z0-9]([a-z0-9-]*[a-z0-9])?$'
          description: New slot name

    BulkDeleteSlotsRequest:
      type: object
      description: Request to delete multiple save slots in a single operation
      required: [gameId, slotIds]
      properties:
        gameId:
          type: string
          description: Game identifier
        slotIds:
          type: array
          items:
            type: string
            format: uuid
          description: Slot IDs to delete

    BulkDeleteSlotsResponse:
      type: object
      description: Result of bulk slot deletion with total cleanup statistics
      required: [deletedCount, bytesFreed]
      properties:
        deletedCount:
          type: integer
          description: Number of slots deleted
        bytesFreed:
          type: integer
          format: int64
          description: Total storage freed

    CopySaveRequest:
      description: Request to copy save data from one slot to another, optionally across different entities or games.
      type: object
      required: [sourceGameId, sourceOwnerId, sourceOwnerType, sourceSlotName, targetGameId, targetOwnerId, 
          targetOwnerType, targetSlotName]
      properties:
        sourceGameId:
          type: string
          description: Game identifier of the source save
        sourceOwnerId:
          type: string
          format: uuid
          description: Entity ID that owns the source save
        sourceOwnerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns the source save
        sourceSlotName:
          type: string
          description: Name of the source slot to copy from
        sourceVersion:
          type: integer
          nullable: true
          description: Version to copy (latest if null)
        targetGameId:
          type: string
          description: Game identifier for the target save
        targetOwnerId:
          type: string
          format: uuid
          description: Entity ID that will own the copied save
        targetOwnerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that will own the copied save
        targetSlotName:
          type: string
          description: Name of the target slot to copy to
        targetCategory:
          $ref: '#/components/schemas/SaveCategory'
          description: Category for new slot if auto-created

    ExportSavesRequest:
      type: object
      description: Request to export all saves for an owner to a downloadable archive
      required: [gameId, ownerId, ownerType]
      properties:
        gameId:
          type: string
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: Entity ID that owns the saves to export
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns the saves to export
        slotNames:
          type: array
          items:
            type: string
          description: Specific slots to export (all if null)

    ExportSavesResponse:
      type: object
      description: Response with pre-signed URL for downloading exported save archive
      required: [downloadUrl, expiresAt, sizeBytes]
      properties:
        downloadUrl:
          type: string
          format: uri
          description: Pre-signed URL to download export archive
        expiresAt:
          type: string
          format: date-time
          description: When the download URL expires
        sizeBytes:
          type: integer
          format: int64
          description: Archive size

    ImportSavesRequest:
      type: object
      description: Request to import saves from an uploaded archive
      required: [archiveAssetId, targetGameId, targetOwnerId, targetOwnerType]
      properties:
        archiveAssetId:
          type: string
          format: uuid
          description: Asset ID of uploaded export archive
        targetGameId:
          type: string
          description: Game identifier for namespace isolation
        targetOwnerId:
          type: string
          format: uuid
          description: Entity ID that will own the imported saves
        targetOwnerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that will own the imported saves
        conflictResolution:
          $ref: '#/components/schemas/ConflictResolution'
          description: How to handle existing slots

    ImportSavesResponse:
      type: object
      description: Result of save archive import with success and conflict counts
      required: [importedSlots, importedVersions, skippedSlots]
      properties:
        importedSlots:
          type: integer
          description: Number of slots successfully imported
        importedVersions:
          type: integer
          description: Total number of versions imported across all slots
        skippedSlots:
          type: integer
          description: Slots skipped due to conflicts
        conflicts:
          type: array
          items:
            type: string
          description: Names of slots that had conflicts

    VerifyIntegrityRequest:
      type: object
      description: Request to verify data integrity of a save version via hash comparison
      required: [gameId, ownerId, ownerType, slotName]
      properties:
        gameId:
          type: string
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Name of the slot to verify
        versionNumber:
          type: integer
          nullable: true
          description: Version to verify (latest if null)

    VerifyIntegrityResponse:
      type: object
      description: Result of integrity verification with hash comparison details
      required: [valid, versionNumber]
      properties:
        valid:
          type: boolean
          description: Whether integrity check passed
        versionNumber:
          type: integer
          description: Version that was verified
        expectedHash:
          type: string
          description: Expected SHA-256 hash
        actualHash:
          type: string
          nullable: true
          description: Actual hash (null if data unavailable)
        errorMessage:
          type: string
          nullable: true
          description: Error details if verification failed

    PromoteVersionRequest:
      type: object
      description: Request to promote an older save version to be the latest
      required: [gameId, ownerId, ownerType, slotName, versionNumber]
      properties:
        gameId:
          type: string
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Name of the slot containing the version to promote
        versionNumber:
          type: integer
          description: Old version to promote to latest
        displayName:
          type: string
          nullable: true
          description: Display name for promoted version

    # ═══════════════════════════════════════════════════════════════════════════
    # DELTA SAVE MODELS
    # ═══════════════════════════════════════════════════════════════════════════

    DeltaAlgorithm:
      type: string
      enum: [JSON_PATCH, BSDIFF, XDELTA]
      default: JSON_PATCH
      description: |
        Algorithm used for delta computation.
        JSON_PATCH: RFC 6902, best for structured JSON data
        BSDIFF: Binary diff, good for general binary data
        XDELTA: RFC 3284 VCDIFF, efficient for large binary files

    SaveDeltaRequest:
      type: object
      description: Request to save incremental changes as a delta from a base version
      required: [gameId, ownerId, ownerType, slotName, baseVersion, delta]
      properties:
        gameId:
          type: string
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: ID of the owning entity
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Name of the slot to save the delta to
        baseVersion:
          type: integer
          description: Version number this delta is based on
        delta:
          type: string
          format: byte
          description: |
            Base64-encoded delta/patch data.
            For JSON_PATCH: Array of RFC 6902 operations
            For BSDIFF/XDELTA: Binary patch data
        algorithm:
          allOf:
          - $ref: '#/components/schemas/DeltaAlgorithm'
          nullable: true
          description: Delta computation algorithm to use (defaults to JSON_PATCH)
        schemaVersion:
          type: string
          nullable: true
          description: Schema version of this save for migration tracking
        displayName:
          type: string
          nullable: true
          description: Human-readable name for this delta save
        deviceId:
          type: string
          nullable: true
          description: Device identifier for cross-device sync conflict detection
        metadata:
          type: object
          nullable: true
          additionalProperties:
            type: string
          description: Custom key-value metadata for this delta version

    SaveDeltaResponse:
      type: object
      description: Result of delta save operation with size and chain information
      required: [slotId, versionNumber, baseVersion, deltaSizeBytes, estimatedFullSizeBytes, createdAt]
      properties:
        slotId:
          type: string
          format: uuid
          description: Unique identifier of the save slot
        versionNumber:
          type: integer
          description: New version number
        baseVersion:
          type: integer
          description: Base version this delta is relative to
        deltaSizeBytes:
          type: integer
          format: int64
          description: Size of stored delta
        estimatedFullSizeBytes:
          type: integer
          format: int64
          description: Estimated size when reconstructed
        chainLength:
          type: integer
          description: Number of deltas in chain to base snapshot
        compressionSavings:
          type: number
          format: double
          description: Storage savings vs full snapshot (0-1)
        createdAt:
          type: string
          format: date-time
          description: When the delta version was created

    CollapseDeltasRequest:
      type: object
      description: Request to collapse a delta chain into a full snapshot
      required: [gameId, ownerId, ownerType, slotName]
      properties:
        gameId:
          type: string
          description: Game identifier for namespace isolation
        ownerId:
          type: string
          format: uuid
          description: Entity ID that owns the save slot
        ownerType:
          $ref: '#/components/schemas/OwnerType'
          description: Type of entity that owns this save slot
        slotName:
          type: string
          description: Name of the slot containing deltas to collapse
        versionNumber:
          type: integer
          nullable: true
          description: Version to collapse to (latest if null)
        deleteIntermediates:
          type: boolean
          default: true
          description: Delete intermediate delta versions after collapse
