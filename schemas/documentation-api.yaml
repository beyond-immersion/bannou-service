openapi: 3.0.0
info:
  title: Bannou Documentation API
  description: |
    Knowledge base API for AI agents to query documentation.
    Designed for SignalWire SWAIG, OpenAI function calling, and Claude tool use.
    All endpoints return voice-friendly summaries alongside detailed content.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    **Browser Endpoint**: The GET /documentation/view/{slug} endpoint is browser-facing
    (NGINX-routed) per FOUNDATION TENETS.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before modifying this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (MUST use "bannou" app-id)

paths:
  # ===== Browser-Facing Endpoint (FOUNDATION TENETS) =====
  /documentation/view/{slug}:
    get:
      operationId: viewDocumentBySlug
      summary: View documentation page in browser
      description: |
        Browser-facing endpoint for viewing documentation.
        Routed via NGINX, not exposed to WebSocket clients.
        Returns HTML-rendered documentation page.
      tags:
      - Browser
      x-permissions: []
      parameters:
      - name: slug
        in: path
        required: true
        schema:
          type: string
          pattern: '^[a-z0-9-]+$'
        description: Document slug within namespace
      - name: ns
        in: query
        required: false
        schema:
          type: string
          default: bannou
        description: Documentation namespace (defaults to bannou)
      responses:
        '200':
          description: HTML documentation page (returns ContentResult)
        '404':
          description: Document not found
      x-manual-implementation: true  # Returns HTML, not JSON - excluded from interface generation

  /documentation/raw/{slug}:
    get:
      operationId: rawDocumentBySlug
      summary: Get raw markdown content
      description: |
        Browser-facing endpoint for retrieving raw markdown content.
        Routed via NGINX, not exposed to WebSocket clients.
        Returns raw markdown with text/markdown content type.
      tags:
      - Browser
      x-permissions: []
      parameters:
      - name: slug
        in: path
        required: true
        schema:
          type: string
          pattern: '^[a-z0-9-]+$'
        description: Document slug within namespace
      - name: ns
        in: query
        required: false
        schema:
          type: string
          default: bannou
        description: Documentation namespace (defaults to bannou)
      responses:
        '200':
          description: Raw markdown content
          content:
            text/markdown:
              schema:
                type: string
        '404':
          description: Document not found
      x-manual-implementation: true

  # ===== Query Endpoints (WebSocket accessible) =====
  /documentation/query:
    post:
      operationId: queryDocumentation
      summary: Natural language documentation search
      description: |
        Search documentation using natural language queries.
        Returns the most relevant documents with voice-friendly summaries.
      tags:
      - Search
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryDocumentationRequest'
      responses:
        '200':
          description: Search results with voice-friendly summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryDocumentationResponse'
        '400':
          description: Invalid request
        '500':
          description: Internal server error

  /documentation/get:
    post:
      operationId: getDocument
      summary: Get specific document by ID or slug
      description: |
        Retrieve a specific document by its unique identifier or slug.
        Returns full content with metadata.
      tags:
      - Documents
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetDocumentRequest'
      responses:
        '200':
          description: Document content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetDocumentResponse'
        '404':
          description: Document not found

  /documentation/search:
    post:
      operationId: searchDocumentation
      summary: Full-text keyword search
      description: |
        Search documentation using exact keyword matching.
        Faster than semantic search but less flexible.
      tags:
      - Search
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchDocumentationRequest'
      responses:
        '200':
          description: Matching documents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchDocumentationResponse'

  /documentation/list:
    post:
      operationId: listDocuments
      summary: List documents by category
      description: |
        List all documents in a specific category or all categories.
        Supports pagination for large result sets.
      tags:
      - Documents
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListDocumentsRequest'
      responses:
        '200':
          description: Document list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListDocumentsResponse'

  /documentation/suggest:
    post:
      operationId: suggestRelatedTopics
      summary: Get related topics and follow-up suggestions
      description: |
        Given a topic or document ID, returns related topics the user
        might want to explore. Useful for conversational AI flow.
      tags:
      - Search
      x-permissions:
      - role: anonymous
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SuggestRelatedRequest'
      responses:
        '200':
          description: Related topics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuggestRelatedResponse'

  # ===== Admin Endpoints =====
  /documentation/create:
    post:
      operationId: createDocument
      summary: Create new documentation entry
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDocumentRequest'
      responses:
        '200':
          description: Document created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateDocumentResponse'
        '409':
          description: Document with same slug already exists

  /documentation/update:
    post:
      operationId: updateDocument
      summary: Update existing documentation entry
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDocumentRequest'
      responses:
        '200':
          description: Document updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateDocumentResponse'
        '404':
          description: Document not found

  /documentation/delete:
    post:
      operationId: deleteDocument
      summary: Soft-delete documentation entry to trashcan
      description: |
        Moves document to trashcan for recovery within TTL period.
        Documents are automatically cleaned up after TrashcanTtlDays.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteDocumentRequest'
      responses:
        '200':
          description: Document moved to trashcan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteDocumentResponse'
        '404':
          description: Document not found

  /documentation/recover:
    post:
      operationId: recoverDocument
      summary: Recover document from trashcan
      description: |
        Restores a soft-deleted document from the trashcan.
        Must be called before the trashcan TTL expires.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecoverDocumentRequest'
      responses:
        '200':
          description: Document recovered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecoverDocumentResponse'
        '404':
          description: Trashcan entry not found or expired
        '409':
          description: Conflict with existing document

  /documentation/bulk-update:
    post:
      operationId: bulkUpdateDocuments
      summary: Bulk update document metadata
      description: |
        Apply category, tag, or metadata changes to multiple documents at once.
        Each document is processed independently - partial success is possible.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkUpdateRequest'
      responses:
        '200':
          description: Bulk update results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkUpdateResponse'

  /documentation/bulk-delete:
    post:
      operationId: bulkDeleteDocuments
      summary: Bulk soft-delete documents to trashcan
      description: |
        Move multiple documents to trashcan at once.
        Each document is processed independently - partial success is possible.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkDeleteRequest'
      responses:
        '200':
          description: Bulk delete results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkDeleteResponse'

  /documentation/import:
    post:
      operationId: importDocumentation
      summary: Bulk import documentation from structured source
      description: |
        Import multiple documents. Each document processed independently.
        Partial success is possible - failures reported per document.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImportDocumentationRequest'
      responses:
        '200':
          description: Import results (may include partial failures)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportDocumentationResponse'

  /documentation/trashcan:
    post:
      operationId: listTrashcan
      summary: List documents in the trashcan
      description: |
        List all soft-deleted documents within the namespace's trashcan.
        Documents remain recoverable until TTL expires or purge is called.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListTrashcanRequest'
      responses:
        '200':
          description: Trashcan contents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListTrashcanResponse'

  /documentation/purge:
    post:
      operationId: purgeTrashcan
      summary: Permanently delete trashcan items
      description: |
        Permanently delete specified documents from trashcan, or purge all.
        This operation is irreversible - documents cannot be recovered after purge.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurgeTrashcanRequest'
      responses:
        '200':
          description: Purge results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PurgeTrashcanResponse'

  /documentation/stats:
    post:
      operationId: getNamespaceStats
      summary: Get namespace documentation statistics
      description: |
        Retrieve usage statistics and metadata for a documentation namespace.
        Useful for monitoring, capacity planning, and administrative dashboards.
      tags:
      - Admin
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetNamespaceStatsRequest'
      responses:
        '200':
          description: Namespace statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NamespaceStatsResponse'

  # ===== Repository Binding Endpoints =====
  /documentation/repo/bind:
    post:
      operationId: bindRepository
      summary: Bind a git repository to a documentation namespace
      description: |
        Bind a git repository URL to a documentation namespace.
        The namespace will be exclusively managed by the repository - manual edits will be blocked.
        Triggers initial sync after binding.
      tags:
      - Repository
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BindRepositoryRequest'
      responses:
        '200':
          description: Repository binding created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BindRepositoryResponse'
        '400':
          description: Invalid request (malformed URL, invalid branch)
        '409':
          description: Namespace already bound to a repository

  /documentation/repo/unbind:
    post:
      operationId: unbindRepository
      summary: Remove repository binding from namespace
      description: |
        Remove repository binding from a namespace, making it manually editable again.
        Optionally delete all documents imported from the repository.
      tags:
      - Repository
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnbindRepositoryRequest'
      responses:
        '200':
          description: Repository binding removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnbindRepositoryResponse'
        '404':
          description: No binding found for namespace

  /documentation/repo/sync:
    post:
      operationId: syncRepository
      summary: Manually trigger repository sync
      description: |
        Manually trigger synchronization of a bound repository.
        If force=true, performs full re-sync regardless of commit hash.
      tags:
      - Repository
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SyncRepositoryRequest'
      responses:
        '200':
          description: Sync completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncRepositoryResponse'
        '404':
          description: No binding found for namespace
        '409':
          description: Sync already in progress

  /documentation/repo/status:
    post:
      operationId: getRepositoryStatus
      summary: Get repository binding status
      description: |
        Get current status of a repository binding including sync state and statistics.
      tags:
      - Repository
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RepositoryStatusRequest'
      responses:
        '200':
          description: Repository binding status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RepositoryStatusResponse'
        '404':
          description: No binding found for namespace

  /documentation/repo/list:
    post:
      operationId: listRepositoryBindings
      summary: List all repository bindings
      description: |
        List all repository bindings with optional filtering by status.
      tags:
      - Repository
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListRepositoryBindingsRequest'
      responses:
        '200':
          description: List of repository bindings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListRepositoryBindingsResponse'

  /documentation/repo/update:
    post:
      operationId: updateRepositoryBinding
      summary: Update repository binding configuration
      description: |
        Update sync settings, file patterns, category mappings, or archive configuration.
      tags:
      - Repository
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRepositoryBindingRequest'
      responses:
        '200':
          description: Repository binding updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateRepositoryBindingResponse'
        '404':
          description: No binding found for namespace

  # ===== Archive Endpoints =====
  /documentation/repo/archive/create:
    post:
      operationId: createDocumentationArchive
      summary: Create documentation archive
      description: |
        Create a .bannou bundle archive of all documents in a namespace.
        Archives are stored via Asset Service.
      tags:
      - Archive
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateArchiveRequest'
      responses:
        '200':
          description: Archive created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateArchiveResponse'
        '404':
          description: Namespace not found

  /documentation/repo/archive/list:
    post:
      operationId: listDocumentationArchives
      summary: List documentation archives
      description: |
        List all archives for a namespace.
      tags:
      - Archive
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListArchivesRequest'
      responses:
        '200':
          description: List of archives
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListArchivesResponse'

  /documentation/repo/archive/restore:
    post:
      operationId: restoreDocumentationArchive
      summary: Restore documentation from archive
      description: |
        Restore documents from a .bannou bundle archive.
        Replaces all documents in the namespace with archived content.
      tags:
      - Archive
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestoreArchiveRequest'
      responses:
        '200':
          description: Archive restored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestoreArchiveResponse'
        '404':
          description: Archive not found

  /documentation/repo/archive/delete:
    post:
      operationId: deleteDocumentationArchive
      summary: Delete documentation archive
      description: |
        Delete an archive from Asset Service storage.
      tags:
      - Archive
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteArchiveRequest'
      responses:
        '200':
          description: Archive deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteArchiveResponse'
        '404':
          description: Archive not found

components:
  schemas:
    # ===== Common Types =====
    DocumentCategory:
      type: string
      enum:
      - getting-started
      - api-reference
      - architecture
      - deployment
      - troubleshooting
      - tutorials
      - game-systems
      - world-lore
      - npc-ai
      - other
      description: Fixed categories for type-safe filtering

    RelatedDepth:
      type: string
      enum:
      - none
      - direct
      - extended
      default: direct
      description: |
        How deep to traverse related document links:
        - none: No related documents included
        - direct: Only directly linked documents (depth 1)
        - extended: Related documents + their related documents (depth 2)

    SearchField:
      type: string
      enum:
      - title
      - content
      - tags
      - summary
      description: Fields that can be searched within documents

    ListSortField:
      type: string
      enum:
      - created_at
      - updated_at
      - title
      default: updated_at
      description: Fields available for sorting document lists

    SuggestionSource:
      type: string
      enum:
      - document_id
      - slug
      - topic
      - category
      description: Source type for generating related topic suggestions

    # ===== Query Endpoint =====
    QueryDocumentationRequest:
      description: Request to search documentation using natural language queries
      type: object
      additionalProperties: false
      required:
      - namespace
      - query
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to search within
        query:
          type: string
          minLength: 3
          maxLength: 500
          description: Natural language query to search for
        sessionId:
          type: string
          format: uuid
          description: Optional session ID for conversational context
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Filter results to a specific category
        maxResults:
          type: integer
          default: 5
          minimum: 1
          maximum: 20
          description: Maximum number of results to return
        includeContent:
          type: boolean
          default: false
          description: Whether to include full document content in results
        maxSummaryLength:
          type: integer
          default: 300
          minimum: 50
          maximum: 500
          description: Maximum length of summaries in characters
        minRelevanceScore:
          type: number
          format: float
          default: 0.3
          minimum: 0.0
          maximum: 1.0
          description: Minimum relevance score threshold for results

    QueryDocumentationResponse:
      description: Response containing search results and voice-friendly summaries
      type: object
      additionalProperties: false
      required:
      - namespace
      - query
      - results
      properties:
        namespace:
          type: string
          description: The namespace that was searched
        query:
          type: string
          description: The original query string
        results:
          type: array
          items:
            $ref: '#/components/schemas/DocumentResult'
          description: List of matching documents
        totalResults:
          type: integer
          description: Total number of matching documents
        voiceSummary:
          type: string
          description: Concise spoken summary for voice AI
        suggestedFollowups:
          type: array
          items:
            type: string
          description: Suggested follow-up queries
        noResultsMessage:
          type: string
          description: User-friendly message when no results found

    # ===== Get Document Endpoint =====
    GetDocumentRequest:
      description: Request to retrieve a specific document by ID or slug
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace containing the document
        documentId:
          type: string
          format: uuid
          nullable: true
          description: Unique identifier of the document to retrieve (null if using slug)
        slug:
          type: string
          pattern: '^[a-z0-9-]+$'
          nullable: true
          description: URL-friendly slug of the document to retrieve (null if using documentId)
        sessionId:
          type: string
          format: uuid
          nullable: true
          description: Optional session ID for tracking document views (null if not tracking)
        includeRelated:
          $ref: '#/components/schemas/RelatedDepth'
          nullable: true
          description: How deep to fetch related documents (null for no related documents)
        includeContent:
          type: boolean
          default: false
          description: Whether to include full document content
        renderHtml:
          type: boolean
          default: false
          description: Whether to render markdown content as HTML

    GetDocumentResponse:
      description: Response containing the requested document and optional related documents
      type: object
      additionalProperties: false
      required:
      - document
      properties:
        document:
          $ref: '#/components/schemas/Document'
          description: The requested document
        relatedDocuments:
          type: array
          items:
            $ref: '#/components/schemas/DocumentSummary'
          description: List of related documents based on includeRelated depth
        contentFormat:
          type: string
          enum:
          - markdown
          - html
          - none
          description: Format of the content field in the response

    # ===== Search Endpoint =====
    SearchDocumentationRequest:
      description: Request to search documentation using keyword matching
      type: object
      additionalProperties: false
      required:
      - namespace
      - searchTerm
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to search within
        searchTerm:
          type: string
          minLength: 2
          maxLength: 200
          description: Keyword or phrase to search for
        sessionId:
          type: string
          format: uuid
          nullable: true
          description: Optional session ID for tracking searches (null if not tracking)
        category:
          $ref: '#/components/schemas/DocumentCategory'
          nullable: true
          description: Filter results to a specific category (null for all categories)
        maxResults:
          type: integer
          default: 10
          minimum: 1
          maximum: 50
          description: Maximum number of results to return
        searchIn:
          type: array
          items:
            $ref: '#/components/schemas/SearchField'
          nullable: true
          description: Fields to search within (null for default fields)
        sortBy:
          type: string
          enum:
          - relevance
          - recency
          - alphabetical
          default: relevance
          description: How to sort the search results
        includeContent:
          type: boolean
          default: false
          description: Whether to include full document content in results

    SearchDocumentationResponse:
      description: Response containing keyword search results
      type: object
      additionalProperties: false
      required:
      - namespace
      - results
      properties:
        namespace:
          type: string
          description: The namespace that was searched
        results:
          type: array
          items:
            $ref: '#/components/schemas/DocumentResult'
          description: List of matching documents
        totalResults:
          type: integer
          description: Total number of matching documents
        searchTerm:
          type: string
          description: The original search term

    # ===== List Endpoint =====
    ListDocumentsRequest:
      description: Request to list documents with optional filtering and pagination
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to list documents from
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Filter to a specific category
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Filter by tags (null to skip tag filtering)
        tagsMatch:
          type: string
          enum:
          - all
          - any
          default: all
          description: Whether documents must match all tags or any tag
        createdAfter:
          type: string
          format: date-time
          description: Filter to documents created after this timestamp
        createdBefore:
          type: string
          format: date-time
          description: Filter to documents created before this timestamp
        updatedAfter:
          type: string
          format: date-time
          description: Filter to documents updated after this timestamp
        updatedBefore:
          type: string
          format: date-time
          description: Filter to documents updated before this timestamp
        titlesOnly:
          type: boolean
          default: false
          description: Return only document titles without summaries
        page:
          type: integer
          default: 1
          minimum: 1
          description: Page number for pagination
        pageSize:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
          description: Number of documents per page
        sortBy:
          $ref: '#/components/schemas/ListSortField'
          description: Field to sort results by
        sortOrder:
          type: string
          enum:
          - asc
          - desc
          default: desc
          description: Sort order direction

    ListDocumentsResponse:
      description: Response containing a paginated list of documents
      type: object
      additionalProperties: false
      required:
      - namespace
      - documents
      properties:
        namespace:
          type: string
          description: The namespace that was listed
        documents:
          type: array
          items:
            $ref: '#/components/schemas/DocumentSummary'
          description: List of documents in the namespace
        totalCount:
          type: integer
          description: Total number of documents matching filters
        page:
          type: integer
          description: Current page number
        pageSize:
          type: integer
          description: Number of documents per page
        totalPages:
          type: integer
          description: Total number of pages available

    # ===== Suggest Endpoint =====
    SuggestRelatedRequest:
      description: Request to get related topic suggestions based on a source
      type: object
      additionalProperties: false
      required:
      - namespace
      - suggestionSource
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace for suggestions
        suggestionSource:
          $ref: '#/components/schemas/SuggestionSource'
          description: Type of source to base suggestions on
        sourceValue:
          type: string
          description: The value for the suggestion source (document ID, slug, topic, or category)
        sessionId:
          type: string
          format: uuid
          description: Optional session ID for personalized suggestions
        maxSuggestions:
          type: integer
          default: 5
          minimum: 1
          maximum: 10
          description: Maximum number of suggestions to return
        excludeRecentlyViewed:
          type: boolean
          default: true
          description: Exclude documents viewed in current session

    SuggestRelatedResponse:
      description: Response containing suggested related topics for conversational flow
      type: object
      additionalProperties: false
      required:
      - namespace
      - suggestions
      properties:
        namespace:
          type: string
          description: The namespace suggestions are from
        suggestions:
          type: array
          items:
            $ref: '#/components/schemas/TopicSuggestion'
          description: List of suggested related topics
        voicePrompt:
          type: string
          description: Voice-friendly prompt for presenting suggestions
        sessionInfluenced:
          type: boolean
          description: Whether suggestions were influenced by session history

    TopicSuggestion:
      description: A suggested related topic with relevance context
      type: object
      additionalProperties: false
      required:
      - documentId
      - title
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the suggested document
        slug:
          type: string
          description: URL-friendly slug of the suggested document
        title:
          type: string
          description: Title of the suggested document
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Category of the suggested document
        relevanceReason:
          type: string
          description: Explanation of why this document is relevant

    # ===== Admin: Create/Update/Delete =====
    CreateDocumentRequest:
      description: Request to create a new documentation entry
      type: object
      additionalProperties: false
      required:
      - namespace
      - slug
      - title
      - category
      - content
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to create document in
        slug:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 100
          description: URL-friendly unique identifier for the document
        title:
          type: string
          maxLength: 200
          description: Display title of the document
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Category for organizing the document
        content:
          type: string
          description: Markdown content (max 500KB)
        summary:
          type: string
          maxLength: 500
          nullable: true
          description: Brief text summary of the document (null if not provided)
        voiceSummary:
          type: string
          maxLength: 200
          nullable: true
          description: Concise summary optimized for voice AI (null if not provided)
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Tags for filtering and search (null to skip tagging)
        relatedDocuments:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
          description: IDs of related documents to link (null to skip linking)
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Custom metadata key-value pairs (null if not needed)

    CreateDocumentResponse:
      description: Response confirming document creation with assigned identifiers
      type: object
      additionalProperties: false
      required:
      - documentId
      - slug
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the created document
        slug:
          type: string
          description: URL-friendly slug of the created document
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the document was created

    UpdateDocumentRequest:
      description: Request to update an existing document's fields
      type: object
      additionalProperties: false
      required:
      - namespace
      - documentId
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace containing the document
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the document to update
        slug:
          type: string
          nullable: true
          description: New URL-friendly slug for the document (null to keep unchanged)
        title:
          type: string
          nullable: true
          description: New display title for the document (null to keep unchanged)
        category:
          $ref: '#/components/schemas/DocumentCategory'
          nullable: true
          description: New category for the document (null to keep unchanged)
        content:
          type: string
          nullable: true
          description: New markdown content for the document (null to keep unchanged)
        summary:
          type: string
          nullable: true
          description: New text summary for the document (null to keep unchanged)
        voiceSummary:
          type: string
          nullable: true
          description: New voice-optimized summary for the document (null to keep unchanged)
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: New set of tags for the document (null to keep unchanged)
        relatedDocuments:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
          description: New set of related document IDs (null to keep unchanged)
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: New custom metadata key-value pairs (null to keep unchanged)

    UpdateDocumentResponse:
      description: Response confirming document update with timestamp
      type: object
      additionalProperties: false
      required:
      - documentId
      - updatedAt
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the updated document
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the document was updated

    DeleteDocumentRequest:
      description: Request to soft-delete a document to the trashcan
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace containing the document
        documentId:
          type: string
          format: uuid
          nullable: true
          description: Unique identifier of the document to delete (null if using slug)
        slug:
          type: string
          nullable: true
          description: URL-friendly slug of the document to delete (null if using documentId)

    DeleteDocumentResponse:
      description: Response confirming document deletion with recovery deadline
      type: object
      additionalProperties: false
      required:
      - documentId
      - deletedAt
      - recoverableUntil
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the deleted document
        deletedAt:
          type: string
          format: date-time
          description: Timestamp when the document was deleted
        recoverableUntil:
          type: string
          format: date-time
          description: Deadline for recovering the document from trashcan

    # ===== Admin: Recover =====
    RecoverDocumentRequest:
      description: Request to recover a deleted document from the trashcan
      type: object
      additionalProperties: false
      required:
      - namespace
      - documentId
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace containing the trashcan
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the document to recover

    RecoverDocumentResponse:
      description: Response confirming document recovery with timestamp
      type: object
      additionalProperties: false
      required:
      - documentId
      - recoveredAt
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the recovered document
        recoveredAt:
          type: string
          format: date-time
          description: Timestamp when the document was recovered

    # ===== Admin: Bulk Operations =====
    BulkUpdateRequest:
      description: Request to update multiple documents at once
      type: object
      additionalProperties: false
      required:
      - namespace
      - documentIds
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace containing the documents
        documentIds:
          type: array
          items:
            type: string
            format: uuid
          description: List of document IDs to update
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: New category to apply to all documents
        addTags:
          type: array
          items:
            type: string
          nullable: true
          description: Tags to add to all documents (null to skip adding)
        removeTags:
          type: array
          items:
            type: string
          nullable: true
          description: Tags to remove from all documents (null to skip removing)

    BulkUpdateResponse:
      description: Response reporting bulk update results with success and failure details
      type: object
      additionalProperties: false
      required:
      - succeeded
      - failed
      properties:
        succeeded:
          type: array
          items:
            type: string
            format: uuid
          description: IDs of documents successfully updated
        failed:
          type: array
          items:
            $ref: '#/components/schemas/BulkOperationFailure'
          description: Details of documents that failed to update

    BulkDeleteRequest:
      description: Request to delete multiple documents at once
      type: object
      additionalProperties: false
      required:
      - namespace
      - documentIds
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace containing the documents
        documentIds:
          type: array
          items:
            type: string
            format: uuid
          description: List of document IDs to delete

    BulkDeleteResponse:
      description: Response reporting bulk deletion results with success and failure details
      type: object
      additionalProperties: false
      required:
      - succeeded
      - failed
      properties:
        succeeded:
          type: array
          items:
            type: string
            format: uuid
          description: IDs of documents successfully deleted
        failed:
          type: array
          items:
            $ref: '#/components/schemas/BulkOperationFailure'
          description: Details of documents that failed to delete

    BulkOperationFailure:
      description: Details of a single document that failed in a bulk operation
      type: object
      additionalProperties: false
      required:
      - documentId
      - error
      properties:
        documentId:
          type: string
          format: uuid
          description: ID of the document that failed
        error:
          type: string
          description: Error message explaining the failure

    # ===== Admin: Import =====
    ImportDocumentationRequest:
      description: Request to import multiple documents into a namespace
      type: object
      additionalProperties: false
      required:
      - namespace
      - documents
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to import into
        documents:
          type: array
          items:
            $ref: '#/components/schemas/ImportDocument'
          description: List of documents to import
        onConflict:
          type: string
          enum:
          - skip
          - update
          - fail
          default: skip
          description: How to handle documents with existing slugs

    ImportDocument:
      description: A single document to import with required fields
      type: object
      additionalProperties: false
      required:
      - slug
      - title
      - category
      - content
      properties:
        slug:
          type: string
          description: URL-friendly unique identifier for the document
        title:
          type: string
          description: Display title of the document
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Category for organizing the document
        content:
          type: string
          description: Markdown content of the document
        summary:
          type: string
          nullable: true
          description: Brief text summary of the document (null if not provided)
        voiceSummary:
          type: string
          nullable: true
          description: Concise summary optimized for voice AI (null if not provided)
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Tags for filtering and search (null to skip tagging)
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Custom metadata key-value pairs (null if not needed)

    ImportDocumentationResponse:
      description: Response reporting import results with counts and failure details
      type: object
      additionalProperties: false
      required:
      - namespace
      - created
      - updated
      - skipped
      - failed
      properties:
        namespace:
          type: string
          description: The namespace documents were imported into
        created:
          type: integer
          description: Number of new documents created
        updated:
          type: integer
          description: Number of existing documents updated
        skipped:
          type: integer
          description: Number of documents skipped due to conflicts
        failed:
          type: array
          items:
            $ref: '#/components/schemas/ImportFailure'
          description: Details of documents that failed to import

    ImportFailure:
      description: Details of a document that failed to import
      type: object
      additionalProperties: false
      required:
      - slug
      - error
      properties:
        slug:
          type: string
          description: Slug of the document that failed to import
        error:
          type: string
          description: Error message explaining the failure

    # ===== Admin: Trashcan =====
    ListTrashcanRequest:
      description: Request to list deleted documents in the trashcan
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to list trashcan from
        page:
          type: integer
          default: 1
          description: Page number for pagination
        pageSize:
          type: integer
          default: 20
          description: Number of items per page

    ListTrashcanResponse:
      description: Response containing deleted documents awaiting permanent deletion
      type: object
      additionalProperties: false
      required:
      - namespace
      - items
      properties:
        namespace:
          type: string
          description: The namespace the trashcan belongs to
        items:
          type: array
          items:
            $ref: '#/components/schemas/TrashcanItem'
          description: List of deleted documents in trashcan
        totalCount:
          type: integer
          description: Total number of items in trashcan

    TrashcanItem:
      description: A deleted document in the trashcan with expiration information
      type: object
      additionalProperties: false
      required:
      - documentId
      - title
      - deletedAt
      - expiresAt
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the deleted document
        slug:
          type: string
          description: URL-friendly slug of the deleted document
        title:
          type: string
          description: Title of the deleted document
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Category of the deleted document
        deletedAt:
          type: string
          format: date-time
          description: Timestamp when the document was deleted
        expiresAt:
          type: string
          format: date-time
          description: Timestamp when the document will be permanently deleted

    PurgeTrashcanRequest:
      description: Request to permanently delete documents from the trashcan
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to purge trashcan from
        documentIds:
          type: array
          items:
            type: string
            format: uuid
          description: If empty, purges all trashcan items

    PurgeTrashcanResponse:
      description: Response confirming permanent deletion of trashcan items
      type: object
      additionalProperties: false
      required:
      - purgedCount
      properties:
        purgedCount:
          type: integer
          description: Number of documents permanently deleted

    # ===== Admin: Stats =====
    GetNamespaceStatsRequest:
      description: Request to get statistics for a documentation namespace
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to get statistics for

    NamespaceStatsResponse:
      description: Response containing namespace statistics and document counts
      type: object
      additionalProperties: false
      required:
      - namespace
      - documentCount
      properties:
        namespace:
          type: string
          description: The namespace statistics are for
        documentCount:
          type: integer
          description: Total number of documents in the namespace
        categoryCounts:
          type: object
          additionalProperties:
            type: integer
          description: Document count per category
        trashcanCount:
          type: integer
          description: Number of documents in the trashcan
        totalContentSizeBytes:
          type: integer
          description: Total size of all document content in bytes
        lastUpdated:
          type: string
          format: date-time
          description: Timestamp of most recent document update

    # ===== Core Document Types =====
    Document:
      description: Complete document with all metadata and content
      type: object
      additionalProperties: false
      required:
      - documentId
      - namespace
      - slug
      - title
      - category
      - createdAt
      - updatedAt
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the document
        namespace:
          type: string
          description: Namespace the document belongs to
        slug:
          type: string
          description: URL-friendly unique identifier
        title:
          type: string
          description: Display title of the document
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Category for organizing the document
        content:
          type: string
          description: Full markdown content of the document
        summary:
          type: string
          nullable: true
          description: Brief text summary of the document
        voiceSummary:
          type: string
          nullable: true
          description: Concise summary optimized for voice AI
        tags:
          type: array
          items:
            type: string
          description: Tags for filtering and search
        relatedDocuments:
          type: array
          items:
            type: string
            format: uuid
          description: IDs of related documents
        metadata:
          type: object
          additionalProperties: true
          description: Custom metadata key-value pairs
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the document was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the document was last updated

    DocumentSummary:
      description: Lightweight document representation for listings and references
      type: object
      additionalProperties: false
      required:
      - documentId
      - slug
      - title
      - category
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the document
        slug:
          type: string
          description: URL-friendly unique identifier
        title:
          type: string
          description: Display title of the document
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Category of the document
        summary:
          type: string
          nullable: true
          description: Brief text summary of the document
        voiceSummary:
          type: string
          nullable: true
          description: Concise summary optimized for voice AI
        tags:
          type: array
          items:
            type: string
          description: Tags associated with the document

    DocumentResult:
      description: Search result with relevance scoring and match highlights
      type: object
      additionalProperties: false
      required:
      - documentId
      - slug
      - title
      - relevanceScore
      properties:
        documentId:
          type: string
          format: uuid
          description: Unique identifier of the document
        slug:
          type: string
          description: URL-friendly unique identifier
        title:
          type: string
          description: Display title of the document
        category:
          $ref: '#/components/schemas/DocumentCategory'
          description: Category of the document
        summary:
          type: string
          nullable: true
          description: Brief text summary of the document
        voiceSummary:
          type: string
          nullable: true
          description: Concise summary optimized for voice AI
        content:
          type: string
          nullable: true
          description: Full document content if requested
        relevanceScore:
          type: number
          format: float
          description: Relevance score from 0.0 to 1.0
        matchHighlights:
          type: array
          items:
            type: string
          description: Text snippets showing where matches occurred

    # ===== Repository Binding Types =====
    BindingStatus:
      type: string
      enum:
      - pending
      - syncing
      - synced
      - error
      - disabled
      description: Status of a repository binding

    SyncStatus:
      type: string
      enum:
      - success
      - partial
      - failed
      description: Result status of a sync operation

    SyncTrigger:
      type: string
      enum:
      - manual
      - scheduled
      description: What triggered the sync operation

    # ===== Repository Binding Request/Response Models =====
    BindRepositoryRequest:
      description: Request to bind a Git repository for automatic documentation sync
      type: object
      additionalProperties: false
      required:
      - namespace
      - repositoryUrl
      - owner
      properties:
        owner:
          type: string
          description: |
            Owner of this binding. NOT a session ID.
            For user-initiated bindings: the accountId (UUID format).
            For service-initiated bindings: the service name (e.g., "orchestrator").
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to bind
        repositoryUrl:
          type: string
          description: Git clone URL (HTTPS for public repos)
        branch:
          type: string
          default: main
          description: Branch to sync from
        syncIntervalMinutes:
          type: integer
          default: 60
          minimum: 5
          maximum: 1440
          description: How often to sync (5 min to 24 hours)
        filePatterns:
          type: array
          nullable: true
          items:
            type: string
          default: ["**/*.md"]
          description: Glob patterns for files to include (defaults to all markdown files if not provided)
        excludePatterns:
          type: array
          nullable: true
          items:
            type: string
          default: [".git/**", ".obsidian/**", "node_modules/**"]
          description: Glob patterns for files to exclude (defaults to common non-content directories if not provided)
        categoryMapping:
          type: object
          nullable: true
          additionalProperties:
            type: string
          description: Map directory prefixes to categories (empty mapping if not provided)
        defaultCategory:
          $ref: '#/components/schemas/DocumentCategory'
          description: Default category for documents without mapping
        archiveEnabled:
          type: boolean
          default: false
          description: Enable archive functionality
        archiveOnSync:
          type: boolean
          default: false
          description: Create archive after each sync

    BindRepositoryResponse:
      description: Response confirming repository binding creation
      type: object
      additionalProperties: false
      required:
      - bindingId
      - namespace
      - status
      properties:
        bindingId:
          type: string
          format: uuid
          description: Unique identifier of the repository binding
        namespace:
          type: string
          description: Namespace the repository is bound to
        repositoryUrl:
          type: string
          description: URL of the bound repository
        branch:
          type: string
          description: Branch being synced
        status:
          $ref: '#/components/schemas/BindingStatus'
          description: Current status of the binding
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the binding was created

    UnbindRepositoryRequest:
      description: Request to remove a repository binding from a namespace
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to unbind
        deleteDocuments:
          type: boolean
          default: false
          description: Also delete all documents from the namespace

    UnbindRepositoryResponse:
      description: Response confirming repository unbinding with cleanup details
      type: object
      additionalProperties: false
      required:
      - namespace
      - documentsDeleted
      properties:
        namespace:
          type: string
          description: Namespace that was unbound
        documentsDeleted:
          type: integer
          description: Number of documents deleted (0 if deleteDocuments was false)

    SyncRepositoryRequest:
      description: Request to trigger a manual repository sync
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to sync
        force:
          type: boolean
          default: false
          description: Force full re-sync even if commit hash unchanged

    SyncRepositoryResponse:
      description: Response containing sync operation results and statistics
      type: object
      additionalProperties: false
      required:
      - syncId
      - status
      properties:
        syncId:
          type: string
          format: uuid
          description: Unique identifier of this sync operation
        status:
          $ref: '#/components/schemas/SyncStatus'
          description: Result status of the sync
        commitHash:
          type: string
          nullable: true
          description: Git commit hash that was synced (null if sync failed or repo is empty)
        documentsCreated:
          type: integer
          description: Number of new documents created
        documentsUpdated:
          type: integer
          description: Number of existing documents updated
        documentsDeleted:
          type: integer
          description: Number of documents deleted
        documentsFailed:
          type: integer
          description: Number of documents that failed to process
        durationMs:
          type: integer
          description: Time taken for sync in milliseconds
        errorMessage:
          type: string
          nullable: true
          description: Error message if sync failed

    RepositoryStatusRequest:
      description: Request to get current repository binding and sync status
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to get status for

    RepositoryStatusResponse:
      description: Response containing binding configuration and recent sync information
      type: object
      additionalProperties: false
      properties:
        binding:
          $ref: '#/components/schemas/RepositoryBindingInfo'
          description: Current binding configuration and status
        lastSync:
          $ref: '#/components/schemas/SyncInfo'
          description: Information about the most recent sync

    RepositoryBindingInfo:
      description: Detailed repository binding configuration and status
      type: object
      additionalProperties: false
      required:
      - bindingId
      - namespace
      - repositoryUrl
      - status
      properties:
        bindingId:
          type: string
          format: uuid
          description: Unique identifier of the repository binding
        namespace:
          type: string
          description: Namespace the repository is bound to
        repositoryUrl:
          type: string
          description: URL of the bound repository
        branch:
          type: string
          description: Branch being synced
        status:
          $ref: '#/components/schemas/BindingStatus'
          description: Current status of the binding
        syncEnabled:
          type: boolean
          description: Whether automatic sync is enabled
        syncIntervalMinutes:
          type: integer
          description: Sync interval in minutes
        documentCount:
          type: integer
          description: Number of documents from this repository
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the binding was created
        owner:
          type: string
          description: |
            Owner of this binding. NOT a session ID.
            Contains either an accountId (UUID format) for user-initiated bindings
            or a service name for service-initiated bindings.

    SyncInfo:
      description: Information about a repository sync operation
      type: object
      additionalProperties: false
      properties:
        syncId:
          type: string
          format: uuid
          description: Unique identifier of the sync operation
        status:
          $ref: '#/components/schemas/SyncStatus'
          description: Result status of the sync
        triggeredBy:
          $ref: '#/components/schemas/SyncTrigger'
          description: What triggered the sync
        startedAt:
          type: string
          format: date-time
          description: Timestamp when sync started
        completedAt:
          type: string
          format: date-time
          description: Timestamp when sync completed
        commitHash:
          type: string
          nullable: true
          description: Git commit hash that was synced (null if sync failed or repo is empty)
        documentsProcessed:
          type: integer
          description: Total documents processed in sync

    ListRepositoryBindingsRequest:
      description: Request to list all repository bindings with optional filtering
      type: object
      additionalProperties: false
      properties:
        status:
          $ref: '#/components/schemas/BindingStatus'
          description: Filter by binding status
        limit:
          type: integer
          default: 50
          minimum: 1
          maximum: 100
          description: Maximum number of bindings to return
        offset:
          type: integer
          default: 0
          minimum: 0
          description: Number of bindings to skip

    ListRepositoryBindingsResponse:
      description: Response containing a list of repository bindings
      type: object
      additionalProperties: false
      required:
      - bindings
      - total
      properties:
        bindings:
          type: array
          items:
            $ref: '#/components/schemas/RepositoryBindingInfo'
          description: List of repository bindings
        total:
          type: integer
          description: Total number of bindings matching filter

    UpdateRepositoryBindingRequest:
      description: Request to update repository binding configuration
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace of the binding to update
        syncEnabled:
          type: boolean
          description: Enable or disable automatic syncing
        syncIntervalMinutes:
          type: integer
          minimum: 5
          maximum: 1440
          description: New sync interval in minutes
        filePatterns:
          type: array
          items:
            type: string
          nullable: true
          description: New glob patterns for files to include (null to keep unchanged)
        excludePatterns:
          type: array
          items:
            type: string
          nullable: true
          description: New glob patterns for files to exclude (null to keep unchanged)
        categoryMapping:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: New directory-to-category mapping (null to keep unchanged)
        defaultCategory:
          $ref: '#/components/schemas/DocumentCategory'
          description: New default category for unmapped documents
        archiveEnabled:
          type: boolean
          description: Enable or disable archive functionality
        archiveOnSync:
          type: boolean
          description: Enable or disable archiving after each sync

    UpdateRepositoryBindingResponse:
      description: Response containing the updated binding configuration
      type: object
      additionalProperties: false
      required:
      - binding
      properties:
        binding:
          $ref: '#/components/schemas/RepositoryBindingInfo'
          description: Updated binding configuration

    # ===== Archive Request/Response Models =====
    CreateArchiveRequest:
      description: Request to create a point-in-time snapshot of namespace documentation
      type: object
      additionalProperties: false
      required:
      - namespace
      - owner
      properties:
        owner:
          type: string
          description: |
            Owner of this archive. NOT a session ID.
            For user-initiated archives: the accountId (UUID format).
            For service-initiated archives: the service name (e.g., "orchestrator").
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to archive
        description:
          type: string
          maxLength: 500
          description: Optional description for the archive

    CreateArchiveResponse:
      description: Response containing the created archive details
      type: object
      additionalProperties: false
      required:
      - archiveId
      - namespace
      properties:
        archiveId:
          type: string
          format: uuid
          description: Unique identifier of the created archive
        namespace:
          type: string
          description: Namespace that was archived
        bundleAssetId:
          type: string
          format: uuid
          description: Asset ID in Asset Service
        documentCount:
          type: integer
          description: Number of documents in the archive
        sizeBytes:
          type: integer
          description: Total size of the archive in bytes
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the archive was created
        commitHash:
          type: string
          nullable: true
          description: Git commit hash if namespace is bound

    ListArchivesRequest:
      description: Request to list available archives for a namespace
      type: object
      additionalProperties: false
      required:
      - namespace
      properties:
        namespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: Documentation namespace to list archives for
        limit:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
          description: Maximum number of archives to return
        offset:
          type: integer
          default: 0
          minimum: 0
          description: Number of archives to skip

    ListArchivesResponse:
      description: Response containing a paginated list of archives
      type: object
      additionalProperties: false
      required:
      - archives
      - total
      properties:
        archives:
          type: array
          items:
            $ref: '#/components/schemas/ArchiveInfo'
          description: List of archives for the namespace
        total:
          type: integer
          description: Total number of archives

    ArchiveInfo:
      description: Archive metadata including size and document count
      type: object
      additionalProperties: false
      required:
      - archiveId
      - namespace
      - createdAt
      properties:
        archiveId:
          type: string
          format: uuid
          description: Unique identifier of the archive
        namespace:
          type: string
          description: Namespace the archive belongs to
        bundleAssetId:
          type: string
          format: uuid
          description: Asset ID in Asset Service
        description:
          type: string
          nullable: true
          description: Description of the archive
        documentCount:
          type: integer
          description: Number of documents in the archive
        sizeBytes:
          type: integer
          description: Total size of the archive in bytes
        commitHash:
          type: string
          nullable: true
          description: Git commit hash if namespace was bound at archive time
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the archive was created
        owner:
          type: string
          description: |
            Owner of this archive. NOT a session ID.
            Contains either an accountId (UUID format) for user-initiated archives
            or a service name for service-initiated archives.

    RestoreArchiveRequest:
      description: Request to restore documents from an archive
      type: object
      additionalProperties: false
      required:
      - archiveId
      properties:
        archiveId:
          type: string
          format: uuid
          description: Unique identifier of the archive to restore
        targetNamespace:
          type: string
          pattern: '^[a-z0-9-]+$'
          maxLength: 50
          description: If not provided, restores to original namespace

    RestoreArchiveResponse:
      description: Response containing restore operation results
      type: object
      additionalProperties: false
      required:
      - namespace
      - documentsRestored
      properties:
        namespace:
          type: string
          description: Namespace documents were restored to
        documentsRestored:
          type: integer
          description: Number of documents restored from archive
        previousDocumentsDeleted:
          type: integer
          description: Number of existing documents deleted before restore

    DeleteArchiveRequest:
      description: Request to permanently delete an archive
      type: object
      additionalProperties: false
      required:
      - archiveId
      properties:
        archiveId:
          type: string
          format: uuid
          description: Unique identifier of the archive to delete

    DeleteArchiveResponse:
      description: Response confirming archive deletion
      type: object
      additionalProperties: false
      required:
      - deleted
      properties:
        deleted:
          type: boolean
          description: Whether the archive was successfully deleted
