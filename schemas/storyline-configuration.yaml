openapi: 3.0.0
info:
  title: Storyline Service Configuration
  version: 1.0.0
  description: |
    Configuration for the Storyline service.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.

x-service-configuration:
  required:
  - PlanCacheTtlSeconds
  properties:
    PlanCacheTtlSeconds:
      type: integer
      default: 3600
      minimum: 60
      maximum: 86400
      description: |
        TTL in seconds for cached composed plans.
        Default: 3600 (1 hour)
      env: STORYLINE_PLAN_CACHE_TTL_SECONDS

    DefaultPlanningUrgency:
      $ref: 'storyline-api.yaml#/components/schemas/PlanningUrgency'
      default: medium
      description: |
        Default urgency tier for GOAP planning.
        low = more iterations (1000/20)
        medium = balanced (500/15)
        high = fewer iterations (200/10)
      env: STORYLINE_DEFAULT_PLANNING_URGENCY

    PlanCacheEnabled:
      type: boolean
      default: true
      description: |
        Whether to cache deterministic plans (those with explicit seed).
        Disable for testing or when cache overhead is undesirable.
      env: STORYLINE_PLAN_CACHE_ENABLED

    DefaultGenre:
      type: string
      default: drama
      description: |
        Default genre when not specified and cannot be inferred.
      env: STORYLINE_DEFAULT_GENRE

    MaxSeedSources:
      type: integer
      default: 10
      minimum: 1
      maximum: 20
      description: |
        Maximum number of seed sources per compose request.
      env: STORYLINE_MAX_SEED_SOURCES

    # Confidence calculation parameters (T21 compliant - no hardcoded magic numbers)
    ConfidenceBaseScore:
      type: number
      format: double
      default: 0.5
      minimum: 0
      maximum: 1
      description: |
        Base confidence score before any bonuses are applied.
      env: STORYLINE_CONFIDENCE_BASE_SCORE

    ConfidencePhaseThreshold:
      type: integer
      default: 3
      minimum: 1
      maximum: 10
      description: |
        Minimum number of phases to receive a phase count bonus.
      env: STORYLINE_CONFIDENCE_PHASE_THRESHOLD

    ConfidencePhaseBonus:
      type: number
      format: double
      default: 0.2
      minimum: 0
      maximum: 0.5
      description: |
        Confidence bonus when phase threshold is met.
      env: STORYLINE_CONFIDENCE_PHASE_BONUS

    ConfidenceCoreEventBonus:
      type: number
      format: double
      default: 0.15
      minimum: 0
      maximum: 0.5
      description: |
        Confidence bonus when plan contains core events.
      env: STORYLINE_CONFIDENCE_CORE_EVENT_BONUS

    ConfidenceActionCountBonus:
      type: number
      format: double
      default: 0.15
      minimum: 0
      maximum: 0.5
      description: |
        Confidence bonus when action count is within acceptable range.
      env: STORYLINE_CONFIDENCE_ACTION_COUNT_BONUS

    ConfidenceMinActionCount:
      type: integer
      default: 5
      minimum: 1
      maximum: 50
      description: |
        Minimum action count for action count bonus.
      env: STORYLINE_CONFIDENCE_MIN_ACTION_COUNT

    ConfidenceMaxActionCount:
      type: integer
      default: 20
      minimum: 5
      maximum: 100
      description: |
        Maximum action count for action count bonus.
      env: STORYLINE_CONFIDENCE_MAX_ACTION_COUNT

    # Risk identification thresholds (T21 compliant)
    RiskMinActionThreshold:
      type: integer
      default: 3
      minimum: 1
      maximum: 20
      description: |
        Minimum action count before "thin_content" risk is flagged.
      env: STORYLINE_RISK_MIN_ACTION_THRESHOLD

    RiskMinPhaseThreshold:
      type: integer
      default: 2
      minimum: 1
      maximum: 10
      description: |
        Minimum phase count before "flat_arc" risk is flagged.
      env: STORYLINE_RISK_MIN_PHASE_THRESHOLD
