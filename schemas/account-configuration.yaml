openapi: 3.0.4
info:
  title: Account Service Configuration
  description: |
    Configuration schema for Account service.
    Properties are bound to environment variables with BANNOU_ prefix.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
paths: {}
x-service-configuration:
  properties:
    # Admin Configuration
    AdminEmails:
      type: string
      nullable: true  # NRT: Optional config MUST be nullable
      description: Comma-separated list of admin email addresses
      env: ACCOUNT_ADMIN_EMAILS
      example: "admin@example.com,devops@example.com"
    AdminEmailDomain:
      type: string
      nullable: true  # NRT: Optional config MUST be nullable
      description: Email domain that grants admin access (e.g., "@company.com")
      env: ACCOUNT_ADMIN_EMAIL_DOMAIN
      example: "@admin.example.com"

    # Pagination Configuration
    DefaultPageSize:
      type: integer
      minimum: 1
      maximum: 1000
      description: Default page size for list operations when not specified
      env: ACCOUNT_DEFAULT_PAGE_SIZE
      default: 20
    MaxPageSize:
      type: integer
      minimum: 1
      maximum: 10000
      description: Maximum allowed page size for list operations
      env: ACCOUNT_MAX_PAGE_SIZE
      default: 100

    # Batch Processing Configuration
    ListBatchSize:
      type: integer
      minimum: 1
      maximum: 10000
      description: Number of accounts to process per batch in list operations
      env: ACCOUNT_LIST_BATCH_SIZE
      default: 100

    # Distributed Lock Configuration
    CreateLockExpirySeconds:
      type: integer
      env: ACCOUNT_CREATE_LOCK_EXPIRY_SECONDS
      default: 10
      minimum: 1
      maximum: 60
      description: Lock expiry in seconds for account creation email uniqueness check

    # Email Change Lock Configuration
    EmailChangeLockExpirySeconds:
      type: integer
      env: ACCOUNT_EMAIL_CHANGE_LOCK_EXPIRY_SECONDS
      default: 10
      minimum: 1
      maximum: 60
      description: Lock expiry in seconds for email uniqueness check during email change

    # Provider Filter Configuration
    ProviderFilterMaxScanSize:
      type: integer
      env: ACCOUNT_PROVIDER_FILTER_MAX_SCAN_SIZE
      default: 10000
      minimum: 100
      maximum: 100000
      description: Maximum number of accounts to scan when filtering by provider (admin-only endpoint)

    # Role Management Configuration
    AutoManageAnonymousRole:
      type: boolean
      description: When true, automatically manages the anonymous role. If removing roles would leave zero roles, anonymous is added automatically. If adding a non-anonymous role, anonymous is removed if present. This ensures accounts always have at least one role for permission resolution.
      env: ACCOUNT_AUTO_MANAGE_ANONYMOUS_ROLE
      default: true
