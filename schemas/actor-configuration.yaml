openapi: 3.0.3
info:
  title: Actor Service Configuration
  version: 1.0.0
  description: |
    Configuration options for the Actor service.
    Controls deployment mode, pool node management, and default behavior parameters.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before
    modifying this schema. Optional reference types require `nullable: true`.

servers: []

paths: {}

x-service-configuration:
  properties:
    # === Deployment Mode ===
    DeploymentMode:
      type: string
      env: ACTOR_DEPLOYMENT_MODE
      default: "bannou"
      description: "Actor deployment mode: bannou (local dev), pool-per-type, shared-pool, or auto-scale"

    # === Pool Node Identity (set when running as pool node) ===
    PoolNodeId:
      type: string
      env: ACTOR_POOL_NODE_ID
      nullable: true  # NRT: Optional config MUST be nullable (not set = control plane mode)
      description: If set, this instance runs as a pool node (not control plane). Unique identifier for this node.

    PoolNodeAppId:
      type: string
      env: ACTOR_POOL_NODE_APP_ID
      nullable: true  # NRT: Optional config MUST be nullable (required when PoolNodeId is set)
      description: Mesh app-id for routing commands to this pool node. Required when PoolNodeId is set.

    PoolNodeType:
      type: string
      env: ACTOR_POOL_NODE_TYPE
      default: "shared"
      description: "Pool type this node belongs to: shared, npc-brain, event-coordinator, or custom category"

    PoolNodeCapacity:
      type: integer
      env: ACTOR_POOL_NODE_CAPACITY
      default: 100
      description: Maximum actors this pool node can run. Overrides DefaultActorsPerNode when set.

    ControlPlaneAppId:
      type: string
      env: ACTOR_CONTROL_PLANE_APP_ID
      default: "bannou"
      description: App-id of control plane for pool node registration. Pool nodes only.

    # === Pool Node Management (control plane settings) ===
    PoolNodeImage:
      type: string
      env: ACTOR_POOL_NODE_IMAGE
      default: "bannou-actor-pool:latest"
      description: Docker image for pool nodes (pool-per-type, shared-pool, auto-scale modes)

    MinPoolNodes:
      type: integer
      env: ACTOR_MIN_POOL_NODES
      default: 1
      description: Minimum pool nodes to maintain (auto-scale mode)

    MaxPoolNodes:
      type: integer
      env: ACTOR_MAX_POOL_NODES
      default: 10
      description: Maximum pool nodes allowed (auto-scale mode)

    DefaultActorsPerNode:
      type: integer
      env: ACTOR_DEFAULT_ACTORS_PER_NODE
      default: 100
      description: Default capacity per pool node

    # === Heartbeat Configuration ===
    HeartbeatIntervalSeconds:
      type: integer
      env: ACTOR_HEARTBEAT_INTERVAL_SECONDS
      default: 10
      description: Pool node heartbeat frequency

    HeartbeatTimeoutSeconds:
      type: integer
      env: ACTOR_HEARTBEAT_TIMEOUT_SECONDS
      default: 30
      description: Mark node unhealthy after this many seconds without heartbeat

    # === Actor Default Configuration ===
    DefaultTickIntervalMs:
      type: integer
      env: ACTOR_DEFAULT_TICK_INTERVAL_MS
      default: 100
      description: Default behavior loop interval in milliseconds

    DefaultAutoSaveIntervalSeconds:
      type: integer
      env: ACTOR_DEFAULT_AUTOSAVE_INTERVAL_SECONDS
      default: 60
      description: Default interval for periodic state saves (0 to disable)

    # === Queue Configuration ===
    PerceptionQueueSize:
      type: integer
      env: ACTOR_PERCEPTION_QUEUE_SIZE
      default: 100
      description: Max perceptions queued per actor before dropping oldest

    MessageQueueSize:
      type: integer
      env: ACTOR_MESSAGE_QUEUE_SIZE
      default: 50
      description: Max messages queued per actor before dropping oldest

    # === State Update Transport ===
    StateUpdateTransport:
      type: string
      env: ACTOR_STATE_UPDATE_TRANSPORT
      default: "messaging"
      description: "State update transport: messaging (default, works in bannou mode) or internal-connect (production)"

    # === GOAP Configuration ===
    GoapReplanThreshold:
      type: number
      env: ACTOR_GOAP_REPLAN_THRESHOLD
      default: 0.3
      description: Threshold for triggering GOAP replanning when goal relevance drops below this value

    GoapMaxPlanDepth:
      type: integer
      env: ACTOR_GOAP_MAX_PLAN_DEPTH
      default: 10
      description: Maximum depth for GOAP planning search

    GoapPlanTimeoutMs:
      type: integer
      env: ACTOR_GOAP_PLAN_TIMEOUT_MS
      default: 50
      description: Maximum time allowed for GOAP planning in milliseconds

    # === Local Mode Defaults (Tier 1) ===
    LocalModeNodeId:
      type: string
      env: ACTOR_LOCAL_MODE_NODE_ID
      default: "bannou-local"
      description: Node ID used when running in local/bannou deployment mode

    LocalModeAppId:
      type: string
      env: ACTOR_LOCAL_MODE_APP_ID
      default: "bannou"
      description: App ID used when running in local/bannou deployment mode

    # === Perception Thresholds (Tier 2) ===
    PerceptionFilterThreshold:
      type: number
      env: ACTOR_PERCEPTION_FILTER_THRESHOLD
      default: 0.1
      description: Minimum urgency for perception to be processed (0.0-1.0)

    PerceptionMemoryThreshold:
      type: number
      env: ACTOR_PERCEPTION_MEMORY_THRESHOLD
      default: 0.7
      description: Minimum urgency for perception to become a memory (0.0-1.0)

    ShortTermMemoryMinutes:
      type: integer
      env: ACTOR_SHORT_TERM_MEMORY_MINUTES
      default: 5
      description: Expiration time in minutes for short-term memories from high-urgency perceptions

    DefaultMemoryExpirationMinutes:
      type: integer
      env: ACTOR_DEFAULT_MEMORY_EXPIRATION_MINUTES
      default: 60
      description: Default expiration time in minutes for actor memories

    # === State Store Configuration (Tier 3) ===
    TemplateStatestoreName:
      type: string
      env: ACTOR_TEMPLATE_STATESTORE_NAME
      default: "actor-templates"
      description: Name of the state store for actor templates

    InstanceStatestoreName:
      type: string
      env: ACTOR_INSTANCE_STATESTORE_NAME
      default: "actor-instances"
      description: Name of the state store for actor instance tracking

    ActorStateStoreName:
      type: string
      env: ACTOR_STATE_STORE_NAME
      default: "actor-state"
      description: Name of the state store for actor state persistence

    # === Pool Health Monitoring (Tier 2) ===
    PoolHealthCheckIntervalSeconds:
      type: integer
      env: ACTOR_POOL_HEALTH_CHECK_INTERVAL_SECONDS
      default: 5
      description: Interval in seconds between pool health check operations

    # === Scheduled Events (Tier 2) ===
    ScheduledEventCheckIntervalMilliseconds:
      type: integer
      env: ACTOR_SCHEDULED_EVENT_CHECK_INTERVAL_MS
      default: 100
      description: Interval in milliseconds for checking scheduled events

    # === Actor Operation Timeouts (Tier 2) ===
    ActorOperationTimeoutSeconds:
      type: integer
      env: ACTOR_OPERATION_TIMEOUT_SECONDS
      default: 5
      description: Timeout in seconds for individual actor operations

    # === Actor Data Caching (Tier 2) ===
    PersonalityCacheTtlMinutes:
      type: integer
      env: ACTOR_PERSONALITY_CACHE_TTL_MINUTES
      default: 5
      description: TTL in minutes for cached personality data
    EncounterCacheTtlMinutes:
      type: integer
      env: ACTOR_ENCOUNTER_CACHE_TTL_MINUTES
      default: 5
      description: TTL in minutes for cached encounter data
    MaxEncounterResultsPerQuery:
      type: integer
      env: ACTOR_MAX_ENCOUNTER_RESULTS_PER_QUERY
      default: 10
      description: Maximum encounter results returned per query

    # === Memory Store Retry Configuration (Tier 3) ===
    MemoryStoreMaxRetries:
      type: integer
      env: ACTOR_MEMORY_STORE_MAX_RETRIES
      default: 3
      description: Maximum retry attempts for memory store operations

components:
  schemas: {}
