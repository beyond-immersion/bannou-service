openapi: 3.0.0
info:
  title: Bannou Mapping Service API
  description: |
    Spatial data management service for game worlds.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    The Mapping service enables:
    - Game servers (authority) to publish live spatial data via RPC AND lib-messaging
    - Event actors to subscribe to region-wide map data for orchestrating events
    - NPC actors to receive perception-filtered spatial context
    - Design tools to author and edit map templates
    - Event Brain to query affordances for procedural scene orchestration

    **Authority Model**: Authority over a map channel (region + kind) is established at
    creation or checkout. Publishers must include authorityToken in requests.

    **Schema-less Payloads**: Map objects are "bags of data" with additionalProperties: true.
    Only objectType is indexed; lib-mapping passes data through without validation.

    **NRT Compliance**: AI agents MUST review docs/NRT-SCHEMA-RULES.md before modifying
    this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)
paths:
  /mapping/create-channel:
    post:
      summary: Create a new map channel and become its authority
      description: |
        Creates a new region+kind channel and grants authority to caller.
        Returns ingestTopic for high-throughput event publishing.
        If channel already exists with active authority, returns Conflict.
      operationId: createChannel
      tags:
      - Authority
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChannelRequest'
      responses:
        '200':
          description: Channel created, authority granted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorityGrant'
        '409':
          description: Channel already exists with active authority
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateChannelRequest\"\
        ,\n    \"$defs\": {\n        \"CreateChannelRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to create a new map channel\",\n            \"required\": [\n                \"regionId\",\n         \
        \       \"kind\",\n                \"sourceAppId\"\n            ],\n            \"properties\": {\n              \
        \  \"sourceAppId\": {\n                    \"type\": \"string\",\n                    \"description\": \"App-id of
        the caller taking authority (used for event metadata)\"\n                },\n                \"regionId\": {\n   \
        \                 \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Region for this channel\"\n                },\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\"\
        ,\n                    \"description\": \"Map kind for this channel\"\n                },\n                \"nonAuthorityHandling\"\
        : {\n                    \"$ref\": \"#/$defs/NonAuthorityHandlingMode\",\n                    \"description\": \"\
        How to handle non-authority publishes\"\n                },\n                \"takeoverMode\": {\n               \
        \     \"$ref\": \"#/$defs/AuthorityTakeoverMode\",\n                    \"description\": \"Policy for authority takeover
        when channel exists with expired authority.\\npreserve_and_diff (default): Keep existing data, new authority sends
        updates.\\nreset: Clear all channel data before new authority takes over.\\nrequire_consume: New authority must call
        RequestSnapshot before publishing.\\n\"\n                },\n                \"alertConfig\": {\n                \
        \    \"$ref\": \"#/$defs/NonAuthorityAlertConfig\",\n                    \"description\": \"Configuration for non-authority
        publish alerts\",\n                    \"nullable\": true\n                },\n                \"initialSnapshot\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/MapPayload\"\n                    },\n                    \"description\": \"Optional initial data to
        populate channel\",\n                    \"nullable\": true\n                }\n            }\n        },\n      \
        \  \"MapKind\": {\n            \"type\": \"string\",\n            \"description\": \"The category of spatial data
        this map contains.\\nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n        \
        \    \"enum\": [\n                \"terrain\",\n                \"static_geometry\",\n                \"navigation\"\
        ,\n                \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n  \
        \              \"dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n        \
        \        \"ownership\",\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n\
        \        },\n        \"NonAuthorityHandlingMode\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"How to handle publish attempts from non-authority sources\",\n            \"enum\": [\n                \"reject_and_alert\"\
        ,\n                \"accept_and_alert\",\n                \"reject_silent\"\n            ],\n            \"default\"\
        : \"reject_and_alert\"\n        },\n        \"AuthorityTakeoverMode\": {\n            \"type\": \"string\",\n    \
        \        \"description\": \"Policy for handling authority takeover when creating a channel that\\nalready has expired
        authority. Controls what happens to existing data.\\n\",\n            \"enum\": [\n                \"preserve_and_diff\"\
        ,\n                \"reset\",\n                \"require_consume\"\n            ],\n            \"default\": \"preserve_and_diff\"\
        \n        },\n        \"NonAuthorityAlertConfig\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Configuration for non-authority publish alerts\",\n            \"properties\": {\n                \"enabled\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Whether to emit warning events\"\n                },\n                \"alertTopic\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Custom topic for warnings (default map.warnings.unauthorized_publish)\"\
        ,\n                    \"nullable\": true\n                },\n                \"includePayloadSummary\": {\n    \
        \                \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Include truncated payload in warning for debugging\"\n                }\n            }\n        },\n        \"\
        MapPayload\": {\n            \"type\": \"object\",\n            \"description\": \"Schema-less payload. Only envelope
        fields are validated.\\nThe 'data' field can contain ANYTHING the publisher wants.\\nlib-mapping does not validate
        contents - only publisher and consumer care.\\n\",\n            \"required\": [\n                \"objectType\"\n\
        \            ],\n            \"properties\": {\n                \"objectId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique ID for this object
        (generated if not provided)\"\n                },\n                \"objectType\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Publisher-defined type (used for indexing and filtering)\"\n\
        \                },\n                \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n    \
        \                \"description\": \"Position for point objects\",\n                    \"nullable\": true\n      \
        \          },\n                \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n                \
        \    \"description\": \"Bounds for area objects\",\n                    \"nullable\": true\n                },\n \
        \               \"data\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"SCHEMA-LESS. Can contain anything.\\nlib-mapping does not validate
        this.\\nExamples: cover_rating, health, respawn_delay, etc.\\n\",\n                    \"nullable\": true\n      \
        \          }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n          \
        \  \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n              \
        \  \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n      \
        \              \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n       \
        \     \"description\": \"An axis-aligned bounding box in 3D space\",\n            \"required\": [\n              \
        \  \"min\",\n                \"max\"\n            ],\n            \"properties\": {\n                \"min\": {\n\
        \                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Minimum corner (lowest
        x, y, z values)\"\n                },\n                \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\n                }\n         \
        \   }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthorityGrant\"\
        ,\n    \"$defs\": {\n        \"AuthorityGrant\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Granted authority over a map channel\",\n            \"required\": [\n                \"channelId\",\n       \
        \         \"authorityToken\",\n                \"ingestTopic\",\n                \"expiresAt\",\n                \"\
        regionId\",\n                \"kind\"\n            ],\n            \"properties\": {\n                \"channelId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"The channel (region+kind) you have authority over\"\n                },\n                \"authorityToken\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Opaque token proving your authority
        (include in publishes)\"\n                },\n                \"ingestTopic\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Topic for direct lib-messaging publishes (map.ingest.{channelId})\"\
        \n                },\n                \"expiresAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When authority expires (must heartbeat to
        extend)\"\n                },\n                \"regionId\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"uuid\",\n                    \"description\": \"Region ID for this channel\"\n      \
        \          },\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n                 \
        \   \"description\": \"Map kind for this channel\"\n                }\n            }\n        },\n        \"MapKind\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\
        nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n   \
        \             \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n              \
        \  \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"\
        dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\"\
        ,\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Create a new map channel and become its authority\",\n    \"description\"\
        : \"Creates a new region+kind channel and grants authority to caller.\\nReturns ingestTopic for high-throughput event
        publishing.\\nIf channel already exists with active authority, returns Conflict.\\n\",\n    \"tags\": [\n        \"\
        Authority\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"createChannel\"\n}"
  /mapping/release-authority:
    post:
      summary: Release authority over a channel
      description: |
        Voluntarily releases authority. Channel becomes unassigned.
        Only the current authority can release.
      operationId: releaseAuthority
      tags:
      - Authority
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReleaseAuthorityRequest'
      responses:
        '200':
          description: Authority released successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseAuthorityResponse'
        '403':
          description: Not the current authority
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReleaseAuthorityRequest\"\
        ,\n    \"$defs\": {\n        \"ReleaseAuthorityRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to release authority over a channel\",\n            \"required\": [\n                \"channelId\",\n\
        \                \"authorityToken\"\n            ],\n            \"properties\": {\n                \"channelId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Channel to release\"\n                },\n                \"authorityToken\": {\n               \
        \     \"type\": \"string\",\n                    \"description\": \"Current authority token\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReleaseAuthorityResponse\"\
        ,\n    \"$defs\": {\n        \"ReleaseAuthorityResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response to authority release\",\n            \"properties\": {\n                \"released\": {\n           \
        \         \"type\": \"boolean\",\n                    \"description\": \"Whether authority was successfully released\"\
        \n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Release authority over a channel\",\n    \"description\": \"Voluntarily
        releases authority. Channel becomes unassigned.\\nOnly the current authority can release.\\n\",\n    \"tags\": [\n\
        \        \"Authority\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"releaseAuthority\"\n}"
  /mapping/authority-heartbeat:
    post:
      summary: Maintain authority over channel
      description: |
        Keep-alive for authority. Must be called periodically (default every 30s).
        Failure to heartbeat results in authority expiration.
      operationId: authorityHeartbeat
      tags:
      - Authority
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorityHeartbeatRequest'
      responses:
        '200':
          description: Heartbeat acknowledged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorityHeartbeatResponse'
        '403':
          description: Invalid or expired authority token
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthorityHeartbeatRequest\"\
        ,\n    \"$defs\": {\n        \"AuthorityHeartbeatRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to maintain authority\",\n            \"required\": [\n                \"channelId\",\n              \
        \  \"authorityToken\"\n            ],\n            \"properties\": {\n                \"channelId\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Channel to heartbeat\"\n                },\n                \"authorityToken\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Current authority token\"\n                }\n            }\n\
        \        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthorityHeartbeatResponse\"\
        ,\n    \"$defs\": {\n        \"AuthorityHeartbeatResponse\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Response to authority heartbeat\",\n            \"properties\": {\n                \"valid\": {\n\
        \                    \"type\": \"boolean\",\n                    \"description\": \"Whether your authority is still
        valid\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"date-time\",\n                    \"description\": \"Updated expiration time\"\n     \
        \           },\n                \"warning\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"Optional warning (e.g., \\\"authority expiring soon\\\")\",\n                    \"nullable\": true\n\
        \                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Maintain authority over channel\",\n    \"description\": \"Keep-alive for
        authority. Must be called periodically (default every 30s).\\nFailure to heartbeat results in authority expiration.\\\
        n\",\n    \"tags\": [\n        \"Authority\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"authorityHeartbeat\"\
        \n}"
  /mapping/publish:
    post:
      summary: Publish map data update (RPC path)
      description: |
        Game servers use this to push authoritative spatial updates.
        Validates authority token, stores update, and broadcasts to consumers.
        For high-throughput scenarios, use event publishing via ingestTopic instead.
      operationId: publishMapUpdate
      tags:
      - Runtime
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublishMapUpdateRequest'
      responses:
        '200':
          description: Update published successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublishMapUpdateResponse'
        '403':
          description: Not authority for this channel
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/PublishMapUpdateRequest\"\
        ,\n    \"$defs\": {\n        \"PublishMapUpdateRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to publish map data update\",\n            \"required\": [\n                \"channelId\",\n         \
        \       \"authorityToken\",\n                \"payload\"\n            ],\n            \"properties\": {\n        \
        \        \"channelId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"Channel to publish to\"\n                },\n                \"authorityToken\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Authority token for validation\"\
        \n                },\n                \"sourceAppId\": {\n                    \"type\": \"string\",\n            \
        \        \"description\": \"App-id of caller (for warnings on non-authority attempts)\",\n                    \"nullable\"\
        : true\n                },\n                \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n   \
        \                 \"description\": \"Affected area (null means entire region)\",\n                    \"nullable\"\
        : true\n                },\n                \"deltaType\": {\n                    \"$ref\": \"#/$defs/DeltaType\"\
        ,\n                    \"description\": \"Whether this is incremental or full\"\n                },\n            \
        \    \"payload\": {\n                    \"$ref\": \"#/$defs/MapPayload\",\n                    \"description\": \"\
        The payload to publish\"\n                },\n                \"payloadAssetRef\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"For large payloads, lib-asset reference instead of inline\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"Bounds\": {\n \
        \           \"type\": \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D space\",\n  \
        \          \"required\": [\n                \"min\",\n                \"max\"\n            ],\n            \"properties\"\
        : {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\"\
        : \"Minimum corner (lowest x, y, z values)\"\n                },\n                \"max\": {\n                   \
        \ \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\
        \n                }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n   \
        \         \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n       \
        \         \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n\
        \                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"DeltaType\": {\n            \"type\": \"string\",\n    \
        \        \"description\": \"Whether an update is incremental or a full snapshot\",\n            \"enum\": [\n    \
        \            \"delta\",\n                \"snapshot\"\n            ],\n            \"default\": \"delta\"\n      \
        \  },\n        \"MapPayload\": {\n            \"type\": \"object\",\n            \"description\": \"Schema-less payload.
        Only envelope fields are validated.\\nThe 'data' field can contain ANYTHING the publisher wants.\\nlib-mapping does
        not validate contents - only publisher and consumer care.\\n\",\n            \"required\": [\n                \"objectType\"\
        \n            ],\n            \"properties\": {\n                \"objectId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique ID for this object
        (generated if not provided)\"\n                },\n                \"objectType\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Publisher-defined type (used for indexing and filtering)\"\n\
        \                },\n                \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n    \
        \                \"description\": \"Position for point objects\",\n                    \"nullable\": true\n      \
        \          },\n                \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n                \
        \    \"description\": \"Bounds for area objects\",\n                    \"nullable\": true\n                },\n \
        \               \"data\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"SCHEMA-LESS. Can contain anything.\\nlib-mapping does not validate
        this.\\nExamples: cover_rating, health, respawn_delay, etc.\\n\",\n                    \"nullable\": true\n      \
        \          }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/PublishMapUpdateResponse\"\
        ,\n    \"$defs\": {\n        \"PublishMapUpdateResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response to publish request\",\n            \"properties\": {\n                \"accepted\": {\n             \
        \       \"type\": \"boolean\",\n                    \"description\": \"Whether the update was accepted\"\n       \
        \         },\n                \"version\": {\n                    \"type\": \"integer\",\n                    \"format\"\
        : \"int64\",\n                    \"description\": \"Assigned version number\"\n                },\n             \
        \   \"warning\": {\n                    \"type\": \"string\",\n                    \"description\": \"Optional warning
        message\",\n                    \"nullable\": true\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Publish map data update (RPC path)\",\n    \"description\": \"Game servers
        use this to push authoritative spatial updates.\\nValidates authority token, stores update, and broadcasts to consumers.\\
        nFor high-throughput scenarios, use event publishing via ingestTopic instead.\\n\",\n    \"tags\": [\n        \"Runtime\"\
        \n    ],\n    \"deprecated\": false,\n    \"operationId\": \"publishMapUpdate\"\n}"
  /mapping/publish-objects:
    post:
      summary: Publish metadata object changes (batch)
      description: |
        Game servers use this to push object state changes.
        Efficiently batches multiple object changes into one event.
        Max 100 changes per request.
      operationId: publishObjectChanges
      tags:
      - Runtime
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublishObjectChangesRequest'
      responses:
        '200':
          description: Object changes published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublishObjectChangesResponse'
        '403':
          description: Not authority for this channel
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/PublishObjectChangesRequest\"\
        ,\n    \"$defs\": {\n        \"PublishObjectChangesRequest\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Request to publish object changes (batch)\",\n            \"required\": [\n                \"channelId\"\
        ,\n                \"authorityToken\",\n                \"changes\"\n            ],\n            \"properties\": {\n\
        \                \"channelId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Channel to publish to\"\n                },\n                \"authorityToken\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Authority token for validation\"\
        \n                },\n                \"sourceAppId\": {\n                    \"type\": \"string\",\n            \
        \        \"description\": \"App-id of caller (for warnings on non-authority attempts)\",\n                    \"nullable\"\
        : true\n                },\n                \"changes\": {\n                    \"type\": \"array\",\n           \
        \         \"maxItems\": 100,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ObjectChange\"\
        \n                    },\n                    \"description\": \"Object changes to publish\"\n                }\n\
        \            }\n        },\n        \"ObjectChange\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A single change to a map object\",\n            \"required\": [\n                \"objectId\",\n             \
        \   \"action\"\n            ],\n            \"properties\": {\n                \"objectId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"ID of
        the object being changed\"\n                },\n                \"action\": {\n                    \"$ref\": \"#/$defs/ObjectAction\"\
        ,\n                    \"description\": \"Type of change\"\n                },\n                \"objectType\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Object type (required for created)\"\
        ,\n                    \"nullable\": true\n                },\n                \"position\": {\n                 \
        \   \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Object position (for create/update)\"\
        ,\n                    \"nullable\": true\n                },\n                \"bounds\": {\n                   \
        \ \"$ref\": \"#/$defs/Bounds\",\n                    \"description\": \"Object bounds (for create/update)\",\n   \
        \                 \"nullable\": true\n                },\n                \"data\": {\n                    \"type\"\
        : \"object\",\n                    \"additionalProperties\": true,\n                    \"description\": \"Object
        state (for created/updated)\",\n                    \"nullable\": true\n                }\n            }\n       \
        \ },\n        \"ObjectAction\": {\n            \"type\": \"string\",\n            \"description\": \"Type of change
        to a map object\",\n            \"enum\": [\n                \"created\",\n                \"updated\",\n        \
        \        \"deleted\"\n            ]\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n      \
        \          \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n\
        \                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n       \
        \     \"description\": \"An axis-aligned bounding box in 3D space\",\n            \"required\": [\n              \
        \  \"min\",\n                \"max\"\n            ],\n            \"properties\": {\n                \"min\": {\n\
        \                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Minimum corner (lowest
        x, y, z values)\"\n                },\n                \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\n                }\n         \
        \   }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/PublishObjectChangesResponse\"\
        ,\n    \"$defs\": {\n        \"PublishObjectChangesResponse\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Response to object changes publish\",\n            \"properties\": {\n                \"accepted\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether the changes were accepted\"\
        \n                },\n                \"acceptedCount\": {\n                    \"type\": \"integer\",\n         \
        \           \"description\": \"Number of changes accepted\"\n                },\n                \"rejectedCount\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of changes rejected\"\
        \n                },\n                \"version\": {\n                    \"type\": \"integer\",\n               \
        \     \"format\": \"int64\",\n                    \"description\": \"Assigned version number\"\n                },\n\
        \                \"warning\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Optional warning message\",\n                    \"nullable\": true\n                }\n            }\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Publish metadata object changes (batch)\",\n    \"description\": \"Game
        servers use this to push object state changes.\\nEfficiently batches multiple object changes into one event.\\nMax
        100 changes per request.\\n\",\n    \"tags\": [\n        \"Runtime\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"publishObjectChanges\"\n}"
  /mapping/request-snapshot:
    post:
      summary: Request full snapshot for cold start
      description: |
        Consumers use this when starting up to get initial state.
        Returns current snapshot of requested region/kinds.
        For very large maps, payloadRef points to lib-asset storage.
      operationId: requestSnapshot
      tags:
      - Runtime
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestSnapshotRequest'
      responses:
        '200':
          description: Snapshot returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestSnapshotResponse'
        '404':
          description: Region not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RequestSnapshotRequest\"\
        ,\n    \"$defs\": {\n        \"RequestSnapshotRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request for full snapshot\",\n            \"required\": [\n                \"regionId\"\n            ],\n    \
        \        \"properties\": {\n                \"regionId\": {\n                    \"type\": \"string\",\n         \
        \           \"format\": \"uuid\",\n                    \"description\": \"Region to snapshot\"\n                },\n\
        \                \"kinds\": {\n                    \"type\": \"array\",\n                    \"items\": {\n      \
        \                  \"$ref\": \"#/$defs/MapKind\"\n                    },\n                    \"description\": \"\
        Which kinds to include (default all)\",\n                    \"nullable\": true\n                },\n            \
        \    \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n                    \"description\": \"Optional
        bounds filter\",\n                    \"nullable\": true\n                },\n                \"authorityToken\":
        {\n                    \"type\": \"string\",\n                    \"description\": \"Optional authority token. If
        provided and valid, clears the\\nRequiresConsumeBeforePublish flag for require_consume takeover mode.\\n\",\n    \
        \                \"nullable\": true\n                }\n            }\n        },\n        \"MapKind\": {\n      \
        \      \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\nDifferent
        kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n              \
        \  \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n                \"resources\"\
        ,\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"dynamic_objects\"\
        ,\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\",\n          \
        \      \"combat_effects\",\n                \"visual_effects\"\n            ]\n        },\n        \"Bounds\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D space\",\n \
        \           \"required\": [\n                \"min\",\n                \"max\"\n            ],\n            \"properties\"\
        : {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\"\
        : \"Minimum corner (lowest x, y, z values)\"\n                },\n                \"max\": {\n                   \
        \ \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\
        \n                }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n   \
        \         \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n       \
        \         \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n\
        \                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RequestSnapshotResponse\"\
        ,\n    \"$defs\": {\n        \"RequestSnapshotResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Snapshot response\",\n            \"properties\": {\n                \"regionId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Region ID\"\n   \
        \             },\n                \"objects\": {\n                    \"type\": \"array\",\n                    \"\
        items\": {\n                        \"$ref\": \"#/$defs/MapObject\"\n                    },\n                    \"\
        description\": \"All objects in snapshot\"\n                },\n                \"payloadRef\": {\n              \
        \      \"type\": \"string\",\n                    \"description\": \"For large snapshots, lib-asset reference\",\n\
        \                    \"nullable\": true\n                },\n                \"version\": {\n                    \"\
        type\": \"integer\",\n                    \"format\": \"int64\",\n                    \"description\": \"Snapshot
        version\"\n                }\n            }\n        },\n        \"MapObject\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"A stored map object with full metadata\",\n            \"required\": [\n       \
        \         \"objectId\",\n                \"regionId\",\n                \"kind\",\n                \"objectType\"\
        ,\n                \"createdAt\",\n                \"updatedAt\"\n            ],\n            \"properties\": {\n\
        \                \"objectId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Unique identifier for this object\"\n                },\n              \
        \  \"regionId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n       \
        \             \"description\": \"Region this object belongs to\"\n                },\n                \"kind\": {\n\
        \                    \"$ref\": \"#/$defs/MapKind\",\n                    \"description\": \"Map kind this object is
        stored under\"\n                },\n                \"objectType\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Publisher-defined type\"\n                },\n                \"position\"\
        : {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Position for point
        objects\",\n                    \"nullable\": true\n                },\n                \"bounds\": {\n          \
        \          \"$ref\": \"#/$defs/Bounds\",\n                    \"description\": \"Bounding box for area objects\",\n\
        \                    \"nullable\": true\n                },\n                \"data\": {\n                    \"type\"\
        : \"object\",\n                    \"additionalProperties\": true,\n                    \"description\": \"Schema-less
        object data (publisher-defined)\",\n                    \"nullable\": true\n                },\n                \"\
        version\": {\n                    \"type\": \"integer\",\n                    \"format\": \"int64\",\n           \
        \         \"description\": \"Monotonic version for ordering\"\n                },\n                \"createdAt\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                   \
        \ \"description\": \"When the object was first created\"\n                },\n                \"updatedAt\": {\n \
        \                   \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"\
        description\": \"When the object was last updated\"\n                }\n            }\n        },\n        \"MapKind\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\
        nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n   \
        \             \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n              \
        \  \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"\
        dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\"\
        ,\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n        },\n        \"\
        Position3D\": {\n            \"type\": \"object\",\n            \"description\": \"A point in 3D space\",\n      \
        \      \"required\": [\n                \"x\",\n                \"y\",\n                \"z\"\n            ],\n  \
        \          \"properties\": {\n                \"x\": {\n                    \"type\": \"number\",\n              \
        \      \"format\": \"double\",\n                    \"description\": \"X coordinate (typically east-west)\"\n    \
        \            },\n                \"y\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"double\",\n                    \"description\": \"Y coordinate (typically up-down / elevation)\"\n           \
        \     },\n                \"z\": {\n                    \"type\": \"number\",\n                    \"format\": \"\
        double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\n                }\n    \
        \        }\n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n            \"description\": \"\
        An axis-aligned bounding box in 3D space\",\n            \"required\": [\n                \"min\",\n             \
        \   \"max\"\n            ],\n            \"properties\": {\n                \"min\": {\n                    \"$ref\"\
        : \"#/$defs/Position3D\",\n                    \"description\": \"Minimum corner (lowest x, y, z values)\"\n     \
        \           },\n                \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n              \
        \      \"description\": \"Maximum corner (highest x, y, z values)\"\n                }\n            }\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Request full snapshot for cold start\",\n    \"description\": \"Consumers
        use this when starting up to get initial state.\\nReturns current snapshot of requested region/kinds.\\nFor very large
        maps, payloadRef points to lib-asset storage.\\n\",\n    \"tags\": [\n        \"Runtime\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"requestSnapshot\"\n}"
  /mapping/query/point:
    post:
      summary: Query map data at a specific point
      description: |
        Returns all map data at a point across requested kinds.
        Used by behavior stacks for contextual decisions.
        Optionally includes objects within radius.
      operationId: queryPoint
      tags:
      - Query
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryPointRequest'
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryPointResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/QueryPointRequest\"\
        ,\n    \"$defs\": {\n        \"QueryPointRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Query map data at a point\",\n            \"required\": [\n                \"regionId\",\n                \"position\"\
        \n            ],\n            \"properties\": {\n                \"regionId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Region to query\"\n \
        \               },\n                \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n     \
        \               \"description\": \"Point to query at\"\n                },\n                \"kinds\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/MapKind\"\
        \n                    },\n                    \"description\": \"Kinds to query (default all)\",\n               \
        \     \"nullable\": true\n                },\n                \"radius\": {\n                    \"type\": \"number\"\
        ,\n                    \"description\": \"Include objects within this radius\",\n                    \"nullable\"\
        : true\n                }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n  \
        \              \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"\
        description\": \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n            \
        \        \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\":
        \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"z\": {\n                 \
        \   \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Z coordinate
        (typically north-south)\"\n                }\n            }\n        },\n        \"MapKind\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"The category of spatial data this map contains.\\nDifferent kinds have
        different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\"\
        ,\n                \"static_geometry\",\n                \"navigation\",\n                \"resources\",\n       \
        \         \"spawn_points\",\n                \"points_of_interest\",\n                \"dynamic_objects\",\n     \
        \           \"hazards\",\n                \"weather_effects\",\n                \"ownership\",\n                \"\
        combat_effects\",\n                \"visual_effects\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/QueryPointResponse\"\
        ,\n    \"$defs\": {\n        \"QueryPointResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Point query results\",\n            \"properties\": {\n                \"objects\": {\n                    \"\
        type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/MapObject\"\n  \
        \                  },\n                    \"description\": \"Objects at/near the point\"\n                },\n  \
        \              \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\"\
        : \"Queried position\"\n                },\n                \"radius\": {\n                    \"type\": \"number\"\
        ,\n                    \"description\": \"Applied radius filter\",\n                    \"nullable\": true\n     \
        \           }\n            }\n        },\n        \"MapObject\": {\n            \"type\": \"object\",\n          \
        \  \"description\": \"A stored map object with full metadata\",\n            \"required\": [\n                \"objectId\"\
        ,\n                \"regionId\",\n                \"kind\",\n                \"objectType\",\n                \"createdAt\"\
        ,\n                \"updatedAt\"\n            ],\n            \"properties\": {\n                \"objectId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Unique identifier for this object\"\n                },\n                \"regionId\": {\n                   \
        \ \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Region
        this object belongs to\"\n                },\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\"\
        ,\n                    \"description\": \"Map kind this object is stored under\"\n                },\n           \
        \     \"objectType\": {\n                    \"type\": \"string\",\n                    \"description\": \"Publisher-defined
        type\"\n                },\n                \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Position for point objects\",\n                    \"nullable\": true\n\
        \                },\n                \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n          \
        \          \"description\": \"Bounding box for area objects\",\n                    \"nullable\": true\n         \
        \       },\n                \"data\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Schema-less object data (publisher-defined)\",\n                 \
        \   \"nullable\": true\n                },\n                \"version\": {\n                    \"type\": \"integer\"\
        ,\n                    \"format\": \"int64\",\n                    \"description\": \"Monotonic version for ordering\"\
        \n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the object was first created\"\n  \
        \              },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"date-time\",\n                    \"description\": \"When the object was last updated\"\n      \
        \          }\n            }\n        },\n        \"MapKind\": {\n            \"type\": \"string\",\n            \"\
        description\": \"The category of spatial data this map contains.\\nDifferent kinds have different update frequencies,
        storage models, and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\",\n                \"static_geometry\"\
        ,\n                \"navigation\",\n                \"resources\",\n                \"spawn_points\",\n          \
        \      \"points_of_interest\",\n                \"dynamic_objects\",\n                \"hazards\",\n             \
        \   \"weather_effects\",\n                \"ownership\",\n                \"combat_effects\",\n                \"\
        visual_effects\"\n            ]\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n      \
        \      \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n          \
        \      \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n  \
        \                  \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n       \
        \     \"description\": \"An axis-aligned bounding box in 3D space\",\n            \"required\": [\n              \
        \  \"min\",\n                \"max\"\n            ],\n            \"properties\": {\n                \"min\": {\n\
        \                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Minimum corner (lowest
        x, y, z values)\"\n                },\n                \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\n                }\n         \
        \   }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Query map data at a specific point\",\n    \"description\": \"Returns all
        map data at a point across requested kinds.\\nUsed by behavior stacks for contextual decisions.\\nOptionally includes
        objects within radius.\\n\",\n    \"tags\": [\n        \"Query\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"queryPoint\"\n}"
  /mapping/query/bounds:
    post:
      summary: Query map data within bounds
      description: |
        Returns map data within a bounding box.
        For event actors needing region overview.
        Limited to maxObjects per kind.
      operationId: queryBounds
      tags:
      - Query
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryBoundsRequest'
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryBoundsResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/QueryBoundsRequest\"\
        ,\n    \"$defs\": {\n        \"QueryBoundsRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Query map data within bounds\",\n            \"required\": [\n                \"regionId\",\n                \"\
        bounds\"\n            ],\n            \"properties\": {\n                \"regionId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Region to query\"\
        \n                },\n                \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n         \
        \           \"description\": \"Bounding box to query\"\n                },\n                \"kinds\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/MapKind\"\
        \n                    },\n                    \"description\": \"Kinds to query (default all)\",\n               \
        \     \"nullable\": true\n                },\n                \"maxObjects\": {\n                    \"type\": \"\
        integer\",\n                    \"default\": 500,\n                    \"maximum\": 5000,\n                    \"\
        description\": \"Maximum objects to return\"\n                }\n            }\n        },\n        \"Bounds\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D space\",\n \
        \           \"required\": [\n                \"min\",\n                \"max\"\n            ],\n            \"properties\"\
        : {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\"\
        : \"Minimum corner (lowest x, y, z values)\"\n                },\n                \"max\": {\n                   \
        \ \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\
        \n                }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n   \
        \         \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n       \
        \         \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n\
        \                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"MapKind\": {\n            \"type\": \"string\",\n      \
        \      \"description\": \"The category of spatial data this map contains.\\nDifferent kinds have different update
        frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\",\n            \
        \    \"static_geometry\",\n                \"navigation\",\n                \"resources\",\n                \"spawn_points\"\
        ,\n                \"points_of_interest\",\n                \"dynamic_objects\",\n                \"hazards\",\n \
        \               \"weather_effects\",\n                \"ownership\",\n                \"combat_effects\",\n      \
        \          \"visual_effects\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/QueryBoundsResponse\"\
        ,\n    \"$defs\": {\n        \"QueryBoundsResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Bounds query results\",\n            \"properties\": {\n                \"objects\": {\n                    \"\
        type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/MapObject\"\n  \
        \                  },\n                    \"description\": \"Objects within bounds\"\n                },\n      \
        \          \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n                    \"description\":
        \"Queried bounds\"\n                },\n                \"truncated\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether results were truncated\"\n                }\n            }\n   \
        \     },\n        \"MapObject\": {\n            \"type\": \"object\",\n            \"description\": \"A stored map
        object with full metadata\",\n            \"required\": [\n                \"objectId\",\n                \"regionId\"\
        ,\n                \"kind\",\n                \"objectType\",\n                \"createdAt\",\n                \"\
        updatedAt\"\n            ],\n            \"properties\": {\n                \"objectId\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique identifier
        for this object\"\n                },\n                \"regionId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Region this object belongs to\"\
        \n                },\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n          \
        \          \"description\": \"Map kind this object is stored under\"\n                },\n                \"objectType\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Publisher-defined type\"\n\
        \                },\n                \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n    \
        \                \"description\": \"Position for point objects\",\n                    \"nullable\": true\n      \
        \          },\n                \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n                \
        \    \"description\": \"Bounding box for area objects\",\n                    \"nullable\": true\n               \
        \ },\n                \"data\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Schema-less object data (publisher-defined)\",\n                 \
        \   \"nullable\": true\n                },\n                \"version\": {\n                    \"type\": \"integer\"\
        ,\n                    \"format\": \"int64\",\n                    \"description\": \"Monotonic version for ordering\"\
        \n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the object was first created\"\n  \
        \              },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"date-time\",\n                    \"description\": \"When the object was last updated\"\n      \
        \          }\n            }\n        },\n        \"MapKind\": {\n            \"type\": \"string\",\n            \"\
        description\": \"The category of spatial data this map contains.\\nDifferent kinds have different update frequencies,
        storage models, and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\",\n                \"static_geometry\"\
        ,\n                \"navigation\",\n                \"resources\",\n                \"spawn_points\",\n          \
        \      \"points_of_interest\",\n                \"dynamic_objects\",\n                \"hazards\",\n             \
        \   \"weather_effects\",\n                \"ownership\",\n                \"combat_effects\",\n                \"\
        visual_effects\"\n            ]\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n      \
        \      \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n          \
        \      \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n  \
        \                  \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n       \
        \     \"description\": \"An axis-aligned bounding box in 3D space\",\n            \"required\": [\n              \
        \  \"min\",\n                \"max\"\n            ],\n            \"properties\": {\n                \"min\": {\n\
        \                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Minimum corner (lowest
        x, y, z values)\"\n                },\n                \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\n                }\n         \
        \   }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Query map data within bounds\",\n    \"description\": \"Returns map data
        within a bounding box.\\nFor event actors needing region overview.\\nLimited to maxObjects per kind.\\n\",\n    \"\
        tags\": [\n        \"Query\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"queryBounds\"\n}"
  /mapping/query/objects-by-type:
    post:
      summary: Find all objects of a type in region
      description: |
        Returns all objects matching an objectType filter.
        For event actors asking "where are all the boulder clusters?"
      operationId: queryObjectsByType
      tags:
      - Query
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryObjectsByTypeRequest'
      responses:
        '200':
          description: Matching objects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryObjectsByTypeResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/QueryObjectsByTypeRequest\"\
        ,\n    \"$defs\": {\n        \"QueryObjectsByTypeRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Query objects by type\",\n            \"required\": [\n                \"regionId\",\n                \"objectType\"\
        \n            ],\n            \"properties\": {\n                \"regionId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Region to query\"\n \
        \               },\n                \"objectType\": {\n                    \"type\": \"string\",\n               \
        \     \"description\": \"Object type to filter by\"\n                },\n                \"bounds\": {\n         \
        \           \"$ref\": \"#/$defs/Bounds\",\n                    \"description\": \"Optional bounds filter\",\n    \
        \                \"nullable\": true\n                },\n                \"maxObjects\": {\n                    \"\
        type\": \"integer\",\n                    \"default\": 500,\n                    \"maximum\": 5000,\n            \
        \        \"description\": \"Maximum objects to return\"\n                }\n            }\n        },\n        \"\
        Bounds\": {\n            \"type\": \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D
        space\",\n            \"required\": [\n                \"min\",\n                \"max\"\n            ],\n       \
        \     \"properties\": {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n     \
        \               \"description\": \"Minimum corner (lowest x, y, z values)\"\n                },\n                \"\
        max\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner
        (highest x, y, z values)\"\n                }\n            }\n        },\n        \"Position3D\": {\n            \"\
        type\": \"object\",\n            \"description\": \"A point in 3D space\",\n            \"required\": [\n        \
        \        \"x\",\n                \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n  \
        \              \"x\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n\
        \                    \"description\": \"X coordinate (typically east-west)\"\n                },\n               \
        \ \"y\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n             \
        \       \"description\": \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"\
        z\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                 \
        \   \"description\": \"Z coordinate (typically north-south)\"\n                }\n            }\n        }\n    }\n\
        }"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/QueryObjectsByTypeResponse\"\
        ,\n    \"$defs\": {\n        \"QueryObjectsByTypeResponse\": {\n            \"type\": \"object\",\n            \"\
        description\": \"Object type query results\",\n            \"properties\": {\n                \"objects\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/MapObject\"\
        \n                    },\n                    \"description\": \"Matching objects\"\n                },\n        \
        \        \"objectType\": {\n                    \"type\": \"string\",\n                    \"description\": \"Queried
        object type\"\n                },\n                \"truncated\": {\n                    \"type\": \"boolean\",\n\
        \                    \"description\": \"Whether results were truncated\"\n                }\n            }\n     \
        \   },\n        \"MapObject\": {\n            \"type\": \"object\",\n            \"description\": \"A stored map object
        with full metadata\",\n            \"required\": [\n                \"objectId\",\n                \"regionId\",\n\
        \                \"kind\",\n                \"objectType\",\n                \"createdAt\",\n                \"updatedAt\"\
        \n            ],\n            \"properties\": {\n                \"objectId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique identifier for
        this object\"\n                },\n                \"regionId\": {\n                    \"type\": \"string\",\n  \
        \                  \"format\": \"uuid\",\n                    \"description\": \"Region this object belongs to\"\n\
        \                },\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n           \
        \         \"description\": \"Map kind this object is stored under\"\n                },\n                \"objectType\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Publisher-defined type\"\n\
        \                },\n                \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n    \
        \                \"description\": \"Position for point objects\",\n                    \"nullable\": true\n      \
        \          },\n                \"bounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n                \
        \    \"description\": \"Bounding box for area objects\",\n                    \"nullable\": true\n               \
        \ },\n                \"data\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Schema-less object data (publisher-defined)\",\n                 \
        \   \"nullable\": true\n                },\n                \"version\": {\n                    \"type\": \"integer\"\
        ,\n                    \"format\": \"int64\",\n                    \"description\": \"Monotonic version for ordering\"\
        \n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the object was first created\"\n  \
        \              },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"date-time\",\n                    \"description\": \"When the object was last updated\"\n      \
        \          }\n            }\n        },\n        \"MapKind\": {\n            \"type\": \"string\",\n            \"\
        description\": \"The category of spatial data this map contains.\\nDifferent kinds have different update frequencies,
        storage models, and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\",\n                \"static_geometry\"\
        ,\n                \"navigation\",\n                \"resources\",\n                \"spawn_points\",\n          \
        \      \"points_of_interest\",\n                \"dynamic_objects\",\n                \"hazards\",\n             \
        \   \"weather_effects\",\n                \"ownership\",\n                \"combat_effects\",\n                \"\
        visual_effects\"\n            ]\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n      \
        \      \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n          \
        \      \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n  \
        \                  \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n       \
        \     \"description\": \"An axis-aligned bounding box in 3D space\",\n            \"required\": [\n              \
        \  \"min\",\n                \"max\"\n            ],\n            \"properties\": {\n                \"min\": {\n\
        \                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Minimum corner (lowest
        x, y, z values)\"\n                },\n                \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\n                }\n         \
        \   }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Find all objects of a type in region\",\n    \"description\": \"Returns
        all objects matching an objectType filter.\\nFor event actors asking \\\"where are all the boulder clusters?\\\"\\\
        n\",\n    \"tags\": [\n        \"Query\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"queryObjectsByType\"\
        \n}"
  /mapping/query/affordance:
    post:
      summary: Find locations that afford a specific action or scene type
      description: |
        Affordance queries answer "where can I do X?" by combining
        multiple map kinds and applying game-specific scoring logic.

        Used by Event Brain for procedural scene orchestration:
        - "Find ambush locations"
        - "Find dramatic reveal spots"
        - "Find sheltered rest areas"

        Well-known types have predefined scoring; use affordanceType=custom
        with customAffordance for novel scenarios.
      operationId: queryAffordance
      tags:
      - Query
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AffordanceQueryRequest'
      responses:
        '200':
          description: Scored locations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AffordanceQueryResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AffordanceQueryRequest\"\
        ,\n    \"$defs\": {\n        \"AffordanceQueryRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Query for locations that afford a specific action\",\n            \"required\": [\n                \"regionId\"\
        ,\n                \"affordanceType\"\n            ],\n            \"properties\": {\n                \"regionId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Region to search\"\n                },\n                \"affordanceType\": {\n                 \
        \   \"$ref\": \"#/$defs/AffordanceType\",\n                    \"description\": \"Type of affordance to search for\"\
        \n                },\n                \"customAffordance\": {\n                    \"$ref\": \"#/$defs/CustomAffordance\"\
        ,\n                    \"description\": \"Custom affordance definition (when affordanceType=custom)\",\n         \
        \           \"nullable\": true\n                },\n                \"bounds\": {\n                    \"$ref\": \"\
        #/$defs/Bounds\",\n                    \"description\": \"Optional bounds to search within\",\n                  \
        \  \"nullable\": true\n                },\n                \"maxResults\": {\n                    \"type\": \"integer\"\
        ,\n                    \"default\": 10,\n                    \"maximum\": 100,\n                    \"description\"\
        : \"Maximum locations to return\"\n                },\n                \"minScore\": {\n                    \"type\"\
        : \"number\",\n                    \"minimum\": 0,\n                    \"maximum\": 1,\n                    \"default\"\
        : 0.5,\n                    \"description\": \"Minimum affordance score to include\"\n                },\n       \
        \         \"participantCount\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Expected participants (affects space requirements)\",\n                    \"nullable\": true\n              \
        \  },\n                \"excludePositions\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/Position3D\"\n                    },\n                    \"description\"\
        : \"Positions to exclude (e.g., player's current location)\",\n                    \"nullable\": true\n          \
        \      },\n                \"actorCapabilities\": {\n                    \"$ref\": \"#/$defs/ActorCapabilities\",\n\
        \                    \"description\": \"Actor capabilities affecting evaluation\",\n                    \"nullable\"\
        : true\n                },\n                \"freshness\": {\n                    \"$ref\": \"#/$defs/AffordanceFreshness\"\
        ,\n                    \"description\": \"Cache freshness level\"\n                },\n                \"maxAgeSeconds\"\
        : {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"maximum\"\
        : 3600,\n                    \"description\": \"Max age of cached results (for cached/aggressive_cache)\",\n     \
        \               \"nullable\": true\n                }\n            }\n        },\n        \"AffordanceType\": {\n\
        \            \"type\": \"string\",\n            \"description\": \"Well-known affordance types with predefined scoring
        logic.\\nUse 'custom' for novel affordance definitions.\\n\",\n            \"enum\": [\n                \"ambush\"\
        ,\n                \"shelter\",\n                \"vista\",\n                \"choke_point\",\n                \"\
        gathering_spot\",\n                \"dramatic_reveal\",\n                \"hidden_path\",\n                \"defensible_position\"\
        ,\n                \"custom\"\n            ]\n        },\n        \"CustomAffordance\": {\n            \"type\": \"\
        object\",\n            \"description\": \"Custom affordance definition for novel scenarios\",\n            \"properties\"\
        : {\n                \"description\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Human-readable description of this affordance\",\n                    \"nullable\": true\n                },\n\
        \                \"requires\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Required criteria. Object types, property constraints.\\nExample:
        { \\\"objectTypes\\\": [\\\"boulder\\\"], \\\"cover_rating\\\": { \\\"min\\\": 0.5 } }\\n\",\n                   \
        \ \"nullable\": true\n                },\n                \"prefers\": {\n                    \"type\": \"object\"\
        ,\n                    \"additionalProperties\": true,\n                    \"description\": \"Preferred criteria
        (boost score but not required).\\nExample: { \\\"elevation\\\": { \\\"prefer_higher\\\": true } }\\n\",\n        \
        \            \"nullable\": true\n                },\n                \"excludes\": {\n                    \"type\"\
        : \"object\",\n                    \"additionalProperties\": true,\n                    \"description\": \"Exclusion
        criteria. Reject candidates matching these.\\nExample: { \\\"hazards\\\": true, \\\"contested\\\": true }\\n\",\n\
        \                    \"nullable\": true\n                }\n            }\n        },\n        \"Bounds\": {\n   \
        \         \"type\": \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D space\",\n    \
        \        \"required\": [\n                \"min\",\n                \"max\"\n            ],\n            \"properties\"\
        : {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\"\
        : \"Minimum corner (lowest x, y, z values)\"\n                },\n                \"max\": {\n                   \
        \ \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\
        \n                }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n   \
        \         \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n       \
        \         \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n\
        \                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        },\n        \"ActorCapabilities\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"Actor-specific capabilities that affect affordance evaluation.\\nSame location may
        afford different actions to different actor types.\\n\",\n            \"properties\": {\n                \"size\"\
        : {\n                    \"$ref\": \"#/$defs/ActorSize\",\n                    \"description\": \"Affects cover requirements
        and passage width\"\n                },\n                \"height\": {\n                    \"type\": \"number\",\n\
        \                    \"description\": \"Actor height in meters (affects cover, sightlines)\",\n                  \
        \  \"nullable\": true\n                },\n                \"canClimb\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"default\": false,\n                    \"description\": \"Can reach elevated positions\"\n\
        \                },\n                \"canSwim\": {\n                    \"type\": \"boolean\",\n                \
        \    \"default\": false,\n                    \"description\": \"Includes water-based positions\"\n              \
        \  },\n                \"canFly\": {\n                    \"type\": \"boolean\",\n                    \"default\"\
        : false,\n                    \"description\": \"Includes aerial positions\"\n                },\n               \
        \ \"perceptionRange\": {\n                    \"type\": \"number\",\n                    \"description\": \"Affects
        sightline distance requirements\",\n                    \"nullable\": true\n                },\n                \"\
        movementSpeed\": {\n                    \"type\": \"number\",\n                    \"description\": \"Affects escape
        route viability calculations\",\n                    \"nullable\": true\n                },\n                \"stealthRating\"\
        : {\n                    \"type\": \"number\",\n                    \"minimum\": 0,\n                    \"maximum\"\
        : 1,\n                    \"description\": \"Affects ambush/hidden_path affordance scoring\",\n                  \
        \  \"nullable\": true\n                }\n            }\n        },\n        \"ActorSize\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Size classification affecting cover requirements and passage width\"\
        ,\n            \"enum\": [\n                \"tiny\",\n                \"small\",\n                \"medium\",\n \
        \               \"large\",\n                \"huge\"\n            ],\n            \"default\": \"medium\"\n      \
        \  },\n        \"AffordanceFreshness\": {\n            \"type\": \"string\",\n            \"description\": \"Controls
        caching behavior for affordance queries\",\n            \"enum\": [\n                \"fresh\",\n                \"\
        cached\",\n                \"aggressive_cache\"\n            ],\n            \"default\": \"cached\"\n        }\n\
        \    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AffordanceQueryResponse\"\
        ,\n    \"$defs\": {\n        \"AffordanceQueryResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Affordance query results\",\n            \"properties\": {\n                \"locations\": {\n               \
        \     \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/AffordanceLocation\"\
        \n                    },\n                    \"description\": \"Scored locations (highest score first)\"\n      \
        \          },\n                \"queryMetadata\": {\n                    \"$ref\": \"#/$defs/AffordanceQueryMetadata\"\
        ,\n                    \"description\": \"Metadata about query execution (optional)\",\n                    \"nullable\"\
        : true\n                }\n            }\n        },\n        \"AffordanceLocation\": {\n            \"type\": \"\
        object\",\n            \"description\": \"A location that affords the requested action\",\n            \"properties\"\
        : {\n                \"position\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"\
        description\": \"Location position\"\n                },\n                \"bounds\": {\n                    \"$ref\"\
        : \"#/$defs/Bounds\",\n                    \"description\": \"Area bounds if affordance spans an area\",\n       \
        \             \"nullable\": true\n                },\n                \"score\": {\n                    \"type\":
        \"number\",\n                    \"minimum\": 0,\n                    \"maximum\": 1,\n                    \"description\"\
        : \"How well this location affords the action (0-1)\"\n                },\n                \"features\": {\n     \
        \               \"type\": \"object\",\n                    \"additionalProperties\": true,\n                    \"\
        description\": \"What makes this location suitable.\\nExample: { \\\"cover_rating\\\": 0.8, \\\"sightlines\\\": [\\\
        \"north\\\"], \\\"terrain\\\": \\\"rocky\\\" }\\n\",\n                    \"nullable\": true\n                },\n\
        \                \"objectIds\": {\n                    \"type\": \"array\",\n                    \"items\": {\n  \
        \                      \"type\": \"string\",\n                        \"format\": \"uuid\"\n                    },\n\
        \                    \"description\": \"Map objects contributing to this affordance\",\n                    \"nullable\"\
        : true\n                }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n  \
        \              \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"\
        description\": \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n            \
        \        \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\":
        \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"z\": {\n                 \
        \   \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Z coordinate
        (typically north-south)\"\n                }\n            }\n        },\n        \"Bounds\": {\n            \"type\"\
        : \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D space\",\n            \"required\"\
        : [\n                \"min\",\n                \"max\"\n            ],\n            \"properties\": {\n          \
        \      \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"\
        Minimum corner (lowest x, y, z values)\"\n                },\n                \"max\": {\n                    \"$ref\"\
        : \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\n    \
        \            }\n            }\n        },\n        \"AffordanceQueryMetadata\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"Metadata about the affordance query execution\",\n            \"properties\": {\n\
        \                \"kindsSearched\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"type\": \"string\"\n                    },\n                    \"description\": \"Map
        kinds that were queried\",\n                    \"nullable\": true\n                },\n                \"objectsEvaluated\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of candidate objects
        evaluated\"\n                },\n                \"candidatesGenerated\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Number of candidate positions generated\"\n                },\n        \
        \        \"searchDurationMs\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Query execution time in milliseconds\"\n                },\n                \"cacheHit\": {\n                \
        \    \"type\": \"boolean\",\n                    \"description\": \"Whether results came from cache\"\n          \
        \      }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Find locations that afford a specific action or scene type\",\n    \"description\"\
        : \"Affordance queries answer \\\"where can I do X?\\\" by combining\\nmultiple map kinds and applying game-specific
        scoring logic.\\n\\nUsed by Event Brain for procedural scene orchestration:\\n- \\\"Find ambush locations\\\"\\n-
        \\\"Find dramatic reveal spots\\\"\\n- \\\"Find sheltered rest areas\\\"\\n\\nWell-known types have predefined scoring;
        use affordanceType=custom\\nwith customAffordance for novel scenarios.\\n\",\n    \"tags\": [\n        \"Query\"\n\
        \    ],\n    \"deprecated\": false,\n    \"operationId\": \"queryAffordance\"\n}"
  /mapping/authoring/checkout:
    post:
      summary: Acquire exclusive edit lock for design-time editing
      description: |
        For level editors and design tools only.
        Game servers do NOT use this - they use create-channel for implicit authority.
        Returns authority token for publishing edits.
      operationId: checkoutForAuthoring
      tags:
      - Authoring
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthoringCheckoutRequest'
      responses:
        '200':
          description: Checkout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthoringCheckoutResponse'
        '409':
          description: Already checked out by another editor
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthoringCheckoutRequest\"\
        ,\n    \"$defs\": {\n        \"AuthoringCheckoutRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to checkout for authoring\",\n            \"required\": [\n                \"regionId\",\n           \
        \     \"kind\",\n                \"editorId\"\n            ],\n            \"properties\": {\n                \"regionId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Region to checkout\"\n                },\n                \"kind\": {\n                    \"$ref\"\
        : \"#/$defs/MapKind\",\n                    \"description\": \"Map kind to checkout\"\n                },\n      \
        \          \"editorId\": {\n                    \"type\": \"string\",\n                    \"description\": \"Identifier
        for the editor/user\"\n                }\n            }\n        },\n        \"MapKind\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"The category of spatial data this map contains.\\nDifferent kinds have
        different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\"\
        ,\n                \"static_geometry\",\n                \"navigation\",\n                \"resources\",\n       \
        \         \"spawn_points\",\n                \"points_of_interest\",\n                \"dynamic_objects\",\n     \
        \           \"hazards\",\n                \"weather_effects\",\n                \"ownership\",\n                \"\
        combat_effects\",\n                \"visual_effects\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthoringCheckoutResponse\"\
        ,\n    \"$defs\": {\n        \"AuthoringCheckoutResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Checkout response\",\n            \"properties\": {\n                \"authorityToken\": {\n                 \
        \   \"type\": \"string\",\n                    \"description\": \"Token for publishing changes (if successful)\",\n\
        \                    \"nullable\": true\n                },\n                \"expiresAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"\
        When the checkout expires\",\n                    \"nullable\": true\n                },\n                \"lockedBy\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Who has the lock (if checkout
        failed)\",\n                    \"nullable\": true\n                },\n                \"lockedAt\": {\n        \
        \            \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When the lock was acquired (if checkout failed)\",\n                    \"nullable\": true\n                }\n\
        \            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Acquire exclusive edit lock for design-time editing\",\n    \"description\"\
        : \"For level editors and design tools only.\\nGame servers do NOT use this - they use create-channel for implicit
        authority.\\nReturns authority token for publishing edits.\\n\",\n    \"tags\": [\n        \"Authoring\"\n    ],\n\
        \    \"deprecated\": false,\n    \"operationId\": \"checkoutForAuthoring\"\n}"
  /mapping/authoring/commit:
    post:
      summary: Commit design-time changes
      description: |
        Commits pending changes and releases the checkout lock.
        Optionally includes a commit message for history.
      operationId: commitAuthoring
      tags:
      - Authoring
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthoringCommitRequest'
      responses:
        '200':
          description: Changes committed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthoringCommitResponse'
        '403':
          description: Invalid checkout token
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthoringCommitRequest\"\
        ,\n    \"$defs\": {\n        \"AuthoringCommitRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to commit authoring changes\",\n            \"required\": [\n                \"regionId\",\n         \
        \       \"kind\",\n                \"authorityToken\"\n            ],\n            \"properties\": {\n           \
        \     \"regionId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n    \
        \                \"description\": \"Region being edited\"\n                },\n                \"kind\": {\n     \
        \               \"$ref\": \"#/$defs/MapKind\",\n                    \"description\": \"Map kind being edited\"\n \
        \               },\n                \"authorityToken\": {\n                    \"type\": \"string\",\n           \
        \         \"description\": \"Checkout authority token\"\n                },\n                \"commitMessage\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Optional commit message for history\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"MapKind\": {\n\
        \            \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\
        nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n   \
        \             \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n              \
        \  \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"\
        dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\"\
        ,\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthoringCommitResponse\"\
        ,\n    \"$defs\": {\n        \"AuthoringCommitResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Commit response\",\n            \"properties\": {\n                \"version\": {\n                    \"type\"\
        : \"integer\",\n                    \"format\": \"int64\",\n                    \"description\": \"Committed version
        number\",\n                    \"nullable\": true\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Commit design-time changes\",\n    \"description\": \"Commits pending changes
        and releases the checkout lock.\\nOptionally includes a commit message for history.\\n\",\n    \"tags\": [\n     \
        \   \"Authoring\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"commitAuthoring\"\n}"
  /mapping/authoring/release:
    post:
      summary: Release authoring checkout without committing
      description: |
        Discards pending changes and releases the checkout lock.
        Use when abandoning edits.
      operationId: releaseAuthoring
      tags:
      - Authoring
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthoringReleaseRequest'
      responses:
        '200':
          description: Checkout released
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthoringReleaseResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthoringReleaseRequest\"\
        ,\n    \"$defs\": {\n        \"AuthoringReleaseRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to release authoring checkout\",\n            \"required\": [\n                \"regionId\",\n       \
        \         \"kind\",\n                \"authorityToken\"\n            ],\n            \"properties\": {\n         \
        \       \"regionId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n  \
        \                  \"description\": \"Region being edited\"\n                },\n                \"kind\": {\n   \
        \                 \"$ref\": \"#/$defs/MapKind\",\n                    \"description\": \"Map kind being edited\"\n\
        \                },\n                \"authorityToken\": {\n                    \"type\": \"string\",\n          \
        \          \"description\": \"Checkout authority token\"\n                }\n            }\n        },\n        \"\
        MapKind\": {\n            \"type\": \"string\",\n            \"description\": \"The category of spatial data this
        map contains.\\nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"\
        enum\": [\n                \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n \
        \               \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n     \
        \           \"dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n           \
        \     \"ownership\",\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n   \
        \     }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/AuthoringReleaseResponse\"\
        ,\n    \"$defs\": {\n        \"AuthoringReleaseResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Release response\",\n            \"properties\": {\n                \"released\": {\n                    \"type\"\
        : \"boolean\",\n                    \"description\": \"Whether checkout was released\"\n                }\n      \
        \      }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Release authoring checkout without committing\",\n    \"description\":
        \"Discards pending changes and releases the checkout lock.\\nUse when abandoning edits.\\n\",\n    \"tags\": [\n \
        \       \"Authoring\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"releaseAuthoring\"\n}"
  /mapping/definition/create:
    post:
      summary: Create a map definition template
      description: |
        Creates a new map definition (template) that describes the structure
        of a region. Definitions are templates that can be used to bootstrap
        channels with predefined layer configurations.
      operationId: createDefinition
      tags:
      - Definition
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDefinitionRequest'
      responses:
        '200':
          description: Definition created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MapDefinition'
        '409':
          description: Definition with this name already exists
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"CreateDefinitionRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to create a map definition\",\n            \"required\": [\n                \"name\"\n            ],\n\
        \            \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n         \
        \           \"description\": \"Human-readable name\"\n                },\n                \"description\": {\n   \
        \                 \"type\": \"string\",\n                    \"description\": \"Description of the map template\"\
        ,\n                    \"nullable\": true\n                },\n                \"layers\": {\n                   \
        \ \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/LayerDefinition\"\
        \n                    },\n                    \"description\": \"Layer configurations\",\n                    \"nullable\"\
        : true\n                },\n                \"defaultBounds\": {\n                    \"$ref\": \"#/$defs/Bounds\"\
        ,\n                    \"description\": \"Default bounds for regions using this definition\",\n                  \
        \  \"nullable\": true\n                },\n                \"metadata\": {\n                    \"type\": \"object\"\
        ,\n                    \"additionalProperties\": true,\n                    \"description\": \"Additional metadata\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"LayerDefinition\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Configuration for a specific layer within a
        map definition\",\n            \"required\": [\n                \"kind\"\n            ],\n            \"properties\"\
        : {\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n                    \"description\"\
        : \"The layer kind\"\n                },\n                \"storageMode\": {\n                    \"type\": \"string\"\
        ,\n                    \"enum\": [\n                        \"durable\",\n                        \"cached\",\n  \
        \                      \"ephemeral\"\n                    ],\n                    \"default\": \"cached\",\n     \
        \               \"description\": \"How this layer's data should be stored\"\n                },\n                \"\
        ttlSeconds\": {\n                    \"type\": \"integer\",\n                    \"description\": \"TTL for cached/ephemeral
        data (0 = no TTL)\",\n                    \"nullable\": true\n                },\n                \"defaultNonAuthorityHandling\"\
        : {\n                    \"$ref\": \"#/$defs/NonAuthorityHandlingMode\",\n                    \"description\": \"\
        Default non-authority handling for channels using this layer\"\n                },\n                \"cellSize\":
        {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"\
        description\": \"Spatial cell size for indexing (default from config if not set)\",\n                    \"nullable\"\
        : true\n                }\n            }\n        },\n        \"MapKind\": {\n            \"type\": \"string\",\n\
        \            \"description\": \"The category of spatial data this map contains.\\nDifferent kinds have different update
        frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\",\n            \
        \    \"static_geometry\",\n                \"navigation\",\n                \"resources\",\n                \"spawn_points\"\
        ,\n                \"points_of_interest\",\n                \"dynamic_objects\",\n                \"hazards\",\n \
        \               \"weather_effects\",\n                \"ownership\",\n                \"combat_effects\",\n      \
        \          \"visual_effects\"\n            ]\n        },\n        \"NonAuthorityHandlingMode\": {\n            \"\
        type\": \"string\",\n            \"description\": \"How to handle publish attempts from non-authority sources\",\n\
        \            \"enum\": [\n                \"reject_and_alert\",\n                \"accept_and_alert\",\n         \
        \       \"reject_silent\"\n            ],\n            \"default\": \"reject_and_alert\"\n        },\n        \"Bounds\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D space\"\
        ,\n            \"required\": [\n                \"min\",\n                \"max\"\n            ],\n            \"\
        properties\": {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n             \
        \       \"description\": \"Minimum corner (lowest x, y, z values)\"\n                },\n                \"max\":
        {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner (highest
        x, y, z values)\"\n                }\n            }\n        },\n        \"Position3D\": {\n            \"type\":
        \"object\",\n            \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"\
        x\",\n                \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n             \
        \   \"x\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n           \
        \         \"description\": \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n\
        \                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"z\": {\n               \
        \     \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"\
        Z coordinate (typically north-south)\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/MapDefinition\"\
        ,\n    \"$defs\": {\n        \"MapDefinition\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A map definition template that describes the structure of a region\",\n            \"required\": [\n         \
        \       \"definitionId\",\n                \"name\",\n                \"createdAt\"\n            ],\n            \"\
        properties\": {\n                \"definitionId\": {\n                    \"type\": \"string\",\n                \
        \    \"format\": \"uuid\",\n                    \"description\": \"Unique identifier for this definition\"\n     \
        \           },\n                \"name\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Human-readable name\"\n                },\n                \"description\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Description of the map template\",\n                    \"nullable\"\
        : true\n                },\n                \"layers\": {\n                    \"type\": \"array\",\n            \
        \        \"items\": {\n                        \"$ref\": \"#/$defs/LayerDefinition\"\n                    },\n   \
        \                 \"description\": \"Layer configurations for this map\",\n                    \"nullable\": true\n\
        \                },\n                \"defaultBounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n   \
        \                 \"description\": \"Default bounds for regions using this definition\",\n                    \"nullable\"\
        : true\n                },\n                \"metadata\": {\n                    \"type\": \"object\",\n         \
        \           \"additionalProperties\": true,\n                    \"description\": \"Additional metadata (schema-less)\"\
        ,\n                    \"nullable\": true\n                },\n                \"createdAt\": {\n                \
        \    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"\
        When the definition was created\"\n                },\n                \"updatedAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the definition
        was last updated\",\n                    \"nullable\": true\n                }\n            }\n        },\n      \
        \  \"LayerDefinition\": {\n            \"type\": \"object\",\n            \"description\": \"Configuration for a specific
        layer within a map definition\",\n            \"required\": [\n                \"kind\"\n            ],\n        \
        \    \"properties\": {\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n        \
        \            \"description\": \"The layer kind\"\n                },\n                \"storageMode\": {\n       \
        \             \"type\": \"string\",\n                    \"enum\": [\n                        \"durable\",\n     \
        \                   \"cached\",\n                        \"ephemeral\"\n                    ],\n                 \
        \   \"default\": \"cached\",\n                    \"description\": \"How this layer's data should be stored\"\n  \
        \              },\n                \"ttlSeconds\": {\n                    \"type\": \"integer\",\n               \
        \     \"description\": \"TTL for cached/ephemeral data (0 = no TTL)\",\n                    \"nullable\": true\n \
        \               },\n                \"defaultNonAuthorityHandling\": {\n                    \"$ref\": \"#/$defs/NonAuthorityHandlingMode\"\
        ,\n                    \"description\": \"Default non-authority handling for channels using this layer\"\n       \
        \         },\n                \"cellSize\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"double\",\n                    \"description\": \"Spatial cell size for indexing (default from config if not set)\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"MapKind\": {\n\
        \            \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\
        nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n   \
        \             \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n              \
        \  \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"\
        dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\"\
        ,\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n        },\n        \"\
        NonAuthorityHandlingMode\": {\n            \"type\": \"string\",\n            \"description\": \"How to handle publish
        attempts from non-authority sources\",\n            \"enum\": [\n                \"reject_and_alert\",\n         \
        \       \"accept_and_alert\",\n                \"reject_silent\"\n            ],\n            \"default\": \"reject_and_alert\"\
        \n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n            \"description\": \"An axis-aligned
        bounding box in 3D space\",\n            \"required\": [\n                \"min\",\n                \"max\"\n    \
        \        ],\n            \"properties\": {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Minimum corner (lowest x, y, z values)\"\n                },\n         \
        \       \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"\
        Maximum corner (highest x, y, z values)\"\n                }\n            }\n        },\n        \"Position3D\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"A point in 3D space\",\n            \"required\"\
        : [\n                \"x\",\n                \"y\",\n                \"z\"\n            ],\n            \"properties\"\
        : {\n                \"x\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\"\
        ,\n                    \"description\": \"X coordinate (typically east-west)\"\n                },\n             \
        \   \"y\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n           \
        \         \"description\": \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"\
        z\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                 \
        \   \"description\": \"Z coordinate (typically north-south)\"\n                }\n            }\n        }\n    }\n\
        }"
      x-endpoint-info-json: "{\n    \"summary\": \"Create a map definition template\",\n    \"description\": \"Creates a new
        map definition (template) that describes the structure\\nof a region. Definitions are templates that can be used to
        bootstrap\\nchannels with predefined layer configurations.\\n\",\n    \"tags\": [\n        \"Definition\"\n    ],\n\
        \    \"deprecated\": false,\n    \"operationId\": \"createDefinition\"\n}"
  /mapping/definition/get:
    post:
      summary: Get a map definition by ID
      description: Returns the full map definition including all layer configurations.
      operationId: getDefinition
      tags:
      - Definition
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetDefinitionRequest'
      responses:
        '200':
          description: Definition found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MapDefinition'
        '404':
          description: Definition not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"GetDefinitionRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to get a map definition\",\n            \"required\": [\n                \"definitionId\"\n          \
        \  ],\n            \"properties\": {\n                \"definitionId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Definition ID to retrieve\"\n\
        \                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/MapDefinition\"\
        ,\n    \"$defs\": {\n        \"MapDefinition\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A map definition template that describes the structure of a region\",\n            \"required\": [\n         \
        \       \"definitionId\",\n                \"name\",\n                \"createdAt\"\n            ],\n            \"\
        properties\": {\n                \"definitionId\": {\n                    \"type\": \"string\",\n                \
        \    \"format\": \"uuid\",\n                    \"description\": \"Unique identifier for this definition\"\n     \
        \           },\n                \"name\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Human-readable name\"\n                },\n                \"description\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Description of the map template\",\n                    \"nullable\"\
        : true\n                },\n                \"layers\": {\n                    \"type\": \"array\",\n            \
        \        \"items\": {\n                        \"$ref\": \"#/$defs/LayerDefinition\"\n                    },\n   \
        \                 \"description\": \"Layer configurations for this map\",\n                    \"nullable\": true\n\
        \                },\n                \"defaultBounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n   \
        \                 \"description\": \"Default bounds for regions using this definition\",\n                    \"nullable\"\
        : true\n                },\n                \"metadata\": {\n                    \"type\": \"object\",\n         \
        \           \"additionalProperties\": true,\n                    \"description\": \"Additional metadata (schema-less)\"\
        ,\n                    \"nullable\": true\n                },\n                \"createdAt\": {\n                \
        \    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"\
        When the definition was created\"\n                },\n                \"updatedAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the definition
        was last updated\",\n                    \"nullable\": true\n                }\n            }\n        },\n      \
        \  \"LayerDefinition\": {\n            \"type\": \"object\",\n            \"description\": \"Configuration for a specific
        layer within a map definition\",\n            \"required\": [\n                \"kind\"\n            ],\n        \
        \    \"properties\": {\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n        \
        \            \"description\": \"The layer kind\"\n                },\n                \"storageMode\": {\n       \
        \             \"type\": \"string\",\n                    \"enum\": [\n                        \"durable\",\n     \
        \                   \"cached\",\n                        \"ephemeral\"\n                    ],\n                 \
        \   \"default\": \"cached\",\n                    \"description\": \"How this layer's data should be stored\"\n  \
        \              },\n                \"ttlSeconds\": {\n                    \"type\": \"integer\",\n               \
        \     \"description\": \"TTL for cached/ephemeral data (0 = no TTL)\",\n                    \"nullable\": true\n \
        \               },\n                \"defaultNonAuthorityHandling\": {\n                    \"$ref\": \"#/$defs/NonAuthorityHandlingMode\"\
        ,\n                    \"description\": \"Default non-authority handling for channels using this layer\"\n       \
        \         },\n                \"cellSize\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"double\",\n                    \"description\": \"Spatial cell size for indexing (default from config if not set)\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"MapKind\": {\n\
        \            \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\
        nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n   \
        \             \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n              \
        \  \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"\
        dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\"\
        ,\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n        },\n        \"\
        NonAuthorityHandlingMode\": {\n            \"type\": \"string\",\n            \"description\": \"How to handle publish
        attempts from non-authority sources\",\n            \"enum\": [\n                \"reject_and_alert\",\n         \
        \       \"accept_and_alert\",\n                \"reject_silent\"\n            ],\n            \"default\": \"reject_and_alert\"\
        \n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n            \"description\": \"An axis-aligned
        bounding box in 3D space\",\n            \"required\": [\n                \"min\",\n                \"max\"\n    \
        \        ],\n            \"properties\": {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Minimum corner (lowest x, y, z values)\"\n                },\n         \
        \       \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"\
        Maximum corner (highest x, y, z values)\"\n                }\n            }\n        },\n        \"Position3D\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"A point in 3D space\",\n            \"required\"\
        : [\n                \"x\",\n                \"y\",\n                \"z\"\n            ],\n            \"properties\"\
        : {\n                \"x\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\"\
        ,\n                    \"description\": \"X coordinate (typically east-west)\"\n                },\n             \
        \   \"y\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n           \
        \         \"description\": \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"\
        z\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                 \
        \   \"description\": \"Z coordinate (typically north-south)\"\n                }\n            }\n        }\n    }\n\
        }"
      x-endpoint-info-json: "{\n    \"summary\": \"Get a map definition by ID\",\n    \"description\": \"Returns the full
        map definition including all layer configurations.\",\n    \"tags\": [\n        \"Definition\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"getDefinition\"\n}"
  /mapping/definition/list:
    post:
      summary: List map definitions with optional filters
      description: Returns a paginated list of map definitions.
      operationId: listDefinitions
      tags:
      - Definition
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListDefinitionsRequest'
      responses:
        '200':
          description: Definitions list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListDefinitionsResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListDefinitionsRequest\"\
        ,\n    \"$defs\": {\n        \"ListDefinitionsRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to list map definitions\",\n            \"properties\": {\n                \"nameFilter\": {\n       \
        \             \"type\": \"string\",\n                    \"description\": \"Filter by name (partial match)\",\n  \
        \                  \"nullable\": true\n                },\n                \"offset\": {\n                    \"type\"\
        : \"integer\",\n                    \"default\": 0,\n                    \"description\": \"Pagination offset\"\n\
        \                },\n                \"limit\": {\n                    \"type\": \"integer\",\n                  \
        \  \"default\": 50,\n                    \"description\": \"Max results to return\"\n                }\n         \
        \   }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListDefinitionsResponse\"\
        ,\n    \"$defs\": {\n        \"ListDefinitionsResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response containing list of map definitions\",\n            \"properties\": {\n                \"definitions\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/MapDefinition\"\n                    },\n                    \"description\": \"List of definitions\"\n\
        \                },\n                \"total\": {\n                    \"type\": \"integer\",\n                  \
        \  \"description\": \"Total count matching filter\"\n                },\n                \"offset\": {\n         \
        \           \"type\": \"integer\",\n                    \"description\": \"Current offset\"\n                },\n\
        \                \"limit\": {\n                    \"type\": \"integer\",\n                    \"description\": \"\
        Results limit used\"\n                }\n            }\n        },\n        \"MapDefinition\": {\n            \"type\"\
        : \"object\",\n            \"description\": \"A map definition template that describes the structure of a region\"\
        ,\n            \"required\": [\n                \"definitionId\",\n                \"name\",\n                \"createdAt\"\
        \n            ],\n            \"properties\": {\n                \"definitionId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique identifier
        for this definition\"\n                },\n                \"name\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Human-readable name\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the map template\"\
        ,\n                    \"nullable\": true\n                },\n                \"layers\": {\n                   \
        \ \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/LayerDefinition\"\
        \n                    },\n                    \"description\": \"Layer configurations for this map\",\n          \
        \          \"nullable\": true\n                },\n                \"defaultBounds\": {\n                    \"$ref\"\
        : \"#/$defs/Bounds\",\n                    \"description\": \"Default bounds for regions using this definition\",\n\
        \                    \"nullable\": true\n                },\n                \"metadata\": {\n                   \
        \ \"type\": \"object\",\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional metadata (schema-less)\",\n                    \"nullable\": true\n                },\n           \
        \     \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n\
        \                    \"description\": \"When the definition was created\"\n                },\n                \"\
        updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n      \
        \              \"description\": \"When the definition was last updated\",\n                    \"nullable\": true\n\
        \                }\n            }\n        },\n        \"LayerDefinition\": {\n            \"type\": \"object\",\n\
        \            \"description\": \"Configuration for a specific layer within a map definition\",\n            \"required\"\
        : [\n                \"kind\"\n            ],\n            \"properties\": {\n                \"kind\": {\n      \
        \              \"$ref\": \"#/$defs/MapKind\",\n                    \"description\": \"The layer kind\"\n         \
        \       },\n                \"storageMode\": {\n                    \"type\": \"string\",\n                    \"\
        enum\": [\n                        \"durable\",\n                        \"cached\",\n                        \"ephemeral\"\
        \n                    ],\n                    \"default\": \"cached\",\n                    \"description\": \"How
        this layer's data should be stored\"\n                },\n                \"ttlSeconds\": {\n                    \"\
        type\": \"integer\",\n                    \"description\": \"TTL for cached/ephemeral data (0 = no TTL)\",\n     \
        \               \"nullable\": true\n                },\n                \"defaultNonAuthorityHandling\": {\n     \
        \               \"$ref\": \"#/$defs/NonAuthorityHandlingMode\",\n                    \"description\": \"Default non-authority
        handling for channels using this layer\"\n                },\n                \"cellSize\": {\n                  \
        \  \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Spatial
        cell size for indexing (default from config if not set)\",\n                    \"nullable\": true\n             \
        \   }\n            }\n        },\n        \"MapKind\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"The category of spatial data this map contains.\\nDifferent kinds have different update frequencies, storage models,
        and TTLs.\\n\",\n            \"enum\": [\n                \"terrain\",\n                \"static_geometry\",\n   \
        \             \"navigation\",\n                \"resources\",\n                \"spawn_points\",\n               \
        \ \"points_of_interest\",\n                \"dynamic_objects\",\n                \"hazards\",\n                \"\
        weather_effects\",\n                \"ownership\",\n                \"combat_effects\",\n                \"visual_effects\"\
        \n            ]\n        },\n        \"NonAuthorityHandlingMode\": {\n            \"type\": \"string\",\n        \
        \    \"description\": \"How to handle publish attempts from non-authority sources\",\n            \"enum\": [\n  \
        \              \"reject_and_alert\",\n                \"accept_and_alert\",\n                \"reject_silent\"\n \
        \           ],\n            \"default\": \"reject_and_alert\"\n        },\n        \"Bounds\": {\n            \"type\"\
        : \"object\",\n            \"description\": \"An axis-aligned bounding box in 3D space\",\n            \"required\"\
        : [\n                \"min\",\n                \"max\"\n            ],\n            \"properties\": {\n          \
        \      \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"\
        Minimum corner (lowest x, y, z values)\"\n                },\n                \"max\": {\n                    \"$ref\"\
        : \"#/$defs/Position3D\",\n                    \"description\": \"Maximum corner (highest x, y, z values)\"\n    \
        \            }\n            }\n        },\n        \"Position3D\": {\n            \"type\": \"object\",\n        \
        \    \"description\": \"A point in 3D space\",\n            \"required\": [\n                \"x\",\n            \
        \    \"y\",\n                \"z\"\n            ],\n            \"properties\": {\n                \"x\": {\n    \
        \                \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\"\
        : \"X coordinate (typically east-west)\"\n                },\n                \"y\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Y coordinate (typically
        up-down / elevation)\"\n                },\n                \"z\": {\n                    \"type\": \"number\",\n\
        \                    \"format\": \"double\",\n                    \"description\": \"Z coordinate (typically north-south)\"\
        \n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List map definitions with optional filters\",\n    \"description\": \"\
        Returns a paginated list of map definitions.\",\n    \"tags\": [\n        \"Definition\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"listDefinitions\"\n}"
  /mapping/definition/update:
    post:
      summary: Update a map definition
      description: |
        Updates an existing map definition. Cannot change the definition ID.
        Layer configurations can be modified.
      operationId: updateDefinition
      tags:
      - Definition
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDefinitionRequest'
      responses:
        '200':
          description: Definition updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MapDefinition'
        '404':
          description: Definition not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/UpdateDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"UpdateDefinitionRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to update a map definition\",\n            \"required\": [\n                \"definitionId\"\n       \
        \     ],\n            \"properties\": {\n                \"definitionId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Definition ID to update\"\n \
        \               },\n                \"name\": {\n                    \"type\": \"string\",\n                    \"\
        description\": \"New name (optional)\",\n                    \"nullable\": true\n                },\n            \
        \    \"description\": {\n                    \"type\": \"string\",\n                    \"description\": \"New description
        (optional)\",\n                    \"nullable\": true\n                },\n                \"layers\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/LayerDefinition\"\
        \n                    },\n                    \"description\": \"New layer configurations (replaces existing)\",\n\
        \                    \"nullable\": true\n                },\n                \"defaultBounds\": {\n              \
        \      \"$ref\": \"#/$defs/Bounds\",\n                    \"description\": \"New default bounds\",\n             \
        \       \"nullable\": true\n                },\n                \"metadata\": {\n                    \"type\": \"\
        object\",\n                    \"additionalProperties\": true,\n                    \"description\": \"New metadata
        (replaces existing)\",\n                    \"nullable\": true\n                }\n            }\n        },\n   \
        \     \"LayerDefinition\": {\n            \"type\": \"object\",\n            \"description\": \"Configuration for
        a specific layer within a map definition\",\n            \"required\": [\n                \"kind\"\n            ],\n\
        \            \"properties\": {\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n\
        \                    \"description\": \"The layer kind\"\n                },\n                \"storageMode\": {\n\
        \                    \"type\": \"string\",\n                    \"enum\": [\n                        \"durable\",\n\
        \                        \"cached\",\n                        \"ephemeral\"\n                    ],\n            \
        \        \"default\": \"cached\",\n                    \"description\": \"How this layer's data should be stored\"\
        \n                },\n                \"ttlSeconds\": {\n                    \"type\": \"integer\",\n            \
        \        \"description\": \"TTL for cached/ephemeral data (0 = no TTL)\",\n                    \"nullable\": true\n\
        \                },\n                \"defaultNonAuthorityHandling\": {\n                    \"$ref\": \"#/$defs/NonAuthorityHandlingMode\"\
        ,\n                    \"description\": \"Default non-authority handling for channels using this layer\"\n       \
        \         },\n                \"cellSize\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"double\",\n                    \"description\": \"Spatial cell size for indexing (default from config if not set)\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"MapKind\": {\n\
        \            \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\
        nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n   \
        \             \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n              \
        \  \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"\
        dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\"\
        ,\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n        },\n        \"\
        NonAuthorityHandlingMode\": {\n            \"type\": \"string\",\n            \"description\": \"How to handle publish
        attempts from non-authority sources\",\n            \"enum\": [\n                \"reject_and_alert\",\n         \
        \       \"accept_and_alert\",\n                \"reject_silent\"\n            ],\n            \"default\": \"reject_and_alert\"\
        \n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n            \"description\": \"An axis-aligned
        bounding box in 3D space\",\n            \"required\": [\n                \"min\",\n                \"max\"\n    \
        \        ],\n            \"properties\": {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Minimum corner (lowest x, y, z values)\"\n                },\n         \
        \       \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"\
        Maximum corner (highest x, y, z values)\"\n                }\n            }\n        },\n        \"Position3D\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"A point in 3D space\",\n            \"required\"\
        : [\n                \"x\",\n                \"y\",\n                \"z\"\n            ],\n            \"properties\"\
        : {\n                \"x\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\"\
        ,\n                    \"description\": \"X coordinate (typically east-west)\"\n                },\n             \
        \   \"y\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n           \
        \         \"description\": \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"\
        z\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                 \
        \   \"description\": \"Z coordinate (typically north-south)\"\n                }\n            }\n        }\n    }\n\
        }"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/MapDefinition\"\
        ,\n    \"$defs\": {\n        \"MapDefinition\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A map definition template that describes the structure of a region\",\n            \"required\": [\n         \
        \       \"definitionId\",\n                \"name\",\n                \"createdAt\"\n            ],\n            \"\
        properties\": {\n                \"definitionId\": {\n                    \"type\": \"string\",\n                \
        \    \"format\": \"uuid\",\n                    \"description\": \"Unique identifier for this definition\"\n     \
        \           },\n                \"name\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Human-readable name\"\n                },\n                \"description\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Description of the map template\",\n                    \"nullable\"\
        : true\n                },\n                \"layers\": {\n                    \"type\": \"array\",\n            \
        \        \"items\": {\n                        \"$ref\": \"#/$defs/LayerDefinition\"\n                    },\n   \
        \                 \"description\": \"Layer configurations for this map\",\n                    \"nullable\": true\n\
        \                },\n                \"defaultBounds\": {\n                    \"$ref\": \"#/$defs/Bounds\",\n   \
        \                 \"description\": \"Default bounds for regions using this definition\",\n                    \"nullable\"\
        : true\n                },\n                \"metadata\": {\n                    \"type\": \"object\",\n         \
        \           \"additionalProperties\": true,\n                    \"description\": \"Additional metadata (schema-less)\"\
        ,\n                    \"nullable\": true\n                },\n                \"createdAt\": {\n                \
        \    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"\
        When the definition was created\"\n                },\n                \"updatedAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the definition
        was last updated\",\n                    \"nullable\": true\n                }\n            }\n        },\n      \
        \  \"LayerDefinition\": {\n            \"type\": \"object\",\n            \"description\": \"Configuration for a specific
        layer within a map definition\",\n            \"required\": [\n                \"kind\"\n            ],\n        \
        \    \"properties\": {\n                \"kind\": {\n                    \"$ref\": \"#/$defs/MapKind\",\n        \
        \            \"description\": \"The layer kind\"\n                },\n                \"storageMode\": {\n       \
        \             \"type\": \"string\",\n                    \"enum\": [\n                        \"durable\",\n     \
        \                   \"cached\",\n                        \"ephemeral\"\n                    ],\n                 \
        \   \"default\": \"cached\",\n                    \"description\": \"How this layer's data should be stored\"\n  \
        \              },\n                \"ttlSeconds\": {\n                    \"type\": \"integer\",\n               \
        \     \"description\": \"TTL for cached/ephemeral data (0 = no TTL)\",\n                    \"nullable\": true\n \
        \               },\n                \"defaultNonAuthorityHandling\": {\n                    \"$ref\": \"#/$defs/NonAuthorityHandlingMode\"\
        ,\n                    \"description\": \"Default non-authority handling for channels using this layer\"\n       \
        \         },\n                \"cellSize\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"double\",\n                    \"description\": \"Spatial cell size for indexing (default from config if not set)\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"MapKind\": {\n\
        \            \"type\": \"string\",\n            \"description\": \"The category of spatial data this map contains.\\
        nDifferent kinds have different update frequencies, storage models, and TTLs.\\n\",\n            \"enum\": [\n   \
        \             \"terrain\",\n                \"static_geometry\",\n                \"navigation\",\n              \
        \  \"resources\",\n                \"spawn_points\",\n                \"points_of_interest\",\n                \"\
        dynamic_objects\",\n                \"hazards\",\n                \"weather_effects\",\n                \"ownership\"\
        ,\n                \"combat_effects\",\n                \"visual_effects\"\n            ]\n        },\n        \"\
        NonAuthorityHandlingMode\": {\n            \"type\": \"string\",\n            \"description\": \"How to handle publish
        attempts from non-authority sources\",\n            \"enum\": [\n                \"reject_and_alert\",\n         \
        \       \"accept_and_alert\",\n                \"reject_silent\"\n            ],\n            \"default\": \"reject_and_alert\"\
        \n        },\n        \"Bounds\": {\n            \"type\": \"object\",\n            \"description\": \"An axis-aligned
        bounding box in 3D space\",\n            \"required\": [\n                \"min\",\n                \"max\"\n    \
        \        ],\n            \"properties\": {\n                \"min\": {\n                    \"$ref\": \"#/$defs/Position3D\"\
        ,\n                    \"description\": \"Minimum corner (lowest x, y, z values)\"\n                },\n         \
        \       \"max\": {\n                    \"$ref\": \"#/$defs/Position3D\",\n                    \"description\": \"\
        Maximum corner (highest x, y, z values)\"\n                }\n            }\n        },\n        \"Position3D\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"A point in 3D space\",\n            \"required\"\
        : [\n                \"x\",\n                \"y\",\n                \"z\"\n            ],\n            \"properties\"\
        : {\n                \"x\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\"\
        ,\n                    \"description\": \"X coordinate (typically east-west)\"\n                },\n             \
        \   \"y\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n           \
        \         \"description\": \"Y coordinate (typically up-down / elevation)\"\n                },\n                \"\
        z\": {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                 \
        \   \"description\": \"Z coordinate (typically north-south)\"\n                }\n            }\n        }\n    }\n\
        }"
      x-endpoint-info-json: "{\n    \"summary\": \"Update a map definition\",\n    \"description\": \"Updates an existing
        map definition. Cannot change the definition ID.\\nLayer configurations can be modified.\\n\",\n    \"tags\": [\n\
        \        \"Definition\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"updateDefinition\"\n}"
  /mapping/definition/delete:
    post:
      summary: Delete a map definition
      description: Deletes a map definition. Cannot delete if active channels reference it.
      operationId: deleteDefinition
      tags:
      - Definition
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteDefinitionRequest'
      responses:
        '200':
          description: Definition deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteDefinitionResponse'
        '404':
          description: Definition not found
        '409':
          description: Definition in use by active channels
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"DeleteDefinitionRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to delete a map definition\",\n            \"required\": [\n                \"definitionId\"\n       \
        \     ],\n            \"properties\": {\n                \"definitionId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Definition ID to delete\"\n \
        \               }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteDefinitionResponse\"\
        ,\n    \"$defs\": {\n        \"DeleteDefinitionResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response to delete request\",\n            \"properties\": {\n                \"deleted\": {\n               \
        \     \"type\": \"boolean\",\n                    \"description\": \"Whether the definition was deleted\"\n      \
        \          }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Delete a map definition\",\n    \"description\": \"Deletes a map definition.
        Cannot delete if active channels reference it.\",\n    \"tags\": [\n        \"Definition\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"deleteDefinition\"\n}"
components:
  schemas:
    MapKind:
      type: string
      description: |
        The category of spatial data this map contains.
        Different kinds have different update frequencies, storage models, and TTLs.
      enum:
      - terrain
      - static_geometry
      - navigation
      - resources
      - spawn_points
      - points_of_interest
      - dynamic_objects
      - hazards
      - weather_effects
      - ownership
      - combat_effects
      - visual_effects
    NonAuthorityHandlingMode:
      type: string
      description: How to handle publish attempts from non-authority sources
      enum:
      - reject_and_alert
      - accept_and_alert
      - reject_silent
      default: reject_and_alert
    AuthorityTakeoverMode:
      type: string
      description: |
        Policy for handling authority takeover when creating a channel that
        already has expired authority. Controls what happens to existing data.
      enum:
      - preserve_and_diff
      - reset
      - require_consume
      default: preserve_and_diff
    AffordanceType:
      type: string
      description: |
        Well-known affordance types with predefined scoring logic.
        Use 'custom' for novel affordance definitions.
      enum:
      - ambush
      - shelter
      - vista
      - choke_point
      - gathering_spot
      - dramatic_reveal
      - hidden_path
      - defensible_position
      - custom
    AffordanceFreshness:
      type: string
      description: Controls caching behavior for affordance queries
      enum:
      - fresh
      - cached
      - aggressive_cache
      default: cached
    ActorSize:
      type: string
      description: Size classification affecting cover requirements and passage width
      enum:
      - tiny
      - small
      - medium
      - large
      - huge
      default: medium
    DeltaType:
      type: string
      description: Whether an update is incremental or a full snapshot
      enum:
      - delta
      - snapshot
      default: delta
    ObjectAction:
      type: string
      description: Type of change to a map object
      enum:
      - created
      - updated
      - deleted
    Position3D:
      type: object
      description: A point in 3D space
      required:
      - x
      - y
      - z
      properties:
        x:
          type: number
          format: double
          description: X coordinate (typically east-west)
        y:
          type: number
          format: double
          description: Y coordinate (typically up-down / elevation)
        z:
          type: number
          format: double
          description: Z coordinate (typically north-south)
    Bounds:
      type: object
      description: An axis-aligned bounding box in 3D space
      required:
      - min
      - max
      properties:
        min:
          $ref: '#/components/schemas/Position3D'
          description: Minimum corner (lowest x, y, z values)
        max:
          $ref: '#/components/schemas/Position3D'
          description: Maximum corner (highest x, y, z values)
    MapPayload:
      type: object
      description: |
        Schema-less payload. Only envelope fields are validated.
        The 'data' field can contain ANYTHING the publisher wants.
        lib-mapping does not validate contents - only publisher and consumer care.
      required:
      - objectType
      properties:
        objectId:
          type: string
          format: uuid
          description: Unique ID for this object (generated if not provided)
        objectType:
          type: string
          description: Publisher-defined type (used for indexing and filtering)
        position:
          $ref: '#/components/schemas/Position3D'
          description: Position for point objects
          nullable: true
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Bounds for area objects
          nullable: true
        data:
          type: object
          additionalProperties: true
          description: |
            SCHEMA-LESS. Can contain anything.
            lib-mapping does not validate this.
            Examples: cover_rating, health, respawn_delay, etc.
          nullable: true
    MapObject:
      type: object
      description: A stored map object with full metadata
      required:
      - objectId
      - regionId
      - kind
      - objectType
      - createdAt
      - updatedAt
      properties:
        objectId:
          type: string
          format: uuid
          description: Unique identifier for this object
        regionId:
          type: string
          format: uuid
          description: Region this object belongs to
        kind:
          $ref: '#/components/schemas/MapKind'
          description: Map kind this object is stored under
        objectType:
          type: string
          description: Publisher-defined type
        position:
          $ref: '#/components/schemas/Position3D'
          description: Position for point objects
          nullable: true
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Bounding box for area objects
          nullable: true
        data:
          type: object
          additionalProperties: true
          description: Schema-less object data (publisher-defined)
          nullable: true
        version:
          type: integer
          format: int64
          description: Monotonic version for ordering
        createdAt:
          type: string
          format: date-time
          description: When the object was first created
        updatedAt:
          type: string
          format: date-time
          description: When the object was last updated
    ObjectChange:
      type: object
      description: A single change to a map object
      required:
      - objectId
      - action
      properties:
        objectId:
          type: string
          format: uuid
          description: ID of the object being changed
        action:
          $ref: '#/components/schemas/ObjectAction'
          description: Type of change
        objectType:
          type: string
          description: Object type (required for created)
          nullable: true
        position:
          $ref: '#/components/schemas/Position3D'
          description: Object position (for create/update)
          nullable: true
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Object bounds (for create/update)
          nullable: true
        data:
          type: object
          additionalProperties: true
          description: Object state (for created/updated)
          nullable: true
    AuthorityGrant:
      type: object
      description: Granted authority over a map channel
      required:
      - channelId
      - authorityToken
      - ingestTopic
      - expiresAt
      - regionId
      - kind
      properties:
        channelId:
          type: string
          format: uuid
          description: The channel (region+kind) you have authority over
        authorityToken:
          type: string
          description: Opaque token proving your authority (include in publishes)
        ingestTopic:
          type: string
          description: Topic for direct lib-messaging publishes (map.ingest.{channelId})
        expiresAt:
          type: string
          format: date-time
          description: When authority expires (must heartbeat to extend)
        regionId:
          type: string
          format: uuid
          description: Region ID for this channel
        kind:
          $ref: '#/components/schemas/MapKind'
          description: Map kind for this channel
    NonAuthorityAlertConfig:
      type: object
      description: Configuration for non-authority publish alerts
      properties:
        enabled:
          type: boolean
          default: true
          description: Whether to emit warning events
        alertTopic:
          type: string
          description: Custom topic for warnings (default map.warnings.unauthorized_publish)
          nullable: true
        includePayloadSummary:
          type: boolean
          default: false
          description: Include truncated payload in warning for debugging
    ActorCapabilities:
      type: object
      description: |
        Actor-specific capabilities that affect affordance evaluation.
        Same location may afford different actions to different actor types.
      properties:
        size:
          $ref: '#/components/schemas/ActorSize'
          description: Affects cover requirements and passage width
        height:
          type: number
          description: Actor height in meters (affects cover, sightlines)
          nullable: true
        canClimb:
          type: boolean
          default: false
          description: Can reach elevated positions
        canSwim:
          type: boolean
          default: false
          description: Includes water-based positions
        canFly:
          type: boolean
          default: false
          description: Includes aerial positions
        perceptionRange:
          type: number
          description: Affects sightline distance requirements
          nullable: true
        movementSpeed:
          type: number
          description: Affects escape route viability calculations
          nullable: true
        stealthRating:
          type: number
          minimum: 0
          maximum: 1
          description: Affects ambush/hidden_path affordance scoring
          nullable: true
    CustomAffordance:
      type: object
      description: Custom affordance definition for novel scenarios
      properties:
        description:
          type: string
          description: Human-readable description of this affordance
          nullable: true
        requires:
          type: object
          additionalProperties: true
          description: |
            Required criteria. Object types, property constraints.
            Example: { "objectTypes": ["boulder"], "cover_rating": { "min": 0.5 } }
          nullable: true
        prefers:
          type: object
          additionalProperties: true
          description: |
            Preferred criteria (boost score but not required).
            Example: { "elevation": { "prefer_higher": true } }
          nullable: true
        excludes:
          type: object
          additionalProperties: true
          description: |
            Exclusion criteria. Reject candidates matching these.
            Example: { "hazards": true, "contested": true }
          nullable: true
    CreateChannelRequest:
      type: object
      description: Request to create a new map channel
      required:
      - regionId
      - kind
      - sourceAppId
      properties:
        sourceAppId:
          type: string
          description: App-id of the caller taking authority (used for event metadata)
        regionId:
          type: string
          format: uuid
          description: Region for this channel
        kind:
          $ref: '#/components/schemas/MapKind'
          description: Map kind for this channel
        nonAuthorityHandling:
          $ref: '#/components/schemas/NonAuthorityHandlingMode'
          description: How to handle non-authority publishes
        takeoverMode:
          $ref: '#/components/schemas/AuthorityTakeoverMode'
          description: |
            Policy for authority takeover when channel exists with expired authority.
            preserve_and_diff (default): Keep existing data, new authority sends updates.
            reset: Clear all channel data before new authority takes over.
            require_consume: New authority must call RequestSnapshot before publishing.
        alertConfig:
          $ref: '#/components/schemas/NonAuthorityAlertConfig'
          description: Configuration for non-authority publish alerts
          nullable: true
        initialSnapshot:
          type: array
          items:
            $ref: '#/components/schemas/MapPayload'
          description: Optional initial data to populate channel
          nullable: true
    ReleaseAuthorityRequest:
      type: object
      description: Request to release authority over a channel
      required:
      - channelId
      - authorityToken
      properties:
        channelId:
          type: string
          format: uuid
          description: Channel to release
        authorityToken:
          type: string
          description: Current authority token
    ReleaseAuthorityResponse:
      type: object
      description: Response to authority release
      properties:
        released:
          type: boolean
          description: Whether authority was successfully released
    AuthorityHeartbeatRequest:
      type: object
      description: Request to maintain authority
      required:
      - channelId
      - authorityToken
      properties:
        channelId:
          type: string
          format: uuid
          description: Channel to heartbeat
        authorityToken:
          type: string
          description: Current authority token
    AuthorityHeartbeatResponse:
      type: object
      description: Response to authority heartbeat
      properties:
        valid:
          type: boolean
          description: Whether your authority is still valid
        expiresAt:
          type: string
          format: date-time
          description: Updated expiration time
        warning:
          type: string
          description: Optional warning (e.g., "authority expiring soon")
          nullable: true
    PublishMapUpdateRequest:
      type: object
      description: Request to publish map data update
      required:
      - channelId
      - authorityToken
      - payload
      properties:
        channelId:
          type: string
          format: uuid
          description: Channel to publish to
        authorityToken:
          type: string
          description: Authority token for validation
        sourceAppId:
          type: string
          description: App-id of caller (for warnings on non-authority attempts)
          nullable: true
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Affected area (null means entire region)
          nullable: true
        deltaType:
          $ref: '#/components/schemas/DeltaType'
          description: Whether this is incremental or full
        payload:
          $ref: '#/components/schemas/MapPayload'
          description: The payload to publish
        payloadAssetRef:
          type: string
          description: For large payloads, lib-asset reference instead of inline
          nullable: true
    PublishMapUpdateResponse:
      type: object
      description: Response to publish request
      properties:
        accepted:
          type: boolean
          description: Whether the update was accepted
        version:
          type: integer
          format: int64
          description: Assigned version number
        warning:
          type: string
          description: Optional warning message
          nullable: true
    PublishObjectChangesRequest:
      type: object
      description: Request to publish object changes (batch)
      required:
      - channelId
      - authorityToken
      - changes
      properties:
        channelId:
          type: string
          format: uuid
          description: Channel to publish to
        authorityToken:
          type: string
          description: Authority token for validation
        sourceAppId:
          type: string
          description: App-id of caller (for warnings on non-authority attempts)
          nullable: true
        changes:
          type: array
          maxItems: 100
          items:
            $ref: '#/components/schemas/ObjectChange'
          description: Object changes to publish
    PublishObjectChangesResponse:
      type: object
      description: Response to object changes publish
      properties:
        accepted:
          type: boolean
          description: Whether the changes were accepted
        acceptedCount:
          type: integer
          description: Number of changes accepted
        rejectedCount:
          type: integer
          description: Number of changes rejected
        version:
          type: integer
          format: int64
          description: Assigned version number
        warning:
          type: string
          description: Optional warning message
          nullable: true
    RequestSnapshotRequest:
      type: object
      description: Request for full snapshot
      required:
      - regionId
      properties:
        regionId:
          type: string
          format: uuid
          description: Region to snapshot
        kinds:
          type: array
          items:
            $ref: '#/components/schemas/MapKind'
          description: Which kinds to include (default all)
          nullable: true
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Optional bounds filter
          nullable: true
        authorityToken:
          type: string
          description: |
            Optional authority token. If provided and valid, clears the
            RequiresConsumeBeforePublish flag for require_consume takeover mode.
          nullable: true
    RequestSnapshotResponse:
      type: object
      description: Snapshot response
      properties:
        regionId:
          type: string
          format: uuid
          description: Region ID
        objects:
          type: array
          items:
            $ref: '#/components/schemas/MapObject'
          description: All objects in snapshot
        payloadRef:
          type: string
          description: For large snapshots, lib-asset reference
          nullable: true
        version:
          type: integer
          format: int64
          description: Snapshot version
    QueryPointRequest:
      type: object
      description: Query map data at a point
      required:
      - regionId
      - position
      properties:
        regionId:
          type: string
          format: uuid
          description: Region to query
        position:
          $ref: '#/components/schemas/Position3D'
          description: Point to query at
        kinds:
          type: array
          items:
            $ref: '#/components/schemas/MapKind'
          description: Kinds to query (default all)
          nullable: true
        radius:
          type: number
          description: Include objects within this radius
          nullable: true
    QueryPointResponse:
      type: object
      description: Point query results
      properties:
        objects:
          type: array
          items:
            $ref: '#/components/schemas/MapObject'
          description: Objects at/near the point
        position:
          $ref: '#/components/schemas/Position3D'
          description: Queried position
        radius:
          type: number
          description: Applied radius filter
          nullable: true
    QueryBoundsRequest:
      type: object
      description: Query map data within bounds
      required:
      - regionId
      - bounds
      properties:
        regionId:
          type: string
          format: uuid
          description: Region to query
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Bounding box to query
        kinds:
          type: array
          items:
            $ref: '#/components/schemas/MapKind'
          description: Kinds to query (default all)
          nullable: true
        maxObjects:
          type: integer
          default: 500
          maximum: 5000
          description: Maximum objects to return
    QueryBoundsResponse:
      type: object
      description: Bounds query results
      properties:
        objects:
          type: array
          items:
            $ref: '#/components/schemas/MapObject'
          description: Objects within bounds
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Queried bounds
        truncated:
          type: boolean
          description: Whether results were truncated
    QueryObjectsByTypeRequest:
      type: object
      description: Query objects by type
      required:
      - regionId
      - objectType
      properties:
        regionId:
          type: string
          format: uuid
          description: Region to query
        objectType:
          type: string
          description: Object type to filter by
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Optional bounds filter
          nullable: true
        maxObjects:
          type: integer
          default: 500
          maximum: 5000
          description: Maximum objects to return
    QueryObjectsByTypeResponse:
      type: object
      description: Object type query results
      properties:
        objects:
          type: array
          items:
            $ref: '#/components/schemas/MapObject'
          description: Matching objects
        objectType:
          type: string
          description: Queried object type
        truncated:
          type: boolean
          description: Whether results were truncated
    AffordanceQueryRequest:
      type: object
      description: Query for locations that afford a specific action
      required:
      - regionId
      - affordanceType
      properties:
        regionId:
          type: string
          format: uuid
          description: Region to search
        affordanceType:
          $ref: '#/components/schemas/AffordanceType'
          description: Type of affordance to search for
        customAffordance:
          $ref: '#/components/schemas/CustomAffordance'
          description: Custom affordance definition (when affordanceType=custom)
          nullable: true
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Optional bounds to search within
          nullable: true
        maxResults:
          type: integer
          default: 10
          maximum: 100
          description: Maximum locations to return
        minScore:
          type: number
          minimum: 0
          maximum: 1
          default: 0.5
          description: Minimum affordance score to include
        participantCount:
          type: integer
          description: Expected participants (affects space requirements)
          nullable: true
        excludePositions:
          type: array
          items:
            $ref: '#/components/schemas/Position3D'
          description: Positions to exclude (e.g., player's current location)
          nullable: true
        actorCapabilities:
          $ref: '#/components/schemas/ActorCapabilities'
          description: Actor capabilities affecting evaluation
          nullable: true
        freshness:
          $ref: '#/components/schemas/AffordanceFreshness'
          description: Cache freshness level
        maxAgeSeconds:
          type: integer
          minimum: 0
          maximum: 3600
          description: Max age of cached results (for cached/aggressive_cache)
          nullable: true
    AffordanceLocation:
      type: object
      description: A location that affords the requested action
      properties:
        position:
          $ref: '#/components/schemas/Position3D'
          description: Location position
        bounds:
          $ref: '#/components/schemas/Bounds'
          description: Area bounds if affordance spans an area
          nullable: true
        score:
          type: number
          minimum: 0
          maximum: 1
          description: How well this location affords the action (0-1)
        features:
          type: object
          additionalProperties: true
          description: |
            What makes this location suitable.
            Example: { "cover_rating": 0.8, "sightlines": ["north"], "terrain": "rocky" }
          nullable: true
        objectIds:
          type: array
          items:
            type: string
            format: uuid
          description: Map objects contributing to this affordance
          nullable: true
    AffordanceQueryMetadata:
      type: object
      description: Metadata about the affordance query execution
      properties:
        kindsSearched:
          type: array
          items:
            type: string
          description: Map kinds that were queried
          nullable: true
        objectsEvaluated:
          type: integer
          description: Number of candidate objects evaluated
        candidatesGenerated:
          type: integer
          description: Number of candidate positions generated
        searchDurationMs:
          type: integer
          description: Query execution time in milliseconds
        cacheHit:
          type: boolean
          description: Whether results came from cache
    AffordanceQueryResponse:
      type: object
      description: Affordance query results
      properties:
        locations:
          type: array
          items:
            $ref: '#/components/schemas/AffordanceLocation'
          description: Scored locations (highest score first)
        queryMetadata:
          $ref: '#/components/schemas/AffordanceQueryMetadata'
          description: Metadata about query execution (optional)
          nullable: true
    AuthoringCheckoutRequest:
      type: object
      description: Request to checkout for authoring
      required:
      - regionId
      - kind
      - editorId
      properties:
        regionId:
          type: string
          format: uuid
          description: Region to checkout
        kind:
          $ref: '#/components/schemas/MapKind'
          description: Map kind to checkout
        editorId:
          type: string
          description: Identifier for the editor/user
    AuthoringCheckoutResponse:
      type: object
      description: Checkout response
      properties:
        authorityToken:
          type: string
          description: Token for publishing changes (if successful)
          nullable: true
        expiresAt:
          type: string
          format: date-time
          description: When the checkout expires
          nullable: true
        lockedBy:
          type: string
          description: Who has the lock (if checkout failed)
          nullable: true
        lockedAt:
          type: string
          format: date-time
          description: When the lock was acquired (if checkout failed)
          nullable: true
    AuthoringCommitRequest:
      type: object
      description: Request to commit authoring changes
      required:
      - regionId
      - kind
      - authorityToken
      properties:
        regionId:
          type: string
          format: uuid
          description: Region being edited
        kind:
          $ref: '#/components/schemas/MapKind'
          description: Map kind being edited
        authorityToken:
          type: string
          description: Checkout authority token
        commitMessage:
          type: string
          description: Optional commit message for history
          nullable: true
    AuthoringCommitResponse:
      type: object
      description: Commit response
      properties:
        version:
          type: integer
          format: int64
          description: Committed version number
          nullable: true
    AuthoringReleaseRequest:
      type: object
      description: Request to release authoring checkout
      required:
      - regionId
      - kind
      - authorityToken
      properties:
        regionId:
          type: string
          format: uuid
          description: Region being edited
        kind:
          $ref: '#/components/schemas/MapKind'
          description: Map kind being edited
        authorityToken:
          type: string
          description: Checkout authority token
    AuthoringReleaseResponse:
      type: object
      description: Release response
      properties:
        released:
          type: boolean
          description: Whether checkout was released
    MapDefinition:
      type: object
      description: A map definition template that describes the structure of a region
      required:
      - definitionId
      - name
      - createdAt
      properties:
        definitionId:
          type: string
          format: uuid
          description: Unique identifier for this definition
        name:
          type: string
          description: Human-readable name
        description:
          type: string
          description: Description of the map template
          nullable: true
        layers:
          type: array
          items:
            $ref: '#/components/schemas/LayerDefinition'
          description: Layer configurations for this map
          nullable: true
        defaultBounds:
          $ref: '#/components/schemas/Bounds'
          description: Default bounds for regions using this definition
          nullable: true
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata (schema-less)
          nullable: true
        createdAt:
          type: string
          format: date-time
          description: When the definition was created
        updatedAt:
          type: string
          format: date-time
          description: When the definition was last updated
          nullable: true
    LayerDefinition:
      type: object
      description: Configuration for a specific layer within a map definition
      required:
      - kind
      properties:
        kind:
          $ref: '#/components/schemas/MapKind'
          description: The layer kind
        storageMode:
          type: string
          enum:
          - durable
          - cached
          - ephemeral
          default: cached
          description: How this layer's data should be stored
        ttlSeconds:
          type: integer
          description: TTL for cached/ephemeral data (0 = no TTL)
          nullable: true
        defaultNonAuthorityHandling:
          $ref: '#/components/schemas/NonAuthorityHandlingMode'
          description: Default non-authority handling for channels using this layer
        cellSize:
          type: number
          format: double
          description: Spatial cell size for indexing (default from config if not set)
          nullable: true
    CreateDefinitionRequest:
      type: object
      description: Request to create a map definition
      required:
      - name
      properties:
        name:
          type: string
          description: Human-readable name
        description:
          type: string
          description: Description of the map template
          nullable: true
        layers:
          type: array
          items:
            $ref: '#/components/schemas/LayerDefinition'
          description: Layer configurations
          nullable: true
        defaultBounds:
          $ref: '#/components/schemas/Bounds'
          description: Default bounds for regions using this definition
          nullable: true
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata
          nullable: true
    GetDefinitionRequest:
      type: object
      description: Request to get a map definition
      required:
      - definitionId
      properties:
        definitionId:
          type: string
          format: uuid
          description: Definition ID to retrieve
    ListDefinitionsRequest:
      type: object
      description: Request to list map definitions
      properties:
        nameFilter:
          type: string
          description: Filter by name (partial match)
          nullable: true
        offset:
          type: integer
          default: 0
          description: Pagination offset
        limit:
          type: integer
          default: 50
          description: Max results to return
    ListDefinitionsResponse:
      type: object
      description: Response containing list of map definitions
      properties:
        definitions:
          type: array
          items:
            $ref: '#/components/schemas/MapDefinition'
          description: List of definitions
        total:
          type: integer
          description: Total count matching filter
        offset:
          type: integer
          description: Current offset
        limit:
          type: integer
          description: Results limit used
    UpdateDefinitionRequest:
      type: object
      description: Request to update a map definition
      required:
      - definitionId
      properties:
        definitionId:
          type: string
          format: uuid
          description: Definition ID to update
        name:
          type: string
          description: New name (optional)
          nullable: true
        description:
          type: string
          description: New description (optional)
          nullable: true
        layers:
          type: array
          items:
            $ref: '#/components/schemas/LayerDefinition'
          description: New layer configurations (replaces existing)
          nullable: true
        defaultBounds:
          $ref: '#/components/schemas/Bounds'
          description: New default bounds
          nullable: true
        metadata:
          type: object
          additionalProperties: true
          description: New metadata (replaces existing)
          nullable: true
    DeleteDefinitionRequest:
      type: object
      description: Request to delete a map definition
      required:
      - definitionId
      properties:
        definitionId:
          type: string
          format: uuid
          description: Definition ID to delete
    DeleteDefinitionResponse:
      type: object
      description: Response to delete request
      properties:
        deleted:
          type: boolean
          description: Whether the definition was deleted
