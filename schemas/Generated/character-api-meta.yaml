openapi: 3.0.3
info:
  title: Bannou Character Service API
  description: |
    Character management service for game worlds.

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    Characters are independent world assets (not owned by accounts). Guardian spirits
    (future service) will reference characters for possession mechanics.

    **Scale**: Designed to handle hundreds of thousands of characters with realm-based
    partitioning for optimal performance.

    **Foreign Keys**: realmId and speciesId are UUIDs referencing future services
    (Realm, Species).

    **Relationships**: Character relationships are managed by the separate Relationship
    service, which handles entity-agnostic relationships between any two entities.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  version: 1.0.0
  x-resource-lifecycle:
    resourceType: character
    gracePeriodSeconds: 2592000
    cleanupPolicy: ALL_REQUIRED
  x-compression-callback:
    resourceType: character
    sourceType: character-base
    compressEndpoint: /character/get-compress-data
    compressPayloadTemplate: '{"characterId": "{{resourceId}}"}'
    priority: 0
    templateNamespace: character
    description: Base character data (name, species, realm, status, timestamps)
x-service-layer: GameFoundation
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)
paths:
  /character/create:
    post:
      summary: Create new character
      operationId: createCharacter
      tags:
      - Character Management
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCharacterRequest'
      responses:
        '200':
          description: Character created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterResponse'
        '400':
          description: Invalid character data
        '409':
          description: Character already exists
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateCharacterRequest\"\
        ,\n    \"$defs\": {\n        \"CreateCharacterRequest\": {\n            \"description\": \"Request payload for creating
        a new character in the game world\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"name\",\n                \"realmId\",\n                \"speciesId\"\
        ,\n                \"birthDate\"\n            ],\n            \"properties\": {\n                \"name\": {\n   \
        \                 \"type\": \"string\",\n                    \"minLength\": 1,\n                    \"maxLength\"\
        : 100,\n                    \"description\": \"Character name\"\n                },\n                \"realmId\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Realm ID (foreign key to future Realm service, partition key)\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Species ID (foreign key to future Species service)\"\n                },\n                \"birthDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game birth timestamp\"\n                },\n                \"status\": {\n            \
        \        \"allOf\": [\n                        {\n                            \"$ref\": \"#/$defs/CharacterStatus\"\
        \n                        }\n                    ],\n                    \"default\": \"alive\",\n               \
        \     \"description\": \"Initial lifecycle status for the character\"\n                }\n            }\n        },\n\
        \        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character lifecycle
        status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n                \"dormant\"\
        \n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterResponse\"\
        ,\n    \"$defs\": {\n        \"CharacterResponse\": {\n            \"description\": \"Complete character data returned
        from character operations\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n  \
        \          \"required\": [\n                \"characterId\",\n                \"name\",\n                \"realmId\"\
        ,\n                \"speciesId\",\n                \"birthDate\",\n                \"status\",\n                \"\
        createdAt\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        identifier for the character\"\n                },\n                \"name\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Display name of the character\"\n                },\n          \
        \      \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n    \
        \                \"description\": \"Realm ID (partition key)\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Species ID (foreign key to Species service)\"\n                },\n                \"birthDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game birth timestamp\"\n                },\n                \"deathDate\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"In-game death timestamp\"\n                },\n                \"\
        status\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"\
        #/$defs/CharacterStatus\"\n                        }\n                    ],\n                    \"description\"\
        : \"Current lifecycle status of the character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"Real-world creation timestamp\"\n                },\n                \"updatedAt\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Real-world last update timestamp\"\n                }\n            }\n      \
        \  },\n        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character
        lifecycle status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n            \
        \    \"dormant\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Create new character\",\n    \"description\": \"\",\n    \"tags\": [\n\
        \        \"Character Management\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"createCharacter\"\n}"
  /character/get:
    post:
      summary: Get character by ID
      operationId: getCharacter
      tags:
      - Character Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCharacterRequest'
      responses:
        '200':
          description: Character retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterResponse'
        '404':
          description: Character not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetCharacterRequest\"\
        ,\n    \"$defs\": {\n        \"GetCharacterRequest\": {\n            \"description\": \"Request payload for retrieving
        a single character by ID\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n   \
        \         \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n      \
        \          \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the character to retrieve\"\n                }\n            }\n  \
        \      }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterResponse\"\
        ,\n    \"$defs\": {\n        \"CharacterResponse\": {\n            \"description\": \"Complete character data returned
        from character operations\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n  \
        \          \"required\": [\n                \"characterId\",\n                \"name\",\n                \"realmId\"\
        ,\n                \"speciesId\",\n                \"birthDate\",\n                \"status\",\n                \"\
        createdAt\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        identifier for the character\"\n                },\n                \"name\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Display name of the character\"\n                },\n          \
        \      \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n    \
        \                \"description\": \"Realm ID (partition key)\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Species ID (foreign key to Species service)\"\n                },\n                \"birthDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game birth timestamp\"\n                },\n                \"deathDate\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"In-game death timestamp\"\n                },\n                \"\
        status\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"\
        #/$defs/CharacterStatus\"\n                        }\n                    ],\n                    \"description\"\
        : \"Current lifecycle status of the character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"Real-world creation timestamp\"\n                },\n                \"updatedAt\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Real-world last update timestamp\"\n                }\n            }\n      \
        \  },\n        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character
        lifecycle status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n            \
        \    \"dormant\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get character by ID\",\n    \"description\": \"\",\n    \"tags\": [\n \
        \       \"Character Management\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"getCharacter\"\n}"
  /character/update:
    post:
      summary: Update character
      operationId: updateCharacter
      tags:
      - Character Management
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCharacterRequest'
      responses:
        '200':
          description: Character updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterResponse'
        '404':
          description: Character not found
        '400':
          description: Invalid update data
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/UpdateCharacterRequest\"\
        ,\n    \"$defs\": {\n        \"UpdateCharacterRequest\": {\n            \"description\": \"Request payload for updating
        an existing character's properties\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n   \
        \             \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the character to update\"\n                },\n                \"\
        name\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n                    \"\
        maxLength\": 100,\n                    \"nullable\": true,\n                    \"description\": \"New name for the
        character\"\n                },\n                \"speciesId\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Update character's species (used for species merge migrations)\"\n                },\n                \"status\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"#/$defs/CharacterStatus\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"New lifecycle status for the character\"\n                },\n                \"deathDate\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                   \
        \ \"nullable\": true,\n                    \"description\": \"In-game death timestamp (sets status to dead)\"\n  \
        \              }\n            }\n        },\n        \"CharacterStatus\": {\n            \"type\": \"string\",\n \
        \           \"description\": \"Character lifecycle status\",\n            \"enum\": [\n                \"alive\",\n\
        \                \"dead\",\n                \"dormant\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterResponse\"\
        ,\n    \"$defs\": {\n        \"CharacterResponse\": {\n            \"description\": \"Complete character data returned
        from character operations\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n  \
        \          \"required\": [\n                \"characterId\",\n                \"name\",\n                \"realmId\"\
        ,\n                \"speciesId\",\n                \"birthDate\",\n                \"status\",\n                \"\
        createdAt\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        identifier for the character\"\n                },\n                \"name\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Display name of the character\"\n                },\n          \
        \      \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n    \
        \                \"description\": \"Realm ID (partition key)\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Species ID (foreign key to Species service)\"\n                },\n                \"birthDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game birth timestamp\"\n                },\n                \"deathDate\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"In-game death timestamp\"\n                },\n                \"\
        status\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"\
        #/$defs/CharacterStatus\"\n                        }\n                    ],\n                    \"description\"\
        : \"Current lifecycle status of the character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"Real-world creation timestamp\"\n                },\n                \"updatedAt\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Real-world last update timestamp\"\n                }\n            }\n      \
        \  },\n        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character
        lifecycle status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n            \
        \    \"dormant\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Update character\",\n    \"description\": \"\",\n    \"tags\": [\n    \
        \    \"Character Management\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"updateCharacter\"\n}"
  /character/delete:
    post:
      summary: Delete character (permanent removal)
      operationId: deleteCharacter
      tags:
      - Character Management
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteCharacterRequest'
      responses:
        '200':
          description: Character deleted successfully
        '404':
          description: Character not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteCharacterRequest\"\
        ,\n    \"$defs\": {\n        \"DeleteCharacterRequest\": {\n            \"description\": \"Request payload for permanently
        deleting a character\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n       \
        \     \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n          \
        \      \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"ID of the character to delete\"\n                }\n            }\n      \
        \  }\n    }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n    \"summary\": \"Delete character (permanent removal)\",\n    \"description\": \"\",\n \
        \   \"tags\": [\n        \"Character Management\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"deleteCharacter\"\
        \n}"
  /character/list:
    post:
      summary: List characters with filtering
      operationId: listCharacters
      tags:
      - Character Management
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListCharactersRequest'
      responses:
        '200':
          description: Characters retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterListResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListCharactersRequest\"\
        ,\n    \"$defs\": {\n        \"ListCharactersRequest\": {\n            \"description\": \"Request payload for listing
        characters with filtering and pagination\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"realmId\"\n            ],\n            \"properties\": {\n\
        \                \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Realm to list characters from (required for efficiency)\"\n            \
        \    },\n                \"speciesId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Filter by species\"\n\
        \                },\n                \"status\": {\n                    \"allOf\": [\n                        {\n\
        \                            \"$ref\": \"#/$defs/CharacterStatus\"\n                        }\n                  \
        \  ],\n                    \"nullable\": true,\n                    \"description\": \"Filter by status\"\n      \
        \          },\n                \"page\": {\n                    \"type\": \"integer\",\n                    \"minimum\"\
        : 1,\n                    \"default\": 1,\n                    \"description\": \"Page number for pagination (1-based)\"\
        \n                },\n                \"pageSize\": {\n                    \"type\": \"integer\",\n              \
        \      \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"default\": 20,\n            \
        \        \"description\": \"Number of results per page\"\n                }\n            }\n        },\n        \"\
        CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character lifecycle status\"\
        ,\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n                \"dormant\"\n \
        \           ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterListResponse\"\
        ,\n    \"$defs\": {\n        \"CharacterListResponse\": {\n            \"description\": \"Paginated list of characters
        with metadata for navigation\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characters\",\n                \"totalCount\",\n                \"\
        page\",\n                \"pageSize\",\n                \"hasNextPage\",\n                \"hasPreviousPage\"\n  \
        \          ],\n            \"properties\": {\n                \"characters\": {\n                    \"type\": \"\
        array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/CharacterResponse\"\n    \
        \                },\n                    \"description\": \"List of characters matching the query\"\n            \
        \    },\n                \"totalCount\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Total number of characters matching the filter criteria\"\n                },\n                \"page\": {\n \
        \                   \"type\": \"integer\",\n                    \"description\": \"Current page number (1-based)\"\
        \n                },\n                \"pageSize\": {\n                    \"type\": \"integer\",\n              \
        \      \"description\": \"Number of results per page\"\n                },\n                \"hasNextPage\": {\n \
        \                   \"type\": \"boolean\",\n                    \"description\": \"Whether there are more results
        after this page\"\n                },\n                \"hasPreviousPage\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether there are results before this page\"\n                }\n      \
        \      }\n        },\n        \"CharacterResponse\": {\n            \"description\": \"Complete character data returned
        from character operations\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n  \
        \          \"required\": [\n                \"characterId\",\n                \"name\",\n                \"realmId\"\
        ,\n                \"speciesId\",\n                \"birthDate\",\n                \"status\",\n                \"\
        createdAt\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        identifier for the character\"\n                },\n                \"name\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Display name of the character\"\n                },\n          \
        \      \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n    \
        \                \"description\": \"Realm ID (partition key)\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Species ID (foreign key to Species service)\"\n                },\n                \"birthDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game birth timestamp\"\n                },\n                \"deathDate\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"In-game death timestamp\"\n                },\n                \"\
        status\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"\
        #/$defs/CharacterStatus\"\n                        }\n                    ],\n                    \"description\"\
        : \"Current lifecycle status of the character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"Real-world creation timestamp\"\n                },\n                \"updatedAt\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Real-world last update timestamp\"\n                }\n            }\n      \
        \  },\n        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character
        lifecycle status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n            \
        \    \"dormant\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List characters with filtering\",\n    \"description\": \"\",\n    \"tags\"\
        : [\n        \"Character Management\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"listCharacters\"\
        \n}"
  /character/get-enriched:
    post:
      summary: Get character with optional related data (personality, backstory, family)
      description: |
        Retrieves a character with optional include flags for related data.
        Use this endpoint when you need aggregated character data from multiple services.
        Each included dataset is fetched from its respective service.
      operationId: getEnrichedCharacter
      tags:
      - Character Lookup
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetEnrichedCharacterRequest'
      responses:
        '200':
          description: Character retrieved with requested includes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrichedCharacterResponse'
        '404':
          description: Character not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetEnrichedCharacterRequest\"\
        ,\n    \"$defs\": {\n        \"GetEnrichedCharacterRequest\": {\n            \"description\": \"Request payload for
        retrieving a character with optional related data.\\nEach include flag fetches data from its respective service (zero
        overhead if not requested).\\n\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n   \
        \             \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the character to retrieve\"\n                },\n                \"\
        includeFamilyTree\": {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n    \
        \                \"description\": \"Include family relationships from relationship service\"\n                }\n\
        \            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/EnrichedCharacterResponse\"\
        ,\n    \"$defs\": {\n        \"EnrichedCharacterResponse\": {\n            \"description\": \"Character data with
        optional enriched fields.\\nFields are only populated if the corresponding include flag was set in the request.\\\
        n\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n\
        \                \"characterId\",\n                \"name\",\n                \"realmId\",\n                \"speciesId\"\
        ,\n                \"birthDate\",\n                \"status\",\n                \"createdAt\"\n            ],\n  \
        \          \"properties\": {\n                \"characterId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Unique identifier for the character\"\
        \n                },\n                \"name\": {\n                    \"type\": \"string\",\n                   \
        \ \"description\": \"Display name of the character\"\n                },\n                \"realmId\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Realm ID (partition key)\"\n                },\n                \"speciesId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Species ID (foreign
        key to Species service)\"\n                },\n                \"birthDate\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"In-game birth timestamp\"\
        \n                },\n                \"deathDate\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"\
        In-game death timestamp\"\n                },\n                \"status\": {\n                    \"allOf\": [\n \
        \                       {\n                            \"$ref\": \"#/$defs/CharacterStatus\"\n                   \
        \     }\n                    ],\n                    \"description\": \"Current lifecycle status of the character\"\
        \n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"Real-world creation timestamp\"\n      \
        \          },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                    \"\
        format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"Real-world
        last update timestamp\"\n                },\n                \"familyTree\": {\n                    \"$ref\": \"#/$defs/FamilyTreeResponse\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Family relationships (included
        if includeFamilyTree=true)\"\n                }\n            }\n        },\n        \"CharacterStatus\": {\n     \
        \       \"type\": \"string\",\n            \"description\": \"Character lifecycle status\",\n            \"enum\"\
        : [\n                \"alive\",\n                \"dead\",\n                \"dormant\"\n            ]\n        },\n\
        \        \"FamilyTreeResponse\": {\n            \"description\": \"Family relationships for a character\",\n     \
        \       \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n       \
        \         \"parents\",\n                \"children\",\n                \"siblings\",\n                \"spouses\"\
        ,\n                \"pastLives\"\n            ],\n            \"properties\": {\n                \"parents\": {\n\
        \                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/FamilyMember\"\n                    },\n                    \"description\": \"Parent relationships (biological
        and adoptive)\"\n                },\n                \"children\": {\n                    \"type\": \"array\",\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/FamilyMember\"\n                   \
        \ },\n                    \"description\": \"Child relationships\"\n                },\n                \"siblings\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/FamilyMember\"\n                    },\n                    \"description\": \"Sibling relationships (including
        half-siblings)\"\n                },\n                \"spouses\": {\n                    \"type\": \"array\",\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/FamilyMember\"\n                   \
        \ },\n                    \"description\": \"Spousal relationships (spouse, husband, wife)\"\n                },\n\
        \                \"pastLives\": {\n                    \"type\": \"array\",\n                    \"items\": {\n  \
        \                      \"$ref\": \"#/$defs/PastLifeReference\"\n                    },\n                    \"description\"\
        : \"Previous incarnations (if reincarnation tracked)\"\n                }\n            }\n        },\n        \"FamilyMember\"\
        : {\n            \"description\": \"Reference to a family member\",\n            \"type\": \"object\",\n         \
        \   \"additionalProperties\": false,\n            \"required\": [\n                \"characterId\",\n            \
        \    \"relationshipType\",\n                \"isAlive\"\n            ],\n            \"properties\": {\n         \
        \       \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"ID of the related character\"\n                },\n                \"name\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Display name (if available)\"\n                },\n                \"relationshipType\": {\n                 \
        \   \"type\": \"string\",\n                    \"description\": \"Specific relationship type (MOTHER, FATHER, SON,
        DAUGHTER, etc.)\"\n                },\n                \"isAlive\": {\n                    \"type\": \"boolean\",\n\
        \                    \"description\": \"Whether the related character is alive\"\n                }\n            }\n\
        \        },\n        \"PastLifeReference\": {\n            \"description\": \"Reference to a past incarnation\",\n\
        \            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"required\": [\n  \
        \              \"characterId\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"ID of the previous incarnation\"\n                },\n                \"name\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Display name of the
        past life\"\n                },\n                \"deathDate\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the past life ended\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get character with optional related data (personality, backstory, family)\"\
        ,\n    \"description\": \"Retrieves a character with optional include flags for related data.\\nUse this endpoint
        when you need aggregated character data from multiple services.\\nEach included dataset is fetched from its respective
        service.\\n\",\n    \"tags\": [\n        \"Character Lookup\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"getEnrichedCharacter\"\n}"
  /character/compress:
    post:
      summary: Compress a dead character to archive format
      description: |
        Compresses a dead character's data for long-term storage.
        Generates text summaries of personality, backstory, and relationships.
        After compression, detailed data can be deleted to save storage.
        Only works on characters with status 'dead'.
      operationId: compressCharacter
      tags:
      - Character Compression
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompressCharacterRequest'
      responses:
        '200':
          description: Character compressed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterArchive'
        '400':
          description: Character is not dead (cannot compress alive characters)
        '404':
          description: Character not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CompressCharacterRequest\"\
        ,\n    \"$defs\": {\n        \"CompressCharacterRequest\": {\n            \"description\": \"Request to compress a
        dead character for archival\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n   \
        \             \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the dead character to compress\"\n                },\n           \
        \     \"deleteSourceData\": {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n\
        \                    \"description\": \"If true, delete personality/backstory data after compression.\\nThe archive
        becomes the only record of this information.\\n\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterArchive\"\
        ,\n    \"$defs\": {\n        \"CharacterArchive\": {\n            \"description\": \"Compressed archive of a dead
        character.\\nContains text summaries instead of structured data for long-term storage.\\nSelf-contained with no external
        references (suitable for cleanup).\\n\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"characterId\",\n                \"name\",\n             \
        \   \"realmId\",\n                \"speciesId\",\n                \"birthDate\",\n                \"deathDate\",\n\
        \                \"compressedAt\"\n            ],\n            \"properties\": {\n                \"characterId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Original character ID\"\n                },\n                \"name\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Character display name\"\n                },\n       \
        \         \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n \
        \                   \"description\": \"Realm the character belonged to\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Character's species\"\n                },\n                \"birthDate\": {\n                   \
        \ \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"In-game
        birth date\"\n                },\n                \"deathDate\": {\n                    \"type\": \"string\",\n  \
        \                  \"format\": \"date-time\",\n                    \"description\": \"In-game death date\"\n     \
        \           },\n                \"compressedAt\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"date-time\",\n                    \"description\": \"When this archive was created\"\n         \
        \       },\n                \"personalitySummary\": {\n                    \"type\": \"string\",\n               \
        \     \"nullable\": true,\n                    \"description\": \"Text summary of personality traits.\\nExample: \\\
        \"Brave and loyal, somewhat hot-tempered with a strong sense of justice\\\"\\n\"\n                },\n           \
        \     \"keyBackstoryPoints\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Key backstory elements as text. Null when compression did not include backstory data.\\
        nExample: [\\\"Trained by the Knights Guild\\\", \\\"Born in the Northlands\\\"]\\n\"\n                },\n      \
        \          \"majorLifeEvents\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Significant life events as text. Null when compression did not include history data.\\
        nExample: [\\\"Fought in the Battle of Stormgate (Hero)\\\", \\\"Survived the Great Flood\\\"]\\n\"\n            \
        \    },\n                \"familySummary\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Text summary of family relationships.\\nExample: \\\"Father of 3,
        married to Elena, orphaned at young age\\\"\\n\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Compress a dead character to archive format\",\n    \"description\": \"\
        Compresses a dead character's data for long-term storage.\\nGenerates text summaries of personality, backstory, and
        relationships.\\nAfter compression, detailed data can be deleted to save storage.\\nOnly works on characters with
        status 'dead'.\\n\",\n    \"tags\": [\n        \"Character Compression\"\n    ],\n    \"deprecated\": false,\n   \
        \ \"operationId\": \"compressCharacter\"\n}"
  /character/get-archive:
    post:
      summary: Get compressed archive data for a character
      operationId: getCharacterArchive
      tags:
      - Character Compression
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCharacterArchiveRequest'
      responses:
        '200':
          description: Archive retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterArchive'
        '404':
          description: Archive not found (character may not be compressed yet)
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetCharacterArchiveRequest\"\
        ,\n    \"$defs\": {\n        \"GetCharacterArchiveRequest\": {\n            \"description\": \"Request to retrieve
        a character's compressed archive\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n   \
        \             \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"ID of the character to get archive for\"\n                }\n          \
        \  }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterArchive\"\
        ,\n    \"$defs\": {\n        \"CharacterArchive\": {\n            \"description\": \"Compressed archive of a dead
        character.\\nContains text summaries instead of structured data for long-term storage.\\nSelf-contained with no external
        references (suitable for cleanup).\\n\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"characterId\",\n                \"name\",\n             \
        \   \"realmId\",\n                \"speciesId\",\n                \"birthDate\",\n                \"deathDate\",\n\
        \                \"compressedAt\"\n            ],\n            \"properties\": {\n                \"characterId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Original character ID\"\n                },\n                \"name\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Character display name\"\n                },\n       \
        \         \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n \
        \                   \"description\": \"Realm the character belonged to\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Character's species\"\n                },\n                \"birthDate\": {\n                   \
        \ \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"In-game
        birth date\"\n                },\n                \"deathDate\": {\n                    \"type\": \"string\",\n  \
        \                  \"format\": \"date-time\",\n                    \"description\": \"In-game death date\"\n     \
        \           },\n                \"compressedAt\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"date-time\",\n                    \"description\": \"When this archive was created\"\n         \
        \       },\n                \"personalitySummary\": {\n                    \"type\": \"string\",\n               \
        \     \"nullable\": true,\n                    \"description\": \"Text summary of personality traits.\\nExample: \\\
        \"Brave and loyal, somewhat hot-tempered with a strong sense of justice\\\"\\n\"\n                },\n           \
        \     \"keyBackstoryPoints\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Key backstory elements as text. Null when compression did not include backstory data.\\
        nExample: [\\\"Trained by the Knights Guild\\\", \\\"Born in the Northlands\\\"]\\n\"\n                },\n      \
        \          \"majorLifeEvents\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n\
        \                    \"items\": {\n                        \"type\": \"string\"\n                    },\n        \
        \            \"description\": \"Significant life events as text. Null when compression did not include history data.\\
        nExample: [\\\"Fought in the Battle of Stormgate (Hero)\\\", \\\"Survived the Great Flood\\\"]\\n\"\n            \
        \    },\n                \"familySummary\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Text summary of family relationships.\\nExample: \\\"Father of 3,
        married to Elena, orphaned at young age\\\"\\n\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get compressed archive data for a character\",\n    \"description\": \"\
        \",\n    \"tags\": [\n        \"Character Compression\"\n    ],\n    \"deprecated\": false,\n    \"operationId\":
        \"getCharacterArchive\"\n}"
  /character/check-references:
    post:
      summary: Check reference count for cleanup eligibility
      description: |
        Returns the current reference count for a compressed character.
        Characters with refCount=0 for the grace period are eligible for deletion.
        References include: family relationships, past lives, historical events, memories.
      operationId: checkCharacterReferences
      tags:
      - Character Compression
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckReferencesRequest'
      responses:
        '200':
          description: Reference count retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterRefCount'
        '404':
          description: Character not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CheckReferencesRequest\"\
        ,\n    \"$defs\": {\n        \"CheckReferencesRequest\": {\n            \"description\": \"Request to check reference
        count for a character\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n      \
        \      \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n         \
        \       \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"ID of the character to check references for\"\n                }\n       \
        \     }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterRefCount\"\
        ,\n    \"$defs\": {\n        \"CharacterRefCount\": {\n            \"description\": \"Reference count information
        for cleanup eligibility\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n    \
        \        \"required\": [\n                \"characterId\",\n                \"referenceCount\",\n                \"\
        referenceTypes\",\n                \"isCompressed\",\n                \"isEligibleForCleanup\"\n            ],\n \
        \           \"properties\": {\n                \"characterId\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"uuid\",\n                    \"description\": \"Character ID\"\n                },\n\
        \                \"referenceCount\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Number of active references to this character\"\n                },\n                \"referenceTypes\": {\n \
        \                   \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\
        \n                    },\n                    \"description\": \"Types of references found. L2 sources use constants
        (RELATIONSHIP, CONTRACT). L4 sources are reported by lib-resource using their registered source type strings (e.g.,
        actor, encounter).\\n\"\n                },\n                \"isCompressed\": {\n                    \"type\": \"\
        boolean\",\n                    \"description\": \"Whether the character has been compressed\"\n                },\n\
        \                \"isEligibleForCleanup\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"True if compressed, refCount=0, and grace period has passed.\\nSafe to permanently delete if true.\\n\"\n    \
        \            },\n                \"zeroRefSince\": {\n                    \"type\": \"string\",\n                \
        \    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"\
        When refCount first reached zero (null if refCount > 0)\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Check reference count for cleanup eligibility\",\n    \"description\":
        \"Returns the current reference count for a compressed character.\\nCharacters with refCount=0 for the grace period
        are eligible for deletion.\\nReferences include: family relationships, past lives, historical events, memories.\\\
        n\",\n    \"tags\": [\n        \"Character Compression\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"checkCharacterReferences\"\n}"
  /character/by-realm:
    post:
      summary: Get all characters in a realm (primary query pattern)
      operationId: getCharactersByRealm
      tags:
      - Character Lookup
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCharactersByRealmRequest'
      responses:
        '200':
          description: Characters retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterListResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetCharactersByRealmRequest\"\
        ,\n    \"$defs\": {\n        \"GetCharactersByRealmRequest\": {\n            \"description\": \"Request payload for
        retrieving all characters within a specific realm\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"realmId\"\n            ],\n            \"properties\": {\n\
        \                \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Realm ID to query (uses partition key for efficiency)\"\n              \
        \  },\n                \"speciesId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Filter by species\"\n\
        \                },\n                \"status\": {\n                    \"allOf\": [\n                        {\n\
        \                            \"$ref\": \"#/$defs/CharacterStatus\"\n                        }\n                  \
        \  ],\n                    \"nullable\": true,\n                    \"description\": \"Optional status filter\"\n\
        \                },\n                \"page\": {\n                    \"type\": \"integer\",\n                   \
        \ \"minimum\": 1,\n                    \"default\": 1,\n                    \"description\": \"Page number for pagination
        (1-based)\"\n                },\n                \"pageSize\": {\n                    \"type\": \"integer\",\n   \
        \                 \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"default\": 20,\n \
        \                   \"description\": \"Number of results per page\"\n                }\n            }\n        },\n\
        \        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character lifecycle
        status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n                \"dormant\"\
        \n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterListResponse\"\
        ,\n    \"$defs\": {\n        \"CharacterListResponse\": {\n            \"description\": \"Paginated list of characters
        with metadata for navigation\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"required\": [\n                \"characters\",\n                \"totalCount\",\n                \"\
        page\",\n                \"pageSize\",\n                \"hasNextPage\",\n                \"hasPreviousPage\"\n  \
        \          ],\n            \"properties\": {\n                \"characters\": {\n                    \"type\": \"\
        array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/CharacterResponse\"\n    \
        \                },\n                    \"description\": \"List of characters matching the query\"\n            \
        \    },\n                \"totalCount\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Total number of characters matching the filter criteria\"\n                },\n                \"page\": {\n \
        \                   \"type\": \"integer\",\n                    \"description\": \"Current page number (1-based)\"\
        \n                },\n                \"pageSize\": {\n                    \"type\": \"integer\",\n              \
        \      \"description\": \"Number of results per page\"\n                },\n                \"hasNextPage\": {\n \
        \                   \"type\": \"boolean\",\n                    \"description\": \"Whether there are more results
        after this page\"\n                },\n                \"hasPreviousPage\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether there are results before this page\"\n                }\n      \
        \      }\n        },\n        \"CharacterResponse\": {\n            \"description\": \"Complete character data returned
        from character operations\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n  \
        \          \"required\": [\n                \"characterId\",\n                \"name\",\n                \"realmId\"\
        ,\n                \"speciesId\",\n                \"birthDate\",\n                \"status\",\n                \"\
        createdAt\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        identifier for the character\"\n                },\n                \"name\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Display name of the character\"\n                },\n          \
        \      \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n    \
        \                \"description\": \"Realm ID (partition key)\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Species ID (foreign key to Species service)\"\n                },\n                \"birthDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game birth timestamp\"\n                },\n                \"deathDate\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"In-game death timestamp\"\n                },\n                \"\
        status\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"\
        #/$defs/CharacterStatus\"\n                        }\n                    ],\n                    \"description\"\
        : \"Current lifecycle status of the character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"Real-world creation timestamp\"\n                },\n                \"updatedAt\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Real-world last update timestamp\"\n                }\n            }\n      \
        \  },\n        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character
        lifecycle status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n            \
        \    \"dormant\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get all characters in a realm (primary query pattern)\",\n    \"description\"\
        : \"\",\n    \"tags\": [\n        \"Character Lookup\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"\
        getCharactersByRealm\"\n}"
  /character/transfer-realm:
    post:
      summary: Transfer character to a different realm
      description: |
        Moves a character from their current realm to a new target realm.
        Updates all indexes, validates the target realm exists and is active,
        and publishes realm transition events.
      operationId: transferCharacterToRealm
      tags:
      - Character Management
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferCharacterToRealmRequest'
      responses:
        '200':
          description: Character transferred successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterResponse'
        '400':
          description: Invalid transfer (same realm or target realm invalid)
        '404':
          description: Character or target realm not found
        '409':
          description: Could not acquire lock on character
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TransferCharacterToRealmRequest\"\
        ,\n    \"$defs\": {\n        \"TransferCharacterToRealmRequest\": {\n            \"description\": \"Request payload
        for transferring a character to a different realm\",\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"required\": [\n                \"characterId\",\n                \"targetRealmId\"\n     \
        \       ],\n            \"properties\": {\n                \"characterId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"ID of the character to transfer\"\
        \n                },\n                \"targetRealmId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"description\": \"ID of the realm to transfer the character
        to\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterResponse\"\
        ,\n    \"$defs\": {\n        \"CharacterResponse\": {\n            \"description\": \"Complete character data returned
        from character operations\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n  \
        \          \"required\": [\n                \"characterId\",\n                \"name\",\n                \"realmId\"\
        ,\n                \"speciesId\",\n                \"birthDate\",\n                \"status\",\n                \"\
        createdAt\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        identifier for the character\"\n                },\n                \"name\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Display name of the character\"\n                },\n          \
        \      \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n    \
        \                \"description\": \"Realm ID (partition key)\"\n                },\n                \"speciesId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Species ID (foreign key to Species service)\"\n                },\n                \"birthDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game birth timestamp\"\n                },\n                \"deathDate\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"In-game death timestamp\"\n                },\n                \"\
        status\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"\
        #/$defs/CharacterStatus\"\n                        }\n                    ],\n                    \"description\"\
        : \"Current lifecycle status of the character\"\n                },\n                \"createdAt\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"Real-world creation timestamp\"\n                },\n                \"updatedAt\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Real-world last update timestamp\"\n                }\n            }\n      \
        \  },\n        \"CharacterStatus\": {\n            \"type\": \"string\",\n            \"description\": \"Character
        lifecycle status\",\n            \"enum\": [\n                \"alive\",\n                \"dead\",\n            \
        \    \"dormant\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Transfer character to a different realm\",\n    \"description\": \"Moves
        a character from their current realm to a new target realm.\\nUpdates all indexes, validates the target realm exists
        and is active,\\nand publishes realm transition events.\\n\",\n    \"tags\": [\n        \"Character Management\"\n\
        \    ],\n    \"deprecated\": false,\n    \"operationId\": \"transferCharacterToRealm\"\n}"
  /character/get-compress-data:
    post:
      summary: Get character base data for compression
      operationId: getCompressData
      tags:
      - Character Compression
      description: |
        Called by Resource service during compression.
        Returns core character data (name, dates, family summary).
        Returns BadRequest if character is alive - only dead characters can be compressed.
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCompressDataRequest'
      responses:
        '200':
          description: Character base data returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterBaseArchive'
        '400':
          description: Character is not dead (cannot compress alive characters)
        '404':
          description: Character not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetCompressDataRequest\"\
        ,\n    \"$defs\": {\n        \"GetCompressDataRequest\": {\n            \"description\": \"Request to get character
        data for compression\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n       \
        \     \"required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n          \
        \      \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"ID of the character to get compress data for\"\n                }\n      \
        \      }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CharacterBaseArchive\"\
        ,\n    \"$defs\": {\n        \"CharacterBaseArchive\": {\n            \"type\": \"object\",\n            \"x-archive-type\"\
        : true,\n            \"description\": \"Core character data for archive storage and storyline SDK consumption.\\nInherits
        base archive properties from ResourceArchiveBase.\\nThe characterId field equals resourceId for convenience.\\n\\\
        nNote: This is distinct from CharacterArchive which contains text summaries\\nfor cleanup. CharacterBaseArchive contains
        structured data for SDK consumption.\\n\",\n            \"allOf\": [\n                {\n                    \"type\"\
        : \"object\"\n                }\n            ],\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"characterId\",\n                \"name\",\n                \"realmId\",\n                \"\
        speciesId\",\n                \"birthDate\",\n                \"deathDate\",\n                \"status\",\n      \
        \          \"createdAt\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n    \
        \                \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Unique identifier for the character (equals resourceId)\"\n                },\n                \"name\": {\n \
        \                   \"type\": \"string\",\n                    \"description\": \"Display name of the character\"\n\
        \                },\n                \"realmId\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"uuid\",\n                    \"description\": \"Realm ID (partition key)\"\n                },\n\
        \                \"speciesId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Species ID (foreign key to Species service)\"\n                },\n    \
        \            \"birthDate\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"In-game birth timestamp\"\n                },\n                \"deathDate\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"In-game death timestamp (required for compression)\"\n                },\n                \"\
        status\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\": \"\
        #/$defs/CharacterStatus\"\n                        }\n                    ],\n                    \"description\"\
        : \"Current lifecycle status (must be dead for compression)\"\n                },\n                \"familySummary\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Text summary of family relationships.\\nExample: \\\"Father of 3, married to Elena, orphaned at young age\\\"\\\
        n\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n           \
        \         \"format\": \"date-time\",\n                    \"description\": \"Real-world creation timestamp\"\n   \
        \             },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                  \
        \  \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"Real-world
        last update timestamp\"\n                }\n            }\n        },\n        \"CharacterStatus\": {\n          \
        \  \"type\": \"string\",\n            \"description\": \"Character lifecycle status\",\n            \"enum\": [\n\
        \                \"alive\",\n                \"dead\",\n                \"dormant\"\n            ]\n        }\n  \
        \  }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get character base data for compression\",\n    \"description\": \"Called
        by Resource service during compression.\\nReturns core character data (name, dates, family summary).\\nReturns BadRequest
        if character is alive - only dead characters can be compressed.\\n\",\n    \"tags\": [\n        \"Character Compression\"\
        \n    ],\n    \"deprecated\": false,\n    \"operationId\": \"getCompressData\"\n}"
components:
  schemas:
    CharacterStatus:
      type: string
      description: Character lifecycle status
      enum:
      - alive
      - dead
      - dormant
    CreateCharacterRequest:
      description: Request payload for creating a new character in the game world
      type: object
      additionalProperties: false
      required:
      - name
      - realmId
      - speciesId
      - birthDate
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Character name
        realmId:
          type: string
          format: uuid
          description: Realm ID (foreign key to future Realm service, partition key)
        speciesId:
          type: string
          format: uuid
          description: Species ID (foreign key to future Species service)
        birthDate:
          type: string
          format: date-time
          description: In-game birth timestamp
        status:
          allOf:
          - $ref: '#/components/schemas/CharacterStatus'
          default: alive
          description: Initial lifecycle status for the character
    GetCharacterRequest:
      description: Request payload for retrieving a single character by ID
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to retrieve
    UpdateCharacterRequest:
      description: Request payload for updating an existing character's properties
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to update
        name:
          type: string
          minLength: 1
          maxLength: 100
          nullable: true
          description: New name for the character
        speciesId:
          type: string
          format: uuid
          nullable: true
          description: Update character's species (used for species merge migrations)
        status:
          allOf:
          - $ref: '#/components/schemas/CharacterStatus'
          nullable: true
          description: New lifecycle status for the character
        deathDate:
          type: string
          format: date-time
          nullable: true
          description: In-game death timestamp (sets status to dead)
    DeleteCharacterRequest:
      description: Request payload for permanently deleting a character
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to delete
    ListCharactersRequest:
      description: Request payload for listing characters with filtering and pagination
      type: object
      additionalProperties: false
      required:
      - realmId
      properties:
        realmId:
          type: string
          format: uuid
          description: Realm to list characters from (required for efficiency)
        speciesId:
          type: string
          format: uuid
          nullable: true
          description: Filter by species
        status:
          allOf:
          - $ref: '#/components/schemas/CharacterStatus'
          nullable: true
          description: Filter by status
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number for pagination (1-based)
        pageSize:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Number of results per page
    GetCharactersByRealmRequest:
      description: Request payload for retrieving all characters within a specific realm
      type: object
      additionalProperties: false
      required:
      - realmId
      properties:
        realmId:
          type: string
          format: uuid
          description: Realm ID to query (uses partition key for efficiency)
        speciesId:
          type: string
          format: uuid
          nullable: true
          description: Filter by species
        status:
          allOf:
          - $ref: '#/components/schemas/CharacterStatus'
          nullable: true
          description: Optional status filter
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number for pagination (1-based)
        pageSize:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Number of results per page
    TransferCharacterToRealmRequest:
      description: Request payload for transferring a character to a different realm
      type: object
      additionalProperties: false
      required:
      - characterId
      - targetRealmId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to transfer
        targetRealmId:
          type: string
          format: uuid
          description: ID of the realm to transfer the character to
    CharacterResponse:
      description: Complete character data returned from character operations
      type: object
      additionalProperties: false
      required:
      - characterId
      - name
      - realmId
      - speciesId
      - birthDate
      - status
      - createdAt
      properties:
        characterId:
          type: string
          format: uuid
          description: Unique identifier for the character
        name:
          type: string
          description: Display name of the character
        realmId:
          type: string
          format: uuid
          description: Realm ID (partition key)
        speciesId:
          type: string
          format: uuid
          description: Species ID (foreign key to Species service)
        birthDate:
          type: string
          format: date-time
          description: In-game birth timestamp
        deathDate:
          type: string
          format: date-time
          nullable: true
          description: In-game death timestamp
        status:
          allOf:
          - $ref: '#/components/schemas/CharacterStatus'
          description: Current lifecycle status of the character
        createdAt:
          type: string
          format: date-time
          description: Real-world creation timestamp
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: Real-world last update timestamp
    CharacterListResponse:
      description: Paginated list of characters with metadata for navigation
      type: object
      additionalProperties: false
      required:
      - characters
      - totalCount
      - page
      - pageSize
      - hasNextPage
      - hasPreviousPage
      properties:
        characters:
          type: array
          items:
            $ref: '#/components/schemas/CharacterResponse'
          description: List of characters matching the query
        totalCount:
          type: integer
          description: Total number of characters matching the filter criteria
        page:
          type: integer
          description: Current page number (1-based)
        pageSize:
          type: integer
          description: Number of results per page
        hasNextPage:
          type: boolean
          description: Whether there are more results after this page
        hasPreviousPage:
          type: boolean
          description: Whether there are results before this page
    CharacterRealmLeftReason:
      type: string
      description: Reason a character left a realm
      enum:
      - deletion
      - transfer
    GetEnrichedCharacterRequest:
      description: |
        Request payload for retrieving a character with optional related data.
        Each include flag fetches data from its respective service (zero overhead if not requested).
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to retrieve
        includeFamilyTree:
          type: boolean
          default: false
          description: Include family relationships from relationship service
    EnrichedCharacterResponse:
      description: |
        Character data with optional enriched fields.
        Fields are only populated if the corresponding include flag was set in the request.
      type: object
      additionalProperties: false
      required:
      - characterId
      - name
      - realmId
      - speciesId
      - birthDate
      - status
      - createdAt
      properties:
        characterId:
          type: string
          format: uuid
          description: Unique identifier for the character
        name:
          type: string
          description: Display name of the character
        realmId:
          type: string
          format: uuid
          description: Realm ID (partition key)
        speciesId:
          type: string
          format: uuid
          description: Species ID (foreign key to Species service)
        birthDate:
          type: string
          format: date-time
          description: In-game birth timestamp
        deathDate:
          type: string
          format: date-time
          nullable: true
          description: In-game death timestamp
        status:
          allOf:
          - $ref: '#/components/schemas/CharacterStatus'
          description: Current lifecycle status of the character
        createdAt:
          type: string
          format: date-time
          description: Real-world creation timestamp
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: Real-world last update timestamp
        familyTree:
          $ref: '#/components/schemas/FamilyTreeResponse'
          nullable: true
          description: Family relationships (included if includeFamilyTree=true)
    FamilyTreeResponse:
      description: Family relationships for a character
      type: object
      additionalProperties: false
      required:
      - parents
      - children
      - siblings
      - spouses
      - pastLives
      properties:
        parents:
          type: array
          items:
            $ref: '#/components/schemas/FamilyMember'
          description: Parent relationships (biological and adoptive)
        children:
          type: array
          items:
            $ref: '#/components/schemas/FamilyMember'
          description: Child relationships
        siblings:
          type: array
          items:
            $ref: '#/components/schemas/FamilyMember'
          description: Sibling relationships (including half-siblings)
        spouses:
          type: array
          items:
            $ref: '#/components/schemas/FamilyMember'
          description: Spousal relationships (spouse, husband, wife)
        pastLives:
          type: array
          items:
            $ref: '#/components/schemas/PastLifeReference'
          description: Previous incarnations (if reincarnation tracked)
    FamilyMember:
      description: Reference to a family member
      type: object
      additionalProperties: false
      required:
      - characterId
      - relationshipType
      - isAlive
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the related character
        name:
          type: string
          nullable: true
          description: Display name (if available)
        relationshipType:
          type: string
          description: Specific relationship type (MOTHER, FATHER, SON, DAUGHTER, etc.)
        isAlive:
          type: boolean
          description: Whether the related character is alive
    PastLifeReference:
      description: Reference to a past incarnation
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the previous incarnation
        name:
          type: string
          nullable: true
          description: Display name of the past life
        deathDate:
          type: string
          format: date-time
          nullable: true
          description: When the past life ended
    CompressCharacterRequest:
      description: Request to compress a dead character for archival
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the dead character to compress
        deleteSourceData:
          type: boolean
          default: false
          description: |
            If true, delete personality/backstory data after compression.
            The archive becomes the only record of this information.
    GetCharacterArchiveRequest:
      description: Request to retrieve a character's compressed archive
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to get archive for
    CheckReferencesRequest:
      description: Request to check reference count for a character
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to check references for
    CharacterArchive:
      description: |
        Compressed archive of a dead character.
        Contains text summaries instead of structured data for long-term storage.
        Self-contained with no external references (suitable for cleanup).
      type: object
      additionalProperties: false
      required:
      - characterId
      - name
      - realmId
      - speciesId
      - birthDate
      - deathDate
      - compressedAt
      properties:
        characterId:
          type: string
          format: uuid
          description: Original character ID
        name:
          type: string
          description: Character display name
        realmId:
          type: string
          format: uuid
          description: Realm the character belonged to
        speciesId:
          type: string
          format: uuid
          description: Character's species
        birthDate:
          type: string
          format: date-time
          description: In-game birth date
        deathDate:
          type: string
          format: date-time
          description: In-game death date
        compressedAt:
          type: string
          format: date-time
          description: When this archive was created
        personalitySummary:
          type: string
          nullable: true
          description: |
            Text summary of personality traits.
            Example: "Brave and loyal, somewhat hot-tempered with a strong sense of justice"
        keyBackstoryPoints:
          type: array
          nullable: true
          items:
            type: string
          description: |
            Key backstory elements as text. Null when compression did not include backstory data.
            Example: ["Trained by the Knights Guild", "Born in the Northlands"]
        majorLifeEvents:
          type: array
          nullable: true
          items:
            type: string
          description: |
            Significant life events as text. Null when compression did not include history data.
            Example: ["Fought in the Battle of Stormgate (Hero)", "Survived the Great Flood"]
        familySummary:
          type: string
          nullable: true
          description: |
            Text summary of family relationships.
            Example: "Father of 3, married to Elena, orphaned at young age"
    CharacterRefCount:
      description: Reference count information for cleanup eligibility
      type: object
      additionalProperties: false
      required:
      - characterId
      - referenceCount
      - referenceTypes
      - isCompressed
      - isEligibleForCleanup
      properties:
        characterId:
          type: string
          format: uuid
          description: Character ID
        referenceCount:
          type: integer
          description: Number of active references to this character
        referenceTypes:
          type: array
          items:
            type: string
          description: >
            Types of references found. L2 sources use constants (RELATIONSHIP, CONTRACT).
            L4 sources are reported by lib-resource using their registered source type strings
            (e.g., actor, encounter).
        isCompressed:
          type: boolean
          description: Whether the character has been compressed
        isEligibleForCleanup:
          type: boolean
          description: |
            True if compressed, refCount=0, and grace period has passed.
            Safe to permanently delete if true.
        zeroRefSince:
          type: string
          format: date-time
          nullable: true
          description: When refCount first reached zero (null if refCount > 0)
    GetCompressDataRequest:
      description: Request to get character data for compression
      type: object
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to get compress data for
    CharacterBaseArchive:
      type: object
      x-archive-type: true
      description: |
        Core character data for archive storage and storyline SDK consumption.
        Inherits base archive properties from ResourceArchiveBase.
        The characterId field equals resourceId for convenience.

        Note: This is distinct from CharacterArchive which contains text summaries
        for cleanup. CharacterBaseArchive contains structured data for SDK consumption.
      allOf:
      - $ref: './common-api.yaml#/components/schemas/ResourceArchiveBase'
      additionalProperties: false
      required:
      - characterId
      - name
      - realmId
      - speciesId
      - birthDate
      - deathDate
      - status
      - createdAt
      properties:
        characterId:
          type: string
          format: uuid
          description: Unique identifier for the character (equals resourceId)
        name:
          type: string
          description: Display name of the character
        realmId:
          type: string
          format: uuid
          description: Realm ID (partition key)
        speciesId:
          type: string
          format: uuid
          description: Species ID (foreign key to Species service)
        birthDate:
          type: string
          format: date-time
          description: In-game birth timestamp
        deathDate:
          type: string
          format: date-time
          description: In-game death timestamp (required for compression)
        status:
          allOf:
          - $ref: '#/components/schemas/CharacterStatus'
          description: Current lifecycle status (must be dead for compression)
        familySummary:
          type: string
          nullable: true
          description: |
            Text summary of family relationships.
            Example: "Father of 3, married to Elena, orphaned at young age"
        createdAt:
          type: string
          format: date-time
          description: Real-world creation timestamp
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: Real-world last update timestamp
