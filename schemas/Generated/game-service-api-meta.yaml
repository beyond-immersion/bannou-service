openapi: 3.0.0
info:
  title: Bannou Game Service API
  description: |
    Registry service for game services that users can subscribe to.
    Provides a minimal registry of available services (games/applications).

    **POST-Only API Pattern**: This API uses POST for all operations to support zero-copy
    WebSocket routing. Path parameters are passed in request bodies instead of URLs.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    **Schema Rules**: AI agents MUST review docs/reference/SCHEMA-RULES.md before modifying this schema. Optional reference types require `nullable: true`.
  version: 1.0.0
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)
paths:
  /game-service/services/list:
    post:
      summary: List all registered game services
      description: Returns all game services, optionally filtered by active status.
      operationId: listServices
      tags:
      - Game Service Registry
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListServicesRequest'
      responses:
        '200':
          description: Services retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListServicesResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListServicesRequest\"\
        ,\n    \"$defs\": {\n        \"ListServicesRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to list all game services\",\n            \"properties\": {\n   \
        \             \"activeOnly\": {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n\
        \                    \"description\": \"If true, only return active services\"\n                }\n            }\n\
        \        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListServicesResponse\"\
        ,\n    \"$defs\": {\n        \"ListServicesResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Response containing list of game services\",\n            \"required\": [\n\
        \                \"services\",\n                \"totalCount\"\n            ],\n            \"properties\": {\n  \
        \              \"services\": {\n                    \"type\": \"array\",\n                    \"description\": \"\
        List of game services matching the request criteria\",\n                    \"items\": {\n                       \
        \ \"$ref\": \"#/$defs/ServiceInfo\"\n                    }\n                },\n                \"totalCount\": {\n\
        \                    \"type\": \"integer\",\n                    \"description\": \"Total number of services matching
        the filter\"\n                }\n            }\n        },\n        \"ServiceInfo\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Information about a game service\"\
        ,\n            \"required\": [\n                \"serviceId\",\n                \"stubName\",\n                \"\
        displayName\",\n                \"isActive\",\n                \"createdAt\"\n            ],\n            \"properties\"\
        : {\n                \"serviceId\": {\n                    \"type\": \"string\",\n                    \"format\":
        \"uuid\",\n                    \"description\": \"Unique identifier for the service\"\n                },\n      \
        \          \"stubName\": {\n                    \"type\": \"string\",\n                    \"description\": \"URL-safe
        identifier (e.g., \\\"my-game\\\")\"\n                },\n                \"displayName\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"Human-readable name (e.g., \\\"My Game Online\\\"\
        )\"\n                },\n                \"description\": {\n                    \"type\": \"string\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional description\"\n                },\n\
        \                \"isActive\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether the service is currently active\"\n                },\n                \"createdAt\": {\n            \
        \        \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When the service was created\"\n                },\n                \"updatedAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n         \
        \           \"description\": \"When the service was last updated\"\n                }\n            }\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List all registered game services\",\n    \"description\": \"Returns all
        game services, optionally filtered by active status.\",\n    \"tags\": [\n        \"Game Service Registry\"\n    ],\n\
        \    \"deprecated\": false,\n    \"operationId\": \"listServices\"\n}"
  /game-service/services/get:
    post:
      summary: Get service by ID or stub name
      description: Retrieves a single service by either serviceId (GUID) or stubName.
      operationId: getService
      tags:
      - Game Service Registry
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetServiceRequest'
      responses:
        '200':
          description: Service retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceInfo'
        '404':
          description: Service not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetServiceRequest\"\
        ,\n    \"$defs\": {\n        \"GetServiceRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to get a service by ID or stub name (provide either one)\",\n   \
        \         \"properties\": {\n                \"serviceId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"ID of the service to retrieve (null if using stubName)\"\n                },\n                \"stubName\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Stub name of the service to retrieve (null if using serviceId)\"\n                }\n            }\n        }\n\
        \    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceInfo\"\
        ,\n    \"$defs\": {\n        \"ServiceInfo\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Information about a game service\",\n            \"required\": [\n      \
        \          \"serviceId\",\n                \"stubName\",\n                \"displayName\",\n                \"isActive\"\
        ,\n                \"createdAt\"\n            ],\n            \"properties\": {\n                \"serviceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Unique identifier for the service\"\n                },\n                \"stubName\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"URL-safe identifier (e.g., \\\"my-game\\\")\"\n  \
        \              },\n                \"displayName\": {\n                    \"type\": \"string\",\n               \
        \     \"description\": \"Human-readable name (e.g., \\\"My Game Online\\\")\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Optional description\"\n                },\n                \"isActive\": {\n  \
        \                  \"type\": \"boolean\",\n                    \"description\": \"Whether the service is currently
        active\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"date-time\",\n                    \"description\": \"When the service was created\"\n\
        \                },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n               \
        \     \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"\
        When the service was last updated\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get service by ID or stub name\",\n    \"description\": \"Retrieves a single
        service by either serviceId (GUID) or stubName.\",\n    \"tags\": [\n        \"Game Service Registry\"\n    ],\n \
        \   \"deprecated\": false,\n    \"operationId\": \"getService\"\n}"
  /game-service/services/create:
    post:
      summary: Create a new game service entry
      description: Admin-only endpoint to register a new game service in the registry.
      operationId: createService
      tags:
      - Game Service Registry
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateServiceRequest'
      responses:
        '200':
          description: Service created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceInfo'
        '400':
          description: Invalid service data
        '409':
          description: Service with stub_name already exists
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateServiceRequest\"\
        ,\n    \"$defs\": {\n        \"CreateServiceRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to create a new game service\",\n            \"required\": [\n  \
        \              \"stubName\",\n                \"displayName\"\n            ],\n            \"properties\": {\n   \
        \             \"stubName\": {\n                    \"type\": \"string\",\n                    \"pattern\": \"^[a-z0-9-]+$\"\
        ,\n                    \"minLength\": 2,\n                    \"maxLength\": 50,\n                    \"description\"\
        : \"URL-safe identifier for the service (e.g., \\\"my-game\\\", \\\"my-other-game\\\")\"\n                },\n   \
        \             \"displayName\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n\
        \                    \"maxLength\": 100,\n                    \"description\": \"Human-readable name for the service
        (e.g., \\\"My Game Online\\\")\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"maxLength\": 500,\n                \
        \    \"description\": \"Optional description of the service\"\n                },\n                \"isActive\": {\n\
        \                    \"type\": \"boolean\",\n                    \"default\": true,\n                    \"description\"\
        : \"Whether the service is currently active\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceInfo\"\
        ,\n    \"$defs\": {\n        \"ServiceInfo\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Information about a game service\",\n            \"required\": [\n      \
        \          \"serviceId\",\n                \"stubName\",\n                \"displayName\",\n                \"isActive\"\
        ,\n                \"createdAt\"\n            ],\n            \"properties\": {\n                \"serviceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Unique identifier for the service\"\n                },\n                \"stubName\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"URL-safe identifier (e.g., \\\"my-game\\\")\"\n  \
        \              },\n                \"displayName\": {\n                    \"type\": \"string\",\n               \
        \     \"description\": \"Human-readable name (e.g., \\\"My Game Online\\\")\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Optional description\"\n                },\n                \"isActive\": {\n  \
        \                  \"type\": \"boolean\",\n                    \"description\": \"Whether the service is currently
        active\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"date-time\",\n                    \"description\": \"When the service was created\"\n\
        \                },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n               \
        \     \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"\
        When the service was last updated\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Create a new game service entry\",\n    \"description\": \"Admin-only endpoint
        to register a new game service in the registry.\",\n    \"tags\": [\n        \"Game Service Registry\"\n    ],\n \
        \   \"deprecated\": false,\n    \"operationId\": \"createService\"\n}"
  /game-service/services/update:
    post:
      summary: Update a game service entry
      description: Admin-only endpoint to update an existing game service.
      operationId: updateService
      tags:
      - Game Service Registry
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateServiceRequest'
      responses:
        '200':
          description: Service updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceInfo'
        '404':
          description: Service not found
        '400':
          description: Invalid update data
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/UpdateServiceRequest\"\
        ,\n    \"$defs\": {\n        \"UpdateServiceRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to update an existing game service\",\n            \"required\":
        [\n                \"serviceId\"\n            ],\n            \"properties\": {\n                \"serviceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"ID of the service to update\"\n                },\n                \"displayName\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"maxLength\": 100,\n          \
        \          \"description\": \"New display name\"\n                },\n                \"description\": {\n       \
        \             \"type\": \"string\",\n                    \"nullable\": true,\n                    \"maxLength\": 500,\n\
        \                    \"description\": \"New description\"\n                },\n                \"isActive\": {\n \
        \                   \"type\": \"boolean\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"New active status\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ServiceInfo\"\
        ,\n    \"$defs\": {\n        \"ServiceInfo\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Information about a game service\",\n            \"required\": [\n      \
        \          \"serviceId\",\n                \"stubName\",\n                \"displayName\",\n                \"isActive\"\
        ,\n                \"createdAt\"\n            ],\n            \"properties\": {\n                \"serviceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Unique identifier for the service\"\n                },\n                \"stubName\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"URL-safe identifier (e.g., \\\"my-game\\\")\"\n  \
        \              },\n                \"displayName\": {\n                    \"type\": \"string\",\n               \
        \     \"description\": \"Human-readable name (e.g., \\\"My Game Online\\\")\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Optional description\"\n                },\n                \"isActive\": {\n  \
        \                  \"type\": \"boolean\",\n                    \"description\": \"Whether the service is currently
        active\"\n                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"date-time\",\n                    \"description\": \"When the service was created\"\n\
        \                },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n               \
        \     \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"\
        When the service was last updated\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Update a game service entry\",\n    \"description\": \"Admin-only endpoint
        to update an existing game service.\",\n    \"tags\": [\n        \"Game Service Registry\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"updateService\"\n}"
  /game-service/services/delete:
    post:
      summary: Delete a game service entry
      description: Admin-only endpoint to remove a game service from the registry.
      operationId: deleteService
      tags:
      - Game Service Registry
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteServiceRequest'
      responses:
        '200':
          description: Service deleted successfully
        '404':
          description: Service not found
        '409':
          description: Service cannot be deleted (active subscriptions exist)
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeleteServiceRequest\"\
        ,\n    \"$defs\": {\n        \"DeleteServiceRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to delete a game service\",\n            \"required\": [\n      \
        \          \"serviceId\"\n            ],\n            \"properties\": {\n                \"serviceId\": {\n      \
        \              \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"ID of the service to delete\"\n                },\n                \"reason\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Optional reason for
        deletion (included in the lifecycle event)\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n    \"summary\": \"Delete a game service entry\",\n    \"description\": \"Admin-only endpoint
        to remove a game service from the registry.\",\n    \"tags\": [\n        \"Game Service Registry\"\n    ],\n    \"\
        deprecated\": false,\n    \"operationId\": \"deleteService\"\n}"
components:
  schemas:
    ListServicesRequest:
      type: object
      additionalProperties: false
      description: Request to list all game services
      properties:
        activeOnly:
          type: boolean
          default: false
          description: If true, only return active services
    GetServiceRequest:
      type: object
      additionalProperties: false
      description: Request to get a service by ID or stub name (provide either one)
      properties:
        serviceId:
          type: string
          format: uuid
          nullable: true
          description: ID of the service to retrieve (null if using stubName)
        stubName:
          type: string
          nullable: true
          description: Stub name of the service to retrieve (null if using serviceId)
    CreateServiceRequest:
      type: object
      additionalProperties: false
      description: Request to create a new game service
      required:
      - stubName
      - displayName
      properties:
        stubName:
          type: string
          pattern: '^[a-z0-9-]+$'
          minLength: 2
          maxLength: 50
          description: URL-safe identifier for the service (e.g., "my-game", "my-other-game")
        displayName:
          type: string
          minLength: 1
          maxLength: 100
          description: Human-readable name for the service (e.g., "My Game Online")
        description:
          type: string
          nullable: true
          maxLength: 500
          description: Optional description of the service
        isActive:
          type: boolean
          default: true
          description: Whether the service is currently active
    UpdateServiceRequest:
      type: object
      additionalProperties: false
      description: Request to update an existing game service
      required:
      - serviceId
      properties:
        serviceId:
          type: string
          format: uuid
          description: ID of the service to update
        displayName:
          type: string
          nullable: true
          maxLength: 100
          description: New display name
        description:
          type: string
          nullable: true
          maxLength: 500
          description: New description
        isActive:
          type: boolean
          nullable: true
          description: New active status
    DeleteServiceRequest:
      type: object
      additionalProperties: false
      description: Request to delete a game service
      required:
      - serviceId
      properties:
        serviceId:
          type: string
          format: uuid
          description: ID of the service to delete
        reason:
          type: string
          nullable: true
          description: Optional reason for deletion (included in the lifecycle event)
    ServiceInfo:
      type: object
      additionalProperties: false
      description: Information about a game service
      required:
      - serviceId
      - stubName
      - displayName
      - isActive
      - createdAt
      properties:
        serviceId:
          type: string
          format: uuid
          description: Unique identifier for the service
        stubName:
          type: string
          description: URL-safe identifier (e.g., "my-game")
        displayName:
          type: string
          description: Human-readable name (e.g., "My Game Online")
        description:
          type: string
          nullable: true
          description: Optional description
        isActive:
          type: boolean
          description: Whether the service is currently active
        createdAt:
          type: string
          format: date-time
          description: When the service was created
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: When the service was last updated
    ListServicesResponse:
      type: object
      additionalProperties: false
      description: Response containing list of game services
      required:
      - services
      - totalCount
      properties:
        services:
          type: array
          description: List of game services matching the request criteria
          items:
            $ref: '#/components/schemas/ServiceInfo'
        totalCount:
          type: integer
          description: Total number of services matching the filter
