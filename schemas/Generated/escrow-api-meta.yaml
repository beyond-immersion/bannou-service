openapi: 3.0.0
info:
  title: Escrow Service API
  version: 1.0.0
  description: |
    Full-custody orchestration layer for multi-party asset exchanges.

    lib-escrow sits ABOVE the foundational asset plugins (lib-currency, lib-inventory,
    lib-contract). It creates its own wallets, containers, and contract locks to take
    complete possession of assets during multi-party agreements.

    **Key Design Principle**: The contract is the brain, escrow is the vault. The bound
    contract defines what assets are needed, how they should be distributed, and what
    fees apply. The escrow holds assets and gates access.

    **Per-Party Infrastructure**: Each party gets their own dedicated escrow wallet and
    container (owned by the escrow entity). This enables clean refunds, contribution
    tracking, and ownership validation.

    **POST-Only API Pattern**: This API uses POST for all operations to support
    zero-copy WebSocket routing. Path parameters are passed in request bodies.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)
paths:
  /escrow/create:
    post:
      operationId: createEscrow
      tags:
      - Lifecycle
      summary: Create a new escrow agreement
      description: |
        Create a new escrow agreement. For each party, creates a dedicated escrow wallet
        and container (owned by escrow entity). Issues deposit tokens and returns ALL
        tokens to the creating service, which is responsible for distributing them to
        parties through appropriate channels. Sets template values on bound contract.
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEscrowRequest'
      responses:
        '200':
          description: Escrow created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateEscrowResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateEscrowRequest\"\
        ,\n    \"$defs\": {\n        \"CreateEscrowRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to create a new escrow agreement\",\n            \"required\": [\n                \"escrowType\",\n  \
        \              \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n             \
        \   \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"escrowType\": {\n       \
        \             \"$ref\": \"#/$defs/EscrowType\",\n                    \"description\": \"Type of escrow agreement\"\
        \n                },\n                \"trustMode\": {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\"\
        ,\n                    \"description\": \"Trust mode for the escrow\"\n                },\n                \"trustedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For single_party_trusted mode\"\n                },\n  \
        \              \"trustedPartyType\": {\n                    \"allOf\": [\n                        {\n            \
        \                \"type\": \"object\"\n                        }\n                    ],\n                    \"nullable\"\
        : true,\n                    \"description\": \"Type of the trusted party\"\n                },\n                \"\
        parties\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                       \
        \ \"$ref\": \"#/$defs/CreateEscrowPartyInput\"\n                    },\n                    \"description\": \"Parties
        in the escrow\"\n                },\n                \"expectedDeposits\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDepositInput\"\n        \
        \            },\n                    \"description\": \"Expected deposits from parties\"\n                },\n   \
        \             \"releaseAllocations\": {\n                    \"type\": \"array\",\n                    \"nullable\"\
        : true,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ReleaseAllocationInput\"\n\
        \                    },\n                    \"description\": \"Optional explicit release allocations\"\n        \
        \        },\n                \"boundContractId\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Contract
        governing this escrow\"\n                },\n                \"requiredConsentsForRelease\": {\n                 \
        \   \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Number
        of consents required (-1 for all)\"\n                },\n                \"expiresAt\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Optional expiration time\"\n                },\n                \"referenceType\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Reference type (trade, auction, etc.)\"\n                },\n                \"referenceId\": {\n            \
        \        \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Reference entity ID\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Human-readable description\"\n                },\n                \"metadata\": {\n                    \"type\"\
        : \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n    \
        \                \"description\": \"Application metadata\"\n                },\n                \"releaseMode\": {\n\
        \                    \"allOf\": [\n                        {\n                            \"$ref\": \"#/$defs/ReleaseMode\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"How release confirmation is handled. Defaults to service_only if not specified.\\nOnly applies
        to unbound escrows; contract-bound escrows follow contract fulfillment.\\n\"\n                },\n               \
        \ \"refundMode\": {\n                    \"allOf\": [\n                        {\n                            \"$ref\"\
        : \"#/$defs/RefundMode\"\n                        }\n                    ],\n                    \"nullable\": true,\n\
        \                    \"description\": \"How refund confirmation is handled. Defaults to immediate if not specified.\"\
        \n                },\n                \"idempotencyKey\": {\n                    \"type\": \"string\",\n         \
        \           \"description\": \"Idempotency key for this operation\"\n                }\n            }\n        },\n\
        \        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow agreement.\\
        n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex deposit/receive
        rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all with
        refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"CreateEscrowPartyInput\": {\n            \"type\": \"object\",\n          \
        \  \"description\": \"Input for defining a party in escrow creation\",\n            \"required\": [\n            \
        \    \"partyId\",\n                \"partyType\",\n                \"role\"\n            ],\n            \"properties\"\
        : {\n                \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"description\": \"Party entity ID\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\"\
        : \"object\"\n                },\n                \"displayName\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Display name\"\n                },\n\
        \                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                    \"description\"\
        : \"Role of this party in the escrow\"\n                },\n                \"consentRequired\": {\n             \
        \       \"type\": \"boolean\",\n                    \"nullable\": true,\n                    \"description\": \"Whether
        consent is required (defaults based on role)\"\n                },\n                \"walletId\": {\n            \
        \        \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Party wallet for currency operations\"\n                },\n             \
        \   \"containerId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n   \
        \                 \"nullable\": true,\n                    \"description\": \"Party container for item operations\"\
        \n                }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n\
        \            \"description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient:
        Receives assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter:
        Can resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n           \
        \ \"enum\": [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\"\
        ,\n                \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDepositInput\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Input for defining expected deposits from a
        party\",\n            \"required\": [\n                \"partyId\",\n                \"partyType\",\n            \
        \    \"expectedAssets\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party who should deposit\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of depositing party\",\n                    \"type\": \"object\"\n                },\n                \"\
        expectedAssets\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                \
        \        \"$ref\": \"#/$defs/EscrowAssetInput\"\n                    },\n                    \"description\": \"Expected
        assets\"\n                },\n                \"optional\": {\n                    \"type\": \"boolean\",\n      \
        \              \"nullable\": true,\n                    \"description\": \"Is this deposit optional\"\n          \
        \      },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n                   \
        \ \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"Specific
        deadline for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetInput\": {\n     \
        \       \"type\": \"object\",\n            \"description\": \"Input for specifying an asset in escrow operations\"\
        ,\n            \"required\": [\n                \"assetType\"\n            ],\n            \"properties\": {\n   \
        \             \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"description\"\
        : \"Type of asset to deposit\"\n                },\n                \"currencyDefinitionId\": {\n                \
        \    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n \
        \                   \"description\": \"Currency definition ID\"\n                },\n                \"currencyCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Currency code\"\n                },\n                \"currencyAmount\": {\n                    \"type\": \"number\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Currency amount\"\n           \
        \     },\n                \"itemInstanceId\": {\n                    \"type\": \"string\",\n                    \"\
        format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Item instance
        ID\"\n                },\n                \"itemName\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Item name\"\n                },\n          \
        \      \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Item template ID (for stacks)\"\
        \n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\",\n       \
        \             \"nullable\": true,\n                    \"description\": \"Item template name\"\n                },\n\
        \                \"itemQuantity\": {\n                    \"type\": \"integer\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Item quantity (for stacks)\"\n                },\n               \
        \ \"contractInstanceId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Contract instance ID\"\n        \
        \        },\n                \"contractTemplateCode\": {\n                    \"type\": \"string\",\n            \
        \        \"nullable\": true,\n                    \"description\": \"Contract template code\"\n                },\n\
        \                \"contractDescription\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Contract description\"\n                },\n                \"contractPartyRole\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract party role being escrowed\"\n                },\n                \"customAssetType\": {\n           \
        \         \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Custom asset type\"\n                },\n                \"customAssetId\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Custom asset ID\"\n           \
        \     },\n                \"customAssetData\": {\n                    \"type\": \"object\",\n                    \"\
        nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\": \"Custom
        asset data\"\n                }\n            }\n        },\n        \"AssetType\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount held in escrow wallet\\
        n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity) held in escrow container\\
        n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset type via registered handler\\\
        n\",\n            \"enum\": [\n                \"currency\",\n                \"item\",\n                \"item_stack\"\
        ,\n                \"contract\",\n                \"custom\"\n            ]\n        },\n        \"ReleaseAllocationInput\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Input for specifying how assets should be allocated
        on release\",\n            \"required\": [\n                \"recipientPartyId\",\n                \"recipientPartyType\"\
        ,\n                \"assets\"\n            ],\n            \"properties\": {\n                \"recipientPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Recipient party ID\"\n                },\n                \"recipientPartyType\": {\n           \
        \         \"type\": \"object\",\n                    \"description\": \"Recipient party type\"\n                },\n\
        \                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\": {\n     \
        \                   \"$ref\": \"#/$defs/EscrowAssetInput\"\n                    },\n                    \"description\"\
        : \"Assets to allocate\"\n                },\n                \"destinationWalletId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Destination wallet\"\n                },\n                \"destinationContainerId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Destination container\"\n                }\n            }\n      \
        \  },\n        \"ReleaseMode\": {\n            \"type\": \"string\",\n            \"description\": \"Controls how
        release confirmation is handled:\\n- immediate: Finalizing \\u2192 Released (skip Releasing state entirely).\\n  \\
        u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios (NPC vendors, system rewards).\\n  Assets are marked
        as released BEFORE downstream services confirm transfers.\\n  If downstream services fail, manual intervention may
        be required.\\n- service_only: Wait for downstream services (currency, inventory) to confirm transfers complete.\\
        n- party_required: Wait for all parties to call /confirm-release.\\n- service_and_party: Wait for both service completion
        AND party confirmation.\\n\",\n            \"enum\": [\n                \"immediate\",\n                \"service_only\"\
        ,\n                \"party_required\",\n                \"service_and_party\"\n            ]\n        },\n       \
        \ \"RefundMode\": {\n            \"type\": \"string\",\n            \"description\": \"Controls how refund confirmation
        is handled. Same semantics as ReleaseMode.\\nRefunds typically use 'immediate' since parties get their own assets
        back.\\n\",\n            \"enum\": [\n                \"immediate\",\n                \"service_only\",\n        \
        \        \"party_required\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateEscrowResponse\"\
        ,\n    \"$defs\": {\n        \"CreateEscrowResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from creating an escrow agreement\",\n            \"required\": [\n                \"escrow\",\n    \
        \            \"depositTokens\"\n            ],\n            \"properties\": {\n                \"escrow\": {\n   \
        \                 \"$ref\": \"#/$defs/EscrowAgreement\",\n                    \"description\": \"Created escrow agreement\"\
        \n                },\n                \"depositTokens\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/PartyToken\"\n                    },\n       \
        \             \"description\": \"Deposit tokens for each party (full_consent mode)\"\n                }\n        \
        \    }\n        },\n        \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Main escrow agreement record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\"\
        ,\n                \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n         \
        \       \"deposits\",\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\"\
        ,\n                \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n          \
        \      \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        escrow agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\"\
        : \"#/$defs/EscrowType\",\n                    \"description\": \"Type of escrow agreement\"\n                },\n\
        \                \"trustMode\": {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                  \
        \  \"description\": \"Trust mode for the escrow\"\n                },\n                \"trustedPartyId\": {\n   \
        \                 \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For single_party_trusted - which party has authority\"\n         \
        \       },\n                \"trustedPartyType\": {\n                    \"allOf\": [\n                        {\n\
        \                            \"type\": \"object\"\n                        }\n                    ],\n           \
        \         \"nullable\": true,\n                    \"description\": \"Type of the trusted party\"\n              \
        \  },\n                \"initiatorServiceId\": {\n                    \"type\": \"string\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For initiator_trusted - which service created this\"\n \
        \               },\n                \"parties\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\n                    },\n              \
        \      \"description\": \"All parties involved in the escrow\"\n                },\n                \"expectedDeposits\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/ExpectedDeposit\"\n                    },\n                    \"description\": \"What deposits are expected
        from each party\"\n                },\n                \"deposits\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowDeposit\"\n                 \
        \   },\n                    \"description\": \"Actual deposits received\"\n                },\n                \"\
        releaseAllocations\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n     \
        \               \"items\": {\n                        \"$ref\": \"#/$defs/ReleaseAllocation\"\n                  \
        \  },\n                    \"description\": \"How assets should be distributed on release\"\n                },\n\
        \                \"boundContractId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Contract governing conditions
        for this escrow\"\n                },\n                \"consents\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\n                 \
        \   },\n                    \"description\": \"Consent decisions from parties\"\n                },\n            \
        \    \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                    \"description\":
        \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\": {\n               \
        \     \"type\": \"integer\",\n                    \"description\": \"How many parties must consent for release (-1
        = all required)\"\n                },\n                \"lastValidatedAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"When the escrow was last validated\"\n                },\n                \"validationFailures\"\
        : {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n                    },\n                   \
        \ \"description\": \"Any validation failures detected\"\n                },\n                \"createdAt\": {\n  \
        \                  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When the escrow was created\"\n                },\n                \"createdBy\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Who created the escrow\"\
        \n                },\n                \"createdByType\": {\n                    \"type\": \"object\",\n          \
        \          \"description\": \"Type of the creator entity\"\n                },\n                \"fundedAt\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"\
        nullable\": true,\n                    \"description\": \"When all expected deposits were received\"\n           \
        \     },\n                \"expiresAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"description\": \"Auto-refund if not completed by this time\"\n           \
        \     },\n                \"completedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When the escrow
        reached terminal state\"\n                },\n                \"referenceType\": {\n                    \"type\":
        \"string\",\n                    \"nullable\": true,\n                    \"description\": \"What this escrow is for
        (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n        \
        \            \"description\": \"ID of the referenced entity\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Human-readable description\"\n                },\n                \"metadata\": {\n                    \"type\"\
        : \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n    \
        \                \"description\": \"Game/application specific metadata\"\n                },\n                \"resolution\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\": \"How the escrow
        was resolved\",\n                    \"nullable\": true\n                },\n                \"resolutionNotes\":
        {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Notes about the resolution\"\n                },\n                \"releaseMode\": {\n                    \"$ref\"\
        : \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation is handled for this escrow.\"\
        \n                },\n                \"refundMode\": {\n                    \"$ref\": \"#/$defs/RefundMode\",\n \
        \                   \"description\": \"How refund confirmation is handled for this escrow.\"\n                },\n\
        \                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"Deadline for party
        confirmations when in Releasing/Refunding state.\"\n                }\n            }\n        },\n        \"EscrowType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow agreement.\\n- two_party: Simple
        trade escrow between Party A and Party B\\n- multi_party: N parties with complex deposit/receive rules\\n- conditional:
        Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all with refunds to losers\\\
        n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\",\n                \"\
        conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\": {\n         \
        \   \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        },\n\
        \        \"PartyToken\": {\n            \"type\": \"object\",\n            \"description\": \"Token issued to a party
        for deposit or release operations\",\n            \"required\": [\n                \"partyId\",\n                \"\
        partyType\",\n                \"token\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party ID\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"token\": {\n                    \"type\": \"string\",\n                    \"description\": \"The
        token\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Create a new escrow agreement\",\n    \"description\": \"Create a new escrow
        agreement. For each party, creates a dedicated escrow wallet\\nand container (owned by escrow entity). Issues deposit
        tokens and returns ALL\\ntokens to the creating service, which is responsible for distributing them to\\nparties through
        appropriate channels. Sets template values on bound contract.\\n\",\n    \"tags\": [\n        \"Lifecycle\"\n    ],\n\
        \    \"deprecated\": false,\n    \"operationId\": \"createEscrow\"\n}"
  /escrow/get:
    post:
      operationId: getEscrow
      tags:
      - Lifecycle
      summary: Get escrow details
      description: Get escrow agreement details by ID.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetEscrowRequest'
      responses:
        '200':
          description: Escrow details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetEscrowResponse'
        '404':
          description: Escrow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetEscrowRequest\"\
        ,\n    \"$defs\": {\n        \"GetEscrowRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to retrieve an escrow agreement by ID\",\n            \"required\": [\n                \"escrowId\"\n\
        \            ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow ID to retrieve\"\
        \n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetEscrowResponse\"\
        ,\n    \"$defs\": {\n        \"GetEscrowResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response containing escrow agreement details\",\n            \"required\": [\n                \"escrow\"\n   \
        \         ],\n            \"properties\": {\n                \"escrow\": {\n                    \"$ref\": \"#/$defs/EscrowAgreement\"\
        ,\n                    \"description\": \"Escrow agreement details\"\n                }\n            }\n        },\n\
        \        \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow agreement
        record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n               \
        \ \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"deposits\"\
        ,\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\",\n \
        \               \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n             \
        \   \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique escrow
        agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\"\
        ,\n                    \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode
        for the escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get escrow details\",\n    \"description\": \"Get escrow agreement details
        by ID.\",\n    \"tags\": [\n        \"Lifecycle\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"getEscrow\"\
        \n}"
  /escrow/list:
    post:
      operationId: listEscrows
      tags:
      - Lifecycle
      summary: List escrows for a party
      description: List escrow agreements with filtering options.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListEscrowsRequest'
      responses:
        '200':
          description: List of escrows
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListEscrowsResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListEscrowsRequest\"\
        ,\n    \"$defs\": {\n        \"ListEscrowsRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to list escrow agreements with optional filters\",\n            \"properties\": {\n                \"\
        partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Filter by party\"\n                },\n      \
        \          \"partyType\": {\n                    \"allOf\": [\n                        {\n                       \
        \     \"type\": \"object\"\n                        }\n                    ],\n                    \"nullable\": true,\n\
        \                    \"description\": \"Party type filter\"\n                },\n                \"status\": {\n \
        \                   \"type\": \"array\",\n                    \"nullable\": true,\n                    \"items\":
        {\n                        \"$ref\": \"#/$defs/EscrowStatus\"\n                    },\n                    \"description\"\
        : \"Filter by status\"\n                },\n                \"referenceType\": {\n                    \"type\": \"\
        string\",\n                    \"nullable\": true,\n                    \"description\": \"Filter by reference type\"\
        \n                },\n                \"referenceId\": {\n                    \"type\": \"string\",\n            \
        \        \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Filter
        by reference ID\"\n                },\n                \"fromDate\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Filter from date\"\n                },\n                \"toDate\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"Filter to date\"\n                },\n                \"limit\": {\n                    \"type\"\
        : \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Limit results\"\n\
        \                },\n                \"offset\": {\n                    \"type\": \"integer\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"Offset for pagination\"\n                }\n     \
        \       }\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties to deposit\\n- partially_funded:
        Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\n- pending_consent:
        Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment or external verification\\
        n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release in progress (transient)\\
        n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\n- refunded: Assets returned
        to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without completion\\n- cancelled:
        Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\n\",\n    \
        \        \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n             \
        \   \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n                \"\
        finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\",\n   \
        \             \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"cancelled\"\
        ,\n                \"validation_failed\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListEscrowsResponse\"\
        ,\n    \"$defs\": {\n        \"ListEscrowsResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response containing list of escrow agreements\",\n            \"required\": [\n                \"escrows\",\n\
        \                \"totalCount\"\n            ],\n            \"properties\": {\n                \"escrows\": {\n \
        \                   \"type\": \"array\",\n                    \"description\": \"List of escrow agreements matching
        the query\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAgreement\"\n  \
        \                  }\n                },\n                \"totalCount\": {\n                    \"type\": \"integer\"\
        ,\n                    \"description\": \"Total count for pagination\"\n                }\n            }\n       \
        \ },\n        \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow
        agreement record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n     \
        \           \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"\
        deposits\",\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\"\
        ,\n                \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n          \
        \      \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        escrow agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\"\
        : \"#/$defs/EscrowType\",\n                    \"description\": \"Type of escrow agreement\"\n                },\n\
        \                \"trustMode\": {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                  \
        \  \"description\": \"Trust mode for the escrow\"\n                },\n                \"trustedPartyId\": {\n   \
        \                 \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For single_party_trusted - which party has authority\"\n         \
        \       },\n                \"trustedPartyType\": {\n                    \"allOf\": [\n                        {\n\
        \                            \"type\": \"object\"\n                        }\n                    ],\n           \
        \         \"nullable\": true,\n                    \"description\": \"Type of the trusted party\"\n              \
        \  },\n                \"initiatorServiceId\": {\n                    \"type\": \"string\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For initiator_trusted - which service created this\"\n \
        \               },\n                \"parties\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\n                    },\n              \
        \      \"description\": \"All parties involved in the escrow\"\n                },\n                \"expectedDeposits\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/ExpectedDeposit\"\n                    },\n                    \"description\": \"What deposits are expected
        from each party\"\n                },\n                \"deposits\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowDeposit\"\n                 \
        \   },\n                    \"description\": \"Actual deposits received\"\n                },\n                \"\
        releaseAllocations\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n     \
        \               \"items\": {\n                        \"$ref\": \"#/$defs/ReleaseAllocation\"\n                  \
        \  },\n                    \"description\": \"How assets should be distributed on release\"\n                },\n\
        \                \"boundContractId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Contract governing conditions
        for this escrow\"\n                },\n                \"consents\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\n                 \
        \   },\n                    \"description\": \"Consent decisions from parties\"\n                },\n            \
        \    \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                    \"description\":
        \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\": {\n               \
        \     \"type\": \"integer\",\n                    \"description\": \"How many parties must consent for release (-1
        = all required)\"\n                },\n                \"lastValidatedAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"When the escrow was last validated\"\n                },\n                \"validationFailures\"\
        : {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n                    },\n                   \
        \ \"description\": \"Any validation failures detected\"\n                },\n                \"createdAt\": {\n  \
        \                  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When the escrow was created\"\n                },\n                \"createdBy\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Who created the escrow\"\
        \n                },\n                \"createdByType\": {\n                    \"type\": \"object\",\n          \
        \          \"description\": \"Type of the creator entity\"\n                },\n                \"fundedAt\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"\
        nullable\": true,\n                    \"description\": \"When all expected deposits were received\"\n           \
        \     },\n                \"expiresAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"description\": \"Auto-refund if not completed by this time\"\n           \
        \     },\n                \"completedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When the escrow
        reached terminal state\"\n                },\n                \"referenceType\": {\n                    \"type\":
        \"string\",\n                    \"nullable\": true,\n                    \"description\": \"What this escrow is for
        (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n        \
        \            \"description\": \"ID of the referenced entity\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Human-readable description\"\n                },\n                \"metadata\": {\n                    \"type\"\
        : \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n    \
        \                \"description\": \"Game/application specific metadata\"\n                },\n                \"resolution\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\": \"How the escrow
        was resolved\",\n                    \"nullable\": true\n                },\n                \"resolutionNotes\":
        {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Notes about the resolution\"\n                },\n                \"releaseMode\": {\n                    \"$ref\"\
        : \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation is handled for this escrow.\"\
        \n                },\n                \"refundMode\": {\n                    \"$ref\": \"#/$defs/RefundMode\",\n \
        \                   \"description\": \"How refund confirmation is handled for this escrow.\"\n                },\n\
        \                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"Deadline for party
        confirmations when in Releasing/Refunding state.\"\n                }\n            }\n        },\n        \"EscrowType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow agreement.\\n- two_party: Simple
        trade escrow between Party A and Party B\\n- multi_party: N parties with complex deposit/receive rules\\n- conditional:
        Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all with refunds to losers\\\
        n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\",\n                \"\
        conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\": {\n         \
        \   \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List escrows for a party\",\n    \"description\": \"List escrow agreements
        with filtering options.\",\n    \"tags\": [\n        \"Lifecycle\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"listEscrows\"\n}"
  /escrow/get-my-token:
    post:
      operationId: getMyToken
      tags:
      - Lifecycle
      summary: Get deposit or release token for a party
      description: |
        Get the deposit or release token for a specific party. Internal-only endpoint
        accessed via Shortcut APIs (prebound). Direct user access is prohibited to prevent
        token snooping. The party is identified by ownerId/ownerType (works for characters,
        NPCs, guilds, etc.).
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetMyTokenRequest'
      responses:
        '200':
          description: Token information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetMyTokenResponse'
        '404':
          description: Escrow or party not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetMyTokenRequest\"\
        ,\n    \"$defs\": {\n        \"GetMyTokenRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to retrieve a party token for deposit or release\",\n            \"required\": [\n                \"escrowId\"\
        ,\n                \"ownerId\",\n                \"ownerType\",\n                \"tokenType\"\n            ],\n \
        \           \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"uuid\",\n                    \"description\": \"Escrow ID\"\n                },\n   \
        \             \"ownerId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party ID\"\n                },\n                \"ownerType\": {\n     \
        \               \"type\": \"object\",\n                    \"description\": \"Party type\"\n                },\n \
        \               \"tokenType\": {\n                    \"$ref\": \"#/$defs/TokenType\",\n                    \"description\"\
        : \"Type of token to retrieve\"\n                }\n            }\n        },\n        \"TokenType\": {\n        \
        \    \"type\": \"string\",\n            \"description\": \"Type of token being requested.\\n- deposit: Token for depositing
        assets\\n- release: Token for consenting to release\\n\",\n            \"enum\": [\n                \"deposit\",\n\
        \                \"release\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetMyTokenResponse\"\
        ,\n    \"$defs\": {\n        \"GetMyTokenResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response containing party token information\",\n            \"required\": [\n                \"tokenUsed\"\n \
        \           ],\n            \"properties\": {\n                \"token\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"The requested token (if available)\"\
        \n                },\n                \"tokenUsed\": {\n                    \"type\": \"boolean\",\n             \
        \       \"description\": \"Whether the token has been used\"\n                },\n                \"tokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the token was used\"\n                }\n   \
        \         }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get deposit or release token for a party\",\n    \"description\": \"Get
        the deposit or release token for a specific party. Internal-only endpoint\\naccessed via Shortcut APIs (prebound).
        Direct user access is prohibited to prevent\\ntoken snooping. The party is identified by ownerId/ownerType (works
        for characters,\\nNPCs, guilds, etc.).\\n\",\n    \"tags\": [\n        \"Lifecycle\"\n    ],\n    \"deprecated\":
        false,\n    \"operationId\": \"getMyToken\"\n}"
  /escrow/deposit:
    post:
      operationId: deposit
      tags:
      - Deposits
      summary: Deposit assets into escrow
      description: |
        Deposit assets into escrow. Transfers currency from party's own wallet to that
        party's escrow wallet. Moves items from party's own container to that party's
        escrow container. Locks contracts with escrow as guardian.
        Rejects soulbound/non-tradeable items. After each deposit, queries bound contract
        to check if all asset requirements are satisfied.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DepositRequest'
      responses:
        '200':
          description: Deposit successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DepositResponse'
        '400':
          description: Deposit failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DepositRequest\"\
        ,\n    \"$defs\": {\n        \"DepositRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to deposit assets into an escrow\",\n            \"required\": [\n                \"escrowId\",\n    \
        \            \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"idempotencyKey\"\
        \n            ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow ID\"\n       \
        \         },\n                \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"description\": \"Party depositing\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\"\
        : \"object\"\n                },\n                \"assets\": {\n                    \"$ref\": \"#/$defs/EscrowAssetBundleInput\"\
        ,\n                    \"description\": \"Assets to deposit\"\n                },\n                \"depositToken\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deposit token (required for full_consent)\"\n                },\n                \"idempotencyKey\": {\n     \
        \               \"type\": \"string\",\n                    \"description\": \"Idempotency key\"\n                }\n\
        \            }\n        },\n        \"EscrowAssetBundleInput\": {\n            \"type\": \"object\",\n           \
        \ \"description\": \"Input for specifying a bundle of assets\",\n            \"required\": [\n                \"assets\"\
        \n            ],\n            \"properties\": {\n                \"assets\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAssetInput\"\n            \
        \        },\n                    \"description\": \"Assets to deposit\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Bundle description\"\n                },\n                \"estimatedValue\": {\n                    \"type\"\
        : \"number\",\n                    \"nullable\": true,\n                    \"description\": \"Estimated value\"\n\
        \                }\n            }\n        },\n        \"EscrowAssetInput\": {\n            \"type\": \"object\",\n\
        \            \"description\": \"Input for specifying an asset in escrow operations\",\n            \"required\": [\n\
        \                \"assetType\"\n            ],\n            \"properties\": {\n                \"assetType\": {\n\
        \                    \"$ref\": \"#/$defs/AssetType\",\n                    \"description\": \"Type of asset to deposit\"\
        \n                },\n                \"currencyDefinitionId\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Currency definition ID\"\n                },\n                \"currencyCode\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Currency code\"\n \
        \               },\n                \"currencyAmount\": {\n                    \"type\": \"number\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Currency amount\"\n                },\n    \
        \            \"itemInstanceId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Item instance ID\"\n    \
        \            },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Item name\"\n                },\n                \"itemTemplateId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Item template ID (for stacks)\"\n                },\n  \
        \              \"itemTemplateName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Item template name\"\n                },\n                \"itemQuantity\"\
        : {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Item quantity (for stacks)\"\n                },\n                \"contractInstanceId\": {\n                \
        \    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n \
        \                   \"description\": \"Contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract template code\"\n                },\n                \"contractDescription\": {\n                   \
        \ \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Contract
        description\"\n                },\n                \"contractPartyRole\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Contract party role being escrowed\"\
        \n                },\n                \"customAssetType\": {\n                    \"type\": \"string\",\n        \
        \            \"nullable\": true,\n                    \"description\": \"Custom asset type\"\n                },\n\
        \                \"customAssetId\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Custom asset ID\"\n                },\n                \"customAssetData\"\
        : {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Custom asset data\"\n                }\n            }\n        },\n\
        \        \"AssetType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of asset held in
        escrow.\\n- currency: Currency amount held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack:
        Stackable items (quantity) held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\
        n- custom: Custom asset type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n\
        \                \"item\",\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\
        \n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DepositResponse\"\
        ,\n    \"$defs\": {\n        \"DepositResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from depositing assets into an escrow\",\n            \"required\": [\n                \"escrow\",\n\
        \                \"deposit\",\n                \"fullyFunded\",\n                \"releaseTokens\"\n            ],\n\
        \            \"properties\": {\n                \"escrow\": {\n                    \"$ref\": \"#/$defs/EscrowAgreement\"\
        ,\n                    \"description\": \"Updated escrow agreement\"\n                },\n                \"deposit\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowDeposit\",\n                    \"description\": \"Deposit record\"\
        \n                },\n                \"fullyFunded\": {\n                    \"type\": \"boolean\",\n           \
        \         \"description\": \"Whether escrow is now fully funded\"\n                },\n                \"releaseTokens\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/PartyToken\"\n                    },\n                    \"description\": \"Release tokens (issued when
        fully funded)\"\n                }\n            }\n        },\n        \"EscrowAgreement\": {\n            \"type\"\
        : \"object\",\n            \"description\": \"Main escrow agreement record\",\n            \"required\": [\n     \
        \           \"id\",\n                \"escrowType\",\n                \"trustMode\",\n                \"parties\"\
        ,\n                \"expectedDeposits\",\n                \"deposits\",\n                \"consents\",\n         \
        \       \"status\",\n                \"requiredConsentsForRelease\",\n                \"createdAt\",\n           \
        \     \"createdBy\",\n                \"createdByType\",\n                \"expiresAt\"\n            ],\n        \
        \    \"properties\": {\n                \"id\": {\n                    \"type\": \"string\",\n                   \
        \ \"format\": \"uuid\",\n                    \"description\": \"Unique escrow agreement identifier\"\n           \
        \     },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\",\n             \
        \       \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\": {\n    \
        \                \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode for the
        escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\",\n \
        \                   \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        },\n\
        \        \"PartyToken\": {\n            \"type\": \"object\",\n            \"description\": \"Token issued to a party
        for deposit or release operations\",\n            \"required\": [\n                \"partyId\",\n                \"\
        partyType\",\n                \"token\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party ID\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"token\": {\n                    \"type\": \"string\",\n                    \"description\": \"The
        token\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Deposit assets into escrow\",\n    \"description\": \"Deposit assets into
        escrow. Transfers currency from party's own wallet to that\\nparty's escrow wallet. Moves items from party's own container
        to that party's\\nescrow container. Locks contracts with escrow as guardian.\\nRejects soulbound/non-tradeable items.
        After each deposit, queries bound contract\\nto check if all asset requirements are satisfied.\\n\",\n    \"tags\"\
        : [\n        \"Deposits\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"deposit\"\n}"
  /escrow/deposit/validate:
    post:
      operationId: validateDeposit
      tags:
      - Deposits
      summary: Validate a deposit without executing
      description: Validate a deposit without executing (dry run).
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateDepositRequest'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateDepositResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateDepositRequest\"\
        ,\n    \"$defs\": {\n        \"ValidateDepositRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to validate a deposit without executing\",\n            \"required\": [\n                \"escrowId\"\
        ,\n                \"partyId\",\n                \"partyType\",\n                \"assets\"\n            ],\n    \
        \        \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"string\",\n         \
        \           \"format\": \"uuid\",\n                    \"description\": \"Escrow ID\"\n                },\n      \
        \          \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"Party to validate\"\n                },\n                \"partyType\": {\n\
        \                    \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\"\
        : \"object\"\n                },\n                \"assets\": {\n                    \"$ref\": \"#/$defs/EscrowAssetBundleInput\"\
        ,\n                    \"description\": \"Assets to validate\"\n                }\n            }\n        },\n   \
        \     \"EscrowAssetBundleInput\": {\n            \"type\": \"object\",\n            \"description\": \"Input for specifying
        a bundle of assets\",\n            \"required\": [\n                \"assets\"\n            ],\n            \"properties\"\
        : {\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\": {\n \
        \                       \"$ref\": \"#/$defs/EscrowAssetInput\"\n                    },\n                    \"description\"\
        : \"Assets to deposit\"\n                },\n                \"description\": {\n                    \"type\": \"\
        string\",\n                    \"nullable\": true,\n                    \"description\": \"Bundle description\"\n\
        \                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Estimated value\"\n                }\n    \
        \        }\n        },\n        \"EscrowAssetInput\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Input for specifying an asset in escrow operations\",\n            \"required\": [\n                \"assetType\"\
        \n            ],\n            \"properties\": {\n                \"assetType\": {\n                    \"$ref\": \"\
        #/$defs/AssetType\",\n                    \"description\": \"Type of asset to deposit\"\n                },\n    \
        \            \"currencyDefinitionId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Currency definition ID\"\
        \n                },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Currency code\"\n                },\n      \
        \          \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Currency amount\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Item instance ID\"\n                },\n               \
        \ \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n          \
        \          \"description\": \"Item name\"\n                },\n                \"itemTemplateId\": {\n           \
        \         \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Item template ID (for stacks)\"\n                },\n                \"itemTemplateName\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Item template name\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"\
        integer\",\n                    \"nullable\": true,\n                    \"description\": \"Item quantity (for stacks)\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract instance ID\"\n                },\n                \"contractTemplateCode\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Contract template
        code\"\n                },\n                \"contractDescription\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Contract description\"\n        \
        \        },\n                \"contractPartyRole\": {\n                    \"type\": \"string\",\n               \
        \     \"nullable\": true,\n                    \"description\": \"Contract party role being escrowed\"\n         \
        \       },\n                \"customAssetType\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Custom asset type\"\n                },\n         \
        \       \"customAssetId\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Custom asset ID\"\n                },\n                \"customAssetData\"\
        : {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Custom asset data\"\n                }\n            }\n        },\n\
        \        \"AssetType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of asset held in
        escrow.\\n- currency: Currency amount held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack:
        Stackable items (quantity) held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\
        n- custom: Custom asset type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n\
        \                \"item\",\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\
        \n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateDepositResponse\"\
        ,\n    \"$defs\": {\n        \"ValidateDepositResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from deposit validation\",\n            \"required\": [\n                \"valid\",\n               \
        \ \"errors\",\n                \"warnings\"\n            ],\n            \"properties\": {\n                \"valid\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether the deposit would
        be valid\"\n                },\n                \"errors\": {\n                    \"type\": \"array\",\n        \
        \            \"items\": {\n                        \"type\": \"string\"\n                    },\n                \
        \    \"description\": \"Validation errors\"\n                },\n                \"warnings\": {\n               \
        \     \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n     \
        \               },\n                    \"description\": \"Validation warnings\"\n                }\n            }\n\
        \        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Validate a deposit without executing\",\n    \"description\": \"Validate
        a deposit without executing (dry run).\",\n    \"tags\": [\n        \"Deposits\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"validateDeposit\"\n}"
  /escrow/deposit/status:
    post:
      operationId: getDepositStatus
      tags:
      - Deposits
      summary: Get deposit status for a party
      description: Get deposit status for a party in an escrow.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetDepositStatusRequest'
      responses:
        '200':
          description: Deposit status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetDepositStatusResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetDepositStatusRequest\"\
        ,\n    \"$defs\": {\n        \"GetDepositStatusRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to get deposit status for a party\",\n            \"required\": [\n                \"escrowId\",\n   \
        \             \"partyId\",\n                \"partyType\"\n            ],\n            \"properties\": {\n       \
        \         \"escrowId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"Escrow ID\"\n                },\n                \"partyId\": {\n        \
        \            \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party ID\"\n                },\n                \"partyType\": {\n                    \"description\": \"Type
        of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                }\n           \
        \ }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetDepositStatusResponse\"\
        ,\n    \"$defs\": {\n        \"GetDepositStatusResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response containing party deposit status\",\n            \"required\": [\n                \"expectedAssets\",\n\
        \                \"depositedAssets\",\n                \"fulfilled\"\n            ],\n            \"properties\":
        {\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Expected assets from this party\"\n                },\n                \"depositedAssets\": {\n              \
        \      \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Actually deposited assets\"\n                },\n\
        \                \"fulfilled\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether deposit requirement is fulfilled\"\n                },\n                \"depositToken\": {\n        \
        \            \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\":
        \"Deposit token (if not yet used)\"\n                },\n                \"depositDeadline\": {\n                \
        \    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Deposit deadline\"\n                }\n            }\n        },\n       \
        \ \"EscrowAsset\": {\n            \"type\": \"object\",\n            \"description\": \"An asset held in escrow\"\
        ,\n            \"required\": [\n                \"assetType\",\n                \"sourceOwnerId\",\n             \
        \   \"sourceOwnerType\"\n            ],\n            \"properties\": {\n                \"assetType\": {\n       \
        \             \"$ref\": \"#/$defs/AssetType\",\n                    \"description\": \"Type of asset held in escrow\"\
        \n                },\n                \"currencyDefinitionId\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=currency - currency definition ID\"\n                },\n                \"currencyCode\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized currency code for display\"\n                },\n                \"currencyAmount\": {\n        \
        \            \"type\": \"number\",\n                    \"nullable\": true,\n                    \"description\":
        \"Amount of currency\"\n                },\n                \"itemInstanceId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                  \
        \  \"description\": \"For assetType=item - unique item instance ID\"\n                },\n                \"itemName\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized item name for display\"\n                },\n                \"itemTemplateId\": {\n            \
        \        \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"For assetType=item_stack - stackable item template\"\n                },\n\
        \                \"itemTemplateName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized template name for display\"\n                },\n   \
        \             \"itemQuantity\": {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"For assetType=item_stack - quantity\"\n                },\n              \
        \  \"contractInstanceId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=contract - contract
        instance ID\"\n                },\n                \"contractTemplateCode\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized contract template
        code\"\n                },\n                \"contractDescription\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Description of the contract\"\n \
        \               },\n                \"contractPartyRole\": {\n                    \"type\": \"string\",\n        \
        \            \"nullable\": true,\n                    \"description\": \"Which party role in the contract is being
        escrowed\"\n                },\n                \"customAssetType\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"For assetType=custom - registered
        handler type\"\n                },\n                \"customAssetId\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Custom asset identifier\"\n   \
        \             },\n                \"customAssetData\": {\n                    \"type\": \"object\",\n            \
        \        \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Handler-specific data\"\n                },\n                \"sourceOwnerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Where this asset
        came from (for refunds)\"\n                },\n                \"sourceOwnerType\": {\n                    \"type\"\
        : \"object\",\n                    \"description\": \"Type of the source owner\"\n                },\n           \
        \     \"sourceContainerId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Source wallet/container ID\"\n\
        \                }\n            }\n        },\n        \"AssetType\": {\n            \"type\": \"string\",\n     \
        \       \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount held in escrow wallet\\n- item:
        Item instance held in escrow container\\n- item_stack: Stackable items (quantity) held in escrow container\\n- contract:
        Contract instance locked under escrow guardianship\\n- custom: Custom asset type via registered handler\\n\",\n  \
        \          \"enum\": [\n                \"currency\",\n                \"item\",\n                \"item_stack\",\n\
        \                \"contract\",\n                \"custom\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get deposit status for a party\",\n    \"description\": \"Get deposit status
        for a party in an escrow.\",\n    \"tags\": [\n        \"Deposits\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"getDepositStatus\"\n}"
  /escrow/consent:
    post:
      operationId: recordConsent
      tags:
      - Consent
      summary: Record party consent
      description: Record party consent for release, refund, or re-affirmation.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConsentRequest'
      responses:
        '200':
          description: Consent recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentResponse'
        '400':
          description: Consent failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConsentRequest\"\
        ,\n    \"$defs\": {\n        \"ConsentRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to record party consent for release or refund\",\n            \"required\": [\n                \"escrowId\"\
        ,\n                \"partyId\",\n                \"partyType\",\n                \"consentType\",\n              \
        \  \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"escrowId\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\":
        \"Escrow ID\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"uuid\",\n                    \"description\": \"Party giving consent\"\n         \
        \       },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"consentType\": {\n     \
        \               \"$ref\": \"#/$defs/EscrowConsentType\",\n                    \"description\": \"Type of consent being
        given\"\n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n    \
        \                \"nullable\": true,\n                    \"description\": \"Release token (required for full_consent)\"\
        \n                },\n                \"notes\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                },\n            \
        \    \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\": \"Idempotency
        key\"\n                }\n            }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\
        n- refund: Agrees to refund assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation
        failure\\n\",\n            \"enum\": [\n                \"release\",\n                \"refund\",\n              \
        \  \"dispute\",\n                \"reaffirm\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConsentResponse\"\
        ,\n    \"$defs\": {\n        \"ConsentResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from recording party consent\",\n            \"required\": [\n                \"escrow\",\n         \
        \       \"consentRecorded\",\n                \"triggered\",\n                \"newStatus\"\n            ],\n    \
        \        \"properties\": {\n                \"escrow\": {\n                    \"$ref\": \"#/$defs/EscrowAgreement\"\
        ,\n                    \"description\": \"Updated escrow agreement\"\n                },\n                \"consentRecorded\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether consent was recorded\"\
        \n                },\n                \"triggered\": {\n                    \"type\": \"boolean\",\n             \
        \       \"description\": \"Whether this consent triggered completion\"\n                },\n                \"newStatus\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                    \"description\": \"New escrow status
        after consent\"\n                }\n            }\n        },\n        \"EscrowAgreement\": {\n            \"type\"\
        : \"object\",\n            \"description\": \"Main escrow agreement record\",\n            \"required\": [\n     \
        \           \"id\",\n                \"escrowType\",\n                \"trustMode\",\n                \"parties\"\
        ,\n                \"expectedDeposits\",\n                \"deposits\",\n                \"consents\",\n         \
        \       \"status\",\n                \"requiredConsentsForRelease\",\n                \"createdAt\",\n           \
        \     \"createdBy\",\n                \"createdByType\",\n                \"expiresAt\"\n            ],\n        \
        \    \"properties\": {\n                \"id\": {\n                    \"type\": \"string\",\n                   \
        \ \"format\": \"uuid\",\n                    \"description\": \"Unique escrow agreement identifier\"\n           \
        \     },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\",\n             \
        \       \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\": {\n    \
        \                \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode for the
        escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\",\n \
        \                   \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Record party consent\",\n    \"description\": \"Record party consent for
        release, refund, or re-affirmation.\",\n    \"tags\": [\n        \"Consent\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"recordConsent\"\n}"
  /escrow/consent/status:
    post:
      operationId: getConsentStatus
      tags:
      - Consent
      summary: Get consent status for escrow
      description: Get consent status for all parties in an escrow.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetConsentStatusRequest'
      responses:
        '200':
          description: Consent status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetConsentStatusResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetConsentStatusRequest\"\
        ,\n    \"$defs\": {\n        \"GetConsentStatusRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to get consent status for all parties\",\n            \"required\": [\n                \"escrowId\"\n\
        \            ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow ID\"\n       \
        \         }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetConsentStatusResponse\"\
        ,\n    \"$defs\": {\n        \"GetConsentStatusResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response containing consent status for all parties\",\n            \"required\": [\n                \"partiesRequiringConsent\"\
        ,\n                \"consentsReceived\",\n                \"consentsRequired\",\n                \"canRelease\",\n\
        \                \"canRefund\"\n            ],\n            \"properties\": {\n                \"partiesRequiringConsent\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/PartyConsentStatus\"\n                    },\n                    \"description\": \"Consent status per
        party\"\n                },\n                \"consentsReceived\": {\n                    \"type\": \"integer\",\n\
        \                    \"description\": \"Number of consents received\"\n                },\n                \"consentsRequired\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of consents required\"\
        \n                },\n                \"canRelease\": {\n                    \"type\": \"boolean\",\n            \
        \        \"description\": \"Whether release can proceed\"\n                },\n                \"canRefund\": {\n\
        \                    \"type\": \"boolean\",\n                    \"description\": \"Whether refund can proceed\"\n\
        \                }\n            }\n        },\n        \"PartyConsentStatus\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"Consent status for a single party\",\n            \"required\": [\n            \
        \    \"partyId\",\n                \"partyType\",\n                \"consentGiven\"\n            ],\n            \"\
        properties\": {\n                \"partyId\": {\n                    \"type\": \"string\",\n                    \"\
        format\": \"uuid\",\n                    \"description\": \"Party ID\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\"\
        : \"object\"\n                },\n                \"displayName\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Party display name\"\n          \
        \      },\n                \"consentGiven\": {\n                    \"type\": \"boolean\",\n                    \"\
        description\": \"Whether consent was given\"\n                },\n                \"consentType\": {\n           \
        \         \"$ref\": \"#/$defs/EscrowConsentType\",\n                    \"description\": \"Type of consent given (if
        any)\",\n                    \"nullable\": true\n                },\n                \"consentedAt\": {\n        \
        \            \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"When consent was given\"\n                }\n            }\n     \
        \   },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of
        consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund assets to depositors\\
        n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n            \"enum\": [\n  \
        \              \"release\",\n                \"refund\",\n                \"dispute\",\n                \"reaffirm\"\
        \n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get consent status for escrow\",\n    \"description\": \"Get consent status
        for all parties in an escrow.\",\n    \"tags\": [\n        \"Consent\"\n    ],\n    \"deprecated\": false,\n    \"\
        operationId\": \"getConsentStatus\"\n}"
  /escrow/release:
    post:
      operationId: release
      tags:
      - Completion
      summary: Trigger release
      description: |
        Trigger release (for trusted modes or after consent).
        If boundContractId is set, checks contract status first (must be fulfilled).
        Runs finalization flow before releasing remaining assets.
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReleaseRequest'
      responses:
        '200':
          description: Release result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseResponse'
        '400':
          description: Release failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReleaseRequest\"\
        ,\n    \"$defs\": {\n        \"ReleaseRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to trigger escrow release to recipients\",\n            \"required\": [\n                \"escrowId\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"escrowId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Escrow ID\"\n                },\n                \"initiatorServiceId\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"For initiator_trusted
        mode\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n            \
        \        \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                },\n      \
        \          \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\":
        \"Idempotency key\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReleaseResponse\"\
        ,\n    \"$defs\": {\n        \"ReleaseResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from releasing escrow assets to recipients\",\n            \"required\": [\n                \"escrow\"\
        ,\n                \"finalizerResults\",\n                \"releases\"\n            ],\n            \"properties\"\
        : {\n                \"escrow\": {\n                    \"$ref\": \"#/$defs/EscrowAgreement\",\n                 \
        \   \"description\": \"Released escrow agreement\"\n                },\n                \"finalizerResults\": {\n\
        \                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/FinalizerResult\"\n                    },\n                    \"description\": \"Results of contract finalizer
        APIs\"\n                },\n                \"releases\": {\n                    \"type\": \"array\",\n          \
        \          \"items\": {\n                        \"$ref\": \"#/$defs/ReleaseResult\"\n                    },\n   \
        \                 \"description\": \"Release results per recipient\"\n                }\n            }\n        },\n\
        \        \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow agreement
        record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n               \
        \ \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"deposits\"\
        ,\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\",\n \
        \               \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n             \
        \   \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique escrow
        agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\"\
        ,\n                    \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode
        for the escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        },\n\
        \        \"FinalizerResult\": {\n            \"type\": \"object\",\n            \"description\": \"Result from a contract
        finalizer API call\",\n            \"required\": [\n                \"endpoint\",\n                \"success\"\n \
        \           ],\n            \"properties\": {\n                \"endpoint\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Finalizer endpoint\"\n                },\n                \"success\": {\n\
        \                    \"type\": \"boolean\",\n                    \"description\": \"Whether it succeeded\"\n     \
        \           },\n                \"error\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Error message if failed\"\n                }\n            }\n    \
        \    },\n        \"ReleaseResult\": {\n            \"type\": \"object\",\n            \"description\": \"Result of
        releasing assets to a single recipient\",\n            \"required\": [\n                \"recipientPartyId\",\n  \
        \              \"success\"\n            ],\n            \"properties\": {\n                \"recipientPartyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Recipient party ID\"\n                },\n                \"assets\": {\n                    \"$ref\": \"#/$defs/EscrowAssetBundle\"\
        ,\n                    \"description\": \"Assets released (null if failed)\",\n                    \"nullable\": true\n\
        \                },\n                \"success\": {\n                    \"type\": \"boolean\",\n                \
        \    \"description\": \"Whether release succeeded\"\n                },\n                \"error\": {\n          \
        \          \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Error message if failed\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Trigger release\",\n    \"description\": \"Trigger release (for trusted
        modes or after consent).\\nIf boundContractId is set, checks contract status first (must be fulfilled).\\nRuns finalization
        flow before releasing remaining assets.\\n\",\n    \"tags\": [\n        \"Completion\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"release\"\n}"
  /escrow/refund:
    post:
      operationId: refund
      tags:
      - Completion
      summary: Trigger refund
      description: Trigger refund (for trusted modes or consent).
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefundRequest'
      responses:
        '200':
          description: Refund result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefundResponse'
        '400':
          description: Refund failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RefundRequest\"\
        ,\n    \"$defs\": {\n        \"RefundRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to trigger escrow refund to depositors\",\n            \"required\": [\n                \"escrowId\",\n\
        \                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"escrowId\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Escrow ID\"\n                },\n                \"initiatorServiceId\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For initiator_trusted mode\"\n\
        \                },\n                \"reason\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Reason for refund\"\n                },\n         \
        \       \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        Idempotency key\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RefundResponse\"\
        ,\n    \"$defs\": {\n        \"RefundResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from refunding escrow assets to depositors\",\n            \"required\": [\n                \"escrow\"\
        ,\n                \"refunds\"\n            ],\n            \"properties\": {\n                \"escrow\": {\n   \
        \                 \"$ref\": \"#/$defs/EscrowAgreement\",\n                    \"description\": \"Refunded escrow agreement\"\
        \n                },\n                \"refunds\": {\n                    \"type\": \"array\",\n                 \
        \   \"items\": {\n                        \"$ref\": \"#/$defs/RefundResult\"\n                    },\n           \
        \         \"description\": \"Refund results per depositor\"\n                }\n            }\n        },\n      \
        \  \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow agreement
        record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n               \
        \ \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"deposits\"\
        ,\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\",\n \
        \               \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n             \
        \   \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique escrow
        agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\"\
        ,\n                    \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode
        for the escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        },\n\
        \        \"RefundResult\": {\n            \"type\": \"object\",\n            \"description\": \"Result of refunding
        assets to a single depositor\",\n            \"required\": [\n                \"depositorPartyId\",\n            \
        \    \"success\"\n            ],\n            \"properties\": {\n                \"depositorPartyId\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Depositor party ID\"\n                },\n                \"assets\": {\n                    \"$ref\": \"#/$defs/EscrowAssetBundle\"\
        ,\n                    \"description\": \"Assets refunded (null if failed)\",\n                    \"nullable\": true\n\
        \                },\n                \"success\": {\n                    \"type\": \"boolean\",\n                \
        \    \"description\": \"Whether refund succeeded\"\n                },\n                \"error\": {\n           \
        \         \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Error message if failed\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Trigger refund\",\n    \"description\": \"Trigger refund (for trusted modes
        or consent).\",\n    \"tags\": [\n        \"Completion\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"refund\"\n}"
  /escrow/cancel:
    post:
      operationId: cancel
      tags:
      - Completion
      summary: Cancel escrow before fully funded
      description: Cancel escrow before fully funded, refunding any deposits.
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelRequest'
      responses:
        '200':
          description: Cancel result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelResponse'
        '400':
          description: Cancel failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CancelRequest\"\
        ,\n    \"$defs\": {\n        \"CancelRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to cancel escrow before fully funded\",\n            \"required\": [\n                \"escrowId\",\n\
        \                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"escrowId\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Escrow ID\"\n                },\n                \"reason\": {\n                    \"type\": \"string\",\n  \
        \                  \"nullable\": true,\n                    \"description\": \"Reason for cancellation\"\n       \
        \         },\n                \"idempotencyKey\": {\n                    \"type\": \"string\",\n                 \
        \   \"description\": \"Idempotency key\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CancelResponse\"\
        ,\n    \"$defs\": {\n        \"CancelResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from cancelling an escrow\",\n            \"required\": [\n                \"escrow\",\n            \
        \    \"refunds\"\n            ],\n            \"properties\": {\n                \"escrow\": {\n                 \
        \   \"$ref\": \"#/$defs/EscrowAgreement\",\n                    \"description\": \"Cancelled escrow agreement\"\n\
        \                },\n                \"refunds\": {\n                    \"type\": \"array\",\n                  \
        \  \"items\": {\n                        \"$ref\": \"#/$defs/RefundResult\"\n                    },\n            \
        \        \"description\": \"Refund results for any deposits\"\n                }\n            }\n        },\n    \
        \    \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow agreement
        record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n               \
        \ \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"deposits\"\
        ,\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\",\n \
        \               \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n             \
        \   \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique escrow
        agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\"\
        ,\n                    \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode
        for the escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        },\n\
        \        \"RefundResult\": {\n            \"type\": \"object\",\n            \"description\": \"Result of refunding
        assets to a single depositor\",\n            \"required\": [\n                \"depositorPartyId\",\n            \
        \    \"success\"\n            ],\n            \"properties\": {\n                \"depositorPartyId\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Depositor party ID\"\n                },\n                \"assets\": {\n                    \"$ref\": \"#/$defs/EscrowAssetBundle\"\
        ,\n                    \"description\": \"Assets refunded (null if failed)\",\n                    \"nullable\": true\n\
        \                },\n                \"success\": {\n                    \"type\": \"boolean\",\n                \
        \    \"description\": \"Whether refund succeeded\"\n                },\n                \"error\": {\n           \
        \         \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Error message if failed\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Cancel escrow before fully funded\",\n    \"description\": \"Cancel escrow
        before fully funded, refunding any deposits.\",\n    \"tags\": [\n        \"Completion\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"cancel\"\n}"
  /escrow/dispute:
    post:
      operationId: dispute
      tags:
      - Completion
      summary: Raise a dispute on funded escrow
      description: Raise a dispute on a funded escrow.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DisputeRequest'
      responses:
        '200':
          description: Dispute raised
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisputeResponse'
        '400':
          description: Dispute failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DisputeRequest\"\
        ,\n    \"$defs\": {\n        \"DisputeRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to raise a dispute on a funded escrow\",\n            \"required\": [\n                \"escrowId\",\n\
        \                \"partyId\",\n                \"partyType\",\n                \"reason\",\n                \"idempotencyKey\"\
        \n            ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow ID\"\n       \
        \         },\n                \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"description\": \"Party raising dispute\"\n                },\n                \"\
        partyType\": {\n                    \"description\": \"Type of entity (Account, Character, etc.)\",\n            \
        \        \"type\": \"object\"\n                },\n                \"reason\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Reason for dispute\"\n                },\n                \"releaseToken\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Release token (proves party identity)\"\n                },\n                \"idempotencyKey\": {\n         \
        \           \"type\": \"string\",\n                    \"description\": \"Idempotency key\"\n                }\n \
        \           }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DisputeResponse\"\
        ,\n    \"$defs\": {\n        \"DisputeResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from raising a dispute on an escrow\",\n            \"required\": [\n                \"escrow\"\n   \
        \         ],\n            \"properties\": {\n                \"escrow\": {\n                    \"$ref\": \"#/$defs/EscrowAgreement\"\
        ,\n                    \"description\": \"Disputed escrow agreement\"\n                }\n            }\n        },\n\
        \        \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow agreement
        record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n               \
        \ \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"deposits\"\
        ,\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\",\n \
        \               \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n             \
        \   \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique escrow
        agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\"\
        ,\n                    \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode
        for the escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Raise a dispute on funded escrow\",\n    \"description\": \"Raise a dispute
        on a funded escrow.\",\n    \"tags\": [\n        \"Completion\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"dispute\"\n}"
  /escrow/confirm-release:
    post:
      operationId: confirmRelease
      tags:
      - Completion
      summary: Confirm receipt of released assets
      description: |
        Called by parties to confirm they received their released assets.
        Required when ReleaseMode is party_required or service_and_party.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmReleaseRequest'
      responses:
        '200':
          description: Confirmation recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfirmReleaseResponse'
        '400':
          description: Confirmation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Escrow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConfirmReleaseRequest\"\
        ,\n    \"$defs\": {\n        \"ConfirmReleaseRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to confirm receipt of released assets\",\n            \"additionalProperties\": false,\n            \"\
        required\": [\n                \"escrowId\",\n                \"partyId\",\n                \"releaseToken\"\n   \
        \         ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"The escrow being confirmed.\"\
        \n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n                \
        \    \"format\": \"uuid\",\n                    \"description\": \"The party confirming receipt.\"\n             \
        \   },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"The party's release token (received via confirmation shortcut).\"\n                },\n                \"notes\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Optional confirmation notes.\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConfirmReleaseResponse\"\
        ,\n    \"$defs\": {\n        \"ConfirmReleaseResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from confirming release receipt\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"escrowId\",\n                \"confirmed\",\n                \"allPartiesConfirmed\"\n    \
        \        ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"The escrow ID.\"\n          \
        \      },\n                \"confirmed\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether this party's confirmation was recorded.\"\n                },\n                \"allPartiesConfirmed\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether all parties have now
        confirmed (triggers Released transition).\"\n                },\n                \"status\": {\n                 \
        \   \"$ref\": \"#/$defs/EscrowStatus\",\n                    \"description\": \"Current escrow status after confirmation.\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"EscrowStatus\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Current status of the escrow agreement.\\n-
        pending_deposits: Waiting for parties to deposit\\n- partially_funded: Some but not all deposits received\\n- funded:
        All deposits received, awaiting consent/condition\\n- pending_consent: Some consents received, waiting for more\\\
        n- pending_condition: Waiting for contract fulfillment or external verification\\n- finalizing: Running contract finalizer
        prebound APIs (transient)\\n- releasing: Release in progress (transient)\\n- released: Assets transferred to recipients\\
        n- refunding: Refund in progress (transient)\\n- refunded: Assets returned to depositors\\n- disputed: In dispute,
        arbiter must resolve\\n- expired: Timed out without completion\\n- cancelled: Cancelled before funding complete\\\
        n- validation_failed: Held assets changed, awaiting re-affirmation\\n\",\n            \"enum\": [\n              \
        \  \"pending_deposits\",\n                \"partially_funded\",\n                \"funded\",\n                \"pending_consent\"\
        ,\n                \"pending_condition\",\n                \"finalizing\",\n                \"releasing\",\n     \
        \           \"released\",\n                \"refunding\",\n                \"refunded\",\n                \"disputed\"\
        ,\n                \"expired\",\n                \"cancelled\",\n                \"validation_failed\"\n         \
        \   ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Confirm receipt of released assets\",\n    \"description\": \"Called by
        parties to confirm they received their released assets.\\nRequired when ReleaseMode is party_required or service_and_party.\\\
        n\",\n    \"tags\": [\n        \"Completion\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"confirmRelease\"\
        \n}"
  /escrow/confirm-refund:
    post:
      operationId: confirmRefund
      tags:
      - Completion
      summary: Confirm receipt of refunded assets
      description: |
        Called by parties to confirm they received their refunded deposits.
        Required when RefundMode is party_required.
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmRefundRequest'
      responses:
        '200':
          description: Confirmation recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfirmRefundResponse'
        '400':
          description: Confirmation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Escrow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConfirmRefundRequest\"\
        ,\n    \"$defs\": {\n        \"ConfirmRefundRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to confirm receipt of refunded assets\",\n            \"additionalProperties\": false,\n            \"\
        required\": [\n                \"escrowId\",\n                \"partyId\"\n            ],\n            \"properties\"\
        : {\n                \"escrowId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"description\": \"The escrow being confirmed.\"\n                },\n              \
        \  \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n        \
        \            \"description\": \"The party confirming receipt of refund.\"\n                },\n                \"\
        notes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                 \
        \   \"description\": \"Optional confirmation notes.\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ConfirmRefundResponse\"\
        ,\n    \"$defs\": {\n        \"ConfirmRefundResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from confirming refund receipt\",\n            \"additionalProperties\": false,\n            \"required\"\
        : [\n                \"escrowId\",\n                \"confirmed\",\n                \"allPartiesConfirmed\"\n    \
        \        ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"The escrow ID.\"\n          \
        \      },\n                \"confirmed\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether this party's confirmation was recorded.\"\n                },\n                \"allPartiesConfirmed\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether all parties have now
        confirmed (triggers Refunded transition).\"\n                },\n                \"status\": {\n                 \
        \   \"$ref\": \"#/$defs/EscrowStatus\",\n                    \"description\": \"Current escrow status after confirmation.\"\
        ,\n                    \"nullable\": true\n                }\n            }\n        },\n        \"EscrowStatus\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Current status of the escrow agreement.\\n-
        pending_deposits: Waiting for parties to deposit\\n- partially_funded: Some but not all deposits received\\n- funded:
        All deposits received, awaiting consent/condition\\n- pending_consent: Some consents received, waiting for more\\\
        n- pending_condition: Waiting for contract fulfillment or external verification\\n- finalizing: Running contract finalizer
        prebound APIs (transient)\\n- releasing: Release in progress (transient)\\n- released: Assets transferred to recipients\\
        n- refunding: Refund in progress (transient)\\n- refunded: Assets returned to depositors\\n- disputed: In dispute,
        arbiter must resolve\\n- expired: Timed out without completion\\n- cancelled: Cancelled before funding complete\\\
        n- validation_failed: Held assets changed, awaiting re-affirmation\\n\",\n            \"enum\": [\n              \
        \  \"pending_deposits\",\n                \"partially_funded\",\n                \"funded\",\n                \"pending_consent\"\
        ,\n                \"pending_condition\",\n                \"finalizing\",\n                \"releasing\",\n     \
        \           \"released\",\n                \"refunding\",\n                \"refunded\",\n                \"disputed\"\
        ,\n                \"expired\",\n                \"cancelled\",\n                \"validation_failed\"\n         \
        \   ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Confirm receipt of refunded assets\",\n    \"description\": \"Called by
        parties to confirm they received their refunded deposits.\\nRequired when RefundMode is party_required.\\n\",\n  \
        \  \"tags\": [\n        \"Completion\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"confirmRefund\"\
        \n}"
  /escrow/resolve:
    post:
      operationId: resolve
      tags:
      - Arbiter
      summary: Arbiter resolves disputed escrow
      description: Arbiter resolves a disputed escrow.
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResolveRequest'
      responses:
        '200':
          description: Resolution result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResolveResponse'
        '400':
          description: Resolution failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ResolveRequest\"\
        ,\n    \"$defs\": {\n        \"ResolveRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request for arbiter to resolve a disputed escrow\",\n            \"required\": [\n                \"escrowId\"\
        ,\n                \"arbiterId\",\n                \"arbiterType\",\n                \"resolution\",\n           \
        \     \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"escrowId\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Escrow ID\"\n                },\n                \"arbiterId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Arbiter ID\"\n                },\n\
        \                \"arbiterType\": {\n                    \"type\": \"object\",\n                    \"description\"\
        : \"Arbiter type\"\n                },\n                \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\"\
        ,\n                    \"description\": \"Resolution decision for the dispute\"\n                },\n            \
        \    \"splitAllocations\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n\
        \                    \"items\": {\n                        \"$ref\": \"#/$defs/SplitAllocation\"\n               \
        \     },\n                    \"description\": \"For split resolution\"\n                },\n                \"notes\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Resolution notes\"\n                },\n                \"idempotencyKey\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Idempotency key\"\n                }\n            }\n        },\n\
        \        \"EscrowResolution\": {\n            \"type\": \"string\",\n            \"description\": \"How the escrow
        was resolved.\\n- released: Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split:
        Arbiter split assets between parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled,
        deposits refunded\\n- violation_refunded: Validation failure caused refund\\n\",\n            \"enum\": [\n      \
        \          \"released\",\n                \"refunded\",\n                \"split\",\n                \"expired_refunded\"\
        ,\n                \"cancelled_refunded\",\n                \"violation_refunded\"\n            ]\n        },\n  \
        \      \"SplitAllocation\": {\n            \"type\": \"object\",\n            \"description\": \"Allocation of assets
        to a party in a split resolution\",\n            \"required\": [\n                \"partyId\",\n                \"\
        partyType\",\n                \"assets\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party ID\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"assets\": {\n                    \"type\": \"array\",\n                    \"items\": {\n      \
        \                  \"$ref\": \"#/$defs/EscrowAssetInput\"\n                    },\n                    \"description\"\
        : \"Assets allocated to this party\"\n                }\n            }\n        },\n        \"EscrowAssetInput\":
        {\n            \"type\": \"object\",\n            \"description\": \"Input for specifying an asset in escrow operations\"\
        ,\n            \"required\": [\n                \"assetType\"\n            ],\n            \"properties\": {\n   \
        \             \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"description\"\
        : \"Type of asset to deposit\"\n                },\n                \"currencyDefinitionId\": {\n                \
        \    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n \
        \                   \"description\": \"Currency definition ID\"\n                },\n                \"currencyCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Currency code\"\n                },\n                \"currencyAmount\": {\n                    \"type\": \"number\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Currency amount\"\n           \
        \     },\n                \"itemInstanceId\": {\n                    \"type\": \"string\",\n                    \"\
        format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Item instance
        ID\"\n                },\n                \"itemName\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Item name\"\n                },\n          \
        \      \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Item template ID (for stacks)\"\
        \n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\",\n       \
        \             \"nullable\": true,\n                    \"description\": \"Item template name\"\n                },\n\
        \                \"itemQuantity\": {\n                    \"type\": \"integer\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Item quantity (for stacks)\"\n                },\n               \
        \ \"contractInstanceId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Contract instance ID\"\n        \
        \        },\n                \"contractTemplateCode\": {\n                    \"type\": \"string\",\n            \
        \        \"nullable\": true,\n                    \"description\": \"Contract template code\"\n                },\n\
        \                \"contractDescription\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Contract description\"\n                },\n                \"contractPartyRole\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract party role being escrowed\"\n                },\n                \"customAssetType\": {\n           \
        \         \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Custom asset type\"\n                },\n                \"customAssetId\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Custom asset ID\"\n           \
        \     },\n                \"customAssetData\": {\n                    \"type\": \"object\",\n                    \"\
        nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\": \"Custom
        asset data\"\n                }\n            }\n        },\n        \"AssetType\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount held in escrow wallet\\
        n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity) held in escrow container\\
        n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset type via registered handler\\\
        n\",\n            \"enum\": [\n                \"currency\",\n                \"item\",\n                \"item_stack\"\
        ,\n                \"contract\",\n                \"custom\"\n            ]\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ResolveResponse\"\
        ,\n    \"$defs\": {\n        \"ResolveResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from arbiter resolving a disputed escrow\",\n            \"required\": [\n                \"escrow\"\
        ,\n                \"transfers\"\n            ],\n            \"properties\": {\n                \"escrow\": {\n \
        \                   \"$ref\": \"#/$defs/EscrowAgreement\",\n                    \"description\": \"Resolved escrow
        agreement\"\n                },\n                \"transfers\": {\n                    \"type\": \"array\",\n    \
        \                \"items\": {\n                        \"$ref\": \"#/$defs/TransferResult\"\n                    },\n\
        \                    \"description\": \"Transfer results\"\n                }\n            }\n        },\n       \
        \ \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow agreement
        record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n               \
        \ \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"deposits\"\
        ,\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\",\n \
        \               \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n             \
        \   \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique escrow
        agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\"\
        ,\n                    \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode
        for the escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        },\n\
        \        \"TransferResult\": {\n            \"type\": \"object\",\n            \"description\": \"Result of transferring
        assets to a party during resolution\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"success\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Party
        ID\"\n                },\n                \"assets\": {\n                    \"$ref\": \"#/$defs/EscrowAssetBundle\"\
        ,\n                    \"description\": \"Assets transferred (null if failed)\",\n                    \"nullable\"\
        : true\n                },\n                \"success\": {\n                    \"type\": \"boolean\",\n         \
        \           \"description\": \"Whether transfer succeeded\"\n                },\n                \"error\": {\n  \
        \                  \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Error message if failed\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Arbiter resolves disputed escrow\",\n    \"description\": \"Arbiter resolves
        a disputed escrow.\",\n    \"tags\": [\n        \"Arbiter\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"resolve\"\n}"
  /escrow/verify-condition:
    post:
      operationId: verifyCondition
      tags:
      - Condition
      summary: Verify condition for conditional escrow
      description: |
        Verify condition for conditional escrow (non-contract path).
        For escrows with boundContractId, use contract milestones instead.
      x-permissions:
      - role: developer
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyConditionRequest'
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyConditionResponse'
        '400':
          description: Verification failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/VerifyConditionRequest\"\
        ,\n    \"$defs\": {\n        \"VerifyConditionRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to verify a condition for conditional escrow\",\n            \"required\": [\n                \"escrowId\"\
        ,\n                \"conditionMet\",\n                \"verifierId\",\n                \"verifierType\",\n       \
        \         \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"escrowId\": {\n   \
        \                 \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Escrow ID\"\n                },\n                \"conditionMet\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether the condition was met\"\n                },\n                \"\
        verifierId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n          \
        \          \"description\": \"Verifier entity ID\"\n                },\n                \"verifierType\": {\n    \
        \                \"type\": \"object\",\n                    \"description\": \"Verifier entity type\"\n          \
        \      },\n                \"verificationData\": {\n                    \"type\": \"object\",\n                  \
        \  \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\":
        \"Proof/evidence data\"\n                },\n                \"idempotencyKey\": {\n                    \"type\":
        \"string\",\n                    \"description\": \"Idempotency key\"\n                }\n            }\n        }\n\
        \    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/VerifyConditionResponse\"\
        ,\n    \"$defs\": {\n        \"VerifyConditionResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from verifying a condition on an escrow\",\n            \"required\": [\n                \"escrow\",\n\
        \                \"triggered\"\n            ],\n            \"properties\": {\n                \"escrow\": {\n   \
        \                 \"$ref\": \"#/$defs/EscrowAgreement\",\n                    \"description\": \"Updated escrow agreement\"\
        \n                },\n                \"triggered\": {\n                    \"type\": \"boolean\",\n             \
        \       \"description\": \"Whether this triggered release/refund\"\n                }\n            }\n        },\n\
        \        \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main escrow agreement
        record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n               \
        \ \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n                \"deposits\"\
        ,\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\",\n \
        \               \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n             \
        \   \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique escrow
        agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\"\
        ,\n                    \"description\": \"Type of escrow agreement\"\n                },\n                \"trustMode\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode
        for the escrow\"\n                },\n                \"trustedPartyId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For single_party_trusted - which party has authority\"\n                },\n                \"trustedPartyType\"\
        : {\n                    \"allOf\": [\n                        {\n                            \"type\": \"object\"\
        \n                        }\n                    ],\n                    \"nullable\": true,\n                   \
        \ \"description\": \"Type of the trusted party\"\n                },\n                \"initiatorServiceId\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For initiator_trusted - which service created this\"\n                },\n                \"parties\": {\n   \
        \                 \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\
        \n                    },\n                    \"description\": \"All parties involved in the escrow\"\n          \
        \      },\n                \"expectedDeposits\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n          \
        \          \"description\": \"What deposits are expected from each party\"\n                },\n                \"\
        deposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                      \
        \  \"$ref\": \"#/$defs/EscrowDeposit\"\n                    },\n                    \"description\": \"Actual deposits
        received\"\n                },\n                \"releaseAllocations\": {\n                    \"type\": \"array\"\
        ,\n                    \"nullable\": true,\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/ReleaseAllocation\"\n                    },\n                    \"description\": \"How assets should be distributed
        on release\"\n                },\n                \"boundContractId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Contract governing conditions for this escrow\"\n                },\n                \"consents\": {\n       \
        \             \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\
        \n                    },\n                    \"description\": \"Consent decisions from parties\"\n              \
        \  },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                  \
        \  \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Verify condition for conditional escrow\",\n    \"description\": \"Verify
        condition for conditional escrow (non-contract path).\\nFor escrows with boundContractId, use contract milestones
        instead.\\n\",\n    \"tags\": [\n        \"Condition\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"\
        verifyCondition\"\n}"
  /escrow/validate:
    post:
      operationId: validateEscrow
      tags:
      - Validation
      summary: Manually trigger validation
      description: Manually trigger validation on an active escrow.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateEscrowRequest'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateEscrowResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateEscrowRequest\"\
        ,\n    \"$defs\": {\n        \"ValidateEscrowRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to manually validate escrow assets\",\n            \"required\": [\n                \"escrowId\"\n   \
        \         ],\n            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow ID\"\n               \
        \ }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ValidateEscrowResponse\"\
        ,\n    \"$defs\": {\n        \"ValidateEscrowResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from validating escrow assets\",\n            \"required\": [\n                \"valid\",\n         \
        \       \"failures\",\n                \"escrow\"\n            ],\n            \"properties\": {\n               \
        \ \"valid\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether all assets
        are valid\"\n                },\n                \"failures\": {\n                    \"type\": \"array\",\n     \
        \               \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n                  \
        \  },\n                    \"description\": \"Validation failures\"\n                },\n                \"escrow\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowAgreement\",\n                    \"description\": \"Escrow agreement
        with validation results\"\n                }\n            }\n        },\n        \"ValidationFailure\": {\n      \
        \      \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n            \"\
        required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"ValidationFailureType\": {\n            \"type\": \"string\",\n            \"description\": \"\
        Type of validation failure detected.\\n- asset_missing: Asset no longer exists in escrow custody\\n- asset_mutated:
        Asset properties changed (e.g., item durability)\\n- asset_expired: Asset has a time-based expiration that triggered\\
        n- balance_mismatch: Wallet balance does not match expected held amount\\n\",\n            \"enum\": [\n         \
        \       \"asset_missing\",\n                \"asset_mutated\",\n                \"asset_expired\",\n             \
        \   \"balance_mismatch\"\n            ]\n        },\n        \"EscrowAgreement\": {\n            \"type\": \"object\"\
        ,\n            \"description\": \"Main escrow agreement record\",\n            \"required\": [\n                \"\
        id\",\n                \"escrowType\",\n                \"trustMode\",\n                \"parties\",\n           \
        \     \"expectedDeposits\",\n                \"deposits\",\n                \"consents\",\n                \"status\"\
        ,\n                \"requiredConsentsForRelease\",\n                \"createdAt\",\n                \"createdBy\"\
        ,\n                \"createdByType\",\n                \"expiresAt\"\n            ],\n            \"properties\":
        {\n                \"id\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Unique escrow agreement identifier\"\n                },\n             \
        \   \"escrowType\": {\n                    \"$ref\": \"#/$defs/EscrowType\",\n                    \"description\"\
        : \"Type of escrow agreement\"\n                },\n                \"trustMode\": {\n                    \"$ref\"\
        : \"#/$defs/EscrowTrustMode\",\n                    \"description\": \"Trust mode for the escrow\"\n             \
        \   },\n                \"trustedPartyId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"For single_party_trusted
        - which party has authority\"\n                },\n                \"trustedPartyType\": {\n                    \"\
        allOf\": [\n                        {\n                            \"type\": \"object\"\n                        }\n\
        \                    ],\n                    \"nullable\": true,\n                    \"description\": \"Type of the
        trusted party\"\n                },\n                \"initiatorServiceId\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For initiator_trusted - which service
        created this\"\n                },\n                \"parties\": {\n                    \"type\": \"array\",\n   \
        \                 \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\n                    },\n\
        \                    \"description\": \"All parties involved in the escrow\"\n                },\n               \
        \ \"expectedDeposits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n          \
        \              \"$ref\": \"#/$defs/ExpectedDeposit\"\n                    },\n                    \"description\"\
        : \"What deposits are expected from each party\"\n                },\n                \"deposits\": {\n          \
        \          \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowDeposit\"\
        \n                    },\n                    \"description\": \"Actual deposits received\"\n                },\n\
        \                \"releaseAllocations\": {\n                    \"type\": \"array\",\n                    \"nullable\"\
        : true,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ReleaseAllocation\"\n     \
        \               },\n                    \"description\": \"How assets should be distributed on release\"\n       \
        \         },\n                \"boundContractId\": {\n                    \"type\": \"string\",\n                \
        \    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Contract
        governing conditions for this escrow\"\n                },\n                \"consents\": {\n                    \"\
        type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\n\
        \                    },\n                    \"description\": \"Consent decisions from parties\"\n               \
        \ },\n                \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                   \
        \ \"description\": \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\":
        {\n                    \"type\": \"integer\",\n                    \"description\": \"How many parties must consent
        for release (-1 = all required)\"\n                },\n                \"lastValidatedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the escrow was last validated\"\n                },\n               \
        \ \"validationFailures\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n              \
        \      },\n                    \"description\": \"Any validation failures detected\"\n                },\n       \
        \         \"createdAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"description\": \"When the escrow was created\"\n                },\n                \"createdBy\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Who created the escrow\"\n                },\n                \"createdByType\": {\n            \
        \        \"type\": \"object\",\n                    \"description\": \"Type of the creator entity\"\n            \
        \    },\n                \"fundedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When all expected
        deposits were received\"\n                },\n                \"expiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"description\": \"Auto-refund if not completed
        by this time\"\n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When the escrow reached terminal state\"\n                },\n                \"referenceType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        What this escrow is for (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of the referenced entity\"\n                },\n              \
        \  \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Human-readable description\"\n                },\n                \"metadata\":
        {\n                    \"type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\"\
        : true,\n                    \"description\": \"Game/application specific metadata\"\n                },\n       \
        \         \"resolution\": {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\"\
        : \"How the escrow was resolved\",\n                    \"nullable\": true\n                },\n                \"\
        resolutionNotes\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Notes about the resolution\"\n                },\n                \"releaseMode\"\
        : {\n                    \"$ref\": \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation
        is handled for this escrow.\"\n                },\n                \"refundMode\": {\n                    \"$ref\"\
        : \"#/$defs/RefundMode\",\n                    \"description\": \"How refund confirmation is handled for this escrow.\"\
        \n                },\n                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for party confirmations when in Releasing/Refunding state.\"\n                }\n            }\n    \
        \    },\n        \"EscrowType\": {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow
        agreement.\\n- two_party: Simple trade escrow between Party A and Party B\\n- multi_party: N parties with complex
        deposit/receive rules\\n- conditional: Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all
        with refunds to losers\\n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\"\
        ,\n                \"conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"EscrowDeposit\": {\n   \
        \         \"type\": \"object\",\n            \"description\": \"Records an actual deposit\",\n            \"required\"\
        : [\n                \"id\",\n                \"escrowId\",\n                \"partyId\",\n                \"partyType\"\
        ,\n                \"assets\",\n                \"depositedAt\",\n                \"idempotencyKey\"\n           \
        \ ],\n            \"properties\": {\n                \"id\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"uuid\",\n                    \"description\": \"Deposit record identifier\"\n       \
        \         },\n                \"escrowId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"description\": \"Escrow this deposit belongs to\"\n                },\n       \
        \         \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n \
        \                   \"description\": \"Party who deposited\"\n                },\n                \"partyType\": {\n\
        \                    \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\"\
        : \"object\"\n                },\n                \"assets\": {\n                    \"$ref\": \"#/$defs/EscrowAssetBundle\"\
        ,\n                    \"description\": \"Assets deposited\"\n                },\n                \"depositedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"When the deposit was made\"\n                },\n                \"depositTokenUsed\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Token used (for audit)\"\n                },\n                \"idempotencyKey\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Idempotency key for this deposit\"\n                }\n    \
        \        }\n        },\n        \"EscrowAssetBundle\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Groups multiple assets for a single deposit or release\",\n            \"required\": [\n                \"bundleId\"\
        ,\n                \"assets\"\n            ],\n            \"properties\": {\n                \"bundleId\": {\n  \
        \                  \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Bundle identifier\"\n                },\n                \"assets\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                 \
        \   },\n                    \"description\": \"Assets in this bundle\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Summary for display\"\n                },\n                \"estimatedValue\": {\n                    \"type\"\
        : \"number\",\n                    \"nullable\": true,\n                    \"description\": \"Optional valuation
        for UI display\"\n                }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\"\
        : \"object\",\n            \"description\": \"Defines who gets what on release\",\n            \"required\": [\n \
        \               \"recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n     \
        \       ],\n            \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\":
        \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\
        \n                },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n     \
        \               \"description\": \"Type of the recipient party\"\n                },\n                \"assets\":
        {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/EscrowAsset\"\n                    },\n                    \"description\": \"Assets this recipient should
        receive\"\n                },\n                \"destinationWalletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Where to deliver currency\"\n                },\n                \"destinationContainerId\": {\n             \
        \       \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n \
        \       \"EscrowConsent\": {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent
        decision\",\n            \"required\": [\n                \"partyId\",\n                \"partyType\",\n         \
        \       \"consentType\",\n                \"consentedAt\"\n            ],\n            \"properties\": {\n       \
        \         \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n \
        \                   \"description\": \"Party giving consent\"\n                },\n                \"partyType\":
        {\n                    \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\"\
        : \"object\"\n                },\n                \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\"\
        ,\n                    \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n   \
        \                 \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Token used (for audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Optional notes\"\n            \
        \    }\n            }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n         \
        \   \"description\": \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund:
        Agrees to refund assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\\
        n\",\n            \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\"\
        ,\n                \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"\
        string\",\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for
        parties to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting
        consent/condition\\n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for
        contract fulfillment or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\
        n- releasing: Release in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund
        in progress (transient)\\n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\
        n- expired: Timed out without completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held
        assets changed, awaiting re-affirmation\\n\",\n            \"enum\": [\n                \"pending_deposits\",\n  \
        \              \"partially_funded\",\n                \"funded\",\n                \"pending_consent\",\n        \
        \        \"pending_condition\",\n                \"finalizing\",\n                \"releasing\",\n               \
        \ \"released\",\n                \"refunding\",\n                \"refunded\",\n                \"disputed\",\n  \
        \              \"expired\",\n                \"cancelled\",\n                \"validation_failed\"\n            ]\n\
        \        },\n        \"EscrowResolution\": {\n            \"type\": \"string\",\n            \"description\": \"How
        the escrow was resolved.\\n- released: Assets went to designated recipients\\n- refunded: Assets returned to depositors\\
        n- split: Arbiter split assets between parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded:
        Cancelled, deposits refunded\\n- violation_refunded: Validation failure caused refund\\n\",\n            \"enum\"\
        : [\n                \"released\",\n                \"refunded\",\n                \"split\",\n                \"\
        expired_refunded\",\n                \"cancelled_refunded\",\n                \"violation_refunded\"\n           \
        \ ]\n        },\n        \"ReleaseMode\": {\n            \"type\": \"string\",\n            \"description\": \"Controls
        how release confirmation is handled:\\n- immediate: Finalizing \\u2192 Released (skip Releasing state entirely).\\\
        n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios (NPC vendors, system rewards).\\n  Assets are
        marked as released BEFORE downstream services confirm transfers.\\n  If downstream services fail, manual intervention
        may be required.\\n- service_only: Wait for downstream services (currency, inventory) to confirm transfers complete.\\
        n- party_required: Wait for all parties to call /confirm-release.\\n- service_and_party: Wait for both service completion
        AND party confirmation.\\n\",\n            \"enum\": [\n                \"immediate\",\n                \"service_only\"\
        ,\n                \"party_required\",\n                \"service_and_party\"\n            ]\n        },\n       \
        \ \"RefundMode\": {\n            \"type\": \"string\",\n            \"description\": \"Controls how refund confirmation
        is handled. Same semantics as ReleaseMode.\\nRefunds typically use 'immediate' since parties get their own assets
        back.\\n\",\n            \"enum\": [\n                \"immediate\",\n                \"service_only\",\n        \
        \        \"party_required\"\n            ]\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Manually trigger validation\",\n    \"description\": \"Manually trigger
        validation on an active escrow.\",\n    \"tags\": [\n        \"Validation\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"validateEscrow\"\n}"
  /escrow/reaffirm:
    post:
      operationId: reaffirm
      tags:
      - Validation
      summary: Re-affirm after validation failure
      description: Re-affirm after validation failure (party accepts changed state).
      x-permissions:
      - role: user
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReaffirmRequest'
      responses:
        '200':
          description: Reaffirmation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReaffirmResponse'
        '400':
          description: Reaffirmation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReaffirmRequest\"\
        ,\n    \"$defs\": {\n        \"ReaffirmRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to re-affirm after validation failure\",\n            \"required\": [\n                \"escrowId\",\n\
        \                \"partyId\",\n                \"partyType\",\n                \"idempotencyKey\"\n            ],\n\
        \            \"properties\": {\n                \"escrowId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"description\": \"Escrow ID\"\n                },\n  \
        \              \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party reaffirming\"\n                },\n                \"partyType\":
        {\n                    \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\"\
        : \"object\"\n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Release token\"\n               \
        \ },\n                \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ReaffirmResponse\"\
        ,\n    \"$defs\": {\n        \"ReaffirmResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from party re-affirming after validation failure\",\n            \"required\": [\n                \"\
        escrow\",\n                \"allReaffirmed\"\n            ],\n            \"properties\": {\n                \"escrow\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowAgreement\",\n                    \"description\": \"Reaffirmed
        escrow agreement\"\n                },\n                \"allReaffirmed\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether all parties have reaffirmed\"\n                }\n            }\n\
        \        },\n        \"EscrowAgreement\": {\n            \"type\": \"object\",\n            \"description\": \"Main
        escrow agreement record\",\n            \"required\": [\n                \"id\",\n                \"escrowType\",\n\
        \                \"trustMode\",\n                \"parties\",\n                \"expectedDeposits\",\n           \
        \     \"deposits\",\n                \"consents\",\n                \"status\",\n                \"requiredConsentsForRelease\"\
        ,\n                \"createdAt\",\n                \"createdBy\",\n                \"createdByType\",\n          \
        \      \"expiresAt\"\n            ],\n            \"properties\": {\n                \"id\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique
        escrow agreement identifier\"\n                },\n                \"escrowType\": {\n                    \"$ref\"\
        : \"#/$defs/EscrowType\",\n                    \"description\": \"Type of escrow agreement\"\n                },\n\
        \                \"trustMode\": {\n                    \"$ref\": \"#/$defs/EscrowTrustMode\",\n                  \
        \  \"description\": \"Trust mode for the escrow\"\n                },\n                \"trustedPartyId\": {\n   \
        \                 \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For single_party_trusted - which party has authority\"\n         \
        \       },\n                \"trustedPartyType\": {\n                    \"allOf\": [\n                        {\n\
        \                            \"type\": \"object\"\n                        }\n                    ],\n           \
        \         \"nullable\": true,\n                    \"description\": \"Type of the trusted party\"\n              \
        \  },\n                \"initiatorServiceId\": {\n                    \"type\": \"string\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For initiator_trusted - which service created this\"\n \
        \               },\n                \"parties\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/EscrowParty\"\n                    },\n              \
        \      \"description\": \"All parties involved in the escrow\"\n                },\n                \"expectedDeposits\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/ExpectedDeposit\"\n                    },\n                    \"description\": \"What deposits are expected
        from each party\"\n                },\n                \"deposits\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowDeposit\"\n                 \
        \   },\n                    \"description\": \"Actual deposits received\"\n                },\n                \"\
        releaseAllocations\": {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n     \
        \               \"items\": {\n                        \"$ref\": \"#/$defs/ReleaseAllocation\"\n                  \
        \  },\n                    \"description\": \"How assets should be distributed on release\"\n                },\n\
        \                \"boundContractId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Contract governing conditions
        for this escrow\"\n                },\n                \"consents\": {\n                    \"type\": \"array\",\n\
        \                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowConsent\"\n                 \
        \   },\n                    \"description\": \"Consent decisions from parties\"\n                },\n            \
        \    \"status\": {\n                    \"$ref\": \"#/$defs/EscrowStatus\",\n                    \"description\":
        \"Current escrow status\"\n                },\n                \"requiredConsentsForRelease\": {\n               \
        \     \"type\": \"integer\",\n                    \"description\": \"How many parties must consent for release (-1
        = all required)\"\n                },\n                \"lastValidatedAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"When the escrow was last validated\"\n                },\n                \"validationFailures\"\
        : {\n                    \"type\": \"array\",\n                    \"nullable\": true,\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/ValidationFailure\"\n                    },\n                   \
        \ \"description\": \"Any validation failures detected\"\n                },\n                \"createdAt\": {\n  \
        \                  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When the escrow was created\"\n                },\n                \"createdBy\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Who created the escrow\"\
        \n                },\n                \"createdByType\": {\n                    \"type\": \"object\",\n          \
        \          \"description\": \"Type of the creator entity\"\n                },\n                \"fundedAt\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"\
        nullable\": true,\n                    \"description\": \"When all expected deposits were received\"\n           \
        \     },\n                \"expiresAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"description\": \"Auto-refund if not completed by this time\"\n           \
        \     },\n                \"completedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When the escrow
        reached terminal state\"\n                },\n                \"referenceType\": {\n                    \"type\":
        \"string\",\n                    \"nullable\": true,\n                    \"description\": \"What this escrow is for
        (e.g., trade, auction, contract)\"\n                },\n                \"referenceId\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n        \
        \            \"description\": \"ID of the referenced entity\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Human-readable description\"\n                },\n                \"metadata\": {\n                    \"type\"\
        : \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n    \
        \                \"description\": \"Game/application specific metadata\"\n                },\n                \"resolution\"\
        : {\n                    \"$ref\": \"#/$defs/EscrowResolution\",\n                    \"description\": \"How the escrow
        was resolved\",\n                    \"nullable\": true\n                },\n                \"resolutionNotes\":
        {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Notes about the resolution\"\n                },\n                \"releaseMode\": {\n                    \"$ref\"\
        : \"#/$defs/ReleaseMode\",\n                    \"description\": \"How release confirmation is handled for this escrow.\"\
        \n                },\n                \"refundMode\": {\n                    \"$ref\": \"#/$defs/RefundMode\",\n \
        \                   \"description\": \"How refund confirmation is handled for this escrow.\"\n                },\n\
        \                \"confirmationDeadline\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"Deadline for party
        confirmations when in Releasing/Refunding state.\"\n                }\n            }\n        },\n        \"EscrowType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of escrow agreement.\\n- two_party: Simple
        trade escrow between Party A and Party B\\n- multi_party: N parties with complex deposit/receive rules\\n- conditional:
        Release based on external condition or contract fulfillment\\n- auction: Winner-takes-all with refunds to losers\\\
        n\",\n            \"enum\": [\n                \"two_party\",\n                \"multi_party\",\n                \"\
        conditional\",\n                \"auction\"\n            ]\n        },\n        \"EscrowTrustMode\": {\n         \
        \   \"type\": \"string\",\n            \"description\": \"Trust model for the escrow agreement.\\n- full_consent:
        All parties must explicitly consent using tokens\\n- initiator_trusted: The service that created the escrow can complete
        unilaterally\\n- single_party_trusted: A designated party can complete unilaterally\\n\",\n            \"enum\": [\n\
        \                \"full_consent\",\n                \"initiator_trusted\",\n                \"single_party_trusted\"\
        \n            ]\n        },\n        \"EscrowParty\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"A party in the escrow agreement\",\n            \"required\": [\n                \"partyId\",\n              \
        \  \"partyType\",\n                \"role\",\n                \"consentRequired\",\n                \"depositTokenUsed\"\
        ,\n                \"releaseTokenUsed\"\n            ],\n            \"properties\": {\n                \"partyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Party entity identifier\"\n                },\n                \"partyType\": {\n               \
        \     \"description\": \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n\
        \                },\n                \"displayName\": {\n                    \"type\": \"string\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Display name for UI/logging\"\n              \
        \  },\n                \"role\": {\n                    \"$ref\": \"#/$defs/EscrowPartyRole\",\n                 \
        \   \"description\": \"Role of this party in the escrow\"\n                },\n                \"consentRequired\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this party consent
        is required for release\"\n                },\n                \"walletId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Party own wallet (where currency comes from/returns to)\"\n                },\n                \"containerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Party own container (where items come from/return to)\"\n\
        \                },\n                \"escrowWalletId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Escrow wallet for THIS party deposits (owned by escrow)\"\n                },\n                \"escrowContainerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Escrow container for THIS party deposits (owned by escrow)\"\
        \n                },\n                \"depositToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for depositing (full_consent mode)\"\n\
        \                },\n                \"depositTokenUsed\": {\n                    \"type\": \"boolean\",\n       \
        \             \"description\": \"Whether the deposit token has been used\"\n                },\n                \"\
        depositTokenUsedAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"When the deposit token was used\"\
        \n                },\n                \"releaseToken\": {\n                    \"type\": \"string\",\n           \
        \         \"nullable\": true,\n                    \"description\": \"Token for consenting to release\"\n        \
        \        },\n                \"releaseTokenUsed\": {\n                    \"type\": \"boolean\",\n               \
        \     \"description\": \"Whether the release token has been used\"\n                },\n                \"releaseTokenUsedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When the release token was used\"\n              \
        \  }\n            }\n        },\n        \"EscrowPartyRole\": {\n            \"type\": \"string\",\n            \"\
        description\": \"Role of a party in the escrow.\\n- depositor: Deposits assets into escrow\\n- recipient: Receives
        assets when released\\n- depositor_recipient: Both deposits and can receive (typical for trades)\\n- arbiter: Can
        resolve disputes, does not deposit or receive\\n- observer: Can view status but cannot act\\n\",\n            \"enum\"\
        : [\n                \"depositor\",\n                \"recipient\",\n                \"depositor_recipient\",\n  \
        \              \"arbiter\",\n                \"observer\"\n            ]\n        },\n        \"ExpectedDeposit\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Defines what a party should deposit\",\n  \
        \          \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"expectedAssets\"\
        ,\n                \"optional\",\n                \"fulfilled\"\n            ],\n            \"properties\": {\n \
        \               \"partyId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Party who should deposit\"\n                },\n                \"partyType\"\
        : {\n                    \"description\": \"Type of depositing party\",\n                    \"type\": \"object\"\n\
        \                },\n                \"expectedAssets\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n      \
        \              \"description\": \"Expected assets from this party\"\n                },\n                \"optional\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Is this deposit optional\"\
        \n                },\n                \"depositDeadline\": {\n                    \"type\": \"string\",\n        \
        \            \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Deadline for this specific deposit\"\n                },\n                \"fulfilled\": {\n                 \
        \   \"type\": \"boolean\",\n                    \"description\": \"Has this party fulfilled their deposit requirement\"\
        \n                }\n            }\n        },\n        \"EscrowAsset\": {\n            \"type\": \"object\",\n  \
        \          \"description\": \"An asset held in escrow\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"sourceOwnerId\",\n                \"sourceOwnerType\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\",\n                    \"\
        description\": \"Type of asset held in escrow\"\n                },\n                \"currencyDefinitionId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"For assetType=currency - currency definition ID\"\n              \
        \  },\n                \"currencyCode\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized currency code for display\"\n                },\n   \
        \             \"currencyAmount\": {\n                    \"type\": \"number\",\n                    \"nullable\":
        true,\n                    \"description\": \"Amount of currency\"\n                },\n                \"itemInstanceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"For assetType=item - unique item instance ID\"\n       \
        \         },\n                \"itemName\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Denormalized item name for display\"\n                },\n       \
        \         \"itemTemplateId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - stackable
        item template\"\n                },\n                \"itemTemplateName\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Denormalized template name for
        display\"\n                },\n                \"itemQuantity\": {\n                    \"type\": \"integer\",\n \
        \                   \"nullable\": true,\n                    \"description\": \"For assetType=item_stack - quantity\"\
        \n                },\n                \"contractInstanceId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=contract - contract instance ID\"\n                },\n                \"contractTemplateCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Denormalized contract template code\"\n                },\n                \"contractDescription\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Description of the contract\"\n                },\n                \"contractPartyRole\": {\n                \
        \    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Which
        party role in the contract is being escrowed\"\n                },\n                \"customAssetType\": {\n     \
        \               \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"For assetType=custom - registered handler type\"\n                },\n                \"customAssetId\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Custom asset identifier\"\n                },\n                \"customAssetData\": {\n                    \"\
        type\": \"object\",\n                    \"nullable\": true,\n                    \"additionalProperties\": true,\n\
        \                    \"description\": \"Handler-specific data\"\n                },\n                \"sourceOwnerId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Where this asset came from (for refunds)\"\n                },\n                \"sourceOwnerType\"\
        : {\n                    \"type\": \"object\",\n                    \"description\": \"Type of the source owner\"\n\
        \                },\n                \"sourceContainerId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Source wallet/container ID\"\n                }\n            }\n        },\n        \"AssetType\": {\n       \
        \     \"type\": \"string\",\n            \"description\": \"Type of asset held in escrow.\\n- currency: Currency amount
        held in escrow wallet\\n- item: Item instance held in escrow container\\n- item_stack: Stackable items (quantity)
        held in escrow container\\n- contract: Contract instance locked under escrow guardianship\\n- custom: Custom asset
        type via registered handler\\n\",\n            \"enum\": [\n                \"currency\",\n                \"item\"\
        ,\n                \"item_stack\",\n                \"contract\",\n                \"custom\"\n            ]\n   \
        \     },\n        \"EscrowDeposit\": {\n            \"type\": \"object\",\n            \"description\": \"Records
        an actual deposit\",\n            \"required\": [\n                \"id\",\n                \"escrowId\",\n      \
        \          \"partyId\",\n                \"partyType\",\n                \"assets\",\n                \"depositedAt\"\
        ,\n                \"idempotencyKey\"\n            ],\n            \"properties\": {\n                \"id\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Deposit record identifier\"\n                },\n                \"escrowId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Escrow this deposit
        belongs to\"\n                },\n                \"partyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party who deposited\"\n           \
        \     },\n                \"partyType\": {\n                    \"description\": \"Type of entity (Account, Character,
        etc.)\",\n                    \"type\": \"object\"\n                },\n                \"assets\": {\n          \
        \          \"$ref\": \"#/$defs/EscrowAssetBundle\",\n                    \"description\": \"Assets deposited\"\n \
        \               },\n                \"depositedAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"description\": \"When the deposit was made\"\n          \
        \      },\n                \"depositTokenUsed\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Token used (for audit)\"\n                },\n    \
        \            \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Idempotency key for this deposit\"\n                }\n            }\n        },\n        \"EscrowAssetBundle\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Groups multiple assets for a single deposit
        or release\",\n            \"required\": [\n                \"bundleId\",\n                \"assets\"\n          \
        \  ],\n            \"properties\": {\n                \"bundleId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Bundle identifier\"\n         \
        \       },\n                \"assets\": {\n                    \"type\": \"array\",\n                    \"items\"\
        : {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\n                    },\n                    \"description\"\
        : \"Assets in this bundle\"\n                },\n                \"description\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Summary for display\"\
        \n                },\n                \"estimatedValue\": {\n                    \"type\": \"number\",\n         \
        \           \"nullable\": true,\n                    \"description\": \"Optional valuation for UI display\"\n    \
        \            }\n            }\n        },\n        \"ReleaseAllocation\": {\n            \"type\": \"object\",\n \
        \           \"description\": \"Defines who gets what on release\",\n            \"required\": [\n                \"\
        recipientPartyId\",\n                \"recipientPartyType\",\n                \"assets\"\n            ],\n       \
        \     \"properties\": {\n                \"recipientPartyId\": {\n                    \"type\": \"string\",\n    \
        \                \"format\": \"uuid\",\n                    \"description\": \"Party receiving assets\"\n        \
        \        },\n                \"recipientPartyType\": {\n                    \"type\": \"object\",\n              \
        \      \"description\": \"Type of the recipient party\"\n                },\n                \"assets\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EscrowAsset\"\
        \n                    },\n                    \"description\": \"Assets this recipient should receive\"\n        \
        \        },\n                \"destinationWalletId\": {\n                    \"type\": \"string\",\n             \
        \       \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Where
        to deliver currency\"\n                },\n                \"destinationContainerId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Where to deliver items\"\n                }\n            }\n        },\n        \"EscrowConsent\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Records a party consent decision\",\n     \
        \       \"required\": [\n                \"partyId\",\n                \"partyType\",\n                \"consentType\"\
        ,\n                \"consentedAt\"\n            ],\n            \"properties\": {\n                \"partyId\": {\n\
        \                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Party giving consent\"\n                },\n                \"partyType\": {\n                    \"description\"\
        : \"Type of entity (Account, Character, etc.)\",\n                    \"type\": \"object\"\n                },\n \
        \               \"consentType\": {\n                    \"$ref\": \"#/$defs/EscrowConsentType\",\n               \
        \     \"description\": \"Type of consent given\"\n                },\n                \"consentedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When consent was given\"\n                },\n                \"releaseTokenUsed\": {\n                    \"\
        type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Token used (for
        audit)\"\n                },\n                \"notes\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Optional notes\"\n                }\n     \
        \       }\n        },\n        \"EscrowConsentType\": {\n            \"type\": \"string\",\n            \"description\"\
        : \"Type of consent being given.\\n- release: Agrees to release assets to recipients\\n- refund: Agrees to refund
        assets to depositors\\n- dispute: Raises a dispute\\n- reaffirm: Re-affirms after validation failure\\n\",\n     \
        \       \"enum\": [\n                \"release\",\n                \"refund\",\n                \"dispute\",\n   \
        \             \"reaffirm\"\n            ]\n        },\n        \"EscrowStatus\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Current status of the escrow agreement.\\n- pending_deposits: Waiting for parties
        to deposit\\n- partially_funded: Some but not all deposits received\\n- funded: All deposits received, awaiting consent/condition\\
        n- pending_consent: Some consents received, waiting for more\\n- pending_condition: Waiting for contract fulfillment
        or external verification\\n- finalizing: Running contract finalizer prebound APIs (transient)\\n- releasing: Release
        in progress (transient)\\n- released: Assets transferred to recipients\\n- refunding: Refund in progress (transient)\\
        n- refunded: Assets returned to depositors\\n- disputed: In dispute, arbiter must resolve\\n- expired: Timed out without
        completion\\n- cancelled: Cancelled before funding complete\\n- validation_failed: Held assets changed, awaiting re-affirmation\\\
        n\",\n            \"enum\": [\n                \"pending_deposits\",\n                \"partially_funded\",\n    \
        \            \"funded\",\n                \"pending_consent\",\n                \"pending_condition\",\n         \
        \       \"finalizing\",\n                \"releasing\",\n                \"released\",\n                \"refunding\"\
        ,\n                \"refunded\",\n                \"disputed\",\n                \"expired\",\n                \"\
        cancelled\",\n                \"validation_failed\"\n            ]\n        },\n        \"ValidationFailure\": {\n\
        \            \"type\": \"object\",\n            \"description\": \"Records a validation check failure\",\n       \
        \     \"required\": [\n                \"detectedAt\",\n                \"assetType\",\n                \"assetDescription\"\
        ,\n                \"failureType\",\n                \"affectedPartyId\",\n                \"affectedPartyType\"\n\
        \            ],\n            \"properties\": {\n                \"detectedAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When the failure
        was detected\"\n                },\n                \"assetType\": {\n                    \"$ref\": \"#/$defs/AssetType\"\
        ,\n                    \"description\": \"Type of asset affected\"\n                },\n                \"assetDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Description of the affected
        asset\"\n                },\n                \"failureType\": {\n                    \"$ref\": \"#/$defs/ValidationFailureType\"\
        ,\n                    \"description\": \"Type of validation failure\"\n                },\n                \"affectedPartyId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Which party deposit is affected\"\n                },\n                \"affectedPartyType\": {\n\
        \                    \"type\": \"object\",\n                    \"description\": \"Type of the affected party\"\n\
        \                },\n                \"details\": {\n                    \"type\": \"object\",\n                 \
        \   \"nullable\": true,\n                    \"additionalProperties\": true,\n                    \"description\"\
        : \"Additional failure details\"\n                }\n            }\n        },\n        \"ValidationFailureType\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"Type of validation failure detected.\\n- asset_missing:
        Asset no longer exists in escrow custody\\n- asset_mutated: Asset properties changed (e.g., item durability)\\n- asset_expired:
        Asset has a time-based expiration that triggered\\n- balance_mismatch: Wallet balance does not match expected held
        amount\\n\",\n            \"enum\": [\n                \"asset_missing\",\n                \"asset_mutated\",\n  \
        \              \"asset_expired\",\n                \"balance_mismatch\"\n            ]\n        },\n        \"EscrowResolution\"\
        : {\n            \"type\": \"string\",\n            \"description\": \"How the escrow was resolved.\\n- released:
        Assets went to designated recipients\\n- refunded: Assets returned to depositors\\n- split: Arbiter split assets between
        parties\\n- expired_refunded: Timed out, auto-refunded\\n- cancelled_refunded: Cancelled, deposits refunded\\n- violation_refunded:
        Validation failure caused refund\\n\",\n            \"enum\": [\n                \"released\",\n                \"\
        refunded\",\n                \"split\",\n                \"expired_refunded\",\n                \"cancelled_refunded\"\
        ,\n                \"violation_refunded\"\n            ]\n        },\n        \"ReleaseMode\": {\n            \"type\"\
        : \"string\",\n            \"description\": \"Controls how release confirmation is handled:\\n- immediate: Finalizing
        \\u2192 Released (skip Releasing state entirely).\\n  \\u26a0\\ufe0f WARNING: Use only for trusted/low-value scenarios
        (NPC vendors, system rewards).\\n  Assets are marked as released BEFORE downstream services confirm transfers.\\n\
        \  If downstream services fail, manual intervention may be required.\\n- service_only: Wait for downstream services
        (currency, inventory) to confirm transfers complete.\\n- party_required: Wait for all parties to call /confirm-release.\\
        n- service_and_party: Wait for both service completion AND party confirmation.\\n\",\n            \"enum\": [\n  \
        \              \"immediate\",\n                \"service_only\",\n                \"party_required\",\n          \
        \      \"service_and_party\"\n            ]\n        },\n        \"RefundMode\": {\n            \"type\": \"string\"\
        ,\n            \"description\": \"Controls how refund confirmation is handled. Same semantics as ReleaseMode.\\nRefunds
        typically use 'immediate' since parties get their own assets back.\\n\",\n            \"enum\": [\n              \
        \  \"immediate\",\n                \"service_only\",\n                \"party_required\"\n            ]\n        }\n\
        \    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Re-affirm after validation failure\",\n    \"description\": \"Re-affirm
        after validation failure (party accepts changed state).\",\n    \"tags\": [\n        \"Validation\"\n    ],\n    \"\
        deprecated\": false,\n    \"operationId\": \"reaffirm\"\n}"
  /escrow/handler/register:
    post:
      operationId: registerHandler
      tags:
      - Handlers
      summary: Register a custom asset type handler
      description: Register a custom asset type handler for extensibility.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterHandlerRequest'
      responses:
        '200':
          description: Handler registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterHandlerResponse'
        '400':
          description: Registration failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RegisterHandlerRequest\"\
        ,\n    \"$defs\": {\n        \"RegisterHandlerRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to register a custom asset type handler\",\n            \"required\": [\n                \"assetType\"\
        ,\n                \"pluginId\",\n                \"depositEndpoint\",\n                \"releaseEndpoint\",\n   \
        \             \"refundEndpoint\",\n                \"validateEndpoint\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Unique asset type identifier\"\n                },\n                \"pluginId\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Plugin implementing this handler\"\n                },\n   \
        \             \"depositEndpoint\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Deposit endpoint path\"\n                },\n                \"releaseEndpoint\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Release endpoint path\"\n                },\n              \
        \  \"refundEndpoint\": {\n                    \"type\": \"string\",\n                    \"description\": \"Refund
        endpoint path\"\n                },\n                \"validateEndpoint\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Validate endpoint path\"\n                }\n            }\n        }\n\
        \    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/RegisterHandlerResponse\"\
        ,\n    \"$defs\": {\n        \"RegisterHandlerResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from registering an asset handler\",\n            \"required\": [\n                \"registered\"\n \
        \           ],\n            \"properties\": {\n                \"registered\": {\n                    \"type\": \"\
        boolean\",\n                    \"description\": \"Whether registration succeeded\"\n                }\n         \
        \   }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Register a custom asset type handler\",\n    \"description\": \"Register
        a custom asset type handler for extensibility.\",\n    \"tags\": [\n        \"Handlers\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"registerHandler\"\n}"
  /escrow/handler/list:
    post:
      operationId: listHandlers
      tags:
      - Handlers
      summary: List registered asset handlers
      description: List registered asset handlers (includes built-in).
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListHandlersRequest'
      responses:
        '200':
          description: List of handlers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListHandlersResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListHandlersRequest\"\
        ,\n    \"$defs\": {\n        \"ListHandlersRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Empty request to list handlers\",\n            \"properties\": {}\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListHandlersResponse\"\
        ,\n    \"$defs\": {\n        \"ListHandlersResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response containing list of registered asset handlers\",\n            \"required\": [\n                \"handlers\"\
        \n            ],\n            \"properties\": {\n                \"handlers\": {\n                    \"type\": \"\
        array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/AssetHandlerInfo\"\n     \
        \               },\n                    \"description\": \"Registered handlers\"\n                }\n            }\n\
        \        },\n        \"AssetHandlerInfo\": {\n            \"type\": \"object\",\n            \"description\": \"Information
        about a registered asset handler\",\n            \"required\": [\n                \"assetType\",\n               \
        \ \"pluginId\",\n                \"builtIn\",\n                \"depositEndpoint\",\n                \"releaseEndpoint\"\
        ,\n                \"refundEndpoint\",\n                \"validateEndpoint\"\n            ],\n            \"properties\"\
        : {\n                \"assetType\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Unique asset type identifier\"\n                },\n                \"pluginId\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Plugin that implements this handler\"\n                },\n\
        \                \"builtIn\": {\n                    \"type\": \"boolean\",\n                    \"description\":
        \"Whether this is a built-in handler\"\n                },\n                \"depositEndpoint\": {\n             \
        \       \"type\": \"string\",\n                    \"description\": \"Endpoint for depositing\"\n                },\n\
        \                \"releaseEndpoint\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Endpoint for releasing\"\n                },\n                \"refundEndpoint\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Endpoint for refunding\"\n                },\n             \
        \   \"validateEndpoint\": {\n                    \"type\": \"string\",\n                    \"description\": \"Endpoint
        for validation\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List registered asset handlers\",\n    \"description\": \"List registered
        asset handlers (includes built-in).\",\n    \"tags\": [\n        \"Handlers\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"listHandlers\"\n}"
  /escrow/handler/deregister:
    post:
      operationId: deregisterHandler
      tags:
      - Handlers
      summary: Remove a custom asset handler registration
      description: Remove a custom asset handler registration.
      x-permissions:
      - role: admin
        states: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeregisterHandlerRequest'
      responses:
        '200':
          description: Handler deregistered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeregisterHandlerResponse'
        '400':
          description: Deregistration failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeregisterHandlerRequest\"\
        ,\n    \"$defs\": {\n        \"DeregisterHandlerRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to remove a custom asset handler registration\",\n            \"required\": [\n                \"assetType\"\
        \n            ],\n            \"properties\": {\n                \"assetType\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Asset type to deregister\"\n                }\n            }\n \
        \       }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeregisterHandlerResponse\"\
        ,\n    \"$defs\": {\n        \"DeregisterHandlerResponse\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Response from deregistering an asset handler\",\n            \"required\": [\n                \"deregistered\"\
        \n            ],\n            \"properties\": {\n                \"deregistered\": {\n                    \"type\"\
        : \"boolean\",\n                    \"description\": \"Whether deregistration succeeded\"\n                }\n   \
        \         }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Remove a custom asset handler registration\",\n    \"description\": \"\
        Remove a custom asset handler registration.\",\n    \"tags\": [\n        \"Handlers\"\n    ],\n    \"deprecated\"\
        : false,\n    \"operationId\": \"deregisterHandler\"\n}"
components:
  schemas:
    EscrowType:
      type: string
      description: |
        Type of escrow agreement.
        - two_party: Simple trade escrow between Party A and Party B
        - multi_party: N parties with complex deposit/receive rules
        - conditional: Release based on external condition or contract fulfillment
        - auction: Winner-takes-all with refunds to losers
      enum:
      - two_party
      - multi_party
      - conditional
      - auction
    EscrowStatus:
      type: string
      description: |
        Current status of the escrow agreement.
        - pending_deposits: Waiting for parties to deposit
        - partially_funded: Some but not all deposits received
        - funded: All deposits received, awaiting consent/condition
        - pending_consent: Some consents received, waiting for more
        - pending_condition: Waiting for contract fulfillment or external verification
        - finalizing: Running contract finalizer prebound APIs (transient)
        - releasing: Release in progress (transient)
        - released: Assets transferred to recipients
        - refunding: Refund in progress (transient)
        - refunded: Assets returned to depositors
        - disputed: In dispute, arbiter must resolve
        - expired: Timed out without completion
        - cancelled: Cancelled before funding complete
        - validation_failed: Held assets changed, awaiting re-affirmation
      enum:
      - pending_deposits
      - partially_funded
      - funded
      - pending_consent
      - pending_condition
      - finalizing
      - releasing
      - released
      - refunding
      - refunded
      - disputed
      - expired
      - cancelled
      - validation_failed
    EscrowTrustMode:
      type: string
      description: |
        Trust model for the escrow agreement.
        - full_consent: All parties must explicitly consent using tokens
        - initiator_trusted: The service that created the escrow can complete unilaterally
        - single_party_trusted: A designated party can complete unilaterally
      enum:
      - full_consent
      - initiator_trusted
      - single_party_trusted
    EscrowPartyRole:
      type: string
      description: |
        Role of a party in the escrow.
        - depositor: Deposits assets into escrow
        - recipient: Receives assets when released
        - depositor_recipient: Both deposits and can receive (typical for trades)
        - arbiter: Can resolve disputes, does not deposit or receive
        - observer: Can view status but cannot act
      enum:
      - depositor
      - recipient
      - depositor_recipient
      - arbiter
      - observer
    EscrowConsentType:
      type: string
      description: |
        Type of consent being given.
        - release: Agrees to release assets to recipients
        - refund: Agrees to refund assets to depositors
        - dispute: Raises a dispute
        - reaffirm: Re-affirms after validation failure
      enum:
      - release
      - refund
      - dispute
      - reaffirm
    EscrowResolution:
      type: string
      description: |
        How the escrow was resolved.
        - released: Assets went to designated recipients
        - refunded: Assets returned to depositors
        - split: Arbiter split assets between parties
        - expired_refunded: Timed out, auto-refunded
        - cancelled_refunded: Cancelled, deposits refunded
        - violation_refunded: Validation failure caused refund
      enum:
      - released
      - refunded
      - split
      - expired_refunded
      - cancelled_refunded
      - violation_refunded
    AssetType:
      type: string
      description: |
        Type of asset held in escrow.
        - currency: Currency amount held in escrow wallet
        - item: Item instance held in escrow container
        - item_stack: Stackable items (quantity) held in escrow container
        - contract: Contract instance locked under escrow guardianship
        - custom: Custom asset type via registered handler
      enum:
      - currency
      - item
      - item_stack
      - contract
      - custom
    ValidationFailureType:
      type: string
      description: |
        Type of validation failure detected.
        - asset_missing: Asset no longer exists in escrow custody
        - asset_mutated: Asset properties changed (e.g., item durability)
        - asset_expired: Asset has a time-based expiration that triggered
        - balance_mismatch: Wallet balance does not match expected held amount
      enum:
      - asset_missing
      - asset_mutated
      - asset_expired
      - balance_mismatch
    TokenAlgorithm:
      type: string
      description: |
        Algorithm used for token generation.
        - hmac_sha256: HMAC-SHA256 based tokens
        - random_bytes: Cryptographically random tokens
      enum:
      - hmac_sha256
      - random_bytes
    TokenType:
      type: string
      description: |
        Type of token being requested.
        - deposit: Token for depositing assets
        - release: Token for consenting to release
      enum:
      - deposit
      - release
    ReleaseMode:
      type: string
      description: |
        Controls how release confirmation is handled:
        - immediate: Finalizing  Released (skip Releasing state entirely).
           WARNING: Use only for trusted/low-value scenarios (NPC vendors, system rewards).
          Assets are marked as released BEFORE downstream services confirm transfers.
          If downstream services fail, manual intervention may be required.
        - service_only: Wait for downstream services (currency, inventory) to confirm transfers complete.
        - party_required: Wait for all parties to call /confirm-release.
        - service_and_party: Wait for both service completion AND party confirmation.
      enum:
      - immediate
      - service_only
      - party_required
      - service_and_party
    RefundMode:
      type: string
      description: |
        Controls how refund confirmation is handled. Same semantics as ReleaseMode.
        Refunds typically use 'immediate' since parties get their own assets back.
      enum:
      - immediate
      - service_only
      - party_required
    ConfirmationTimeoutBehavior:
      type: string
      description: |
        What happens when confirmation timeout expires:
        - auto_confirm: If service events received, auto-confirm parties (default).
        - dispute: Transition to Disputed state, require arbiter intervention.
        - refund: Treat as failed, transition to Refunding.
      enum:
      - auto_confirm
      - dispute
      - refund
    EscrowAgreement:
      type: object
      description: Main escrow agreement record
      required:
      - id
      - escrowType
      - trustMode
      - parties
      - expectedDeposits
      - deposits
      - consents
      - status
      - requiredConsentsForRelease
      - createdAt
      - createdBy
      - createdByType
      - expiresAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique escrow agreement identifier
        escrowType:
          $ref: '#/components/schemas/EscrowType'
          description: Type of escrow agreement
        trustMode:
          $ref: '#/components/schemas/EscrowTrustMode'
          description: Trust mode for the escrow
        trustedPartyId:
          type: string
          format: uuid
          nullable: true
          description: For single_party_trusted - which party has authority
        trustedPartyType:
          allOf:
          - $ref: './common-api.yaml#/components/schemas/EntityType'
          nullable: true
          description: Type of the trusted party
        initiatorServiceId:
          type: string
          nullable: true
          description: For initiator_trusted - which service created this
        parties:
          type: array
          items:
            $ref: '#/components/schemas/EscrowParty'
          description: All parties involved in the escrow
        expectedDeposits:
          type: array
          items:
            $ref: '#/components/schemas/ExpectedDeposit'
          description: What deposits are expected from each party
        deposits:
          type: array
          items:
            $ref: '#/components/schemas/EscrowDeposit'
          description: Actual deposits received
        releaseAllocations:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/ReleaseAllocation'
          description: How assets should be distributed on release
        boundContractId:
          type: string
          format: uuid
          nullable: true
          description: Contract governing conditions for this escrow
        consents:
          type: array
          items:
            $ref: '#/components/schemas/EscrowConsent'
          description: Consent decisions from parties
        status:
          $ref: '#/components/schemas/EscrowStatus'
          description: Current escrow status
        requiredConsentsForRelease:
          type: integer
          description: How many parties must consent for release (-1 = all required)
        lastValidatedAt:
          type: string
          format: date-time
          nullable: true
          description: When the escrow was last validated
        validationFailures:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/ValidationFailure'
          description: Any validation failures detected
        createdAt:
          type: string
          format: date-time
          description: When the escrow was created
        createdBy:
          type: string
          format: uuid
          description: Who created the escrow
        createdByType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Type of the creator entity
        fundedAt:
          type: string
          format: date-time
          nullable: true
          description: When all expected deposits were received
        expiresAt:
          type: string
          format: date-time
          description: Auto-refund if not completed by this time
        completedAt:
          type: string
          format: date-time
          nullable: true
          description: When the escrow reached terminal state
        referenceType:
          type: string
          nullable: true
          description: What this escrow is for (e.g., trade, auction, contract)
        referenceId:
          type: string
          format: uuid
          nullable: true
          description: ID of the referenced entity
        description:
          type: string
          nullable: true
          description: Human-readable description
        metadata:
          type: object
          nullable: true
          additionalProperties: true
          description: Game/application specific metadata
        resolution:
          $ref: '#/components/schemas/EscrowResolution'
          description: How the escrow was resolved
          nullable: true
        resolutionNotes:
          type: string
          nullable: true
          description: Notes about the resolution
        releaseMode:
          $ref: '#/components/schemas/ReleaseMode'
          description: How release confirmation is handled for this escrow.
        refundMode:
          $ref: '#/components/schemas/RefundMode'
          description: How refund confirmation is handled for this escrow.
        confirmationDeadline:
          type: string
          format: date-time
          nullable: true
          description: Deadline for party confirmations when in Releasing/Refunding state.
    EscrowParty:
      type: object
      description: A party in the escrow agreement
      required:
      - partyId
      - partyType
      - role
      - consentRequired
      - depositTokenUsed
      - releaseTokenUsed
      properties:
        partyId:
          type: string
          format: uuid
          description: Party entity identifier
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        displayName:
          type: string
          nullable: true
          description: Display name for UI/logging
        role:
          $ref: '#/components/schemas/EscrowPartyRole'
          description: Role of this party in the escrow
        consentRequired:
          type: boolean
          description: Whether this party consent is required for release
        walletId:
          type: string
          format: uuid
          nullable: true
          description: Party own wallet (where currency comes from/returns to)
        containerId:
          type: string
          format: uuid
          nullable: true
          description: Party own container (where items come from/return to)
        escrowWalletId:
          type: string
          format: uuid
          nullable: true
          description: Escrow wallet for THIS party deposits (owned by escrow)
        escrowContainerId:
          type: string
          format: uuid
          nullable: true
          description: Escrow container for THIS party deposits (owned by escrow)
        depositToken:
          type: string
          nullable: true
          description: Token for depositing (full_consent mode)
        depositTokenUsed:
          type: boolean
          description: Whether the deposit token has been used
        depositTokenUsedAt:
          type: string
          format: date-time
          nullable: true
          description: When the deposit token was used
        releaseToken:
          type: string
          nullable: true
          description: Token for consenting to release
        releaseTokenUsed:
          type: boolean
          description: Whether the release token has been used
        releaseTokenUsedAt:
          type: string
          format: date-time
          nullable: true
          description: When the release token was used
    EscrowAsset:
      type: object
      description: An asset held in escrow
      required:
      - assetType
      - sourceOwnerId
      - sourceOwnerType
      properties:
        assetType:
          $ref: '#/components/schemas/AssetType'
          description: Type of asset held in escrow
        currencyDefinitionId:
          type: string
          format: uuid
          nullable: true
          description: For assetType=currency - currency definition ID
        currencyCode:
          type: string
          nullable: true
          description: Denormalized currency code for display
        currencyAmount:
          type: number
          nullable: true
          description: Amount of currency
        itemInstanceId:
          type: string
          format: uuid
          nullable: true
          description: For assetType=item - unique item instance ID
        itemName:
          type: string
          nullable: true
          description: Denormalized item name for display
        itemTemplateId:
          type: string
          format: uuid
          nullable: true
          description: For assetType=item_stack - stackable item template
        itemTemplateName:
          type: string
          nullable: true
          description: Denormalized template name for display
        itemQuantity:
          type: integer
          nullable: true
          description: For assetType=item_stack - quantity
        contractInstanceId:
          type: string
          format: uuid
          nullable: true
          description: For assetType=contract - contract instance ID
        contractTemplateCode:
          type: string
          nullable: true
          description: Denormalized contract template code
        contractDescription:
          type: string
          nullable: true
          description: Description of the contract
        contractPartyRole:
          type: string
          nullable: true
          description: Which party role in the contract is being escrowed
        customAssetType:
          type: string
          nullable: true
          description: For assetType=custom - registered handler type
        customAssetId:
          type: string
          nullable: true
          description: Custom asset identifier
        customAssetData:
          type: object
          nullable: true
          additionalProperties: true
          description: Handler-specific data
        sourceOwnerId:
          type: string
          format: uuid
          description: Where this asset came from (for refunds)
        sourceOwnerType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Type of the source owner
        sourceContainerId:
          type: string
          format: uuid
          nullable: true
          description: Source wallet/container ID
    EscrowAssetBundle:
      type: object
      description: Groups multiple assets for a single deposit or release
      required:
      - bundleId
      - assets
      properties:
        bundleId:
          type: string
          format: uuid
          description: Bundle identifier
        assets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAsset'
          description: Assets in this bundle
        description:
          type: string
          nullable: true
          description: Summary for display
        estimatedValue:
          type: number
          nullable: true
          description: Optional valuation for UI display
    ExpectedDeposit:
      type: object
      description: Defines what a party should deposit
      required:
      - partyId
      - partyType
      - expectedAssets
      - optional
      - fulfilled
      properties:
        partyId:
          type: string
          format: uuid
          description: Party who should deposit
        partyType:
          description: Type of depositing party
          $ref: './common-api.yaml#/components/schemas/EntityType'
        expectedAssets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAsset'
          description: Expected assets from this party
        optional:
          type: boolean
          description: Is this deposit optional
        depositDeadline:
          type: string
          format: date-time
          nullable: true
          description: Deadline for this specific deposit
        fulfilled:
          type: boolean
          description: Has this party fulfilled their deposit requirement
    EscrowDeposit:
      type: object
      description: Records an actual deposit
      required:
      - id
      - escrowId
      - partyId
      - partyType
      - assets
      - depositedAt
      - idempotencyKey
      properties:
        id:
          type: string
          format: uuid
          description: Deposit record identifier
        escrowId:
          type: string
          format: uuid
          description: Escrow this deposit belongs to
        partyId:
          type: string
          format: uuid
          description: Party who deposited
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        assets:
          $ref: '#/components/schemas/EscrowAssetBundle'
          description: Assets deposited
        depositedAt:
          type: string
          format: date-time
          description: When the deposit was made
        depositTokenUsed:
          type: string
          nullable: true
          description: Token used (for audit)
        idempotencyKey:
          type: string
          description: Idempotency key for this deposit
    ReleaseAllocation:
      type: object
      description: Defines who gets what on release
      required:
      - recipientPartyId
      - recipientPartyType
      - assets
      properties:
        recipientPartyId:
          type: string
          format: uuid
          description: Party receiving assets
        recipientPartyType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Type of the recipient party
        assets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAsset'
          description: Assets this recipient should receive
        destinationWalletId:
          type: string
          format: uuid
          nullable: true
          description: Where to deliver currency
        destinationContainerId:
          type: string
          format: uuid
          nullable: true
          description: Where to deliver items
    EscrowConsent:
      type: object
      description: Records a party consent decision
      required:
      - partyId
      - partyType
      - consentType
      - consentedAt
      properties:
        partyId:
          type: string
          format: uuid
          description: Party giving consent
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        consentType:
          $ref: '#/components/schemas/EscrowConsentType'
          description: Type of consent given
        consentedAt:
          type: string
          format: date-time
          description: When consent was given
        releaseTokenUsed:
          type: string
          nullable: true
          description: Token used (for audit)
        notes:
          type: string
          nullable: true
          description: Optional notes
    ValidationFailure:
      type: object
      description: Records a validation check failure
      required:
      - detectedAt
      - assetType
      - assetDescription
      - failureType
      - affectedPartyId
      - affectedPartyType
      properties:
        detectedAt:
          type: string
          format: date-time
          description: When the failure was detected
        assetType:
          $ref: '#/components/schemas/AssetType'
          description: Type of asset affected
        assetDescription:
          type: string
          description: Description of the affected asset
        failureType:
          $ref: '#/components/schemas/ValidationFailureType'
          description: Type of validation failure
        affectedPartyId:
          type: string
          format: uuid
          description: Which party deposit is affected
        affectedPartyType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Type of the affected party
        details:
          type: object
          nullable: true
          additionalProperties: true
          description: Additional failure details
    AssetHandlerInfo:
      type: object
      description: Information about a registered asset handler
      required:
      - assetType
      - pluginId
      - builtIn
      - depositEndpoint
      - releaseEndpoint
      - refundEndpoint
      - validateEndpoint
      properties:
        assetType:
          type: string
          description: Unique asset type identifier
        pluginId:
          type: string
          description: Plugin that implements this handler
        builtIn:
          type: boolean
          description: Whether this is a built-in handler
        depositEndpoint:
          type: string
          description: Endpoint for depositing
        releaseEndpoint:
          type: string
          description: Endpoint for releasing
        refundEndpoint:
          type: string
          description: Endpoint for refunding
        validateEndpoint:
          type: string
          description: Endpoint for validation
    CreateEscrowRequest:
      type: object
      description: Request to create a new escrow agreement
      required:
      - escrowType
      - trustMode
      - parties
      - expectedDeposits
      - idempotencyKey
      properties:
        escrowType:
          $ref: '#/components/schemas/EscrowType'
          description: Type of escrow agreement
        trustMode:
          $ref: '#/components/schemas/EscrowTrustMode'
          description: Trust mode for the escrow
        trustedPartyId:
          type: string
          format: uuid
          nullable: true
          description: For single_party_trusted mode
        trustedPartyType:
          allOf:
          - $ref: './common-api.yaml#/components/schemas/EntityType'
          nullable: true
          description: Type of the trusted party
        parties:
          type: array
          items:
            $ref: '#/components/schemas/CreateEscrowPartyInput'
          description: Parties in the escrow
        expectedDeposits:
          type: array
          items:
            $ref: '#/components/schemas/ExpectedDepositInput'
          description: Expected deposits from parties
        releaseAllocations:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/ReleaseAllocationInput'
          description: Optional explicit release allocations
        boundContractId:
          type: string
          format: uuid
          nullable: true
          description: Contract governing this escrow
        requiredConsentsForRelease:
          type: integer
          nullable: true
          description: Number of consents required (-1 for all)
        expiresAt:
          type: string
          format: date-time
          nullable: true
          description: Optional expiration time
        referenceType:
          type: string
          nullable: true
          description: Reference type (trade, auction, etc.)
        referenceId:
          type: string
          format: uuid
          nullable: true
          description: Reference entity ID
        description:
          type: string
          nullable: true
          description: Human-readable description
        metadata:
          type: object
          nullable: true
          additionalProperties: true
          description: Application metadata
        releaseMode:
          allOf:
          - $ref: '#/components/schemas/ReleaseMode'
          nullable: true
          description: |
            How release confirmation is handled. Defaults to service_only if not specified.
            Only applies to unbound escrows; contract-bound escrows follow contract fulfillment.
        refundMode:
          allOf:
          - $ref: '#/components/schemas/RefundMode'
          nullable: true
          description: How refund confirmation is handled. Defaults to immediate if not specified.
        idempotencyKey:
          type: string
          description: Idempotency key for this operation
    CreateEscrowPartyInput:
      type: object
      description: Input for defining a party in escrow creation
      required:
      - partyId
      - partyType
      - role
      properties:
        partyId:
          type: string
          format: uuid
          description: Party entity ID
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        displayName:
          type: string
          nullable: true
          description: Display name
        role:
          $ref: '#/components/schemas/EscrowPartyRole'
          description: Role of this party in the escrow
        consentRequired:
          type: boolean
          nullable: true
          description: Whether consent is required (defaults based on role)
        walletId:
          type: string
          format: uuid
          nullable: true
          description: Party wallet for currency operations
        containerId:
          type: string
          format: uuid
          nullable: true
          description: Party container for item operations
    ExpectedDepositInput:
      type: object
      description: Input for defining expected deposits from a party
      required:
      - partyId
      - partyType
      - expectedAssets
      properties:
        partyId:
          type: string
          format: uuid
          description: Party who should deposit
        partyType:
          description: Type of depositing party
          $ref: './common-api.yaml#/components/schemas/EntityType'
        expectedAssets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAssetInput'
          description: Expected assets
        optional:
          type: boolean
          nullable: true
          description: Is this deposit optional
        depositDeadline:
          type: string
          format: date-time
          nullable: true
          description: Specific deadline for this deposit
    EscrowAssetInput:
      type: object
      description: Input for specifying an asset in escrow operations
      required:
      - assetType
      properties:
        assetType:
          $ref: '#/components/schemas/AssetType'
          description: Type of asset to deposit
        currencyDefinitionId:
          type: string
          format: uuid
          nullable: true
          description: Currency definition ID
        currencyCode:
          type: string
          nullable: true
          description: Currency code
        currencyAmount:
          type: number
          nullable: true
          description: Currency amount
        itemInstanceId:
          type: string
          format: uuid
          nullable: true
          description: Item instance ID
        itemName:
          type: string
          nullable: true
          description: Item name
        itemTemplateId:
          type: string
          format: uuid
          nullable: true
          description: Item template ID (for stacks)
        itemTemplateName:
          type: string
          nullable: true
          description: Item template name
        itemQuantity:
          type: integer
          nullable: true
          description: Item quantity (for stacks)
        contractInstanceId:
          type: string
          format: uuid
          nullable: true
          description: Contract instance ID
        contractTemplateCode:
          type: string
          nullable: true
          description: Contract template code
        contractDescription:
          type: string
          nullable: true
          description: Contract description
        contractPartyRole:
          type: string
          nullable: true
          description: Contract party role being escrowed
        customAssetType:
          type: string
          nullable: true
          description: Custom asset type
        customAssetId:
          type: string
          nullable: true
          description: Custom asset ID
        customAssetData:
          type: object
          nullable: true
          additionalProperties: true
          description: Custom asset data
    ReleaseAllocationInput:
      type: object
      description: Input for specifying how assets should be allocated on release
      required:
      - recipientPartyId
      - recipientPartyType
      - assets
      properties:
        recipientPartyId:
          type: string
          format: uuid
          description: Recipient party ID
        recipientPartyType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Recipient party type
        assets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAssetInput'
          description: Assets to allocate
        destinationWalletId:
          type: string
          format: uuid
          nullable: true
          description: Destination wallet
        destinationContainerId:
          type: string
          format: uuid
          nullable: true
          description: Destination container
    CreateEscrowResponse:
      type: object
      description: Response from creating an escrow agreement
      required:
      - escrow
      - depositTokens
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Created escrow agreement
        depositTokens:
          type: array
          items:
            $ref: '#/components/schemas/PartyToken'
          description: Deposit tokens for each party (full_consent mode)
    PartyToken:
      type: object
      description: Token issued to a party for deposit or release operations
      required:
      - partyId
      - partyType
      - token
      properties:
        partyId:
          type: string
          format: uuid
          description: Party ID
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        token:
          type: string
          description: The token
    GetEscrowRequest:
      type: object
      description: Request to retrieve an escrow agreement by ID
      required:
      - escrowId
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID to retrieve
    GetEscrowResponse:
      type: object
      description: Response containing escrow agreement details
      required:
      - escrow
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Escrow agreement details
    ListEscrowsRequest:
      type: object
      description: Request to list escrow agreements with optional filters
      properties:
        partyId:
          type: string
          format: uuid
          nullable: true
          description: Filter by party
        partyType:
          allOf:
          - $ref: './common-api.yaml#/components/schemas/EntityType'
          nullable: true
          description: Party type filter
        status:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/EscrowStatus'
          description: Filter by status
        referenceType:
          type: string
          nullable: true
          description: Filter by reference type
        referenceId:
          type: string
          format: uuid
          nullable: true
          description: Filter by reference ID
        fromDate:
          type: string
          format: date-time
          nullable: true
          description: Filter from date
        toDate:
          type: string
          format: date-time
          nullable: true
          description: Filter to date
        limit:
          type: integer
          nullable: true
          description: Limit results
        offset:
          type: integer
          nullable: true
          description: Offset for pagination
    ListEscrowsResponse:
      type: object
      description: Response containing list of escrow agreements
      required:
      - escrows
      - totalCount
      properties:
        escrows:
          type: array
          description: List of escrow agreements matching the query
          items:
            $ref: '#/components/schemas/EscrowAgreement'
        totalCount:
          type: integer
          description: Total count for pagination
    GetMyTokenRequest:
      type: object
      description: Request to retrieve a party token for deposit or release
      required:
      - escrowId
      - ownerId
      - ownerType
      - tokenType
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        ownerId:
          type: string
          format: uuid
          description: Party ID
        ownerType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Party type
        tokenType:
          $ref: '#/components/schemas/TokenType'
          description: Type of token to retrieve
    GetMyTokenResponse:
      type: object
      description: Response containing party token information
      required:
      - tokenUsed
      properties:
        token:
          type: string
          nullable: true
          description: The requested token (if available)
        tokenUsed:
          type: boolean
          description: Whether the token has been used
        tokenUsedAt:
          type: string
          format: date-time
          nullable: true
          description: When the token was used
    DepositRequest:
      type: object
      description: Request to deposit assets into an escrow
      required:
      - escrowId
      - partyId
      - partyType
      - assets
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        partyId:
          type: string
          format: uuid
          description: Party depositing
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        assets:
          $ref: '#/components/schemas/EscrowAssetBundleInput'
          description: Assets to deposit
        depositToken:
          type: string
          nullable: true
          description: Deposit token (required for full_consent)
        idempotencyKey:
          type: string
          description: Idempotency key
    EscrowAssetBundleInput:
      type: object
      description: Input for specifying a bundle of assets
      required:
      - assets
      properties:
        assets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAssetInput'
          description: Assets to deposit
        description:
          type: string
          nullable: true
          description: Bundle description
        estimatedValue:
          type: number
          nullable: true
          description: Estimated value
    DepositResponse:
      type: object
      description: Response from depositing assets into an escrow
      required:
      - escrow
      - deposit
      - fullyFunded
      - releaseTokens
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Updated escrow agreement
        deposit:
          $ref: '#/components/schemas/EscrowDeposit'
          description: Deposit record
        fullyFunded:
          type: boolean
          description: Whether escrow is now fully funded
        releaseTokens:
          type: array
          items:
            $ref: '#/components/schemas/PartyToken'
          description: Release tokens (issued when fully funded)
    ValidateDepositRequest:
      type: object
      description: Request to validate a deposit without executing
      required:
      - escrowId
      - partyId
      - partyType
      - assets
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        partyId:
          type: string
          format: uuid
          description: Party to validate
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        assets:
          $ref: '#/components/schemas/EscrowAssetBundleInput'
          description: Assets to validate
    ValidateDepositResponse:
      type: object
      description: Response from deposit validation
      required:
      - valid
      - errors
      - warnings
      properties:
        valid:
          type: boolean
          description: Whether the deposit would be valid
        errors:
          type: array
          items:
            type: string
          description: Validation errors
        warnings:
          type: array
          items:
            type: string
          description: Validation warnings
    GetDepositStatusRequest:
      type: object
      description: Request to get deposit status for a party
      required:
      - escrowId
      - partyId
      - partyType
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        partyId:
          type: string
          format: uuid
          description: Party ID
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
    GetDepositStatusResponse:
      type: object
      description: Response containing party deposit status
      required:
      - expectedAssets
      - depositedAssets
      - fulfilled
      properties:
        expectedAssets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAsset'
          description: Expected assets from this party
        depositedAssets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAsset'
          description: Actually deposited assets
        fulfilled:
          type: boolean
          description: Whether deposit requirement is fulfilled
        depositToken:
          type: string
          nullable: true
          description: Deposit token (if not yet used)
        depositDeadline:
          type: string
          format: date-time
          nullable: true
          description: Deposit deadline
    ConsentRequest:
      type: object
      description: Request to record party consent for release or refund
      required:
      - escrowId
      - partyId
      - partyType
      - consentType
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        partyId:
          type: string
          format: uuid
          description: Party giving consent
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        consentType:
          $ref: '#/components/schemas/EscrowConsentType'
          description: Type of consent being given
        releaseToken:
          type: string
          nullable: true
          description: Release token (required for full_consent)
        notes:
          type: string
          nullable: true
          description: Optional notes
        idempotencyKey:
          type: string
          description: Idempotency key
    ConsentResponse:
      type: object
      description: Response from recording party consent
      required:
      - escrow
      - consentRecorded
      - triggered
      - newStatus
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Updated escrow agreement
        consentRecorded:
          type: boolean
          description: Whether consent was recorded
        triggered:
          type: boolean
          description: Whether this consent triggered completion
        newStatus:
          $ref: '#/components/schemas/EscrowStatus'
          description: New escrow status after consent
    GetConsentStatusRequest:
      type: object
      description: Request to get consent status for all parties
      required:
      - escrowId
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
    GetConsentStatusResponse:
      type: object
      description: Response containing consent status for all parties
      required:
      - partiesRequiringConsent
      - consentsReceived
      - consentsRequired
      - canRelease
      - canRefund
      properties:
        partiesRequiringConsent:
          type: array
          items:
            $ref: '#/components/schemas/PartyConsentStatus'
          description: Consent status per party
        consentsReceived:
          type: integer
          description: Number of consents received
        consentsRequired:
          type: integer
          description: Number of consents required
        canRelease:
          type: boolean
          description: Whether release can proceed
        canRefund:
          type: boolean
          description: Whether refund can proceed
    PartyConsentStatus:
      type: object
      description: Consent status for a single party
      required:
      - partyId
      - partyType
      - consentGiven
      properties:
        partyId:
          type: string
          format: uuid
          description: Party ID
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        displayName:
          type: string
          nullable: true
          description: Party display name
        consentGiven:
          type: boolean
          description: Whether consent was given
        consentType:
          $ref: '#/components/schemas/EscrowConsentType'
          description: Type of consent given (if any)
          nullable: true
        consentedAt:
          type: string
          format: date-time
          nullable: true
          description: When consent was given
    ReleaseRequest:
      type: object
      description: Request to trigger escrow release to recipients
      required:
      - escrowId
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        initiatorServiceId:
          type: string
          nullable: true
          description: For initiator_trusted mode
        notes:
          type: string
          nullable: true
          description: Optional notes
        idempotencyKey:
          type: string
          description: Idempotency key
    ReleaseResponse:
      type: object
      description: Response from releasing escrow assets to recipients
      required:
      - escrow
      - finalizerResults
      - releases
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Released escrow agreement
        finalizerResults:
          type: array
          items:
            $ref: '#/components/schemas/FinalizerResult'
          description: Results of contract finalizer APIs
        releases:
          type: array
          items:
            $ref: '#/components/schemas/ReleaseResult'
          description: Release results per recipient
    FinalizerResult:
      type: object
      description: Result from a contract finalizer API call
      required:
      - endpoint
      - success
      properties:
        endpoint:
          type: string
          description: Finalizer endpoint
        success:
          type: boolean
          description: Whether it succeeded
        error:
          type: string
          nullable: true
          description: Error message if failed
    ReleaseResult:
      type: object
      description: Result of releasing assets to a single recipient
      required:
      - recipientPartyId
      - success
      properties:
        recipientPartyId:
          type: string
          format: uuid
          description: Recipient party ID
        assets:
          $ref: '#/components/schemas/EscrowAssetBundle'
          description: Assets released (null if failed)
          nullable: true
        success:
          type: boolean
          description: Whether release succeeded
        error:
          type: string
          nullable: true
          description: Error message if failed
    RefundRequest:
      type: object
      description: Request to trigger escrow refund to depositors
      required:
      - escrowId
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        initiatorServiceId:
          type: string
          nullable: true
          description: For initiator_trusted mode
        reason:
          type: string
          nullable: true
          description: Reason for refund
        idempotencyKey:
          type: string
          description: Idempotency key
    RefundResponse:
      type: object
      description: Response from refunding escrow assets to depositors
      required:
      - escrow
      - refunds
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Refunded escrow agreement
        refunds:
          type: array
          items:
            $ref: '#/components/schemas/RefundResult'
          description: Refund results per depositor
    RefundResult:
      type: object
      description: Result of refunding assets to a single depositor
      required:
      - depositorPartyId
      - success
      properties:
        depositorPartyId:
          type: string
          format: uuid
          description: Depositor party ID
        assets:
          $ref: '#/components/schemas/EscrowAssetBundle'
          description: Assets refunded (null if failed)
          nullable: true
        success:
          type: boolean
          description: Whether refund succeeded
        error:
          type: string
          nullable: true
          description: Error message if failed
    CancelRequest:
      type: object
      description: Request to cancel escrow before fully funded
      required:
      - escrowId
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        reason:
          type: string
          nullable: true
          description: Reason for cancellation
        idempotencyKey:
          type: string
          description: Idempotency key
    CancelResponse:
      type: object
      description: Response from cancelling an escrow
      required:
      - escrow
      - refunds
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Cancelled escrow agreement
        refunds:
          type: array
          items:
            $ref: '#/components/schemas/RefundResult'
          description: Refund results for any deposits
    DisputeRequest:
      type: object
      description: Request to raise a dispute on a funded escrow
      required:
      - escrowId
      - partyId
      - partyType
      - reason
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        partyId:
          type: string
          format: uuid
          description: Party raising dispute
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        reason:
          type: string
          description: Reason for dispute
        releaseToken:
          type: string
          nullable: true
          description: Release token (proves party identity)
        idempotencyKey:
          type: string
          description: Idempotency key
    DisputeResponse:
      type: object
      description: Response from raising a dispute on an escrow
      required:
      - escrow
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Disputed escrow agreement
    ConfirmReleaseRequest:
      type: object
      description: Request to confirm receipt of released assets
      additionalProperties: false
      required:
      - escrowId
      - partyId
      - releaseToken
      properties:
        escrowId:
          type: string
          format: uuid
          description: The escrow being confirmed.
        partyId:
          type: string
          format: uuid
          description: The party confirming receipt.
        releaseToken:
          type: string
          description: The party's release token (received via confirmation shortcut).
        notes:
          type: string
          nullable: true
          description: Optional confirmation notes.
    ConfirmReleaseResponse:
      type: object
      description: Response from confirming release receipt
      additionalProperties: false
      required:
      - escrowId
      - confirmed
      - allPartiesConfirmed
      properties:
        escrowId:
          type: string
          format: uuid
          description: The escrow ID.
        confirmed:
          type: boolean
          description: Whether this party's confirmation was recorded.
        allPartiesConfirmed:
          type: boolean
          description: Whether all parties have now confirmed (triggers Released transition).
        status:
          $ref: '#/components/schemas/EscrowStatus'
          description: Current escrow status after confirmation.
          nullable: true
    ConfirmRefundRequest:
      type: object
      description: Request to confirm receipt of refunded assets
      additionalProperties: false
      required:
      - escrowId
      - partyId
      properties:
        escrowId:
          type: string
          format: uuid
          description: The escrow being confirmed.
        partyId:
          type: string
          format: uuid
          description: The party confirming receipt of refund.
        notes:
          type: string
          nullable: true
          description: Optional confirmation notes.
    ConfirmRefundResponse:
      type: object
      description: Response from confirming refund receipt
      additionalProperties: false
      required:
      - escrowId
      - confirmed
      - allPartiesConfirmed
      properties:
        escrowId:
          type: string
          format: uuid
          description: The escrow ID.
        confirmed:
          type: boolean
          description: Whether this party's confirmation was recorded.
        allPartiesConfirmed:
          type: boolean
          description: Whether all parties have now confirmed (triggers Refunded transition).
        status:
          $ref: '#/components/schemas/EscrowStatus'
          description: Current escrow status after confirmation.
          nullable: true
    ResolveRequest:
      type: object
      description: Request for arbiter to resolve a disputed escrow
      required:
      - escrowId
      - arbiterId
      - arbiterType
      - resolution
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        arbiterId:
          type: string
          format: uuid
          description: Arbiter ID
        arbiterType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Arbiter type
        resolution:
          $ref: '#/components/schemas/EscrowResolution'
          description: Resolution decision for the dispute
        splitAllocations:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/SplitAllocation'
          description: For split resolution
        notes:
          type: string
          nullable: true
          description: Resolution notes
        idempotencyKey:
          type: string
          description: Idempotency key
    SplitAllocation:
      type: object
      description: Allocation of assets to a party in a split resolution
      required:
      - partyId
      - partyType
      - assets
      properties:
        partyId:
          type: string
          format: uuid
          description: Party ID
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        assets:
          type: array
          items:
            $ref: '#/components/schemas/EscrowAssetInput'
          description: Assets allocated to this party
    ResolveResponse:
      type: object
      description: Response from arbiter resolving a disputed escrow
      required:
      - escrow
      - transfers
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Resolved escrow agreement
        transfers:
          type: array
          items:
            $ref: '#/components/schemas/TransferResult'
          description: Transfer results
    TransferResult:
      type: object
      description: Result of transferring assets to a party during resolution
      required:
      - partyId
      - success
      properties:
        partyId:
          type: string
          format: uuid
          description: Party ID
        assets:
          $ref: '#/components/schemas/EscrowAssetBundle'
          description: Assets transferred (null if failed)
          nullable: true
        success:
          type: boolean
          description: Whether transfer succeeded
        error:
          type: string
          nullable: true
          description: Error message if failed
    VerifyConditionRequest:
      type: object
      description: Request to verify a condition for conditional escrow
      required:
      - escrowId
      - conditionMet
      - verifierId
      - verifierType
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        conditionMet:
          type: boolean
          description: Whether the condition was met
        verifierId:
          type: string
          format: uuid
          description: Verifier entity ID
        verifierType:
          $ref: './common-api.yaml#/components/schemas/EntityType'
          description: Verifier entity type
        verificationData:
          type: object
          nullable: true
          additionalProperties: true
          description: Proof/evidence data
        idempotencyKey:
          type: string
          description: Idempotency key
    VerifyConditionResponse:
      type: object
      description: Response from verifying a condition on an escrow
      required:
      - escrow
      - triggered
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Updated escrow agreement
        triggered:
          type: boolean
          description: Whether this triggered release/refund
    ValidateEscrowRequest:
      type: object
      description: Request to manually validate escrow assets
      required:
      - escrowId
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
    ValidateEscrowResponse:
      type: object
      description: Response from validating escrow assets
      required:
      - valid
      - failures
      - escrow
      properties:
        valid:
          type: boolean
          description: Whether all assets are valid
        failures:
          type: array
          items:
            $ref: '#/components/schemas/ValidationFailure'
          description: Validation failures
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Escrow agreement with validation results
    ReaffirmRequest:
      type: object
      description: Request to re-affirm after validation failure
      required:
      - escrowId
      - partyId
      - partyType
      - idempotencyKey
      properties:
        escrowId:
          type: string
          format: uuid
          description: Escrow ID
        partyId:
          type: string
          format: uuid
          description: Party reaffirming
        partyType:
          description: Type of entity (Account, Character, etc.)
          $ref: './common-api.yaml#/components/schemas/EntityType'
        releaseToken:
          type: string
          nullable: true
          description: Release token
        idempotencyKey:
          type: string
          description: Idempotency key
    ReaffirmResponse:
      type: object
      description: Response from party re-affirming after validation failure
      required:
      - escrow
      - allReaffirmed
      properties:
        escrow:
          $ref: '#/components/schemas/EscrowAgreement'
          description: Reaffirmed escrow agreement
        allReaffirmed:
          type: boolean
          description: Whether all parties have reaffirmed
    RegisterHandlerRequest:
      type: object
      description: Request to register a custom asset type handler
      required:
      - assetType
      - pluginId
      - depositEndpoint
      - releaseEndpoint
      - refundEndpoint
      - validateEndpoint
      properties:
        assetType:
          type: string
          description: Unique asset type identifier
        pluginId:
          type: string
          description: Plugin implementing this handler
        depositEndpoint:
          type: string
          description: Deposit endpoint path
        releaseEndpoint:
          type: string
          description: Release endpoint path
        refundEndpoint:
          type: string
          description: Refund endpoint path
        validateEndpoint:
          type: string
          description: Validate endpoint path
    RegisterHandlerResponse:
      type: object
      description: Response from registering an asset handler
      required:
      - registered
      properties:
        registered:
          type: boolean
          description: Whether registration succeeded
    ListHandlersRequest:
      type: object
      description: Empty request to list handlers
      properties: {}
    ListHandlersResponse:
      type: object
      description: Response containing list of registered asset handlers
      required:
      - handlers
      properties:
        handlers:
          type: array
          items:
            $ref: '#/components/schemas/AssetHandlerInfo'
          description: Registered handlers
    DeregisterHandlerRequest:
      type: object
      description: Request to remove a custom asset handler registration
      required:
      - assetType
      properties:
        assetType:
          type: string
          description: Asset type to deregister
    DeregisterHandlerResponse:
      type: object
      description: Response from deregistering an asset handler
      required:
      - deregistered
      properties:
        deregistered:
          type: boolean
          description: Whether deregistration succeeded
    ErrorResponse:
      type: object
      description: Standard error response format
      required:
      - error
      - message
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          nullable: true
          additionalProperties: true
          description: Additional error details
