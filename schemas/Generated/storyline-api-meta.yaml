openapi: 3.0.4
info:
  title: Storyline Composer API
  version: 1.0.0
  description: |
    Seeded narrative generation from compressed archives using the storyline SDKs.

    The Storyline service wraps `storyline-theory` and `storyline-storyteller` SDKs
    to provide HTTP endpoints for generating storyline plans from archive data.
    Plans describe narrative arcs with phases, actions, and entity requirements -
    callers (gods/regional watchers) decide whether to instantiate them.

    **POST-Only API Pattern**: This API uses POST for all operations to support
    zero-copy WebSocket routing. Path parameters are passed in request bodies.
    See docs/BANNOU_DESIGN.md for architectural rationale.

    **SCHEMA MODIFICATION GATE**: STOP. Before modifying this schema, you MUST:
    1. Read docs/reference/SCHEMA-RULES.md
    2. State which section applies to your change
    3. Only then proceed with edits
    Edits without stating the applicable rule are FORBIDDEN.
  x-compression-callback:
    resourceType: character
    sourceType: storyline
    compressEndpoint: /storyline/get-compress-data
    compressPayloadTemplate: '{"characterId": "{{resourceId}}"}'
    priority: 60
    description: Storyline participation (scenario history, active arcs, completed count)
x-service-layer: GameFeatures
servers:
- url: http://localhost:5012
  description: Bannou service endpoint (internal only)
paths:
  /storyline/compose:
    post:
      summary: Compose a storyline plan from archive seeds
      description: |
        Generates a storyline plan using data from compressed archives and/or
        live snapshots. The plan describes phases, actions, and entity requirements
        but does NOT create any entities - callers decide whether to instantiate.

        **Workflow**:
        1. Fetch archive/snapshot data via IResourceClient
        2. Extract world state from archive bundle
        3. Select template based on goal and constraints
        4. Run GOAP planner to generate action sequences
        5. Cache plan and publish storyline.composed event
      operationId: Compose
      tags:
      - Composition
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComposeRequest'
      responses:
        '200':
          description: Storyline plan generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComposeResponse'
        '400':
          description: Invalid request (no valid archives, incompatible goal/genre)
        '404':
          description: Archive or snapshot not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ComposeRequest\"\
        ,\n    \"$defs\": {\n        \"ComposeRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to compose a storyline plan\",\n            \"required\": [\n   \
        \             \"seedSources\",\n                \"goal\"\n            ],\n            \"properties\": {\n        \
        \        \"seedSources\": {\n                    \"type\": \"array\",\n                    \"items\": {\n        \
        \                \"$ref\": \"#/$defs/SeedSource\"\n                    },\n                    \"minItems\": 1,\n\
        \                    \"maxItems\": 10,\n                    \"description\": \"Archive or snapshot sources to seed
        the storyline.\\nAt least one source is required. Mix of archives and snapshots allowed.\\n\"\n                },\n\
        \                \"goal\": {\n                    \"$ref\": \"#/$defs/StorylineGoal\",\n                    \"description\"\
        : \"The high-level goal driving arc selection\"\n                },\n                \"constraints\": {\n        \
        \            \"$ref\": \"#/$defs/ComposeConstraints\",\n                    \"nullable\": true,\n                \
        \    \"description\": \"Optional constraints on composition\"\n                },\n                \"genre\": {\n\
        \                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Genre filter (e.g., \\\"crime\\\", \\\"action\\\", \\\"romance\\\").\\nIf omitted, inferred from archive data.\\\
        n\"\n                },\n                \"arcType\": {\n                    \"$ref\": \"#/$defs/ArcType\",\n    \
        \                \"nullable\": true,\n                    \"description\": \"Specific arc type to use. If omitted,
        selected based on goal.\\n\"\n                },\n                \"urgency\": {\n                    \"$ref\": \"\
        #/$defs/PlanningUrgency\",\n                    \"nullable\": true,\n                    \"description\": \"Planning
        urgency level. Defaults to configuration value.\\n\"\n                },\n                \"seed\": {\n          \
        \          \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Random seed for deterministic output (enables caching)\"\n                }\n            }\n        },\n        \"\
        SeedSource\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"A source of seed data (archive or snapshot)\",\n            \"properties\": {\n                \"archiveId\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"ID of a compressed archive (dead entity)\"\n                },\n \
        \               \"snapshotId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"ID of a live snapshot (living entity)\"\
        \n                },\n                \"role\": {\n                    \"type\": \"string\",\n                   \
        \ \"nullable\": true,\n                    \"description\": \"Optional actant role hint (e.g., \\\"protagonist\\\"\
        , \\\"antagonist\\\", \\\"helper\\\").\\nUsed for Greimas actant assignment if provided.\\n\"\n                }\n\
        \            }\n        },\n        \"StorylineGoal\": {\n            \"type\": \"string\",\n            \"enum\"\
        : [\n                \"revenge\",\n                \"resurrection\",\n                \"legacy\",\n              \
        \  \"mystery\",\n                \"peace\"\n            ],\n            \"description\": \"High-level story goal that
        drives arc selection.\\nrevenge: Character seeks vengeance for past wrongs\\nresurrection: Restoring something/someone
        lost\\nlegacy: Creating or continuing a lasting impact\\nmystery: Uncovering hidden truths\\npeace: Resolving conflicts
        and finding harmony\\n\"\n        },\n        \"ComposeConstraints\": {\n            \"type\": \"object\",\n     \
        \       \"additionalProperties\": false,\n            \"description\": \"Constraints on storyline composition\",\n\
        \            \"properties\": {\n                \"realmId\": {\n                    \"type\": \"string\",\n      \
        \              \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Realm to anchor the storyline in\"\n                },\n                \"locationId\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n   \
        \                 \"description\": \"Optional starting location\"\n                },\n                \"maxEntities\"\
        : {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n                    \"maximum\"\
        : 50,\n                    \"nullable\": true,\n                    \"description\": \"Maximum entities the plan can
        require (default from config)\"\n                },\n                \"maxPhases\": {\n                    \"type\"\
        : \"integer\",\n                    \"minimum\": 1,\n                    \"maximum\": 10,\n                    \"\
        nullable\": true,\n                    \"description\": \"Maximum phases in the plan (default unlimited)\"\n     \
        \           }\n            }\n        },\n        \"ArcType\": {\n            \"type\": \"string\",\n            \"\
        enum\": [\n                \"RagsToRiches\",\n                \"Tragedy\",\n                \"ManInHole\",\n     \
        \           \"Icarus\",\n                \"Cinderella\",\n                \"Oedipus\"\n            ],\n          \
        \  \"description\": \"Emotional arc shapes from Reagan et al. research.\\nRagsToRiches: Rise (1)\\nTragedy: Fall (2)\\
        nManInHole: Fall then rise (3)\\nIcarus: Rise then fall (4)\\nCinderella: Rise, fall, rise (5)\\nOedipus: Fall, rise,
        fall (6)\\n\"\n        },\n        \"PlanningUrgency\": {\n            \"type\": \"string\",\n            \"enum\"\
        : [\n                \"Low\",\n                \"Medium\",\n                \"High\"\n            ],\n           \
        \ \"description\": \"GOAP planning urgency level affecting search parameters.\\nLow: More iterations, wider beam (1000/20)\\
        nMedium: Balanced (500/15)\\nHigh: Fewer iterations, narrower beam (200/10)\\n\"\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ComposeResponse\"\
        ,\n    \"$defs\": {\n        \"ComposeResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Composed storyline plan\",\n            \"required\": [\n               \
        \ \"planId\",\n                \"confidence\",\n                \"goal\",\n                \"arcType\",\n        \
        \        \"primarySpectrum\",\n                \"phases\",\n                \"generationTimeMs\",\n              \
        \  \"cached\"\n            ],\n            \"properties\": {\n                \"planId\": {\n                    \"\
        type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique plan
        identifier\"\n                },\n                \"confidence\": {\n                    \"type\": \"number\",\n \
        \                   \"format\": \"double\",\n                    \"minimum\": 0,\n                    \"maximum\"\
        : 1,\n                    \"description\": \"Plan viability score (0-1)\"\n                },\n                \"\
        goal\": {\n                    \"$ref\": \"#/$defs/StorylineGoal\",\n                    \"description\": \"The goal
        that was used\"\n                },\n                \"genre\": {\n                    \"type\": \"string\",\n   \
        \                 \"nullable\": true,\n                    \"description\": \"Inferred or specified genre\"\n    \
        \            },\n                \"arcType\": {\n                    \"$ref\": \"#/$defs/ArcType\",\n            \
        \        \"description\": \"Emotional arc type used\"\n                },\n                \"primarySpectrum\": {\n\
        \                    \"$ref\": \"#/$defs/SpectrumType\",\n                    \"description\": \"Primary Life Value
        spectrum\"\n                },\n                \"themes\": {\n                    \"type\": \"array\",\n        \
        \            \"items\": {\n                        \"type\": \"string\"\n                    },\n                \
        \    \"nullable\": true,\n                    \"description\": \"Inferred thematic elements\"\n                },\n\
        \                \"phases\": {\n                    \"type\": \"array\",\n                    \"items\": {\n     \
        \                   \"$ref\": \"#/$defs/StorylinePlanPhase\"\n                    },\n                    \"description\"\
        : \"Planned phases with actions\"\n                },\n                \"entitiesToSpawn\": {\n                  \
        \  \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/EntityRequirement\"\
        \n                    },\n                    \"nullable\": true,\n                    \"description\": \"Entities
        required for this storyline (descriptions only).\\nCallers decide whether to spawn them.\\n\"\n                },\n\
        \                \"links\": {\n                    \"type\": \"array\",\n                    \"items\": {\n      \
        \                  \"$ref\": \"#/$defs/StorylineLink\"\n                    },\n                    \"nullable\":
        true,\n                    \"description\": \"Links between entities in the plan\"\n                },\n         \
        \       \"risks\": {\n                    \"type\": \"array\",\n                    \"items\": {\n               \
        \         \"$ref\": \"#/$defs/StorylineRisk\"\n                    },\n                    \"nullable\": true,\n \
        \                   \"description\": \"Identified risks or weak points in the plan\"\n                },\n       \
        \         \"generationTimeMs\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Time taken to generate in milliseconds\"\n                },\n                \"cached\": {\n                \
        \    \"type\": \"boolean\",\n                    \"description\": \"Whether this was returned from cache\"\n     \
        \           }\n            }\n        },\n        \"StorylineGoal\": {\n            \"type\": \"string\",\n      \
        \      \"enum\": [\n                \"revenge\",\n                \"resurrection\",\n                \"legacy\",\n\
        \                \"mystery\",\n                \"peace\"\n            ],\n            \"description\": \"High-level
        story goal that drives arc selection.\\nrevenge: Character seeks vengeance for past wrongs\\nresurrection: Restoring
        something/someone lost\\nlegacy: Creating or continuing a lasting impact\\nmystery: Uncovering hidden truths\\npeace:
        Resolving conflicts and finding harmony\\n\"\n        },\n        \"ArcType\": {\n            \"type\": \"string\"\
        ,\n            \"enum\": [\n                \"RagsToRiches\",\n                \"Tragedy\",\n                \"ManInHole\"\
        ,\n                \"Icarus\",\n                \"Cinderella\",\n                \"Oedipus\"\n            ],\n   \
        \         \"description\": \"Emotional arc shapes from Reagan et al. research.\\nRagsToRiches: Rise (1)\\nTragedy:
        Fall (2)\\nManInHole: Fall then rise (3)\\nIcarus: Rise then fall (4)\\nCinderella: Rise, fall, rise (5)\\nOedipus:
        Fall, rise, fall (6)\\n\"\n        },\n        \"SpectrumType\": {\n            \"type\": \"string\",\n          \
        \  \"enum\": [\n                \"LifeDeath\",\n                \"HonorDishonor\",\n                \"JusticeInjustice\"\
        ,\n                \"FreedomSubjugation\",\n                \"LoveHate\",\n                \"RespectShame\",\n   \
        \             \"PowerImpotence\",\n                \"SuccessFailure\",\n                \"AltruismSelfishness\",\n\
        \                \"WisdomIgnorance\"\n            ],\n            \"description\": \"The 10 Story Grid Life Value
        spectrums.\\nThese are bipolar axes for emotional progression.\\n\"\n        },\n        \"StorylinePlanPhase\": {\n\
        \            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"\
        A phase in the storyline plan\",\n            \"required\": [\n                \"phaseNumber\",\n                \"\
        name\",\n                \"actions\",\n                \"targetState\",\n                \"positionBounds\"\n    \
        \        ],\n            \"properties\": {\n                \"phaseNumber\": {\n                    \"type\": \"integer\"\
        ,\n                    \"minimum\": 1,\n                    \"description\": \"1-based phase number\"\n          \
        \      },\n                \"name\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Phase name\"\n                },\n                \"actions\": {\n                    \"type\": \"array\",\n \
        \                   \"items\": {\n                        \"$ref\": \"#/$defs/StorylinePlanAction\"\n            \
        \        },\n                    \"description\": \"Actions in this phase\"\n                },\n                \"\
        targetState\": {\n                    \"$ref\": \"#/$defs/PhaseTargetState\",\n                    \"description\"\
        : \"Target state for phase completion\"\n                },\n                \"positionBounds\": {\n             \
        \       \"$ref\": \"#/$defs/PhasePosition\",\n                    \"description\": \"Position bounds for this phase\"\
        \n                }\n            }\n        },\n        \"StorylinePlanAction\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"A planned action in the storyline\"\
        ,\n            \"required\": [\n                \"actionId\",\n                \"sequenceIndex\",\n              \
        \  \"effects\",\n                \"narrativeEffect\",\n                \"isCoreEvent\"\n            ],\n         \
        \   \"properties\": {\n                \"actionId\": {\n                    \"type\": \"string\",\n              \
        \      \"description\": \"Action identifier from action registry\"\n                },\n                \"sequenceIndex\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Sequence index within the
        plan\"\n                },\n                \"effects\": {\n                    \"type\": \"array\",\n           \
        \         \"items\": {\n                        \"$ref\": \"#/$defs/ActionEffect\"\n                    },\n     \
        \               \"description\": \"World state effects of this action\"\n                },\n                \"narrativeEffect\"\
        : {\n                    \"$ref\": \"#/$defs/NarrativeEffect\",\n                    \"description\": \"Narrative
        effect on the emotional arc\"\n                },\n                \"isCoreEvent\": {\n                    \"type\"\
        : \"boolean\",\n                    \"description\": \"Whether this is an obligatory scene\"\n                },\n\
        \                \"chainedFrom\": {\n                    \"type\": \"string\",\n                    \"nullable\":
        true,\n                    \"description\": \"If chained, the ID of the action it was chained from\"\n           \
        \     }\n            }\n        },\n        \"ActionEffect\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Effect of an action on world state\",\n           \
        \ \"required\": [\n                \"key\",\n                \"value\"\n            ],\n            \"properties\"\
        : {\n                \"key\": {\n                    \"type\": \"string\",\n                    \"description\": \"\
        State key to modify\"\n                },\n                \"value\": {\n                    \"description\": \"New
        value to set (any type)\"\n                },\n                \"cardinality\": {\n                    \"$ref\": \"\
        #/$defs/EffectCardinality\",\n                    \"description\": \"How the effect is applied\"\n               \
        \ }\n            }\n        },\n        \"EffectCardinality\": {\n            \"type\": \"string\",\n            \"\
        enum\": [\n                \"Exclusive\",\n                \"Additive\"\n            ],\n            \"description\"\
        : \"Cardinality for effect application.\\nExclusive: Replaces existing value at key\\nAdditive: Adds to collection
        at key\\n\"\n        },\n        \"NarrativeEffect\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Narrative effect on the emotional arc\",\n            \"properties\": {\n\
        \                \"primarySpectrumDelta\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"double\",\n                    \"nullable\": true,\n                    \"description\": \"Delta to apply to the
        primary spectrum\"\n                },\n                \"secondarySpectrumDelta\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"nullable\": true,\n            \
        \        \"description\": \"Delta to apply to the secondary spectrum\"\n                },\n                \"positionAdvance\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Position advance type (micro, standard, macro)\"\n                }\n            }\n        },\n        \"PhaseTargetState\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Target state for phase completion\",\n            \"required\": [\n                \"minPrimarySpectrum\",\n \
        \               \"maxPrimarySpectrum\"\n            ],\n            \"properties\": {\n                \"minPrimarySpectrum\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"\
        description\": \"Minimum primary spectrum value for this phase\"\n                },\n                \"maxPrimarySpectrum\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"\
        description\": \"Maximum primary spectrum value for this phase\"\n                },\n                \"rangeDescription\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Human-readable description of this state range\"\n                }\n            }\n        },\n        \"PhasePosition\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Phase position constraints from Save the Cat beat timing\",\n            \"required\": [\n                \"stcCenter\"\
        ,\n                \"floor\",\n                \"ceiling\",\n                \"validationBand\"\n            ],\n\
        \            \"properties\": {\n                \"stcCenter\": {\n                    \"type\": \"number\",\n    \
        \                \"format\": \"double\",\n                    \"description\": \"Target position from STC beat timing\"\
        \n                },\n                \"floor\": {\n                    \"type\": \"number\",\n                  \
        \  \"format\": \"double\",\n                    \"description\": \"Earliest advancement position (prevents speed-running)\"\
        \n                },\n                \"ceiling\": {\n                    \"type\": \"number\",\n                \
        \    \"format\": \"double\",\n                    \"description\": \"Forced advancement position (prevents deadlock)\"\
        \n                },\n                \"validationBand\": {\n                    \"type\": \"number\",\n         \
        \           \"format\": \"double\",\n                    \"description\": \"Validation tolerance (\\u00b1)\"\n   \
        \             }\n            }\n        },\n        \"EntityRequirement\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"An entity required for the storyline\"\
        ,\n            \"required\": [\n                \"role\",\n                \"entityType\",\n                \"description\"\
        \n            ],\n            \"properties\": {\n                \"role\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Role in the story (e.g., \\\"witness\\\", \\\"informant\\\", \\\"target\\\
        \")\"\n                },\n                \"entityType\": {\n                    \"type\": \"string\",\n        \
        \            \"description\": \"Type of entity needed (e.g., \\\"character\\\", \\\"location\\\", \\\"item\\\")\"\n\
        \                },\n                \"description\": {\n                    \"type\": \"string\",\n             \
        \       \"description\": \"Description of what's needed\"\n                },\n                \"constraints\": {\n\
        \                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                    \
        \    \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                    \"\
        description\": \"Constraints on entity selection/creation\"\n                },\n                \"sourceArchiveId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"If derived from an archive, that archive's ID\"\n      \
        \          }\n            }\n        },\n        \"StorylineLink\": {\n            \"type\": \"object\",\n       \
        \     \"additionalProperties\": false,\n            \"description\": \"A relationship link in the storyline\",\n \
        \           \"required\": [\n                \"sourceRole\",\n                \"targetRole\",\n                \"\
        linkType\"\n            ],\n            \"properties\": {\n                \"sourceRole\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"Source entity role\"\n                },\n       \
        \         \"targetRole\": {\n                    \"type\": \"string\",\n                    \"description\": \"Target
        entity role\"\n                },\n                \"linkType\": {\n                    \"type\": \"string\",\n  \
        \                  \"description\": \"Type of relationship (e.g., \\\"opposes\\\", \\\"allies_with\\\", \\\"seeks\\\
        \")\"\n                }\n            }\n        },\n        \"StorylineRisk\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Identified risk in the plan\",\n \
        \           \"required\": [\n                \"riskType\",\n                \"description\",\n                \"severity\"\
        \n            ],\n            \"properties\": {\n                \"riskType\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Risk category (e.g., \\\"missing_entity\\\", \\\"low_tension\\\"\
        , \\\"weak_climax\\\")\"\n                },\n                \"description\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Risk description\"\n                },\n                \"severity\"\
        : {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"low\",\n\
        \                        \"medium\",\n                        \"high\"\n                    ],\n                 \
        \   \"description\": \"Risk severity\"\n                },\n                \"mitigation\": {\n                  \
        \  \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Suggested
        mitigation\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Compose a storyline plan from archive seeds\",\n    \"description\": \"\
        Generates a storyline plan using data from compressed archives and/or\\nlive snapshots. The plan describes phases,
        actions, and entity requirements\\nbut does NOT create any entities - callers decide whether to instantiate.\\n\\\
        n**Workflow**:\\n1. Fetch archive/snapshot data via IResourceClient\\n2. Extract world state from archive bundle\\
        n3. Select template based on goal and constraints\\n4. Run GOAP planner to generate action sequences\\n5. Cache plan
        and publish storyline.composed event\\n\",\n    \"tags\": [\n        \"Composition\"\n    ],\n    \"deprecated\":
        false,\n    \"operationId\": \"Compose\"\n}"
  /storyline/plan/get:
    post:
      summary: Retrieve a cached storyline plan
      description: |
        Retrieves a previously generated storyline plan by its ID.
        Returns 404 if the plan has expired from cache or doesn't exist.
      operationId: GetPlan
      tags:
      - Plans
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetPlanRequest'
      responses:
        '200':
          description: Plan retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetPlanResponse'
        '404':
          description: Plan not found or expired
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetPlanRequest\"\
        ,\n    \"$defs\": {\n        \"GetPlanRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to retrieve a cached plan\",\n            \"required\": [\n     \
        \           \"planId\"\n            ],\n            \"properties\": {\n                \"planId\": {\n           \
        \         \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"\
        ID of the plan to retrieve\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetPlanResponse\"\
        ,\n    \"$defs\": {\n        \"GetPlanResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Retrieved plan\",\n            \"required\": [\n                \"found\"\
        \n            ],\n            \"properties\": {\n                \"found\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether the plan was found\"\n                },\n                \"plan\"\
        : {\n                    \"$ref\": \"#/$defs/ComposeResponse\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"The plan (null if not found)\"\n                }\n            }\n        },\n  \
        \      \"ComposeResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n \
        \           \"description\": \"Composed storyline plan\",\n            \"required\": [\n                \"planId\"\
        ,\n                \"confidence\",\n                \"goal\",\n                \"arcType\",\n                \"primarySpectrum\"\
        ,\n                \"phases\",\n                \"generationTimeMs\",\n                \"cached\"\n            ],\n\
        \            \"properties\": {\n                \"planId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"description\": \"Unique plan identifier\"\n           \
        \     },\n                \"confidence\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"double\",\n                    \"minimum\": 0,\n                    \"maximum\": 1,\n                    \"description\"\
        : \"Plan viability score (0-1)\"\n                },\n                \"goal\": {\n                    \"$ref\": \"\
        #/$defs/StorylineGoal\",\n                    \"description\": \"The goal that was used\"\n                },\n  \
        \              \"genre\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Inferred or specified genre\"\n                },\n                \"arcType\"\
        : {\n                    \"$ref\": \"#/$defs/ArcType\",\n                    \"description\": \"Emotional arc type
        used\"\n                },\n                \"primarySpectrum\": {\n                    \"$ref\": \"#/$defs/SpectrumType\"\
        ,\n                    \"description\": \"Primary Life Value spectrum\"\n                },\n                \"themes\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"nullable\": true,\n                    \"description\"\
        : \"Inferred thematic elements\"\n                },\n                \"phases\": {\n                    \"type\"\
        : \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/StorylinePlanPhase\"\n\
        \                    },\n                    \"description\": \"Planned phases with actions\"\n                },\n\
        \                \"entitiesToSpawn\": {\n                    \"type\": \"array\",\n                    \"items\":
        {\n                        \"$ref\": \"#/$defs/EntityRequirement\"\n                    },\n                    \"\
        nullable\": true,\n                    \"description\": \"Entities required for this storyline (descriptions only).\\
        nCallers decide whether to spawn them.\\n\"\n                },\n                \"links\": {\n                  \
        \  \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/StorylineLink\"\
        \n                    },\n                    \"nullable\": true,\n                    \"description\": \"Links between
        entities in the plan\"\n                },\n                \"risks\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/StorylineRisk\"\n               \
        \     },\n                    \"nullable\": true,\n                    \"description\": \"Identified risks or weak
        points in the plan\"\n                },\n                \"generationTimeMs\": {\n                    \"type\": \"\
        integer\",\n                    \"description\": \"Time taken to generate in milliseconds\"\n                },\n\
        \                \"cached\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"\
        Whether this was returned from cache\"\n                }\n            }\n        },\n        \"StorylineGoal\": {\n\
        \            \"type\": \"string\",\n            \"enum\": [\n                \"revenge\",\n                \"resurrection\"\
        ,\n                \"legacy\",\n                \"mystery\",\n                \"peace\"\n            ],\n        \
        \    \"description\": \"High-level story goal that drives arc selection.\\nrevenge: Character seeks vengeance for
        past wrongs\\nresurrection: Restoring something/someone lost\\nlegacy: Creating or continuing a lasting impact\\nmystery:
        Uncovering hidden truths\\npeace: Resolving conflicts and finding harmony\\n\"\n        },\n        \"ArcType\": {\n\
        \            \"type\": \"string\",\n            \"enum\": [\n                \"RagsToRiches\",\n                \"\
        Tragedy\",\n                \"ManInHole\",\n                \"Icarus\",\n                \"Cinderella\",\n       \
        \         \"Oedipus\"\n            ],\n            \"description\": \"Emotional arc shapes from Reagan et al. research.\\
        nRagsToRiches: Rise (1)\\nTragedy: Fall (2)\\nManInHole: Fall then rise (3)\\nIcarus: Rise then fall (4)\\nCinderella:
        Rise, fall, rise (5)\\nOedipus: Fall, rise, fall (6)\\n\"\n        },\n        \"SpectrumType\": {\n            \"\
        type\": \"string\",\n            \"enum\": [\n                \"LifeDeath\",\n                \"HonorDishonor\",\n\
        \                \"JusticeInjustice\",\n                \"FreedomSubjugation\",\n                \"LoveHate\",\n \
        \               \"RespectShame\",\n                \"PowerImpotence\",\n                \"SuccessFailure\",\n    \
        \            \"AltruismSelfishness\",\n                \"WisdomIgnorance\"\n            ],\n            \"description\"\
        : \"The 10 Story Grid Life Value spectrums.\\nThese are bipolar axes for emotional progression.\\n\"\n        },\n\
        \        \"StorylinePlanPhase\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"description\": \"A phase in the storyline plan\",\n            \"required\": [\n                \"\
        phaseNumber\",\n                \"name\",\n                \"actions\",\n                \"targetState\",\n      \
        \          \"positionBounds\"\n            ],\n            \"properties\": {\n                \"phaseNumber\": {\n\
        \                    \"type\": \"integer\",\n                    \"minimum\": 1,\n                    \"description\"\
        : \"1-based phase number\"\n                },\n                \"name\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Phase name\"\n                },\n                \"actions\": {\n     \
        \               \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/StorylinePlanAction\"\
        \n                    },\n                    \"description\": \"Actions in this phase\"\n                },\n   \
        \             \"targetState\": {\n                    \"$ref\": \"#/$defs/PhaseTargetState\",\n                  \
        \  \"description\": \"Target state for phase completion\"\n                },\n                \"positionBounds\"\
        : {\n                    \"$ref\": \"#/$defs/PhasePosition\",\n                    \"description\": \"Position bounds
        for this phase\"\n                }\n            }\n        },\n        \"StorylinePlanAction\": {\n            \"\
        type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"A planned action
        in the storyline\",\n            \"required\": [\n                \"actionId\",\n                \"sequenceIndex\"\
        ,\n                \"effects\",\n                \"narrativeEffect\",\n                \"isCoreEvent\"\n         \
        \   ],\n            \"properties\": {\n                \"actionId\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Action identifier from action registry\"\n                },\n           \
        \     \"sequenceIndex\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Sequence
        index within the plan\"\n                },\n                \"effects\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ActionEffect\"\n                \
        \    },\n                    \"description\": \"World state effects of this action\"\n                },\n       \
        \         \"narrativeEffect\": {\n                    \"$ref\": \"#/$defs/NarrativeEffect\",\n                   \
        \ \"description\": \"Narrative effect on the emotional arc\"\n                },\n                \"isCoreEvent\"\
        : {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether this is an obligatory
        scene\"\n                },\n                \"chainedFrom\": {\n                    \"type\": \"string\",\n     \
        \               \"nullable\": true,\n                    \"description\": \"If chained, the ID of the action it was
        chained from\"\n                }\n            }\n        },\n        \"ActionEffect\": {\n            \"type\": \"\
        object\",\n            \"additionalProperties\": false,\n            \"description\": \"Effect of an action on world
        state\",\n            \"required\": [\n                \"key\",\n                \"value\"\n            ],\n     \
        \       \"properties\": {\n                \"key\": {\n                    \"type\": \"string\",\n               \
        \     \"description\": \"State key to modify\"\n                },\n                \"value\": {\n               \
        \     \"description\": \"New value to set (any type)\"\n                },\n                \"cardinality\": {\n \
        \                   \"$ref\": \"#/$defs/EffectCardinality\",\n                    \"description\": \"How the effect
        is applied\"\n                }\n            }\n        },\n        \"EffectCardinality\": {\n            \"type\"\
        : \"string\",\n            \"enum\": [\n                \"Exclusive\",\n                \"Additive\"\n           \
        \ ],\n            \"description\": \"Cardinality for effect application.\\nExclusive: Replaces existing value at key\\
        nAdditive: Adds to collection at key\\n\"\n        },\n        \"NarrativeEffect\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Narrative effect on the emotional
        arc\",\n            \"properties\": {\n                \"primarySpectrumDelta\": {\n                    \"type\":
        \"number\",\n                    \"format\": \"double\",\n                    \"nullable\": true,\n              \
        \      \"description\": \"Delta to apply to the primary spectrum\"\n                },\n                \"secondarySpectrumDelta\"\
        : {\n                    \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Delta to apply to the secondary spectrum\"\n           \
        \     },\n                \"positionAdvance\": {\n                    \"type\": \"string\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Position advance type (micro, standard, macro)\"\n     \
        \           }\n            }\n        },\n        \"PhaseTargetState\": {\n            \"type\": \"object\",\n   \
        \         \"additionalProperties\": false,\n            \"description\": \"Target state for phase completion\",\n\
        \            \"required\": [\n                \"minPrimarySpectrum\",\n                \"maxPrimarySpectrum\"\n  \
        \          ],\n            \"properties\": {\n                \"minPrimarySpectrum\": {\n                    \"type\"\
        : \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Minimum primary
        spectrum value for this phase\"\n                },\n                \"maxPrimarySpectrum\": {\n                 \
        \   \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Maximum
        primary spectrum value for this phase\"\n                },\n                \"rangeDescription\": {\n           \
        \         \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Human-readable description of this state range\"\n                }\n            }\n        },\n        \"PhasePosition\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Phase position constraints from Save the Cat beat timing\",\n            \"required\": [\n                \"stcCenter\"\
        ,\n                \"floor\",\n                \"ceiling\",\n                \"validationBand\"\n            ],\n\
        \            \"properties\": {\n                \"stcCenter\": {\n                    \"type\": \"number\",\n    \
        \                \"format\": \"double\",\n                    \"description\": \"Target position from STC beat timing\"\
        \n                },\n                \"floor\": {\n                    \"type\": \"number\",\n                  \
        \  \"format\": \"double\",\n                    \"description\": \"Earliest advancement position (prevents speed-running)\"\
        \n                },\n                \"ceiling\": {\n                    \"type\": \"number\",\n                \
        \    \"format\": \"double\",\n                    \"description\": \"Forced advancement position (prevents deadlock)\"\
        \n                },\n                \"validationBand\": {\n                    \"type\": \"number\",\n         \
        \           \"format\": \"double\",\n                    \"description\": \"Validation tolerance (\\u00b1)\"\n   \
        \             }\n            }\n        },\n        \"EntityRequirement\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"An entity required for the storyline\"\
        ,\n            \"required\": [\n                \"role\",\n                \"entityType\",\n                \"description\"\
        \n            ],\n            \"properties\": {\n                \"role\": {\n                    \"type\": \"string\"\
        ,\n                    \"description\": \"Role in the story (e.g., \\\"witness\\\", \\\"informant\\\", \\\"target\\\
        \")\"\n                },\n                \"entityType\": {\n                    \"type\": \"string\",\n        \
        \            \"description\": \"Type of entity needed (e.g., \\\"character\\\", \\\"location\\\", \\\"item\\\")\"\n\
        \                },\n                \"description\": {\n                    \"type\": \"string\",\n             \
        \       \"description\": \"Description of what's needed\"\n                },\n                \"constraints\": {\n\
        \                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                    \
        \    \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                    \"\
        description\": \"Constraints on entity selection/creation\"\n                },\n                \"sourceArchiveId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"If derived from an archive, that archive's ID\"\n      \
        \          }\n            }\n        },\n        \"StorylineLink\": {\n            \"type\": \"object\",\n       \
        \     \"additionalProperties\": false,\n            \"description\": \"A relationship link in the storyline\",\n \
        \           \"required\": [\n                \"sourceRole\",\n                \"targetRole\",\n                \"\
        linkType\"\n            ],\n            \"properties\": {\n                \"sourceRole\": {\n                   \
        \ \"type\": \"string\",\n                    \"description\": \"Source entity role\"\n                },\n       \
        \         \"targetRole\": {\n                    \"type\": \"string\",\n                    \"description\": \"Target
        entity role\"\n                },\n                \"linkType\": {\n                    \"type\": \"string\",\n  \
        \                  \"description\": \"Type of relationship (e.g., \\\"opposes\\\", \\\"allies_with\\\", \\\"seeks\\\
        \")\"\n                }\n            }\n        },\n        \"StorylineRisk\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Identified risk in the plan\",\n \
        \           \"required\": [\n                \"riskType\",\n                \"description\",\n                \"severity\"\
        \n            ],\n            \"properties\": {\n                \"riskType\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Risk category (e.g., \\\"missing_entity\\\", \\\"low_tension\\\"\
        , \\\"weak_climax\\\")\"\n                },\n                \"description\": {\n                    \"type\": \"\
        string\",\n                    \"description\": \"Risk description\"\n                },\n                \"severity\"\
        : {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"low\",\n\
        \                        \"medium\",\n                        \"high\"\n                    ],\n                 \
        \   \"description\": \"Risk severity\"\n                },\n                \"mitigation\": {\n                  \
        \  \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Suggested
        mitigation\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Retrieve a cached storyline plan\",\n    \"description\": \"Retrieves a
        previously generated storyline plan by its ID.\\nReturns 404 if the plan has expired from cache or doesn't exist.\\\
        n\",\n    \"tags\": [\n        \"Plans\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"GetPlan\"\n}"
  /storyline/plan/list:
    post:
      summary: List cached storyline plans
      description: |
        Lists storyline plans in the cache, optionally filtered by realm.
        Plans are ordered by creation time (newest first).
      operationId: ListPlans
      tags:
      - Plans
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListPlansRequest'
      responses:
        '200':
          description: Plans listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListPlansResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListPlansRequest\"\
        ,\n    \"$defs\": {\n        \"ListPlansRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to list cached plans\",\n            \"properties\": {\n        \
        \        \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n  \
        \                  \"nullable\": true,\n                    \"description\": \"Filter by realm (optional)\"\n    \
        \            },\n                \"limit\": {\n                    \"type\": \"integer\",\n                    \"\
        minimum\": 1,\n                    \"maximum\": 100,\n                    \"default\": 20,\n                    \"\
        description\": \"Maximum plans to return\"\n                },\n                \"offset\": {\n                  \
        \  \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"default\": 0,\n            \
        \        \"description\": \"Pagination offset\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListPlansResponse\"\
        ,\n    \"$defs\": {\n        \"ListPlansResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"List of plans\",\n            \"required\": [\n                \"plans\"\
        ,\n                \"totalCount\"\n            ],\n            \"properties\": {\n                \"plans\": {\n \
        \                   \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/PlanSummary\"\
        \n                    },\n                    \"description\": \"Plan summaries\"\n                },\n          \
        \      \"totalCount\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Total
        matching plans\"\n                }\n            }\n        },\n        \"PlanSummary\": {\n            \"type\":
        \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Summary of a cached plan\"\
        ,\n            \"required\": [\n                \"planId\",\n                \"goal\",\n                \"arcType\"\
        ,\n                \"confidence\",\n                \"createdAt\"\n            ],\n            \"properties\": {\n\
        \                \"planId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Plan identifier\"\n                },\n                \"goal\": {\n   \
        \                 \"$ref\": \"#/$defs/StorylineGoal\",\n                    \"description\": \"Story goal\"\n    \
        \            },\n                \"arcType\": {\n                    \"$ref\": \"#/$defs/ArcType\",\n            \
        \        \"description\": \"Arc type\"\n                },\n                \"confidence\": {\n                  \
        \  \"type\": \"number\",\n                    \"format\": \"double\",\n                    \"description\": \"Viability
        score\"\n                },\n                \"realmId\": {\n                    \"type\": \"string\",\n         \
        \           \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Anchored realm (if any)\"\n                },\n                \"createdAt\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When plan was created\"\
        \n                },\n                \"expiresAt\": {\n                    \"type\": \"string\",\n              \
        \      \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"\
        When plan expires from cache\"\n                }\n            }\n        },\n        \"StorylineGoal\": {\n     \
        \       \"type\": \"string\",\n            \"enum\": [\n                \"revenge\",\n                \"resurrection\"\
        ,\n                \"legacy\",\n                \"mystery\",\n                \"peace\"\n            ],\n        \
        \    \"description\": \"High-level story goal that drives arc selection.\\nrevenge: Character seeks vengeance for
        past wrongs\\nresurrection: Restoring something/someone lost\\nlegacy: Creating or continuing a lasting impact\\nmystery:
        Uncovering hidden truths\\npeace: Resolving conflicts and finding harmony\\n\"\n        },\n        \"ArcType\": {\n\
        \            \"type\": \"string\",\n            \"enum\": [\n                \"RagsToRiches\",\n                \"\
        Tragedy\",\n                \"ManInHole\",\n                \"Icarus\",\n                \"Cinderella\",\n       \
        \         \"Oedipus\"\n            ],\n            \"description\": \"Emotional arc shapes from Reagan et al. research.\\
        nRagsToRiches: Rise (1)\\nTragedy: Fall (2)\\nManInHole: Fall then rise (3)\\nIcarus: Rise then fall (4)\\nCinderella:
        Rise, fall, rise (5)\\nOedipus: Fall, rise, fall (6)\\n\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List cached storyline plans\",\n    \"description\": \"Lists storyline
        plans in the cache, optionally filtered by realm.\\nPlans are ordered by creation time (newest first).\\n\",\n   \
        \ \"tags\": [\n        \"Plans\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"ListPlans\"\n}"
  /storyline/scenario/create:
    post:
      summary: Create a new scenario definition
      description: |
        Creates a reusable scenario definition template.
        Scenarios are passive building blocks with triggering conditions,
        phases, mutations, and optional quest hooks.
      operationId: CreateScenarioDefinition
      tags:
      - Scenario Definitions
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScenarioDefinitionRequest'
      responses:
        '200':
          description: Scenario definition created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScenarioDefinition'
        '400':
          description: Invalid request (validation error)
        '409':
          description: Scenario with code already exists
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/CreateScenarioDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"CreateScenarioDefinitionRequest\": {\n            \"type\": \"object\",\n         \
        \   \"additionalProperties\": false,\n            \"description\": \"Request to create a scenario definition\",\n\
        \            \"required\": [\n                \"code\",\n                \"name\",\n                \"triggerConditions\"\
        ,\n                \"phases\"\n            ],\n            \"properties\": {\n                \"code\": {\n      \
        \              \"type\": \"string\",\n                    \"minLength\": 1,\n                    \"maxLength\": 100,\n\
        \                    \"description\": \"Human-readable scenario code (uppercase with underscores)\"\n            \
        \    },\n                \"name\": {\n                    \"type\": \"string\",\n                    \"minLength\"\
        : 1,\n                    \"maxLength\": 200,\n                    \"description\": \"Display name for the scenario\"\
        \n                },\n                \"description\": {\n                    \"type\": \"string\",\n            \
        \        \"nullable\": true,\n                    \"description\": \"Detailed scenario description\"\n           \
        \     },\n                \"triggerConditions\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/TriggerCondition\"\n                    },\n         \
        \           \"minItems\": 1,\n                    \"description\": \"Conditions that must ALL be met to trigger\"\n\
        \                },\n                \"phases\": {\n                    \"type\": \"array\",\n                   \
        \ \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioPhase\"\n                    },\n            \
        \        \"minItems\": 1,\n                    \"description\": \"Execution phases in order\"\n                },\n\
        \                \"mutations\": {\n                    \"type\": \"array\",\n                    \"items\": {\n  \
        \                      \"$ref\": \"#/$defs/ScenarioMutation\"\n                    },\n                    \"nullable\"\
        : true,\n                    \"description\": \"State mutations to apply on completion\"\n                },\n   \
        \             \"questHooks\": {\n                    \"type\": \"array\",\n                    \"items\": {\n    \
        \                    \"$ref\": \"#/$defs/ScenarioQuestHook\"\n                    },\n                    \"nullable\"\
        : true,\n                    \"description\": \"Quests to spawn on completion\"\n                },\n            \
        \    \"cooldownSeconds\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n   \
        \                 \"nullable\": true,\n                    \"description\": \"Per-character cooldown in seconds\"\n\
        \                },\n                \"exclusivityTags\": {\n                    \"type\": \"array\",\n          \
        \          \"items\": {\n                        \"type\": \"string\"\n                    },\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Tags for mutual exclusivity checking\"\n          \
        \      },\n                \"priority\": {\n                    \"type\": \"integer\",\n                    \"default\"\
        : 0,\n                    \"description\": \"Higher priority scenarios are checked first\"\n                },\n \
        \               \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"default\": true,\n\
        \                    \"description\": \"Whether scenario can be triggered\"\n                },\n                \"\
        realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n             \
        \       \"nullable\": true,\n                    \"description\": \"Realm scope (null means all realms)\"\n      \
        \          },\n                \"gameServiceId\": {\n                    \"type\": \"string\",\n                 \
        \   \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Game service
        scope (null means all games)\"\n                },\n                \"tags\": {\n                    \"type\": \"\
        array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n\
        \                    \"nullable\": true,\n                    \"description\": \"Classification tags for filtering\"\
        \n                }\n            }\n        },\n        \"TriggerCondition\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"A condition that must be met for scenario
        triggering\",\n            \"required\": [\n                \"conditionType\"\n            ],\n            \"properties\"\
        : {\n                \"conditionType\": {\n                    \"$ref\": \"#/$defs/TriggerConditionType\",\n     \
        \               \"description\": \"Type of condition to evaluate\"\n                },\n                \"traitAxis\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Personality trait axis for TraitRange (e.g., AGGRESSION)\"\n                },\n                \"traitMin\":
        {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Minimum trait value for TraitRange (-1.0 to 1.0)\"\n             \
        \   },\n                \"traitMax\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"float\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum trait value
        for TraitRange (-1.0 to 1.0)\"\n                },\n                \"backstoryType\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory element type
        for BackstoryElement (e.g., TRAUMA)\"\n                },\n                \"backstoryKey\": {\n                 \
        \   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory
        element key for BackstoryElement\"\n                },\n                \"relationshipTypeCode\": {\n            \
        \        \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Relationship
        type code for RelationshipExists/Missing\"\n                },\n                \"otherEntityType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Type of other entity in relationship check\"\n                },\n                \"ageMin\": {\n                \
        \    \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Minimum
        character age for AgeRange\"\n                },\n                \"ageMax\": {\n                    \"type\": \"\
        integer\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum character age
        for AgeRange\"\n                },\n                \"locationId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Required location ID for LocationAt\"\n                },\n                \"timeOfDayMin\": {\n             \
        \       \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"maximum\": 23,\n      \
        \              \"nullable\": true,\n                    \"description\": \"Minimum hour of day (0-23) for TimeOfDay\"\
        \n                },\n                \"timeOfDayMax\": {\n                    \"type\": \"integer\",\n          \
        \          \"minimum\": 0,\n                    \"maximum\": 23,\n                    \"nullable\": true,\n      \
        \              \"description\": \"Maximum hour of day (0-23) for TimeOfDay\"\n                },\n               \
        \ \"worldStateKey\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n     \
        \               \"description\": \"Custom state key for WorldState/Custom\"\n                },\n                \"\
        worldStateValue\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Expected value for WorldState/Custom\"\n                }\n            }\n      \
        \  },\n        \"TriggerConditionType\": {\n            \"type\": \"string\",\n            \"enum\": [\n         \
        \       \"TraitRange\",\n                \"BackstoryElement\",\n                \"RelationshipExists\",\n        \
        \        \"RelationshipMissing\",\n                \"AgeRange\",\n                \"LocationAt\",\n              \
        \  \"TimeOfDay\",\n                \"WorldState\",\n                \"Custom\"\n            ],\n            \"description\"\
        : \"Types of trigger conditions for scenario activation.\\nTraitRange: Character trait within value range\\nBackstoryElement:
        Character has specific backstory element\\nRelationshipExists: Relationship exists between entities\\nRelationshipMissing:
        Relationship does not exist\\nAgeRange: Character age within range\\nLocationAt: Character at specific location\\\
        nTimeOfDay: In-game time within range\\nWorldState: Custom world state check\\nCustom: Custom condition (not evaluated
        server-side)\\n\"\n        },\n        \"ScenarioPhase\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A phase in scenario execution\",\n            \"required\": [\n         \
        \       \"phaseNumber\",\n                \"name\"\n            ],\n            \"properties\": {\n              \
        \  \"phaseNumber\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n         \
        \           \"description\": \"Phase sequence number (1-based)\"\n                },\n                \"name\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Phase name\"\n                },\n\
        \                \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\":
        true,\n                    \"description\": \"What happens in this phase\"\n                },\n                \"\
        durationSeconds\": {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Expected duration in seconds (for pacing, not enforced)\"\n                },\n\
        \                \"dialogueHint\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Hint for dialogue generation system\"\n                },\n      \
        \          \"actionHint\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Hint for behavior/GOAP system\"\n                }\n            }\n      \
        \  },\n        \"ScenarioMutation\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"description\": \"A state mutation to apply during scenario execution\",\n            \"required\":
        [\n                \"mutationType\"\n            ],\n            \"properties\": {\n                \"mutationType\"\
        : {\n                    \"$ref\": \"#/$defs/MutationType\",\n                    \"description\": \"Type of mutation
        to apply\"\n                },\n                \"experienceType\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Experience type for PersonalityEvolve
        (e.g., TRAUMA, VICTORY)\"\n                },\n                \"experienceIntensity\": {\n                    \"\
        type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n         \
        \           \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\": \"Experience
        intensity for PersonalityEvolve (0.0-1.0)\"\n                },\n                \"backstoryElementType\": {\n   \
        \                 \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element type for BackstoryAdd (e.g., TRAUMA, GOAL)\"\n                },\n                \"backstoryKey\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element key for BackstoryAdd\"\n                },\n                \"backstoryValue\": {\n        \
        \            \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\":
        \"Backstory element value for BackstoryAdd\"\n                },\n                \"backstoryStrength\": {\n     \
        \               \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\"\
        : 0.0,\n                    \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element strength for BackstoryAdd (0.0-1.0)\"\n                },\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Relationship type code for RelationshipCreate/End\"\n                },\n                \"otherParticipantRole\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Role name for other participant in multi-character scenarios\"\n                }\n            }\n        },\n\
        \        \"MutationType\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"PersonalityEvolve\"\
        ,\n                \"BackstoryAdd\",\n                \"RelationshipCreate\",\n                \"RelationshipEnd\"\
        ,\n                \"Custom\"\n            ],\n            \"description\": \"Types of state mutations a scenario
        can apply.\\nPersonalityEvolve: Apply experience to evolve personality traits\\nBackstoryAdd: Add backstory element
        to character history\\nRelationshipCreate: Create relationship between entities\\nRelationshipEnd: End existing relationship\\
        nCustom: Custom mutation (not executed server-side)\\n\"\n        },\n        \"ScenarioQuestHook\": {\n         \
        \   \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Quest to spawn
        on scenario completion\",\n            \"required\": [\n                \"questCode\"\n            ],\n          \
        \  \"properties\": {\n                \"questCode\": {\n                    \"type\": \"string\",\n              \
        \      \"description\": \"Quest definition code to spawn\"\n                },\n                \"delaySeconds\":
        {\n                    \"type\": \"integer\",\n                    \"default\": 0,\n                    \"description\"\
        : \"Delay before spawning quest (not implemented in Phase 1)\"\n                },\n                \"termOverrides\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                 \
        \   \"description\": \"Variable overrides for quest template\"\n                }\n            }\n        }\n    }\n\
        }"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ScenarioDefinition\"\
        ,\n    \"$defs\": {\n        \"ScenarioDefinition\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A scenario definition template that can be triggered when conditions are
        met\",\n            \"required\": [\n                \"scenarioId\",\n                \"code\",\n                \"\
        name\",\n                \"triggerConditions\",\n                \"phases\",\n                \"priority\",\n    \
        \            \"enabled\",\n                \"createdAt\"\n            ],\n            \"properties\": {\n        \
        \        \"scenarioId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"Unique scenario definition identifier\"\n                },\n            \
        \    \"code\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n             \
        \       \"maxLength\": 100,\n                    \"description\": \"Human-readable scenario code (uppercase with underscores)\"\
        \n                },\n                \"name\": {\n                    \"type\": \"string\",\n                   \
        \ \"minLength\": 1,\n                    \"maxLength\": 200,\n                    \"description\": \"Display name
        for the scenario\"\n                },\n                \"description\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Detailed scenario description\"\
        \n                },\n                \"triggerConditions\": {\n                    \"type\": \"array\",\n       \
        \             \"items\": {\n                        \"$ref\": \"#/$defs/TriggerCondition\"\n                    },\n\
        \                    \"minItems\": 1,\n                    \"description\": \"Conditions that must ALL be met to trigger
        (AND logic)\"\n                },\n                \"phases\": {\n                    \"type\": \"array\",\n     \
        \               \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioPhase\"\n                    },\n\
        \                    \"minItems\": 1,\n                    \"description\": \"Execution phases in order\"\n      \
        \          },\n                \"mutations\": {\n                    \"type\": \"array\",\n                    \"\
        items\": {\n                        \"$ref\": \"#/$defs/ScenarioMutation\"\n                    },\n             \
        \       \"nullable\": true,\n                    \"description\": \"State mutations to apply on completion\"\n   \
        \             },\n                \"questHooks\": {\n                    \"type\": \"array\",\n                  \
        \  \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioQuestHook\"\n                    },\n       \
        \             \"nullable\": true,\n                    \"description\": \"Quests to spawn on completion\"\n      \
        \          },\n                \"cooldownSeconds\": {\n                    \"type\": \"integer\",\n              \
        \      \"minimum\": 0,\n                    \"nullable\": true,\n                    \"description\": \"Per-character
        cooldown in seconds (null uses default from config)\"\n                },\n                \"exclusivityTags\": {\n\
        \                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"\
        string\"\n                    },\n                    \"nullable\": true,\n                    \"description\": \"\
        Tags for mutual exclusivity checking\"\n                },\n                \"priority\": {\n                    \"\
        type\": \"integer\",\n                    \"default\": 0,\n                    \"description\": \"Higher priority
        scenarios are checked first\"\n                },\n                \"enabled\": {\n                    \"type\": \"\
        boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether scenario can be
        triggered\"\n                },\n                \"realmId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Realm scope (null means all realms)\"\n                },\n                \"gameServiceId\": {\n            \
        \        \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Game service scope (null means all games)\"\n                },\n        \
        \        \"tags\": {\n                    \"type\": \"array\",\n                    \"items\": {\n               \
        \         \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                \
        \    \"description\": \"Classification tags for filtering\"\n                },\n                \"isDeprecated\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Whether scenario definition is deprecated\"\n                },\n                \"deprecatedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"When the scenario definition was deprecated\"\n                },\n\
        \                \"deprecationReason\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"maxLength\": 500,\n                    \"description\": \"Reason for deprecation\"\n\
        \                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n               \
        \     \"format\": \"date-time\",\n                    \"description\": \"When definition was created\"\n         \
        \       },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When definition
        was last modified\"\n                },\n                \"etag\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"ETag for optimistic concurrency\"\
        \n                }\n            }\n        },\n        \"TriggerCondition\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"A condition that must be met for scenario
        triggering\",\n            \"required\": [\n                \"conditionType\"\n            ],\n            \"properties\"\
        : {\n                \"conditionType\": {\n                    \"$ref\": \"#/$defs/TriggerConditionType\",\n     \
        \               \"description\": \"Type of condition to evaluate\"\n                },\n                \"traitAxis\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Personality trait axis for TraitRange (e.g., AGGRESSION)\"\n                },\n                \"traitMin\":
        {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Minimum trait value for TraitRange (-1.0 to 1.0)\"\n             \
        \   },\n                \"traitMax\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"float\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum trait value
        for TraitRange (-1.0 to 1.0)\"\n                },\n                \"backstoryType\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory element type
        for BackstoryElement (e.g., TRAUMA)\"\n                },\n                \"backstoryKey\": {\n                 \
        \   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory
        element key for BackstoryElement\"\n                },\n                \"relationshipTypeCode\": {\n            \
        \        \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Relationship
        type code for RelationshipExists/Missing\"\n                },\n                \"otherEntityType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Type of other entity in relationship check\"\n                },\n                \"ageMin\": {\n                \
        \    \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Minimum
        character age for AgeRange\"\n                },\n                \"ageMax\": {\n                    \"type\": \"\
        integer\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum character age
        for AgeRange\"\n                },\n                \"locationId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Required location ID for LocationAt\"\n                },\n                \"timeOfDayMin\": {\n             \
        \       \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"maximum\": 23,\n      \
        \              \"nullable\": true,\n                    \"description\": \"Minimum hour of day (0-23) for TimeOfDay\"\
        \n                },\n                \"timeOfDayMax\": {\n                    \"type\": \"integer\",\n          \
        \          \"minimum\": 0,\n                    \"maximum\": 23,\n                    \"nullable\": true,\n      \
        \              \"description\": \"Maximum hour of day (0-23) for TimeOfDay\"\n                },\n               \
        \ \"worldStateKey\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n     \
        \               \"description\": \"Custom state key for WorldState/Custom\"\n                },\n                \"\
        worldStateValue\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Expected value for WorldState/Custom\"\n                }\n            }\n      \
        \  },\n        \"TriggerConditionType\": {\n            \"type\": \"string\",\n            \"enum\": [\n         \
        \       \"TraitRange\",\n                \"BackstoryElement\",\n                \"RelationshipExists\",\n        \
        \        \"RelationshipMissing\",\n                \"AgeRange\",\n                \"LocationAt\",\n              \
        \  \"TimeOfDay\",\n                \"WorldState\",\n                \"Custom\"\n            ],\n            \"description\"\
        : \"Types of trigger conditions for scenario activation.\\nTraitRange: Character trait within value range\\nBackstoryElement:
        Character has specific backstory element\\nRelationshipExists: Relationship exists between entities\\nRelationshipMissing:
        Relationship does not exist\\nAgeRange: Character age within range\\nLocationAt: Character at specific location\\\
        nTimeOfDay: In-game time within range\\nWorldState: Custom world state check\\nCustom: Custom condition (not evaluated
        server-side)\\n\"\n        },\n        \"ScenarioPhase\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A phase in scenario execution\",\n            \"required\": [\n         \
        \       \"phaseNumber\",\n                \"name\"\n            ],\n            \"properties\": {\n              \
        \  \"phaseNumber\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n         \
        \           \"description\": \"Phase sequence number (1-based)\"\n                },\n                \"name\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Phase name\"\n                },\n\
        \                \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\":
        true,\n                    \"description\": \"What happens in this phase\"\n                },\n                \"\
        durationSeconds\": {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Expected duration in seconds (for pacing, not enforced)\"\n                },\n\
        \                \"dialogueHint\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Hint for dialogue generation system\"\n                },\n      \
        \          \"actionHint\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Hint for behavior/GOAP system\"\n                }\n            }\n      \
        \  },\n        \"ScenarioMutation\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"description\": \"A state mutation to apply during scenario execution\",\n            \"required\":
        [\n                \"mutationType\"\n            ],\n            \"properties\": {\n                \"mutationType\"\
        : {\n                    \"$ref\": \"#/$defs/MutationType\",\n                    \"description\": \"Type of mutation
        to apply\"\n                },\n                \"experienceType\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Experience type for PersonalityEvolve
        (e.g., TRAUMA, VICTORY)\"\n                },\n                \"experienceIntensity\": {\n                    \"\
        type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n         \
        \           \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\": \"Experience
        intensity for PersonalityEvolve (0.0-1.0)\"\n                },\n                \"backstoryElementType\": {\n   \
        \                 \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element type for BackstoryAdd (e.g., TRAUMA, GOAL)\"\n                },\n                \"backstoryKey\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element key for BackstoryAdd\"\n                },\n                \"backstoryValue\": {\n        \
        \            \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\":
        \"Backstory element value for BackstoryAdd\"\n                },\n                \"backstoryStrength\": {\n     \
        \               \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\"\
        : 0.0,\n                    \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element strength for BackstoryAdd (0.0-1.0)\"\n                },\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Relationship type code for RelationshipCreate/End\"\n                },\n                \"otherParticipantRole\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Role name for other participant in multi-character scenarios\"\n                }\n            }\n        },\n\
        \        \"MutationType\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"PersonalityEvolve\"\
        ,\n                \"BackstoryAdd\",\n                \"RelationshipCreate\",\n                \"RelationshipEnd\"\
        ,\n                \"Custom\"\n            ],\n            \"description\": \"Types of state mutations a scenario
        can apply.\\nPersonalityEvolve: Apply experience to evolve personality traits\\nBackstoryAdd: Add backstory element
        to character history\\nRelationshipCreate: Create relationship between entities\\nRelationshipEnd: End existing relationship\\
        nCustom: Custom mutation (not executed server-side)\\n\"\n        },\n        \"ScenarioQuestHook\": {\n         \
        \   \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Quest to spawn
        on scenario completion\",\n            \"required\": [\n                \"questCode\"\n            ],\n          \
        \  \"properties\": {\n                \"questCode\": {\n                    \"type\": \"string\",\n              \
        \      \"description\": \"Quest definition code to spawn\"\n                },\n                \"delaySeconds\":
        {\n                    \"type\": \"integer\",\n                    \"default\": 0,\n                    \"description\"\
        : \"Delay before spawning quest (not implemented in Phase 1)\"\n                },\n                \"termOverrides\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                 \
        \   \"description\": \"Variable overrides for quest template\"\n                }\n            }\n        }\n    }\n\
        }"
      x-endpoint-info-json: "{\n    \"summary\": \"Create a new scenario definition\",\n    \"description\": \"Creates a reusable
        scenario definition template.\\nScenarios are passive building blocks with triggering conditions,\\nphases, mutations,
        and optional quest hooks.\\n\",\n    \"tags\": [\n        \"Scenario Definitions\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"CreateScenarioDefinition\"\n}"
  /storyline/scenario/get:
    post:
      summary: Get a scenario definition by ID or code
      description: |
        Retrieves a scenario definition by its ID or code.
        Uses read-through cache for performance.
      operationId: GetScenarioDefinition
      tags:
      - Scenario Definitions
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetScenarioDefinitionRequest'
      responses:
        '200':
          description: Scenario definition retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetScenarioDefinitionResponse'
        '404':
          description: Scenario not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetScenarioDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"GetScenarioDefinitionRequest\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Request to retrieve a scenario definition\",\n    \
        \        \"properties\": {\n                \"scenarioId\": {\n                    \"type\": \"string\",\n       \
        \             \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Scenario ID to retrieve\"\n                },\n                \"code\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Scenario code to retrieve (if ID
        not provided)\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetScenarioDefinitionResponse\"\
        ,\n    \"$defs\": {\n        \"GetScenarioDefinitionResponse\": {\n            \"type\": \"object\",\n           \
        \ \"additionalProperties\": false,\n            \"description\": \"Response with scenario definition\",\n        \
        \    \"required\": [\n                \"found\"\n            ],\n            \"properties\": {\n                \"\
        found\": {\n                    \"type\": \"boolean\",\n                    \"description\": \"Whether the scenario
        was found\"\n                },\n                \"scenario\": {\n                    \"$ref\": \"#/$defs/ScenarioDefinition\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"The scenario definition (null if
        not found)\"\n                }\n            }\n        },\n        \"ScenarioDefinition\": {\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"A scenario definition
        template that can be triggered when conditions are met\",\n            \"required\": [\n                \"scenarioId\"\
        ,\n                \"code\",\n                \"name\",\n                \"triggerConditions\",\n                \"\
        phases\",\n                \"priority\",\n                \"enabled\",\n                \"createdAt\"\n          \
        \  ],\n            \"properties\": {\n                \"scenarioId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Unique scenario definition identifier\"\
        \n                },\n                \"code\": {\n                    \"type\": \"string\",\n                   \
        \ \"minLength\": 1,\n                    \"maxLength\": 100,\n                    \"description\": \"Human-readable
        scenario code (uppercase with underscores)\"\n                },\n                \"name\": {\n                  \
        \  \"type\": \"string\",\n                    \"minLength\": 1,\n                    \"maxLength\": 200,\n       \
        \             \"description\": \"Display name for the scenario\"\n                },\n                \"description\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Detailed scenario description\"\n                },\n                \"triggerConditions\": {\n              \
        \      \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/TriggerCondition\"\
        \n                    },\n                    \"minItems\": 1,\n                    \"description\": \"Conditions
        that must ALL be met to trigger (AND logic)\"\n                },\n                \"phases\": {\n               \
        \     \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioPhase\"\
        \n                    },\n                    \"minItems\": 1,\n                    \"description\": \"Execution phases
        in order\"\n                },\n                \"mutations\": {\n                    \"type\": \"array\",\n     \
        \               \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioMutation\"\n                   \
        \ },\n                    \"nullable\": true,\n                    \"description\": \"State mutations to apply on
        completion\"\n                },\n                \"questHooks\": {\n                    \"type\": \"array\",\n  \
        \                  \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioQuestHook\"\n               \
        \     },\n                    \"nullable\": true,\n                    \"description\": \"Quests to spawn on completion\"\
        \n                },\n                \"cooldownSeconds\": {\n                    \"type\": \"integer\",\n       \
        \             \"minimum\": 0,\n                    \"nullable\": true,\n                    \"description\": \"Per-character
        cooldown in seconds (null uses default from config)\"\n                },\n                \"exclusivityTags\": {\n\
        \                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"\
        string\"\n                    },\n                    \"nullable\": true,\n                    \"description\": \"\
        Tags for mutual exclusivity checking\"\n                },\n                \"priority\": {\n                    \"\
        type\": \"integer\",\n                    \"default\": 0,\n                    \"description\": \"Higher priority
        scenarios are checked first\"\n                },\n                \"enabled\": {\n                    \"type\": \"\
        boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether scenario can be
        triggered\"\n                },\n                \"realmId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Realm scope (null means all realms)\"\n                },\n                \"gameServiceId\": {\n            \
        \        \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Game service scope (null means all games)\"\n                },\n        \
        \        \"tags\": {\n                    \"type\": \"array\",\n                    \"items\": {\n               \
        \         \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                \
        \    \"description\": \"Classification tags for filtering\"\n                },\n                \"isDeprecated\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Whether scenario definition is deprecated\"\n                },\n                \"deprecatedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"When the scenario definition was deprecated\"\n                },\n\
        \                \"deprecationReason\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"maxLength\": 500,\n                    \"description\": \"Reason for deprecation\"\n\
        \                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n               \
        \     \"format\": \"date-time\",\n                    \"description\": \"When definition was created\"\n         \
        \       },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When definition
        was last modified\"\n                },\n                \"etag\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"ETag for optimistic concurrency\"\
        \n                }\n            }\n        },\n        \"TriggerCondition\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"A condition that must be met for scenario
        triggering\",\n            \"required\": [\n                \"conditionType\"\n            ],\n            \"properties\"\
        : {\n                \"conditionType\": {\n                    \"$ref\": \"#/$defs/TriggerConditionType\",\n     \
        \               \"description\": \"Type of condition to evaluate\"\n                },\n                \"traitAxis\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Personality trait axis for TraitRange (e.g., AGGRESSION)\"\n                },\n                \"traitMin\":
        {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Minimum trait value for TraitRange (-1.0 to 1.0)\"\n             \
        \   },\n                \"traitMax\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"float\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum trait value
        for TraitRange (-1.0 to 1.0)\"\n                },\n                \"backstoryType\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory element type
        for BackstoryElement (e.g., TRAUMA)\"\n                },\n                \"backstoryKey\": {\n                 \
        \   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory
        element key for BackstoryElement\"\n                },\n                \"relationshipTypeCode\": {\n            \
        \        \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Relationship
        type code for RelationshipExists/Missing\"\n                },\n                \"otherEntityType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Type of other entity in relationship check\"\n                },\n                \"ageMin\": {\n                \
        \    \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Minimum
        character age for AgeRange\"\n                },\n                \"ageMax\": {\n                    \"type\": \"\
        integer\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum character age
        for AgeRange\"\n                },\n                \"locationId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Required location ID for LocationAt\"\n                },\n                \"timeOfDayMin\": {\n             \
        \       \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"maximum\": 23,\n      \
        \              \"nullable\": true,\n                    \"description\": \"Minimum hour of day (0-23) for TimeOfDay\"\
        \n                },\n                \"timeOfDayMax\": {\n                    \"type\": \"integer\",\n          \
        \          \"minimum\": 0,\n                    \"maximum\": 23,\n                    \"nullable\": true,\n      \
        \              \"description\": \"Maximum hour of day (0-23) for TimeOfDay\"\n                },\n               \
        \ \"worldStateKey\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n     \
        \               \"description\": \"Custom state key for WorldState/Custom\"\n                },\n                \"\
        worldStateValue\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Expected value for WorldState/Custom\"\n                }\n            }\n      \
        \  },\n        \"TriggerConditionType\": {\n            \"type\": \"string\",\n            \"enum\": [\n         \
        \       \"TraitRange\",\n                \"BackstoryElement\",\n                \"RelationshipExists\",\n        \
        \        \"RelationshipMissing\",\n                \"AgeRange\",\n                \"LocationAt\",\n              \
        \  \"TimeOfDay\",\n                \"WorldState\",\n                \"Custom\"\n            ],\n            \"description\"\
        : \"Types of trigger conditions for scenario activation.\\nTraitRange: Character trait within value range\\nBackstoryElement:
        Character has specific backstory element\\nRelationshipExists: Relationship exists between entities\\nRelationshipMissing:
        Relationship does not exist\\nAgeRange: Character age within range\\nLocationAt: Character at specific location\\\
        nTimeOfDay: In-game time within range\\nWorldState: Custom world state check\\nCustom: Custom condition (not evaluated
        server-side)\\n\"\n        },\n        \"ScenarioPhase\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A phase in scenario execution\",\n            \"required\": [\n         \
        \       \"phaseNumber\",\n                \"name\"\n            ],\n            \"properties\": {\n              \
        \  \"phaseNumber\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n         \
        \           \"description\": \"Phase sequence number (1-based)\"\n                },\n                \"name\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Phase name\"\n                },\n\
        \                \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\":
        true,\n                    \"description\": \"What happens in this phase\"\n                },\n                \"\
        durationSeconds\": {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Expected duration in seconds (for pacing, not enforced)\"\n                },\n\
        \                \"dialogueHint\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Hint for dialogue generation system\"\n                },\n      \
        \          \"actionHint\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Hint for behavior/GOAP system\"\n                }\n            }\n      \
        \  },\n        \"ScenarioMutation\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"description\": \"A state mutation to apply during scenario execution\",\n            \"required\":
        [\n                \"mutationType\"\n            ],\n            \"properties\": {\n                \"mutationType\"\
        : {\n                    \"$ref\": \"#/$defs/MutationType\",\n                    \"description\": \"Type of mutation
        to apply\"\n                },\n                \"experienceType\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Experience type for PersonalityEvolve
        (e.g., TRAUMA, VICTORY)\"\n                },\n                \"experienceIntensity\": {\n                    \"\
        type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n         \
        \           \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\": \"Experience
        intensity for PersonalityEvolve (0.0-1.0)\"\n                },\n                \"backstoryElementType\": {\n   \
        \                 \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element type for BackstoryAdd (e.g., TRAUMA, GOAL)\"\n                },\n                \"backstoryKey\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element key for BackstoryAdd\"\n                },\n                \"backstoryValue\": {\n        \
        \            \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\":
        \"Backstory element value for BackstoryAdd\"\n                },\n                \"backstoryStrength\": {\n     \
        \               \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\"\
        : 0.0,\n                    \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element strength for BackstoryAdd (0.0-1.0)\"\n                },\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Relationship type code for RelationshipCreate/End\"\n                },\n                \"otherParticipantRole\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Role name for other participant in multi-character scenarios\"\n                }\n            }\n        },\n\
        \        \"MutationType\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"PersonalityEvolve\"\
        ,\n                \"BackstoryAdd\",\n                \"RelationshipCreate\",\n                \"RelationshipEnd\"\
        ,\n                \"Custom\"\n            ],\n            \"description\": \"Types of state mutations a scenario
        can apply.\\nPersonalityEvolve: Apply experience to evolve personality traits\\nBackstoryAdd: Add backstory element
        to character history\\nRelationshipCreate: Create relationship between entities\\nRelationshipEnd: End existing relationship\\
        nCustom: Custom mutation (not executed server-side)\\n\"\n        },\n        \"ScenarioQuestHook\": {\n         \
        \   \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Quest to spawn
        on scenario completion\",\n            \"required\": [\n                \"questCode\"\n            ],\n          \
        \  \"properties\": {\n                \"questCode\": {\n                    \"type\": \"string\",\n              \
        \      \"description\": \"Quest definition code to spawn\"\n                },\n                \"delaySeconds\":
        {\n                    \"type\": \"integer\",\n                    \"default\": 0,\n                    \"description\"\
        : \"Delay before spawning quest (not implemented in Phase 1)\"\n                },\n                \"termOverrides\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                 \
        \   \"description\": \"Variable overrides for quest template\"\n                }\n            }\n        }\n    }\n\
        }"
      x-endpoint-info-json: "{\n    \"summary\": \"Get a scenario definition by ID or code\",\n    \"description\": \"Retrieves
        a scenario definition by its ID or code.\\nUses read-through cache for performance.\\n\",\n    \"tags\": [\n     \
        \   \"Scenario Definitions\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"GetScenarioDefinition\"\n\
        }"
  /storyline/scenario/list:
    post:
      summary: List scenario definitions
      description: |
        Lists scenario definitions with optional filtering by realm, game service, and tags.
        Results are paginated and ordered by priority (descending), then creation time.
      operationId: ListScenarioDefinitions
      tags:
      - Scenario Definitions
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListScenarioDefinitionsRequest'
      responses:
        '200':
          description: Scenarios listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListScenarioDefinitionsResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListScenarioDefinitionsRequest\"\
        ,\n    \"$defs\": {\n        \"ListScenarioDefinitionsRequest\": {\n            \"type\": \"object\",\n          \
        \  \"additionalProperties\": false,\n            \"description\": \"Request to list scenario definitions\",\n    \
        \        \"properties\": {\n                \"realmId\": {\n                    \"type\": \"string\",\n          \
        \          \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Filter by realm\"\n                },\n                \"gameServiceId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Filter by game service\"\n                },\n                \"tags\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n      \
        \              \"nullable\": true,\n                    \"description\": \"Filter by tags (OR logic)\"\n         \
        \       },\n                \"includeDeprecated\": {\n                    \"type\": \"boolean\",\n               \
        \     \"default\": false,\n                    \"description\": \"Include deprecated scenarios\"\n               \
        \ },\n                \"limit\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n\
        \                    \"maximum\": 100,\n                    \"default\": 20,\n                    \"description\"\
        : \"Maximum scenarios to return\"\n                },\n                \"offset\": {\n                    \"type\"\
        : \"integer\",\n                    \"minimum\": 0,\n                    \"default\": 0,\n                    \"description\"\
        : \"Pagination offset\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ListScenarioDefinitionsResponse\"\
        ,\n    \"$defs\": {\n        \"ListScenarioDefinitionsResponse\": {\n            \"type\": \"object\",\n         \
        \   \"additionalProperties\": false,\n            \"description\": \"List of scenario definitions\",\n           \
        \ \"required\": [\n                \"scenarios\",\n                \"totalCount\"\n            ],\n            \"\
        properties\": {\n                \"scenarios\": {\n                    \"type\": \"array\",\n                    \"\
        items\": {\n                        \"$ref\": \"#/$defs/ScenarioDefinitionSummary\"\n                    },\n    \
        \                \"description\": \"Scenario definition summaries\"\n                },\n                \"totalCount\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Total matching scenarios\"\
        \n                }\n            }\n        },\n        \"ScenarioDefinitionSummary\": {\n            \"type\": \"\
        object\",\n            \"additionalProperties\": false,\n            \"description\": \"Summary of a scenario definition\"\
        ,\n            \"required\": [\n                \"scenarioId\",\n                \"code\",\n                \"name\"\
        ,\n                \"priority\",\n                \"enabled\",\n                \"createdAt\"\n            ],\n  \
        \          \"properties\": {\n                \"scenarioId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"description\": \"Scenario identifier\"\n            \
        \    },\n                \"code\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Scenario code\"\n                },\n                \"name\": {\n                    \"type\": \"string\",\n\
        \                    \"description\": \"Scenario name\"\n                },\n                \"priority\": {\n   \
        \                 \"type\": \"integer\",\n                    \"description\": \"Scenario priority\"\n           \
        \     },\n                \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether enabled\"\n                },\n                \"isDeprecated\": {\n                    \"type\": \"boolean\"\
        ,\n                    \"description\": \"Whether deprecated\"\n                },\n                \"deprecatedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When deprecated\"\n                },\n          \
        \      \"deprecationReason\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"maxLength\": 500,\n                    \"description\": \"Reason for deprecation\"\n      \
        \          },\n                \"conditionCount\": {\n                    \"type\": \"integer\",\n               \
        \     \"description\": \"Number of trigger conditions\"\n                },\n                \"phaseCount\": {\n \
        \                   \"type\": \"integer\",\n                    \"description\": \"Number of phases\"\n          \
        \      },\n                \"mutationCount\": {\n                    \"type\": \"integer\",\n                    \"\
        description\": \"Number of mutations\"\n                },\n                \"questHookCount\": {\n              \
        \      \"type\": \"integer\",\n                    \"description\": \"Number of quest hooks\"\n                },\n\
        \                \"realmId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Realm scope\"\n               \
        \ },\n                \"gameServiceId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"nullable\": true,\n                    \"description\": \"Game service scope\"\n\
        \                },\n                \"tags\": {\n                    \"type\": \"array\",\n                    \"\
        items\": {\n                        \"type\": \"string\"\n                    },\n                    \"nullable\"\
        : true,\n                    \"description\": \"Classification tags\"\n                },\n                \"createdAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"description\": \"When created\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"List scenario definitions\",\n    \"description\": \"Lists scenario definitions
        with optional filtering by realm, game service, and tags.\\nResults are paginated and ordered by priority (descending),
        then creation time.\\n\",\n    \"tags\": [\n        \"Scenario Definitions\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"ListScenarioDefinitions\"\n}"
  /storyline/scenario/update:
    post:
      summary: Update a scenario definition
      description: |
        Updates an existing scenario definition.
        Uses ETag for optimistic concurrency control.
      operationId: UpdateScenarioDefinition
      tags:
      - Scenario Definitions
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScenarioDefinitionRequest'
      responses:
        '200':
          description: Scenario updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScenarioDefinition'
        '404':
          description: Scenario not found
        '409':
          description: Concurrent modification conflict
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/UpdateScenarioDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"UpdateScenarioDefinitionRequest\": {\n            \"type\": \"object\",\n         \
        \   \"additionalProperties\": false,\n            \"description\": \"Request to update a scenario definition\",\n\
        \            \"required\": [\n                \"scenarioId\",\n                \"etag\"\n            ],\n        \
        \    \"properties\": {\n                \"scenarioId\": {\n                    \"type\": \"string\",\n           \
        \         \"format\": \"uuid\",\n                    \"description\": \"Scenario to update\"\n                },\n\
        \                \"etag\": {\n                    \"type\": \"string\",\n                    \"description\": \"ETag
        for optimistic concurrency\"\n                },\n                \"name\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"New name\"\n                },\n\
        \                \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\":
        true,\n                    \"description\": \"New description\"\n                },\n                \"triggerConditions\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/TriggerCondition\"\n                    },\n                    \"nullable\": true,\n                \
        \    \"description\": \"New trigger conditions\"\n                },\n                \"phases\": {\n            \
        \        \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioPhase\"\
        \n                    },\n                    \"nullable\": true,\n                    \"description\": \"New phases\"\
        \n                },\n                \"mutations\": {\n                    \"type\": \"array\",\n               \
        \     \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioMutation\"\n                    },\n     \
        \               \"nullable\": true,\n                    \"description\": \"New mutations\"\n                },\n\
        \                \"questHooks\": {\n                    \"type\": \"array\",\n                    \"items\": {\n \
        \                       \"$ref\": \"#/$defs/ScenarioQuestHook\"\n                    },\n                    \"nullable\"\
        : true,\n                    \"description\": \"New quest hooks\"\n                },\n                \"cooldownSeconds\"\
        : {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"nullable\"\
        : true,\n                    \"description\": \"New cooldown\"\n                },\n                \"exclusivityTags\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\"\
        : \"string\"\n                    },\n                    \"nullable\": true,\n                    \"description\"\
        : \"New exclusivity tags\"\n                },\n                \"priority\": {\n                    \"type\": \"\
        integer\",\n                    \"nullable\": true,\n                    \"description\": \"New priority\"\n     \
        \           },\n                \"enabled\": {\n                    \"type\": \"boolean\",\n                    \"\
        nullable\": true,\n                    \"description\": \"New enabled state\"\n                },\n              \
        \  \"tags\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                     \
        \   \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                    \"\
        description\": \"New classification tags\"\n                }\n            }\n        },\n        \"TriggerCondition\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"A condition that must be met for scenario triggering\",\n            \"required\": [\n                \"conditionType\"\
        \n            ],\n            \"properties\": {\n                \"conditionType\": {\n                    \"$ref\"\
        : \"#/$defs/TriggerConditionType\",\n                    \"description\": \"Type of condition to evaluate\"\n    \
        \            },\n                \"traitAxis\": {\n                    \"type\": \"string\",\n                   \
        \ \"nullable\": true,\n                    \"description\": \"Personality trait axis for TraitRange (e.g., AGGRESSION)\"\
        \n                },\n                \"traitMin\": {\n                    \"type\": \"number\",\n               \
        \     \"format\": \"float\",\n                    \"nullable\": true,\n                    \"description\": \"Minimum
        trait value for TraitRange (-1.0 to 1.0)\"\n                },\n                \"traitMax\": {\n                \
        \    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Maximum trait value for TraitRange (-1.0 to 1.0)\"\n                },\n \
        \               \"backstoryType\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Backstory element type for BackstoryElement (e.g., TRAUMA)\"\n   \
        \             },\n                \"backstoryKey\": {\n                    \"type\": \"string\",\n               \
        \     \"nullable\": true,\n                    \"description\": \"Backstory element key for BackstoryElement\"\n \
        \               },\n                \"relationshipTypeCode\": {\n                    \"type\": \"string\",\n     \
        \               \"nullable\": true,\n                    \"description\": \"Relationship type code for RelationshipExists/Missing\"\
        \n                },\n                \"otherEntityType\": {\n                    \"type\": \"string\",\n        \
        \            \"nullable\": true,\n                    \"description\": \"Type of other entity in relationship check\"\
        \n                },\n                \"ageMin\": {\n                    \"type\": \"integer\",\n                \
        \    \"nullable\": true,\n                    \"description\": \"Minimum character age for AgeRange\"\n          \
        \      },\n                \"ageMax\": {\n                    \"type\": \"integer\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Maximum character age for AgeRange\"\n                },\n       \
        \         \"locationId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Required location ID for LocationAt\"\
        \n                },\n                \"timeOfDayMin\": {\n                    \"type\": \"integer\",\n          \
        \          \"minimum\": 0,\n                    \"maximum\": 23,\n                    \"nullable\": true,\n      \
        \              \"description\": \"Minimum hour of day (0-23) for TimeOfDay\"\n                },\n               \
        \ \"timeOfDayMax\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n         \
        \           \"maximum\": 23,\n                    \"nullable\": true,\n                    \"description\": \"Maximum
        hour of day (0-23) for TimeOfDay\"\n                },\n                \"worldStateKey\": {\n                   \
        \ \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Custom state
        key for WorldState/Custom\"\n                },\n                \"worldStateValue\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Expected value for
        WorldState/Custom\"\n                }\n            }\n        },\n        \"TriggerConditionType\": {\n         \
        \   \"type\": \"string\",\n            \"enum\": [\n                \"TraitRange\",\n                \"BackstoryElement\"\
        ,\n                \"RelationshipExists\",\n                \"RelationshipMissing\",\n                \"AgeRange\"\
        ,\n                \"LocationAt\",\n                \"TimeOfDay\",\n                \"WorldState\",\n            \
        \    \"Custom\"\n            ],\n            \"description\": \"Types of trigger conditions for scenario activation.\\
        nTraitRange: Character trait within value range\\nBackstoryElement: Character has specific backstory element\\nRelationshipExists:
        Relationship exists between entities\\nRelationshipMissing: Relationship does not exist\\nAgeRange: Character age
        within range\\nLocationAt: Character at specific location\\nTimeOfDay: In-game time within range\\nWorldState: Custom
        world state check\\nCustom: Custom condition (not evaluated server-side)\\n\"\n        },\n        \"ScenarioPhase\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"A phase in scenario execution\",\n            \"required\": [\n                \"phaseNumber\",\n            \
        \    \"name\"\n            ],\n            \"properties\": {\n                \"phaseNumber\": {\n               \
        \     \"type\": \"integer\",\n                    \"minimum\": 1,\n                    \"description\": \"Phase sequence
        number (1-based)\"\n                },\n                \"name\": {\n                    \"type\": \"string\",\n \
        \                   \"description\": \"Phase name\"\n                },\n                \"description\": {\n    \
        \                \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"What happens in this phase\"\n                },\n                \"durationSeconds\": {\n                   \
        \ \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Expected
        duration in seconds (for pacing, not enforced)\"\n                },\n                \"dialogueHint\": {\n      \
        \              \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Hint for dialogue generation system\"\n                },\n                \"actionHint\": {\n               \
        \     \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Hint
        for behavior/GOAP system\"\n                }\n            }\n        },\n        \"ScenarioMutation\": {\n      \
        \      \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"A state
        mutation to apply during scenario execution\",\n            \"required\": [\n                \"mutationType\"\n  \
        \          ],\n            \"properties\": {\n                \"mutationType\": {\n                    \"$ref\": \"\
        #/$defs/MutationType\",\n                    \"description\": \"Type of mutation to apply\"\n                },\n\
        \                \"experienceType\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Experience type for PersonalityEvolve (e.g., TRAUMA, VICTORY)\"\n\
        \                },\n                \"experienceIntensity\": {\n                    \"type\": \"number\",\n     \
        \               \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\": 1.0,\n\
        \                    \"nullable\": true,\n                    \"description\": \"Experience intensity for PersonalityEvolve
        (0.0-1.0)\"\n                },\n                \"backstoryElementType\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Backstory element type for BackstoryAdd
        (e.g., TRAUMA, GOAL)\"\n                },\n                \"backstoryKey\": {\n                    \"type\": \"\
        string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory element key for
        BackstoryAdd\"\n                },\n                \"backstoryValue\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Backstory element value for BackstoryAdd\"\
        \n                },\n                \"backstoryStrength\": {\n                    \"type\": \"number\",\n      \
        \              \"format\": \"float\",\n                    \"minimum\": 0.0,\n                    \"maximum\": 1.0,\n\
        \                    \"nullable\": true,\n                    \"description\": \"Backstory element strength for BackstoryAdd
        (0.0-1.0)\"\n                },\n                \"relationshipTypeCode\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Relationship type code for RelationshipCreate/End\"\
        \n                },\n                \"otherParticipantRole\": {\n                    \"type\": \"string\",\n   \
        \                 \"nullable\": true,\n                    \"description\": \"Role name for other participant in multi-character
        scenarios\"\n                }\n            }\n        },\n        \"MutationType\": {\n            \"type\": \"string\"\
        ,\n            \"enum\": [\n                \"PersonalityEvolve\",\n                \"BackstoryAdd\",\n          \
        \      \"RelationshipCreate\",\n                \"RelationshipEnd\",\n                \"Custom\"\n            ],\n\
        \            \"description\": \"Types of state mutations a scenario can apply.\\nPersonalityEvolve: Apply experience
        to evolve personality traits\\nBackstoryAdd: Add backstory element to character history\\nRelationshipCreate: Create
        relationship between entities\\nRelationshipEnd: End existing relationship\\nCustom: Custom mutation (not executed
        server-side)\\n\"\n        },\n        \"ScenarioQuestHook\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Quest to spawn on scenario completion\",\n        \
        \    \"required\": [\n                \"questCode\"\n            ],\n            \"properties\": {\n             \
        \   \"questCode\": {\n                    \"type\": \"string\",\n                    \"description\": \"Quest definition
        code to spawn\"\n                },\n                \"delaySeconds\": {\n                    \"type\": \"integer\"\
        ,\n                    \"default\": 0,\n                    \"description\": \"Delay before spawning quest (not implemented
        in Phase 1)\"\n                },\n                \"termOverrides\": {\n                    \"type\": \"object\"\
        ,\n                    \"additionalProperties\": {\n                        \"type\": \"string\"\n               \
        \     },\n                    \"nullable\": true,\n                    \"description\": \"Variable overrides for quest
        template\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/ScenarioDefinition\"\
        ,\n    \"$defs\": {\n        \"ScenarioDefinition\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A scenario definition template that can be triggered when conditions are
        met\",\n            \"required\": [\n                \"scenarioId\",\n                \"code\",\n                \"\
        name\",\n                \"triggerConditions\",\n                \"phases\",\n                \"priority\",\n    \
        \            \"enabled\",\n                \"createdAt\"\n            ],\n            \"properties\": {\n        \
        \        \"scenarioId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n\
        \                    \"description\": \"Unique scenario definition identifier\"\n                },\n            \
        \    \"code\": {\n                    \"type\": \"string\",\n                    \"minLength\": 1,\n             \
        \       \"maxLength\": 100,\n                    \"description\": \"Human-readable scenario code (uppercase with underscores)\"\
        \n                },\n                \"name\": {\n                    \"type\": \"string\",\n                   \
        \ \"minLength\": 1,\n                    \"maxLength\": 200,\n                    \"description\": \"Display name
        for the scenario\"\n                },\n                \"description\": {\n                    \"type\": \"string\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Detailed scenario description\"\
        \n                },\n                \"triggerConditions\": {\n                    \"type\": \"array\",\n       \
        \             \"items\": {\n                        \"$ref\": \"#/$defs/TriggerCondition\"\n                    },\n\
        \                    \"minItems\": 1,\n                    \"description\": \"Conditions that must ALL be met to trigger
        (AND logic)\"\n                },\n                \"phases\": {\n                    \"type\": \"array\",\n     \
        \               \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioPhase\"\n                    },\n\
        \                    \"minItems\": 1,\n                    \"description\": \"Execution phases in order\"\n      \
        \          },\n                \"mutations\": {\n                    \"type\": \"array\",\n                    \"\
        items\": {\n                        \"$ref\": \"#/$defs/ScenarioMutation\"\n                    },\n             \
        \       \"nullable\": true,\n                    \"description\": \"State mutations to apply on completion\"\n   \
        \             },\n                \"questHooks\": {\n                    \"type\": \"array\",\n                  \
        \  \"items\": {\n                        \"$ref\": \"#/$defs/ScenarioQuestHook\"\n                    },\n       \
        \             \"nullable\": true,\n                    \"description\": \"Quests to spawn on completion\"\n      \
        \          },\n                \"cooldownSeconds\": {\n                    \"type\": \"integer\",\n              \
        \      \"minimum\": 0,\n                    \"nullable\": true,\n                    \"description\": \"Per-character
        cooldown in seconds (null uses default from config)\"\n                },\n                \"exclusivityTags\": {\n\
        \                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"\
        string\"\n                    },\n                    \"nullable\": true,\n                    \"description\": \"\
        Tags for mutual exclusivity checking\"\n                },\n                \"priority\": {\n                    \"\
        type\": \"integer\",\n                    \"default\": 0,\n                    \"description\": \"Higher priority
        scenarios are checked first\"\n                },\n                \"enabled\": {\n                    \"type\": \"\
        boolean\",\n                    \"default\": true,\n                    \"description\": \"Whether scenario can be
        triggered\"\n                },\n                \"realmId\": {\n                    \"type\": \"string\",\n     \
        \               \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Realm scope (null means all realms)\"\n                },\n                \"gameServiceId\": {\n            \
        \        \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Game service scope (null means all games)\"\n                },\n        \
        \        \"tags\": {\n                    \"type\": \"array\",\n                    \"items\": {\n               \
        \         \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                \
        \    \"description\": \"Classification tags for filtering\"\n                },\n                \"isDeprecated\"\
        : {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n                    \"description\"\
        : \"Whether scenario definition is deprecated\"\n                },\n                \"deprecatedAt\": {\n       \
        \             \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"When the scenario definition was deprecated\"\n                },\n\
        \                \"deprecationReason\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"maxLength\": 500,\n                    \"description\": \"Reason for deprecation\"\n\
        \                },\n                \"createdAt\": {\n                    \"type\": \"string\",\n               \
        \     \"format\": \"date-time\",\n                    \"description\": \"When definition was created\"\n         \
        \       },\n                \"updatedAt\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"date-time\",\n                    \"nullable\": true,\n                    \"description\": \"When definition
        was last modified\"\n                },\n                \"etag\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"ETag for optimistic concurrency\"\
        \n                }\n            }\n        },\n        \"TriggerCondition\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"A condition that must be met for scenario
        triggering\",\n            \"required\": [\n                \"conditionType\"\n            ],\n            \"properties\"\
        : {\n                \"conditionType\": {\n                    \"$ref\": \"#/$defs/TriggerConditionType\",\n     \
        \               \"description\": \"Type of condition to evaluate\"\n                },\n                \"traitAxis\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Personality trait axis for TraitRange (e.g., AGGRESSION)\"\n                },\n                \"traitMin\":
        {\n                    \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Minimum trait value for TraitRange (-1.0 to 1.0)\"\n             \
        \   },\n                \"traitMax\": {\n                    \"type\": \"number\",\n                    \"format\"\
        : \"float\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum trait value
        for TraitRange (-1.0 to 1.0)\"\n                },\n                \"backstoryType\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory element type
        for BackstoryElement (e.g., TRAUMA)\"\n                },\n                \"backstoryKey\": {\n                 \
        \   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Backstory
        element key for BackstoryElement\"\n                },\n                \"relationshipTypeCode\": {\n            \
        \        \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Relationship
        type code for RelationshipExists/Missing\"\n                },\n                \"otherEntityType\": {\n         \
        \           \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\": \"\
        Type of other entity in relationship check\"\n                },\n                \"ageMin\": {\n                \
        \    \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Minimum
        character age for AgeRange\"\n                },\n                \"ageMax\": {\n                    \"type\": \"\
        integer\",\n                    \"nullable\": true,\n                    \"description\": \"Maximum character age
        for AgeRange\"\n                },\n                \"locationId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Required location ID for LocationAt\"\n                },\n                \"timeOfDayMin\": {\n             \
        \       \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"maximum\": 23,\n      \
        \              \"nullable\": true,\n                    \"description\": \"Minimum hour of day (0-23) for TimeOfDay\"\
        \n                },\n                \"timeOfDayMax\": {\n                    \"type\": \"integer\",\n          \
        \          \"minimum\": 0,\n                    \"maximum\": 23,\n                    \"nullable\": true,\n      \
        \              \"description\": \"Maximum hour of day (0-23) for TimeOfDay\"\n                },\n               \
        \ \"worldStateKey\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n     \
        \               \"description\": \"Custom state key for WorldState/Custom\"\n                },\n                \"\
        worldStateValue\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n       \
        \             \"description\": \"Expected value for WorldState/Custom\"\n                }\n            }\n      \
        \  },\n        \"TriggerConditionType\": {\n            \"type\": \"string\",\n            \"enum\": [\n         \
        \       \"TraitRange\",\n                \"BackstoryElement\",\n                \"RelationshipExists\",\n        \
        \        \"RelationshipMissing\",\n                \"AgeRange\",\n                \"LocationAt\",\n              \
        \  \"TimeOfDay\",\n                \"WorldState\",\n                \"Custom\"\n            ],\n            \"description\"\
        : \"Types of trigger conditions for scenario activation.\\nTraitRange: Character trait within value range\\nBackstoryElement:
        Character has specific backstory element\\nRelationshipExists: Relationship exists between entities\\nRelationshipMissing:
        Relationship does not exist\\nAgeRange: Character age within range\\nLocationAt: Character at specific location\\\
        nTimeOfDay: In-game time within range\\nWorldState: Custom world state check\\nCustom: Custom condition (not evaluated
        server-side)\\n\"\n        },\n        \"ScenarioPhase\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A phase in scenario execution\",\n            \"required\": [\n         \
        \       \"phaseNumber\",\n                \"name\"\n            ],\n            \"properties\": {\n              \
        \  \"phaseNumber\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n         \
        \           \"description\": \"Phase sequence number (1-based)\"\n                },\n                \"name\": {\n\
        \                    \"type\": \"string\",\n                    \"description\": \"Phase name\"\n                },\n\
        \                \"description\": {\n                    \"type\": \"string\",\n                    \"nullable\":
        true,\n                    \"description\": \"What happens in this phase\"\n                },\n                \"\
        durationSeconds\": {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n      \
        \              \"description\": \"Expected duration in seconds (for pacing, not enforced)\"\n                },\n\
        \                \"dialogueHint\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Hint for dialogue generation system\"\n                },\n      \
        \          \"actionHint\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Hint for behavior/GOAP system\"\n                }\n            }\n      \
        \  },\n        \"ScenarioMutation\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n\
        \            \"description\": \"A state mutation to apply during scenario execution\",\n            \"required\":
        [\n                \"mutationType\"\n            ],\n            \"properties\": {\n                \"mutationType\"\
        : {\n                    \"$ref\": \"#/$defs/MutationType\",\n                    \"description\": \"Type of mutation
        to apply\"\n                },\n                \"experienceType\": {\n                    \"type\": \"string\",\n\
        \                    \"nullable\": true,\n                    \"description\": \"Experience type for PersonalityEvolve
        (e.g., TRAUMA, VICTORY)\"\n                },\n                \"experienceIntensity\": {\n                    \"\
        type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\": 0.0,\n         \
        \           \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\": \"Experience
        intensity for PersonalityEvolve (0.0-1.0)\"\n                },\n                \"backstoryElementType\": {\n   \
        \                 \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element type for BackstoryAdd (e.g., TRAUMA, GOAL)\"\n                },\n                \"backstoryKey\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element key for BackstoryAdd\"\n                },\n                \"backstoryValue\": {\n        \
        \            \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\":
        \"Backstory element value for BackstoryAdd\"\n                },\n                \"backstoryStrength\": {\n     \
        \               \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"minimum\"\
        : 0.0,\n                    \"maximum\": 1.0,\n                    \"nullable\": true,\n                    \"description\"\
        : \"Backstory element strength for BackstoryAdd (0.0-1.0)\"\n                },\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Relationship type code for RelationshipCreate/End\"\n                },\n                \"otherParticipantRole\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Role name for other participant in multi-character scenarios\"\n                }\n            }\n        },\n\
        \        \"MutationType\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"PersonalityEvolve\"\
        ,\n                \"BackstoryAdd\",\n                \"RelationshipCreate\",\n                \"RelationshipEnd\"\
        ,\n                \"Custom\"\n            ],\n            \"description\": \"Types of state mutations a scenario
        can apply.\\nPersonalityEvolve: Apply experience to evolve personality traits\\nBackstoryAdd: Add backstory element
        to character history\\nRelationshipCreate: Create relationship between entities\\nRelationshipEnd: End existing relationship\\
        nCustom: Custom mutation (not executed server-side)\\n\"\n        },\n        \"ScenarioQuestHook\": {\n         \
        \   \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Quest to spawn
        on scenario completion\",\n            \"required\": [\n                \"questCode\"\n            ],\n          \
        \  \"properties\": {\n                \"questCode\": {\n                    \"type\": \"string\",\n              \
        \      \"description\": \"Quest definition code to spawn\"\n                },\n                \"delaySeconds\":
        {\n                    \"type\": \"integer\",\n                    \"default\": 0,\n                    \"description\"\
        : \"Delay before spawning quest (not implemented in Phase 1)\"\n                },\n                \"termOverrides\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                 \
        \   \"description\": \"Variable overrides for quest template\"\n                }\n            }\n        }\n    }\n\
        }"
      x-endpoint-info-json: "{\n    \"summary\": \"Update a scenario definition\",\n    \"description\": \"Updates an existing
        scenario definition.\\nUses ETag for optimistic concurrency control.\\n\",\n    \"tags\": [\n        \"Scenario Definitions\"\
        \n    ],\n    \"deprecated\": false,\n    \"operationId\": \"UpdateScenarioDefinition\"\n}"
  /storyline/scenario/deprecate:
    post:
      summary: Deprecate a scenario definition
      description: |
        Soft-deletes a scenario definition by marking it deprecated.
        Deprecated scenarios are not returned by find-available.
      operationId: DeprecateScenarioDefinition
      tags:
      - Scenario Definitions
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeprecateScenarioDefinitionRequest'
      responses:
        '200':
          description: Scenario deprecated
        '404':
          description: Scenario not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/DeprecateScenarioDefinitionRequest\"\
        ,\n    \"$defs\": {\n        \"DeprecateScenarioDefinitionRequest\": {\n            \"type\": \"object\",\n      \
        \      \"additionalProperties\": false,\n            \"description\": \"Request to deprecate a scenario definition\"\
        ,\n            \"required\": [\n                \"scenarioId\"\n            ],\n            \"properties\": {\n  \
        \              \"scenarioId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Scenario to deprecate\"\n                },\n                \"reason\"\
        : {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n                    \"maxLength\"\
        : 500,\n                    \"description\": \"Reason for deprecation\"\n                }\n            }\n      \
        \  }\n    }\n}"
      x-response-schema-json: '{}'
      x-endpoint-info-json: "{\n    \"summary\": \"Deprecate a scenario definition\",\n    \"description\": \"Soft-deletes
        a scenario definition by marking it deprecated.\\nDeprecated scenarios are not returned by find-available.\\n\",\n\
        \    \"tags\": [\n        \"Scenario Definitions\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"DeprecateScenarioDefinition\"\
        \n}"
  /storyline/scenario/find-available:
    post:
      summary: Find scenarios matching character state
      description: |
        Finds scenarios that match the provided character state.
        This is a PASSIVE query - the caller (Regional Watcher) provides
        all character data; the scenario service does not fetch it.

        Returns scenarios ordered by fit score with cooldown status.
      operationId: FindAvailableScenarios
      tags:
      - Scenario Discovery
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FindAvailableScenariosRequest'
      responses:
        '200':
          description: Matching scenarios found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FindAvailableScenariosResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/FindAvailableScenariosRequest\"\
        ,\n    \"$defs\": {\n        \"FindAvailableScenariosRequest\": {\n            \"type\": \"object\",\n           \
        \ \"additionalProperties\": false,\n            \"description\": \"Request to find scenarios matching character state\"\
        ,\n            \"required\": [\n                \"characterId\",\n                \"characterState\"\n           \
        \ ],\n            \"properties\": {\n                \"characterId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Character to find scenarios for\"\
        \n                },\n                \"characterState\": {\n                    \"$ref\": \"#/$defs/CharacterStateSnapshot\"\
        ,\n                    \"description\": \"Current character state (caller provides this)\"\n                },\n \
        \               \"locationId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"nullable\": true,\n                    \"description\": \"Current character location\"\n\
        \                },\n                \"timeOfDay\": {\n                    \"type\": \"integer\",\n              \
        \      \"minimum\": 0,\n                    \"maximum\": 23,\n                    \"nullable\": true,\n          \
        \          \"description\": \"Current in-game hour (0-23)\"\n                },\n                \"worldState\": {\n\
        \                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                    \
        \    \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                    \"\
        description\": \"Current world state key-value pairs\"\n                },\n                \"realmId\": {\n     \
        \               \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Realm to search within\"\n                },\n                \"gameServiceId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Game service to search within\"\n                },\n  \
        \              \"maxResults\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 1,\n\
        \                    \"maximum\": 50,\n                    \"default\": 10,\n                    \"description\":
        \"Maximum scenarios to return\"\n                },\n                \"excludeTags\": {\n                    \"type\"\
        : \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                   \
        \ },\n                    \"nullable\": true,\n                    \"description\": \"Exclude scenarios with these
        tags\"\n                }\n            }\n        },\n        \"CharacterStateSnapshot\": {\n            \"type\"\
        : \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot of character
        state for condition evaluation\",\n            \"properties\": {\n                \"age\": {\n                   \
        \ \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\": \"Character
        age in years\"\n                },\n                \"traits\": {\n                    \"type\": \"array\",\n    \
        \                \"items\": {\n                        \"$ref\": \"#/$defs/TraitSnapshot\"\n                    },\n\
        \                    \"nullable\": true,\n                    \"description\": \"Current personality traits\"\n  \
        \              },\n                \"backstoryElements\": {\n                    \"type\": \"array\",\n          \
        \          \"items\": {\n                        \"$ref\": \"#/$defs/BackstorySnapshot\"\n                    },\n\
        \                    \"nullable\": true,\n                    \"description\": \"Current backstory elements\"\n  \
        \              },\n                \"relationships\": {\n                    \"type\": \"array\",\n              \
        \      \"items\": {\n                        \"$ref\": \"#/$defs/RelationshipSnapshot\"\n                    },\n\
        \                    \"nullable\": true,\n                    \"description\": \"Current relationships\"\n       \
        \         }\n            }\n        },\n        \"TraitSnapshot\": {\n            \"type\": \"object\",\n        \
        \    \"additionalProperties\": false,\n            \"description\": \"Snapshot of a personality trait\",\n       \
        \     \"required\": [\n                \"axis\",\n                \"value\"\n            ],\n            \"properties\"\
        : {\n                \"axis\": {\n                    \"type\": \"string\",\n                    \"description\":
        \"Trait axis name (e.g., AGGRESSION, OPENNESS)\"\n                },\n                \"value\": {\n             \
        \       \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"description\": \"\
        Trait value (-1.0 to 1.0)\"\n                }\n            }\n        },\n        \"BackstorySnapshot\": {\n    \
        \        \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot
        of a backstory element\",\n            \"required\": [\n                \"elementType\",\n                \"key\"\n\
        \            ],\n            \"properties\": {\n                \"elementType\": {\n                    \"type\":
        \"string\",\n                    \"description\": \"Backstory element type (e.g., TRAUMA, GOAL)\"\n              \
        \  },\n                \"key\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Backstory element key\"\n                }\n            }\n        },\n        \"RelationshipSnapshot\": {\n \
        \           \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot
        of a relationship\",\n            \"required\": [\n                \"relationshipTypeCode\",\n                \"otherEntityId\"\
        ,\n                \"otherEntityType\"\n            ],\n            \"properties\": {\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Relationship type code\"\n\
        \                },\n                \"otherEntityId\": {\n                    \"type\": \"string\",\n           \
        \         \"format\": \"uuid\",\n                    \"description\": \"ID of other entity\"\n                },\n\
        \                \"otherEntityType\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Type of other entity\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/FindAvailableScenariosResponse\"\
        ,\n    \"$defs\": {\n        \"FindAvailableScenariosResponse\": {\n            \"type\": \"object\",\n          \
        \  \"additionalProperties\": false,\n            \"description\": \"Matching scenarios with fit scores\",\n      \
        \      \"required\": [\n                \"matches\"\n            ],\n            \"properties\": {\n             \
        \   \"matches\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                 \
        \       \"$ref\": \"#/$defs/ScenarioMatch\"\n                    },\n                    \"description\": \"Matching
        scenarios ordered by fit score\"\n                }\n            }\n        },\n        \"ScenarioMatch\": {\n   \
        \         \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"A scenario
        that matches character state\",\n            \"required\": [\n                \"scenarioId\",\n                \"\
        code\",\n                \"name\",\n                \"fitScore\",\n                \"conditionsMet\",\n          \
        \      \"conditionsTotal\",\n                \"onCooldown\"\n            ],\n            \"properties\": {\n     \
        \           \"scenarioId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Scenario definition ID\"\n                },\n                \"code\":
        {\n                    \"type\": \"string\",\n                    \"description\": \"Scenario code\"\n           \
        \     },\n                \"name\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Scenario name\"\n                },\n                \"fitScore\": {\n                    \"type\": \"number\"\
        ,\n                    \"format\": \"double\",\n                    \"minimum\": 0,\n                    \"maximum\"\
        : 1,\n                    \"description\": \"Narrative fit score (0-1)\"\n                },\n                \"conditionsMet\"\
        : {\n                    \"type\": \"integer\",\n                    \"description\": \"Number of conditions met\"\
        \n                },\n                \"conditionsTotal\": {\n                    \"type\": \"integer\",\n       \
        \             \"description\": \"Total conditions\"\n                },\n                \"onCooldown\": {\n     \
        \               \"type\": \"boolean\",\n                    \"description\": \"Whether scenario is on cooldown for
        this character\"\n                },\n                \"cooldownExpiresAt\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"\
        description\": \"When cooldown expires (if on cooldown)\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Find scenarios matching character state\",\n    \"description\": \"Finds
        scenarios that match the provided character state.\\nThis is a PASSIVE query - the caller (Regional Watcher) provides\\
        nall character data; the scenario service does not fetch it.\\n\\nReturns scenarios ordered by fit score with cooldown
        status.\\n\",\n    \"tags\": [\n        \"Scenario Discovery\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"FindAvailableScenarios\"\n}"
  /storyline/scenario/test:
    post:
      summary: Dry-run scenario trigger
      description: |
        Tests whether a scenario would trigger for a character without
        actually executing it. Returns detailed condition evaluation results
        and predicted mutations.
      operationId: TestScenarioTrigger
      tags:
      - Scenario Discovery
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestScenarioRequest'
      responses:
        '200':
          description: Test result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestScenarioResponse'
        '404':
          description: Scenario not found
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TestScenarioRequest\"\
        ,\n    \"$defs\": {\n        \"TestScenarioRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to dry-run scenario trigger\",\n            \"required\": [\n   \
        \             \"scenarioId\",\n                \"characterId\",\n                \"characterState\"\n            ],\n\
        \            \"properties\": {\n                \"scenarioId\": {\n                    \"type\": \"string\",\n   \
        \                 \"format\": \"uuid\",\n                    \"description\": \"Scenario to test\"\n             \
        \   },\n                \"characterId\": {\n                    \"type\": \"string\",\n                    \"format\"\
        : \"uuid\",\n                    \"description\": \"Character to test against\"\n                },\n            \
        \    \"characterState\": {\n                    \"$ref\": \"#/$defs/CharacterStateSnapshot\",\n                  \
        \  \"description\": \"Current character state\"\n                },\n                \"locationId\": {\n         \
        \           \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Location context\"\n                },\n                \"timeOfDay\": {\n\
        \                    \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"maximum\"\
        : 23,\n                    \"nullable\": true,\n                    \"description\": \"Current in-game hour\"\n  \
        \              },\n                \"worldState\": {\n                    \"type\": \"object\",\n                \
        \    \"additionalProperties\": {\n                        \"type\": \"string\"\n                    },\n         \
        \           \"nullable\": true,\n                    \"description\": \"World state context\"\n                }\n\
        \            }\n        },\n        \"CharacterStateSnapshot\": {\n            \"type\": \"object\",\n           \
        \ \"additionalProperties\": false,\n            \"description\": \"Snapshot of character state for condition evaluation\"\
        ,\n            \"properties\": {\n                \"age\": {\n                    \"type\": \"integer\",\n       \
        \             \"nullable\": true,\n                    \"description\": \"Character age in years\"\n             \
        \   },\n                \"traits\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"$ref\": \"#/$defs/TraitSnapshot\"\n                    },\n                    \"nullable\"\
        : true,\n                    \"description\": \"Current personality traits\"\n                },\n               \
        \ \"backstoryElements\": {\n                    \"type\": \"array\",\n                    \"items\": {\n         \
        \               \"$ref\": \"#/$defs/BackstorySnapshot\"\n                    },\n                    \"nullable\"\
        : true,\n                    \"description\": \"Current backstory elements\"\n                },\n               \
        \ \"relationships\": {\n                    \"type\": \"array\",\n                    \"items\": {\n             \
        \           \"$ref\": \"#/$defs/RelationshipSnapshot\"\n                    },\n                    \"nullable\":
        true,\n                    \"description\": \"Current relationships\"\n                }\n            }\n        },\n\
        \        \"TraitSnapshot\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n \
        \           \"description\": \"Snapshot of a personality trait\",\n            \"required\": [\n                \"\
        axis\",\n                \"value\"\n            ],\n            \"properties\": {\n                \"axis\": {\n \
        \                   \"type\": \"string\",\n                    \"description\": \"Trait axis name (e.g., AGGRESSION,
        OPENNESS)\"\n                },\n                \"value\": {\n                    \"type\": \"number\",\n       \
        \             \"format\": \"float\",\n                    \"description\": \"Trait value (-1.0 to 1.0)\"\n       \
        \         }\n            }\n        },\n        \"BackstorySnapshot\": {\n            \"type\": \"object\",\n    \
        \        \"additionalProperties\": false,\n            \"description\": \"Snapshot of a backstory element\",\n   \
        \         \"required\": [\n                \"elementType\",\n                \"key\"\n            ],\n           \
        \ \"properties\": {\n                \"elementType\": {\n                    \"type\": \"string\",\n             \
        \       \"description\": \"Backstory element type (e.g., TRAUMA, GOAL)\"\n                },\n                \"key\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Backstory element key\"\n \
        \               }\n            }\n        },\n        \"RelationshipSnapshot\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot of a relationship\",\n  \
        \          \"required\": [\n                \"relationshipTypeCode\",\n                \"otherEntityId\",\n      \
        \          \"otherEntityType\"\n            ],\n            \"properties\": {\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Relationship type code\"\n\
        \                },\n                \"otherEntityId\": {\n                    \"type\": \"string\",\n           \
        \         \"format\": \"uuid\",\n                    \"description\": \"ID of other entity\"\n                },\n\
        \                \"otherEntityType\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Type of other entity\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TestScenarioResponse\"\
        ,\n    \"$defs\": {\n        \"TestScenarioResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Result of scenario dry-run\",\n            \"required\": [\n            \
        \    \"wouldTrigger\",\n                \"conditionResults\"\n            ],\n            \"properties\": {\n    \
        \            \"wouldTrigger\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether scenario would trigger\"\n                },\n                \"conditionResults\": {\n              \
        \      \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/ConditionResult\"\
        \n                    },\n                    \"description\": \"Result of each condition check\"\n              \
        \  },\n                \"predictedMutations\": {\n                    \"type\": \"array\",\n                    \"\
        items\": {\n                        \"$ref\": \"#/$defs/PredictedMutation\"\n                    },\n            \
        \        \"nullable\": true,\n                    \"description\": \"Mutations that would be applied\"\n         \
        \       },\n                \"blockingReason\": {\n                    \"type\": \"string\",\n                   \
        \ \"nullable\": true,\n                    \"description\": \"Why scenario would not trigger (cooldown, exclusivity,
        etc.)\"\n                }\n            }\n        },\n        \"ConditionResult\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"Result of evaluating a single condition\"\
        ,\n            \"required\": [\n                \"conditionType\",\n                \"met\"\n            ],\n    \
        \        \"properties\": {\n                \"conditionType\": {\n                    \"$ref\": \"#/$defs/TriggerConditionType\"\
        ,\n                    \"description\": \"Condition type\"\n                },\n                \"met\": {\n     \
        \               \"type\": \"boolean\",\n                    \"description\": \"Whether condition was met\"\n     \
        \           },\n                \"actualValue\": {\n                    \"type\": \"string\",\n                  \
        \  \"nullable\": true,\n                    \"description\": \"Actual value found\"\n                },\n        \
        \        \"expectedValue\": {\n                    \"type\": \"string\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Expected value\"\n                },\n                \"details\": {\n   \
        \                 \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Additional details\"\n                }\n            }\n        },\n        \"TriggerConditionType\": {\n    \
        \        \"type\": \"string\",\n            \"enum\": [\n                \"TraitRange\",\n                \"BackstoryElement\"\
        ,\n                \"RelationshipExists\",\n                \"RelationshipMissing\",\n                \"AgeRange\"\
        ,\n                \"LocationAt\",\n                \"TimeOfDay\",\n                \"WorldState\",\n            \
        \    \"Custom\"\n            ],\n            \"description\": \"Types of trigger conditions for scenario activation.\\
        nTraitRange: Character trait within value range\\nBackstoryElement: Character has specific backstory element\\nRelationshipExists:
        Relationship exists between entities\\nRelationshipMissing: Relationship does not exist\\nAgeRange: Character age
        within range\\nLocationAt: Character at specific location\\nTimeOfDay: In-game time within range\\nWorldState: Custom
        world state check\\nCustom: Custom condition (not evaluated server-side)\\n\"\n        },\n        \"PredictedMutation\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"Mutation that would be applied\",\n            \"required\": [\n                \"mutationType\",\n          \
        \      \"description\"\n            ],\n            \"properties\": {\n                \"mutationType\": {\n     \
        \               \"$ref\": \"#/$defs/MutationType\",\n                    \"description\": \"Type of mutation\"\n \
        \               },\n                \"description\": {\n                    \"type\": \"string\",\n              \
        \      \"description\": \"Human-readable description\"\n                }\n            }\n        },\n        \"MutationType\"\
        : {\n            \"type\": \"string\",\n            \"enum\": [\n                \"PersonalityEvolve\",\n        \
        \        \"BackstoryAdd\",\n                \"RelationshipCreate\",\n                \"RelationshipEnd\",\n      \
        \          \"Custom\"\n            ],\n            \"description\": \"Types of state mutations a scenario can apply.\\
        nPersonalityEvolve: Apply experience to evolve personality traits\\nBackstoryAdd: Add backstory element to character
        history\\nRelationshipCreate: Create relationship between entities\\nRelationshipEnd: End existing relationship\\\
        nCustom: Custom mutation (not executed server-side)\\n\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Dry-run scenario trigger\",\n    \"description\": \"Tests whether a scenario
        would trigger for a character without\\nactually executing it. Returns detailed condition evaluation results\\nand
        predicted mutations.\\n\",\n    \"tags\": [\n        \"Scenario Discovery\"\n    ],\n    \"deprecated\": false,\n\
        \    \"operationId\": \"TestScenarioTrigger\"\n}"
  /storyline/scenario/evaluate-fit:
    post:
      summary: Score narrative fit without full condition check
      description: |
        Lightweight scoring of narrative fit between a scenario and character
        state. Faster than test but less detailed.
      operationId: EvaluateScenarioFit
      tags:
      - Scenario Discovery
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvaluateFitRequest'
      responses:
        '200':
          description: Fit score calculated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluateFitResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/EvaluateFitRequest\"\
        ,\n    \"$defs\": {\n        \"EvaluateFitRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request for lightweight fit scoring\",\n            \"required\": [\n   \
        \             \"scenarioId\",\n                \"characterState\"\n            ],\n            \"properties\": {\n\
        \                \"scenarioId\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        uuid\",\n                    \"description\": \"Scenario to evaluate\"\n                },\n                \"characterState\"\
        : {\n                    \"$ref\": \"#/$defs/CharacterStateSnapshot\",\n                    \"description\": \"Character
        state snapshot\"\n                }\n            }\n        },\n        \"CharacterStateSnapshot\": {\n          \
        \  \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot of
        character state for condition evaluation\",\n            \"properties\": {\n                \"age\": {\n         \
        \           \"type\": \"integer\",\n                    \"nullable\": true,\n                    \"description\":
        \"Character age in years\"\n                },\n                \"traits\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/TraitSnapshot\"\n               \
        \     },\n                    \"nullable\": true,\n                    \"description\": \"Current personality traits\"\
        \n                },\n                \"backstoryElements\": {\n                    \"type\": \"array\",\n       \
        \             \"items\": {\n                        \"$ref\": \"#/$defs/BackstorySnapshot\"\n                    },\n\
        \                    \"nullable\": true,\n                    \"description\": \"Current backstory elements\"\n  \
        \              },\n                \"relationships\": {\n                    \"type\": \"array\",\n              \
        \      \"items\": {\n                        \"$ref\": \"#/$defs/RelationshipSnapshot\"\n                    },\n\
        \                    \"nullable\": true,\n                    \"description\": \"Current relationships\"\n       \
        \         }\n            }\n        },\n        \"TraitSnapshot\": {\n            \"type\": \"object\",\n        \
        \    \"additionalProperties\": false,\n            \"description\": \"Snapshot of a personality trait\",\n       \
        \     \"required\": [\n                \"axis\",\n                \"value\"\n            ],\n            \"properties\"\
        : {\n                \"axis\": {\n                    \"type\": \"string\",\n                    \"description\":
        \"Trait axis name (e.g., AGGRESSION, OPENNESS)\"\n                },\n                \"value\": {\n             \
        \       \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"description\": \"\
        Trait value (-1.0 to 1.0)\"\n                }\n            }\n        },\n        \"BackstorySnapshot\": {\n    \
        \        \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot
        of a backstory element\",\n            \"required\": [\n                \"elementType\",\n                \"key\"\n\
        \            ],\n            \"properties\": {\n                \"elementType\": {\n                    \"type\":
        \"string\",\n                    \"description\": \"Backstory element type (e.g., TRAUMA, GOAL)\"\n              \
        \  },\n                \"key\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Backstory element key\"\n                }\n            }\n        },\n        \"RelationshipSnapshot\": {\n \
        \           \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot
        of a relationship\",\n            \"required\": [\n                \"relationshipTypeCode\",\n                \"otherEntityId\"\
        ,\n                \"otherEntityType\"\n            ],\n            \"properties\": {\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Relationship type code\"\n\
        \                },\n                \"otherEntityId\": {\n                    \"type\": \"string\",\n           \
        \         \"format\": \"uuid\",\n                    \"description\": \"ID of other entity\"\n                },\n\
        \                \"otherEntityType\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Type of other entity\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/EvaluateFitResponse\"\
        ,\n    \"$defs\": {\n        \"EvaluateFitResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Fit score result\",\n            \"required\": [\n                \"fitScore\"\
        ,\n                \"conditionsMet\",\n                \"conditionsTotal\"\n            ],\n            \"properties\"\
        : {\n                \"fitScore\": {\n                    \"type\": \"number\",\n                    \"format\": \"\
        double\",\n                    \"minimum\": 0,\n                    \"maximum\": 1,\n                    \"description\"\
        : \"Narrative fit score (0-1)\"\n                },\n                \"conditionsMet\": {\n                    \"\
        type\": \"integer\",\n                    \"description\": \"Number of conditions met\"\n                },\n    \
        \            \"conditionsTotal\": {\n                    \"type\": \"integer\",\n                    \"description\"\
        : \"Total conditions\"\n                }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Score narrative fit without full condition check\",\n    \"description\"\
        : \"Lightweight scoring of narrative fit between a scenario and character\\nstate. Faster than test but less detailed.\\\
        n\",\n    \"tags\": [\n        \"Scenario Discovery\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"\
        EvaluateScenarioFit\"\n}"
  /storyline/scenario/trigger:
    post:
      summary: Execute a scenario
      description: |
        Triggers scenario execution for a character. Applies mutations to
        character state (personality, backstory, relationships) and spawns
        quests via quest hooks.

        Uses distributed locks to prevent double-triggering and idempotency
        keys for safe retries.
      operationId: TriggerScenario
      tags:
      - Scenario Execution
      x-permissions: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerScenarioRequest'
      responses:
        '200':
          description: Scenario triggered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriggerScenarioResponse'
        '400':
          description: Conditions not met
        '404':
          description: Scenario not found
        '409':
          description: Cooldown active or exclusivity conflict
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TriggerScenarioRequest\"\
        ,\n    \"$defs\": {\n        \"TriggerScenarioRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request to trigger scenario execution\",\n            \"required\": [\n \
        \               \"scenarioId\",\n                \"characterId\",\n                \"characterState\"\n          \
        \  ],\n            \"properties\": {\n                \"scenarioId\": {\n                    \"type\": \"string\"\
        ,\n                    \"format\": \"uuid\",\n                    \"description\": \"Scenario to trigger\"\n     \
        \           },\n                \"characterId\": {\n                    \"type\": \"string\",\n                  \
        \  \"format\": \"uuid\",\n                    \"description\": \"Primary character in scenario\"\n               \
        \ },\n                \"characterState\": {\n                    \"$ref\": \"#/$defs/CharacterStateSnapshot\",\n \
        \                   \"description\": \"Current character state for condition validation\"\n                },\n  \
        \              \"additionalParticipants\": {\n                    \"type\": \"object\",\n                    \"additionalProperties\"\
        : {\n                        \"type\": \"string\",\n                        \"format\": \"uuid\"\n               \
        \     },\n                    \"nullable\": true,\n                    \"description\": \"Additional participants
        by role name\"\n                },\n                \"locationId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Location context\"\n                },\n                \"timeOfDay\": {\n                    \"type\": \"integer\"\
        ,\n                    \"minimum\": 0,\n                    \"maximum\": 23,\n                    \"nullable\": true,\n\
        \                    \"description\": \"Current in-game hour\"\n                },\n                \"worldState\"\
        : {\n                    \"type\": \"object\",\n                    \"additionalProperties\": {\n                \
        \        \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n                 \
        \   \"description\": \"World state context\"\n                },\n                \"orchestratorId\": {\n        \
        \            \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Actor ID of the orchestrating watcher\"\n                },\n            \
        \    \"skipConditionCheck\": {\n                    \"type\": \"boolean\",\n                    \"default\": false,\n\
        \                    \"description\": \"Skip condition validation (for forced triggers)\"\n                },\n  \
        \              \"idempotencyKey\": {\n                    \"type\": \"string\",\n                    \"nullable\"\
        : true,\n                    \"description\": \"Idempotency key for safe retries\"\n                }\n          \
        \  }\n        },\n        \"CharacterStateSnapshot\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Snapshot of character state for condition evaluation\",\n            \"properties\"\
        : {\n                \"age\": {\n                    \"type\": \"integer\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"Character age in years\"\n                },\n                \"traits\":
        {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"\
        #/$defs/TraitSnapshot\"\n                    },\n                    \"nullable\": true,\n                    \"description\"\
        : \"Current personality traits\"\n                },\n                \"backstoryElements\": {\n                 \
        \   \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/BackstorySnapshot\"\
        \n                    },\n                    \"nullable\": true,\n                    \"description\": \"Current
        backstory elements\"\n                },\n                \"relationships\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/RelationshipSnapshot\"\n        \
        \            },\n                    \"nullable\": true,\n                    \"description\": \"Current relationships\"\
        \n                }\n            }\n        },\n        \"TraitSnapshot\": {\n            \"type\": \"object\",\n\
        \            \"additionalProperties\": false,\n            \"description\": \"Snapshot of a personality trait\",\n\
        \            \"required\": [\n                \"axis\",\n                \"value\"\n            ],\n            \"\
        properties\": {\n                \"axis\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Trait axis name (e.g., AGGRESSION, OPENNESS)\"\n                },\n                \"value\": {\n           \
        \         \"type\": \"number\",\n                    \"format\": \"float\",\n                    \"description\":
        \"Trait value (-1.0 to 1.0)\"\n                }\n            }\n        },\n        \"BackstorySnapshot\": {\n  \
        \          \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot
        of a backstory element\",\n            \"required\": [\n                \"elementType\",\n                \"key\"\n\
        \            ],\n            \"properties\": {\n                \"elementType\": {\n                    \"type\":
        \"string\",\n                    \"description\": \"Backstory element type (e.g., TRAUMA, GOAL)\"\n              \
        \  },\n                \"key\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Backstory element key\"\n                }\n            }\n        },\n        \"RelationshipSnapshot\": {\n \
        \           \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\": \"Snapshot
        of a relationship\",\n            \"required\": [\n                \"relationshipTypeCode\",\n                \"otherEntityId\"\
        ,\n                \"otherEntityType\"\n            ],\n            \"properties\": {\n                \"relationshipTypeCode\"\
        : {\n                    \"type\": \"string\",\n                    \"description\": \"Relationship type code\"\n\
        \                },\n                \"otherEntityId\": {\n                    \"type\": \"string\",\n           \
        \         \"format\": \"uuid\",\n                    \"description\": \"ID of other entity\"\n                },\n\
        \                \"otherEntityType\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Type of other entity\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/TriggerScenarioResponse\"\
        ,\n    \"$defs\": {\n        \"TriggerScenarioResponse\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Result of scenario trigger\",\n            \"required\": [\n            \
        \    \"executionId\",\n                \"scenarioId\",\n                \"status\",\n                \"triggeredAt\"\
        \n            ],\n            \"properties\": {\n                \"executionId\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Scenario execution
        instance ID\"\n                },\n                \"scenarioId\": {\n                    \"type\": \"string\",\n\
        \                    \"format\": \"uuid\",\n                    \"description\": \"Scenario definition ID\"\n    \
        \            },\n                \"status\": {\n                    \"$ref\": \"#/$defs/ScenarioStatus\",\n      \
        \              \"description\": \"Execution status\"\n                },\n                \"triggeredAt\": {\n   \
        \                 \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When scenario was triggered\"\n                },\n                \"mutationsApplied\": {\n                 \
        \   \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/AppliedMutation\"\
        \n                    },\n                    \"nullable\": true,\n                    \"description\": \"Mutations
        that were applied\"\n                },\n                \"questsSpawned\": {\n                    \"type\": \"array\"\
        ,\n                    \"items\": {\n                        \"$ref\": \"#/$defs/SpawnedQuest\"\n                \
        \    },\n                    \"nullable\": true,\n                    \"description\": \"Quests that were spawned\"\
        \n                },\n                \"failureReason\": {\n                    \"type\": \"string\",\n          \
        \          \"nullable\": true,\n                    \"description\": \"Reason for failure (if status is Failed)\"\n\
        \                }\n            }\n        },\n        \"ScenarioStatus\": {\n            \"type\": \"string\",\n\
        \            \"enum\": [\n                \"Active\",\n                \"Completed\",\n                \"Failed\"\
        ,\n                \"Cancelled\"\n            ],\n            \"description\": \"Current status of a scenario execution
        instance.\\nActive: Scenario is currently executing\\nCompleted: Scenario finished successfully\\nFailed: Scenario
        failed during execution\\nCancelled: Scenario was cancelled externally\\n\"\n        },\n        \"AppliedMutation\"\
        : {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"description\"\
        : \"A mutation that was applied\",\n            \"required\": [\n                \"mutationType\",\n             \
        \   \"success\"\n            ],\n            \"properties\": {\n                \"mutationType\": {\n            \
        \        \"$ref\": \"#/$defs/MutationType\",\n                    \"description\": \"Type of mutation\"\n        \
        \        },\n                \"success\": {\n                    \"type\": \"boolean\",\n                    \"description\"\
        : \"Whether mutation succeeded\"\n                },\n                \"targetCharacterId\": {\n                 \
        \   \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"nullable\": true,\n  \
        \                  \"description\": \"Character affected\"\n                },\n                \"details\": {\n \
        \                   \"type\": \"string\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"Details of what changed\"\n                }\n            }\n        },\n        \"MutationType\": {\n       \
        \     \"type\": \"string\",\n            \"enum\": [\n                \"PersonalityEvolve\",\n                \"BackstoryAdd\"\
        ,\n                \"RelationshipCreate\",\n                \"RelationshipEnd\",\n                \"Custom\"\n   \
        \         ],\n            \"description\": \"Types of state mutations a scenario can apply.\\nPersonalityEvolve: Apply
        experience to evolve personality traits\\nBackstoryAdd: Add backstory element to character history\\nRelationshipCreate:
        Create relationship between entities\\nRelationshipEnd: End existing relationship\\nCustom: Custom mutation (not executed
        server-side)\\n\"\n        },\n        \"SpawnedQuest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A quest that was spawned\",\n            \"required\": [\n              \
        \  \"questInstanceId\",\n                \"questCode\"\n            ],\n            \"properties\": {\n          \
        \      \"questInstanceId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Quest instance ID\"\n                },\n                \"questCode\":
        {\n                    \"type\": \"string\",\n                    \"description\": \"Quest definition code\"\n   \
        \             }\n            }\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Execute a scenario\",\n    \"description\": \"Triggers scenario execution
        for a character. Applies mutations to\\ncharacter state (personality, backstory, relationships) and spawns\\nquests
        via quest hooks.\\n\\nUses distributed locks to prevent double-triggering and idempotency\\nkeys for safe retries.\\\
        n\",\n    \"tags\": [\n        \"Scenario Execution\"\n    ],\n    \"deprecated\": false,\n    \"operationId\": \"\
        TriggerScenario\"\n}"
  /storyline/scenario/get-active:
    post:
      summary: Get active scenarios for a character
      description: |
        Returns currently executing scenarios for a character.
      operationId: GetActiveScenarios
      tags:
      - Scenario Execution
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetActiveScenariosRequest'
      responses:
        '200':
          description: Active scenarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetActiveScenariosResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetActiveScenariosRequest\"\
        ,\n    \"$defs\": {\n        \"GetActiveScenariosRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request for active scenarios\",\n            \"required\": [\n          \
        \      \"characterId\"\n            ],\n            \"properties\": {\n                \"characterId\": {\n      \
        \              \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Character to query\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetActiveScenariosResponse\"\
        ,\n    \"$defs\": {\n        \"GetActiveScenariosResponse\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Active scenario executions\",\n            \"required\"\
        : [\n                \"executions\"\n            ],\n            \"properties\": {\n                \"executions\"\
        : {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"$ref\"\
        : \"#/$defs/ScenarioExecution\"\n                    },\n                    \"description\": \"Active scenario executions\"\
        \n                }\n            }\n        },\n        \"ScenarioExecution\": {\n            \"type\": \"object\"\
        ,\n            \"additionalProperties\": false,\n            \"description\": \"A scenario execution instance\",\n\
        \            \"required\": [\n                \"executionId\",\n                \"scenarioId\",\n                \"\
        code\",\n                \"name\",\n                \"status\",\n                \"currentPhase\",\n             \
        \   \"totalPhases\",\n                \"triggeredAt\"\n            ],\n            \"properties\": {\n           \
        \     \"executionId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n \
        \                   \"description\": \"Execution instance ID\"\n                },\n                \"scenarioId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        description\": \"Scenario definition ID\"\n                },\n                \"code\": {\n                    \"\
        type\": \"string\",\n                    \"description\": \"Scenario code\"\n                },\n                \"\
        name\": {\n                    \"type\": \"string\",\n                    \"description\": \"Scenario name\"\n   \
        \             },\n                \"status\": {\n                    \"$ref\": \"#/$defs/ScenarioStatus\",\n     \
        \               \"description\": \"Current status\"\n                },\n                \"currentPhase\": {\n   \
        \                 \"type\": \"integer\",\n                    \"description\": \"Current phase number\"\n        \
        \        },\n                \"totalPhases\": {\n                    \"type\": \"integer\",\n                    \"\
        description\": \"Total phases\"\n                },\n                \"triggeredAt\": {\n                    \"type\"\
        : \"string\",\n                    \"format\": \"date-time\",\n                    \"description\": \"When triggered\"\
        \n                },\n                \"completedAt\": {\n                    \"type\": \"string\",\n            \
        \        \"format\": \"date-time\",\n                    \"nullable\": true,\n                    \"description\"\
        : \"When completed (if applicable)\"\n                }\n            }\n        },\n        \"ScenarioStatus\": {\n\
        \            \"type\": \"string\",\n            \"enum\": [\n                \"Active\",\n                \"Completed\"\
        ,\n                \"Failed\",\n                \"Cancelled\"\n            ],\n            \"description\": \"Current
        status of a scenario execution instance.\\nActive: Scenario is currently executing\\nCompleted: Scenario finished
        successfully\\nFailed: Scenario failed during execution\\nCancelled: Scenario was cancelled externally\\n\"\n    \
        \    }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get active scenarios for a character\",\n    \"description\": \"Returns
        currently executing scenarios for a character.\\n\",\n    \"tags\": [\n        \"Scenario Execution\"\n    ],\n  \
        \  \"deprecated\": false,\n    \"operationId\": \"GetActiveScenarios\"\n}"
  /storyline/scenario/get-history:
    post:
      summary: Get scenario execution history
      description: |
        Returns historical scenario executions for a character with pagination.
      operationId: GetScenarioHistory
      tags:
      - Scenario Execution
      x-permissions:
      - role: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetScenarioHistoryRequest'
      responses:
        '200':
          description: Scenario history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetScenarioHistoryResponse'
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetScenarioHistoryRequest\"\
        ,\n    \"$defs\": {\n        \"GetScenarioHistoryRequest\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"Request for scenario execution history\",\n            \"required\": [\n\
        \                \"characterId\"\n            ],\n            \"properties\": {\n                \"characterId\":
        {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\"\
        : \"Character to query\"\n                },\n                \"limit\": {\n                    \"type\": \"integer\"\
        ,\n                    \"minimum\": 1,\n                    \"maximum\": 100,\n                    \"default\": 20,\n\
        \                    \"description\": \"Max results\"\n                },\n                \"offset\": {\n       \
        \             \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"default\": 0,\n \
        \                   \"description\": \"Pagination offset\"\n                }\n            }\n        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetScenarioHistoryResponse\"\
        ,\n    \"$defs\": {\n        \"GetScenarioHistoryResponse\": {\n            \"type\": \"object\",\n            \"\
        additionalProperties\": false,\n            \"description\": \"Scenario execution history\",\n            \"required\"\
        : [\n                \"executions\",\n                \"totalCount\"\n            ],\n            \"properties\":
        {\n                \"executions\": {\n                    \"type\": \"array\",\n                    \"items\": {\n\
        \                        \"$ref\": \"#/$defs/ScenarioExecution\"\n                    },\n                    \"description\"\
        : \"Historical executions\"\n                },\n                \"totalCount\": {\n                    \"type\":
        \"integer\",\n                    \"description\": \"Total count for pagination\"\n                }\n           \
        \ }\n        },\n        \"ScenarioExecution\": {\n            \"type\": \"object\",\n            \"additionalProperties\"\
        : false,\n            \"description\": \"A scenario execution instance\",\n            \"required\": [\n         \
        \       \"executionId\",\n                \"scenarioId\",\n                \"code\",\n                \"name\",\n\
        \                \"status\",\n                \"currentPhase\",\n                \"totalPhases\",\n              \
        \  \"triggeredAt\"\n            ],\n            \"properties\": {\n                \"executionId\": {\n          \
        \          \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"description\":
        \"Execution instance ID\"\n                },\n                \"scenarioId\": {\n                    \"type\": \"\
        string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Scenario definition ID\"\
        \n                },\n                \"code\": {\n                    \"type\": \"string\",\n                   \
        \ \"description\": \"Scenario code\"\n                },\n                \"name\": {\n                    \"type\"\
        : \"string\",\n                    \"description\": \"Scenario name\"\n                },\n                \"status\"\
        : {\n                    \"$ref\": \"#/$defs/ScenarioStatus\",\n                    \"description\": \"Current status\"\
        \n                },\n                \"currentPhase\": {\n                    \"type\": \"integer\",\n          \
        \          \"description\": \"Current phase number\"\n                },\n                \"totalPhases\": {\n   \
        \                 \"type\": \"integer\",\n                    \"description\": \"Total phases\"\n                },\n\
        \                \"triggeredAt\": {\n                    \"type\": \"string\",\n                    \"format\": \"\
        date-time\",\n                    \"description\": \"When triggered\"\n                },\n                \"completedAt\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"date-time\",\n                 \
        \   \"nullable\": true,\n                    \"description\": \"When completed (if applicable)\"\n               \
        \ }\n            }\n        },\n        \"ScenarioStatus\": {\n            \"type\": \"string\",\n            \"enum\"\
        : [\n                \"Active\",\n                \"Completed\",\n                \"Failed\",\n                \"\
        Cancelled\"\n            ],\n            \"description\": \"Current status of a scenario execution instance.\\nActive:
        Scenario is currently executing\\nCompleted: Scenario finished successfully\\nFailed: Scenario failed during execution\\
        nCancelled: Scenario was cancelled externally\\n\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get scenario execution history\",\n    \"description\": \"Returns historical
        scenario executions for a character with pagination.\\n\",\n    \"tags\": [\n        \"Scenario Execution\"\n    ],\n\
        \    \"deprecated\": false,\n    \"operationId\": \"GetScenarioHistory\"\n}"
  /storyline/get-compress-data:
    post:
      summary: Get storyline data for compression
      operationId: getCompressData
      tags:
      - Compression
      description: |
        Called by Resource service during character compression.
        Returns scenario participations, active arcs, and completion counts for archival.
      x-permissions:
      - role: developer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCompressDataRequest'
      responses:
        '200':
          description: Compressed data returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorylineArchive'
        '404':
          description: No storyline data for character
      x-request-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/GetCompressDataRequest\"\
        ,\n    \"$defs\": {\n        \"GetCompressDataRequest\": {\n            \"type\": \"object\",\n            \"description\"\
        : \"Request to get storyline data for compression\",\n            \"additionalProperties\": false,\n            \"\
        required\": [\n                \"characterId\"\n            ],\n            \"properties\": {\n                \"\
        characterId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n         \
        \           \"description\": \"ID of the character to get compress data for\"\n                }\n            }\n\
        \        }\n    }\n}"
      x-response-schema-json: "{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"$ref\": \"#/$defs/StorylineArchive\"\
        ,\n    \"$defs\": {\n        \"StorylineArchive\": {\n            \"type\": \"object\",\n            \"x-archive-type\"\
        : true,\n            \"description\": \"Complete storyline participation data for archive storage and SDK consumption.\\
        nInherits base archive properties from ResourceArchiveBase.\\nThe characterId field equals resourceId for convenience.\\\
        n\",\n            \"allOf\": [\n                {\n                    \"type\": \"object\"\n                }\n \
        \           ],\n            \"additionalProperties\": false,\n            \"required\": [\n                \"characterId\"\
        ,\n                \"participations\",\n                \"activeArcs\",\n                \"completedStorylines\"\n\
        \            ],\n            \"properties\": {\n                \"characterId\": {\n                    \"type\":
        \"string\",\n                    \"format\": \"uuid\",\n                    \"description\": \"Character this data
        belongs to (equals resourceId)\"\n                },\n                \"participations\": {\n                    \"\
        type\": \"array\",\n                    \"items\": {\n                        \"$ref\": \"#/$defs/StorylineParticipation\"\
        \n                    },\n                    \"description\": \"All scenario participations (completed and active)\"\
        \n                },\n                \"activeArcs\": {\n                    \"type\": \"array\",\n              \
        \      \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"\
        description\": \"Story arcs the character is currently involved in\"\n                },\n                \"completedStorylines\"\
        : {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"description\"\
        : \"Total count of completed scenarios\"\n                }\n            }\n        },\n        \"StorylineParticipation\"\
        : {\n            \"type\": \"object\",\n            \"description\": \"Summary of a scenario participation for archive
        purposes\",\n            \"additionalProperties\": false,\n            \"required\": [\n                \"executionId\"\
        ,\n                \"scenarioCode\",\n                \"role\",\n                \"phase\",\n                \"totalPhases\"\
        ,\n                \"status\",\n                \"startedAt\"\n            ],\n            \"properties\": {\n   \
        \             \"executionId\": {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\"\
        ,\n                    \"description\": \"Scenario execution ID\"\n                },\n                \"scenarioId\"\
        : {\n                    \"type\": \"string\",\n                    \"format\": \"uuid\",\n                    \"\
        nullable\": true,\n                    \"description\": \"Scenario definition ID (if available)\"\n              \
        \  },\n                \"scenarioCode\": {\n                    \"type\": \"string\",\n                    \"description\"\
        : \"Scenario code for lookup\"\n                },\n                \"scenarioName\": {\n                    \"type\"\
        : \"string\",\n                    \"nullable\": true,\n                    \"description\": \"Scenario display name\"\
        \n                },\n                \"role\": {\n                    \"type\": \"string\",\n                   \
        \ \"description\": \"Character's role in the scenario (primary, secondary, witness)\"\n                },\n      \
        \          \"phase\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n       \
        \             \"description\": \"Current phase number (or final phase if completed)\"\n                },\n      \
        \          \"totalPhases\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n \
        \                   \"description\": \"Total number of phases in the scenario\"\n                },\n            \
        \    \"status\": {\n                    \"$ref\": \"#/$defs/ScenarioStatus\",\n                    \"description\"\
        : \"Current status of the scenario execution\"\n                },\n                \"startedAt\": {\n           \
        \         \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"description\"\
        : \"When the scenario was triggered\"\n                },\n                \"completedAt\": {\n                  \
        \  \"type\": \"string\",\n                    \"format\": \"date-time\",\n                    \"nullable\": true,\n\
        \                    \"description\": \"When the scenario completed (null if still active)\"\n                },\n\
        \                \"choices\": {\n                    \"type\": \"array\",\n                    \"items\": {\n    \
        \                    \"type\": \"string\"\n                    },\n                    \"nullable\": true,\n     \
        \               \"description\": \"Key choices made during the scenario (for narrative hooks)\"\n                }\n\
        \            }\n        },\n        \"ScenarioStatus\": {\n            \"type\": \"string\",\n            \"enum\"\
        : [\n                \"Active\",\n                \"Completed\",\n                \"Failed\",\n                \"\
        Cancelled\"\n            ],\n            \"description\": \"Current status of a scenario execution instance.\\nActive:
        Scenario is currently executing\\nCompleted: Scenario finished successfully\\nFailed: Scenario failed during execution\\
        nCancelled: Scenario was cancelled externally\\n\"\n        }\n    }\n}"
      x-endpoint-info-json: "{\n    \"summary\": \"Get storyline data for compression\",\n    \"description\": \"Called by
        Resource service during character compression.\\nReturns scenario participations, active arcs, and completion counts
        for archival.\\n\",\n    \"tags\": [\n        \"Compression\"\n    ],\n    \"deprecated\": false,\n    \"operationId\"\
        : \"getCompressData\"\n}"
components:
  schemas:
    StorylineGoal:
      type: string
      enum:
      - revenge
      - resurrection
      - legacy
      - mystery
      - peace
      description: |
        High-level story goal that drives arc selection.
        revenge: Character seeks vengeance for past wrongs
        resurrection: Restoring something/someone lost
        legacy: Creating or continuing a lasting impact
        mystery: Uncovering hidden truths
        peace: Resolving conflicts and finding harmony
    ArcType:
      type: string
      enum:
      - RagsToRiches
      - Tragedy
      - ManInHole
      - Icarus
      - Cinderella
      - Oedipus
      description: |
        Emotional arc shapes from Reagan et al. research.
        RagsToRiches: Rise (1)
        Tragedy: Fall (2)
        ManInHole: Fall then rise (3)
        Icarus: Rise then fall (4)
        Cinderella: Rise, fall, rise (5)
        Oedipus: Fall, rise, fall (6)
    SpectrumType:
      type: string
      enum:
      - LifeDeath
      - HonorDishonor
      - JusticeInjustice
      - FreedomSubjugation
      - LoveHate
      - RespectShame
      - PowerImpotence
      - SuccessFailure
      - AltruismSelfishness
      - WisdomIgnorance
      description: |
        The 10 Story Grid Life Value spectrums.
        These are bipolar axes for emotional progression.
    PlanningUrgency:
      type: string
      enum:
      - Low
      - Medium
      - High
      description: |
        GOAP planning urgency level affecting search parameters.
        Low: More iterations, wider beam (1000/20)
        Medium: Balanced (500/15)
        High: Fewer iterations, narrower beam (200/10)
    ScenarioStatus:
      type: string
      enum:
      - Active
      - Completed
      - Failed
      - Cancelled
      description: |
        Current status of a scenario execution instance.
        Active: Scenario is currently executing
        Completed: Scenario finished successfully
        Failed: Scenario failed during execution
        Cancelled: Scenario was cancelled externally
    TriggerConditionType:
      type: string
      enum:
      - TraitRange
      - BackstoryElement
      - RelationshipExists
      - RelationshipMissing
      - AgeRange
      - LocationAt
      - TimeOfDay
      - WorldState
      - Custom
      description: |
        Types of trigger conditions for scenario activation.
        TraitRange: Character trait within value range
        BackstoryElement: Character has specific backstory element
        RelationshipExists: Relationship exists between entities
        RelationshipMissing: Relationship does not exist
        AgeRange: Character age within range
        LocationAt: Character at specific location
        TimeOfDay: In-game time within range
        WorldState: Custom world state check
        Custom: Custom condition (not evaluated server-side)
    MutationType:
      type: string
      enum:
      - PersonalityEvolve
      - BackstoryAdd
      - RelationshipCreate
      - RelationshipEnd
      - Custom
      description: |
        Types of state mutations a scenario can apply.
        PersonalityEvolve: Apply experience to evolve personality traits
        BackstoryAdd: Add backstory element to character history
        RelationshipCreate: Create relationship between entities
        RelationshipEnd: End existing relationship
        Custom: Custom mutation (not executed server-side)
    ComposeRequest:
      type: object
      additionalProperties: false
      description: Request to compose a storyline plan
      required:
      - seedSources
      - goal
      properties:
        seedSources:
          type: array
          items:
            $ref: '#/components/schemas/SeedSource'
          minItems: 1
          maxItems: 10
          description: |
            Archive or snapshot sources to seed the storyline.
            At least one source is required. Mix of archives and snapshots allowed.
        goal:
          $ref: '#/components/schemas/StorylineGoal'
          description: The high-level goal driving arc selection
        constraints:
          $ref: '#/components/schemas/ComposeConstraints'
          nullable: true
          description: Optional constraints on composition
        genre:
          type: string
          nullable: true
          description: |
            Genre filter (e.g., "crime", "action", "romance").
            If omitted, inferred from archive data.
        arcType:
          $ref: '#/components/schemas/ArcType'
          nullable: true
          description: |
            Specific arc type to use. If omitted, selected based on goal.
        urgency:
          $ref: '#/components/schemas/PlanningUrgency'
          nullable: true
          description: |
            Planning urgency level. Defaults to configuration value.
        seed:
          type: integer
          nullable: true
          description: Random seed for deterministic output (enables caching)
    SeedSource:
      type: object
      additionalProperties: false
      description: A source of seed data (archive or snapshot)
      properties:
        archiveId:
          type: string
          format: uuid
          nullable: true
          description: ID of a compressed archive (dead entity)
        snapshotId:
          type: string
          format: uuid
          nullable: true
          description: ID of a live snapshot (living entity)
        role:
          type: string
          nullable: true
          description: |
            Optional actant role hint (e.g., "protagonist", "antagonist", "helper").
            Used for Greimas actant assignment if provided.
    ComposeConstraints:
      type: object
      additionalProperties: false
      description: Constraints on storyline composition
      properties:
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Realm to anchor the storyline in
        locationId:
          type: string
          format: uuid
          nullable: true
          description: Optional starting location
        maxEntities:
          type: integer
          minimum: 1
          maximum: 50
          nullable: true
          description: Maximum entities the plan can require (default from config)
        maxPhases:
          type: integer
          minimum: 1
          maximum: 10
          nullable: true
          description: Maximum phases in the plan (default unlimited)
    GetPlanRequest:
      type: object
      additionalProperties: false
      description: Request to retrieve a cached plan
      required:
      - planId
      properties:
        planId:
          type: string
          format: uuid
          description: ID of the plan to retrieve
    ListPlansRequest:
      type: object
      additionalProperties: false
      description: Request to list cached plans
      properties:
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Filter by realm (optional)
        limit:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Maximum plans to return
        offset:
          type: integer
          minimum: 0
          default: 0
          description: Pagination offset
    ComposeResponse:
      type: object
      additionalProperties: false
      description: Composed storyline plan
      required:
      - planId
      - confidence
      - goal
      - arcType
      - primarySpectrum
      - phases
      - generationTimeMs
      - cached
      properties:
        planId:
          type: string
          format: uuid
          description: Unique plan identifier
        confidence:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: Plan viability score (0-1)
        goal:
          $ref: '#/components/schemas/StorylineGoal'
          description: The goal that was used
        genre:
          type: string
          nullable: true
          description: Inferred or specified genre
        arcType:
          $ref: '#/components/schemas/ArcType'
          description: Emotional arc type used
        primarySpectrum:
          $ref: '#/components/schemas/SpectrumType'
          description: Primary Life Value spectrum
        themes:
          type: array
          items:
            type: string
          nullable: true
          description: Inferred thematic elements
        phases:
          type: array
          items:
            $ref: '#/components/schemas/StorylinePlanPhase'
          description: Planned phases with actions
        entitiesToSpawn:
          type: array
          items:
            $ref: '#/components/schemas/EntityRequirement'
          nullable: true
          description: |
            Entities required for this storyline (descriptions only).
            Callers decide whether to spawn them.
        links:
          type: array
          items:
            $ref: '#/components/schemas/StorylineLink'
          nullable: true
          description: Links between entities in the plan
        risks:
          type: array
          items:
            $ref: '#/components/schemas/StorylineRisk'
          nullable: true
          description: Identified risks or weak points in the plan
        generationTimeMs:
          type: integer
          description: Time taken to generate in milliseconds
        cached:
          type: boolean
          description: Whether this was returned from cache
    GetPlanResponse:
      type: object
      additionalProperties: false
      description: Retrieved plan
      required:
      - found
      properties:
        found:
          type: boolean
          description: Whether the plan was found
        plan:
          $ref: '#/components/schemas/ComposeResponse'
          nullable: true
          description: The plan (null if not found)
    ListPlansResponse:
      type: object
      additionalProperties: false
      description: List of plans
      required:
      - plans
      - totalCount
      properties:
        plans:
          type: array
          items:
            $ref: '#/components/schemas/PlanSummary'
          description: Plan summaries
        totalCount:
          type: integer
          description: Total matching plans
    StorylinePlanPhase:
      type: object
      additionalProperties: false
      description: A phase in the storyline plan
      required:
      - phaseNumber
      - name
      - actions
      - targetState
      - positionBounds
      properties:
        phaseNumber:
          type: integer
          minimum: 1
          description: 1-based phase number
        name:
          type: string
          description: Phase name
        actions:
          type: array
          items:
            $ref: '#/components/schemas/StorylinePlanAction'
          description: Actions in this phase
        targetState:
          $ref: '#/components/schemas/PhaseTargetState'
          description: Target state for phase completion
        positionBounds:
          $ref: '#/components/schemas/PhasePosition'
          description: Position bounds for this phase
    StorylinePlanAction:
      type: object
      additionalProperties: false
      description: A planned action in the storyline
      required:
      - actionId
      - sequenceIndex
      - effects
      - narrativeEffect
      - isCoreEvent
      properties:
        actionId:
          type: string
          description: Action identifier from action registry
        sequenceIndex:
          type: integer
          description: Sequence index within the plan
        effects:
          type: array
          items:
            $ref: '#/components/schemas/ActionEffect'
          description: World state effects of this action
        narrativeEffect:
          $ref: '#/components/schemas/NarrativeEffect'
          description: Narrative effect on the emotional arc
        isCoreEvent:
          type: boolean
          description: Whether this is an obligatory scene
        chainedFrom:
          type: string
          nullable: true
          description: If chained, the ID of the action it was chained from
    ActionEffect:
      type: object
      additionalProperties: false
      description: Effect of an action on world state
      required:
      - key
      - value
      properties:
        key:
          type: string
          description: State key to modify
        value:
          description: New value to set (any type)
        cardinality:
          $ref: '#/components/schemas/EffectCardinality'
          description: How the effect is applied
    EffectCardinality:
      type: string
      enum:
      - Exclusive
      - Additive
      description: |
        Cardinality for effect application.
        Exclusive: Replaces existing value at key
        Additive: Adds to collection at key
    NarrativeEffect:
      type: object
      additionalProperties: false
      description: Narrative effect on the emotional arc
      properties:
        primarySpectrumDelta:
          type: number
          format: double
          nullable: true
          description: Delta to apply to the primary spectrum
        secondarySpectrumDelta:
          type: number
          format: double
          nullable: true
          description: Delta to apply to the secondary spectrum
        positionAdvance:
          type: string
          nullable: true
          description: Position advance type (micro, standard, macro)
    PhaseTargetState:
      type: object
      additionalProperties: false
      description: Target state for phase completion
      required:
      - minPrimarySpectrum
      - maxPrimarySpectrum
      properties:
        minPrimarySpectrum:
          type: number
          format: double
          description: Minimum primary spectrum value for this phase
        maxPrimarySpectrum:
          type: number
          format: double
          description: Maximum primary spectrum value for this phase
        rangeDescription:
          type: string
          nullable: true
          description: Human-readable description of this state range
    PhasePosition:
      type: object
      additionalProperties: false
      description: Phase position constraints from Save the Cat beat timing
      required:
      - stcCenter
      - floor
      - ceiling
      - validationBand
      properties:
        stcCenter:
          type: number
          format: double
          description: Target position from STC beat timing
        floor:
          type: number
          format: double
          description: Earliest advancement position (prevents speed-running)
        ceiling:
          type: number
          format: double
          description: Forced advancement position (prevents deadlock)
        validationBand:
          type: number
          format: double
          description: Validation tolerance ()
    EntityRequirement:
      type: object
      additionalProperties: false
      description: An entity required for the storyline
      required:
      - role
      - entityType
      - description
      properties:
        role:
          type: string
          description: Role in the story (e.g., "witness", "informant", "target")
        entityType:
          type: string
          description: Type of entity needed (e.g., "character", "location", "item")
        description:
          type: string
          description: Description of what's needed
        constraints:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Constraints on entity selection/creation
        sourceArchiveId:
          type: string
          format: uuid
          nullable: true
          description: If derived from an archive, that archive's ID
    StorylineLink:
      type: object
      additionalProperties: false
      description: A relationship link in the storyline
      required:
      - sourceRole
      - targetRole
      - linkType
      properties:
        sourceRole:
          type: string
          description: Source entity role
        targetRole:
          type: string
          description: Target entity role
        linkType:
          type: string
          description: Type of relationship (e.g., "opposes", "allies_with", "seeks")
    StorylineRisk:
      type: object
      additionalProperties: false
      description: Identified risk in the plan
      required:
      - riskType
      - description
      - severity
      properties:
        riskType:
          type: string
          description: Risk category (e.g., "missing_entity", "low_tension", "weak_climax")
        description:
          type: string
          description: Risk description
        severity:
          type: string
          enum:
          - low
          - medium
          - high
          description: Risk severity
        mitigation:
          type: string
          nullable: true
          description: Suggested mitigation
    PlanSummary:
      type: object
      additionalProperties: false
      description: Summary of a cached plan
      required:
      - planId
      - goal
      - arcType
      - confidence
      - createdAt
      properties:
        planId:
          type: string
          format: uuid
          description: Plan identifier
        goal:
          $ref: '#/components/schemas/StorylineGoal'
          description: Story goal
        arcType:
          $ref: '#/components/schemas/ArcType'
          description: Arc type
        confidence:
          type: number
          format: double
          description: Viability score
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Anchored realm (if any)
        createdAt:
          type: string
          format: date-time
          description: When plan was created
        expiresAt:
          type: string
          format: date-time
          nullable: true
          description: When plan expires from cache
    ScenarioDefinition:
      type: object
      additionalProperties: false
      description: A scenario definition template that can be triggered when conditions are met
      required:
      - scenarioId
      - code
      - name
      - triggerConditions
      - phases
      - priority
      - enabled
      - createdAt
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Unique scenario definition identifier
        code:
          type: string
          minLength: 1
          maxLength: 100
          description: Human-readable scenario code (uppercase with underscores)
        name:
          type: string
          minLength: 1
          maxLength: 200
          description: Display name for the scenario
        description:
          type: string
          nullable: true
          description: Detailed scenario description
        triggerConditions:
          type: array
          items:
            $ref: '#/components/schemas/TriggerCondition'
          minItems: 1
          description: Conditions that must ALL be met to trigger (AND logic)
        phases:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioPhase'
          minItems: 1
          description: Execution phases in order
        mutations:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioMutation'
          nullable: true
          description: State mutations to apply on completion
        questHooks:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioQuestHook'
          nullable: true
          description: Quests to spawn on completion
        cooldownSeconds:
          type: integer
          minimum: 0
          nullable: true
          description: Per-character cooldown in seconds (null uses default from config)
        exclusivityTags:
          type: array
          items:
            type: string
          nullable: true
          description: Tags for mutual exclusivity checking
        priority:
          type: integer
          default: 0
          description: Higher priority scenarios are checked first
        enabled:
          type: boolean
          default: true
          description: Whether scenario can be triggered
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Realm scope (null means all realms)
        gameServiceId:
          type: string
          format: uuid
          nullable: true
          description: Game service scope (null means all games)
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Classification tags for filtering
        isDeprecated:
          type: boolean
          default: false
          description: Whether scenario definition is deprecated
        deprecatedAt:
          type: string
          format: date-time
          nullable: true
          description: When the scenario definition was deprecated
        deprecationReason:
          type: string
          nullable: true
          maxLength: 500
          description: Reason for deprecation
        createdAt:
          type: string
          format: date-time
          description: When definition was created
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: When definition was last modified
        etag:
          type: string
          nullable: true
          description: ETag for optimistic concurrency
    TriggerCondition:
      type: object
      additionalProperties: false
      description: A condition that must be met for scenario triggering
      required:
      - conditionType
      properties:
        conditionType:
          $ref: '#/components/schemas/TriggerConditionType'
          description: Type of condition to evaluate
        traitAxis:
          type: string
          nullable: true
          description: Personality trait axis for TraitRange (e.g., AGGRESSION)
        traitMin:
          type: number
          format: float
          nullable: true
          description: Minimum trait value for TraitRange (-1.0 to 1.0)
        traitMax:
          type: number
          format: float
          nullable: true
          description: Maximum trait value for TraitRange (-1.0 to 1.0)
        backstoryType:
          type: string
          nullable: true
          description: Backstory element type for BackstoryElement (e.g., TRAUMA)
        backstoryKey:
          type: string
          nullable: true
          description: Backstory element key for BackstoryElement
        relationshipTypeCode:
          type: string
          nullable: true
          description: Relationship type code for RelationshipExists/Missing
        otherEntityType:
          type: string
          nullable: true
          description: Type of other entity in relationship check
        ageMin:
          type: integer
          nullable: true
          description: Minimum character age for AgeRange
        ageMax:
          type: integer
          nullable: true
          description: Maximum character age for AgeRange
        locationId:
          type: string
          format: uuid
          nullable: true
          description: Required location ID for LocationAt
        timeOfDayMin:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
          description: Minimum hour of day (0-23) for TimeOfDay
        timeOfDayMax:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
          description: Maximum hour of day (0-23) for TimeOfDay
        worldStateKey:
          type: string
          nullable: true
          description: Custom state key for WorldState/Custom
        worldStateValue:
          type: string
          nullable: true
          description: Expected value for WorldState/Custom
    ScenarioPhase:
      type: object
      additionalProperties: false
      description: A phase in scenario execution
      required:
      - phaseNumber
      - name
      properties:
        phaseNumber:
          type: integer
          minimum: 1
          description: Phase sequence number (1-based)
        name:
          type: string
          description: Phase name
        description:
          type: string
          nullable: true
          description: What happens in this phase
        durationSeconds:
          type: integer
          nullable: true
          description: Expected duration in seconds (for pacing, not enforced)
        dialogueHint:
          type: string
          nullable: true
          description: Hint for dialogue generation system
        actionHint:
          type: string
          nullable: true
          description: Hint for behavior/GOAP system
    ScenarioMutation:
      type: object
      additionalProperties: false
      description: A state mutation to apply during scenario execution
      required:
      - mutationType
      properties:
        mutationType:
          $ref: '#/components/schemas/MutationType'
          description: Type of mutation to apply
        experienceType:
          type: string
          nullable: true
          description: Experience type for PersonalityEvolve (e.g., TRAUMA, VICTORY)
        experienceIntensity:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          nullable: true
          description: Experience intensity for PersonalityEvolve (0.0-1.0)
        backstoryElementType:
          type: string
          nullable: true
          description: Backstory element type for BackstoryAdd (e.g., TRAUMA, GOAL)
        backstoryKey:
          type: string
          nullable: true
          description: Backstory element key for BackstoryAdd
        backstoryValue:
          type: string
          nullable: true
          description: Backstory element value for BackstoryAdd
        backstoryStrength:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          nullable: true
          description: Backstory element strength for BackstoryAdd (0.0-1.0)
        relationshipTypeCode:
          type: string
          nullable: true
          description: Relationship type code for RelationshipCreate/End
        otherParticipantRole:
          type: string
          nullable: true
          description: Role name for other participant in multi-character scenarios
    ScenarioQuestHook:
      type: object
      additionalProperties: false
      description: Quest to spawn on scenario completion
      required:
      - questCode
      properties:
        questCode:
          type: string
          description: Quest definition code to spawn
        delaySeconds:
          type: integer
          default: 0
          description: Delay before spawning quest (not implemented in Phase 1)
        termOverrides:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Variable overrides for quest template
    CreateScenarioDefinitionRequest:
      type: object
      additionalProperties: false
      description: Request to create a scenario definition
      required:
      - code
      - name
      - triggerConditions
      - phases
      properties:
        code:
          type: string
          minLength: 1
          maxLength: 100
          description: Human-readable scenario code (uppercase with underscores)
        name:
          type: string
          minLength: 1
          maxLength: 200
          description: Display name for the scenario
        description:
          type: string
          nullable: true
          description: Detailed scenario description
        triggerConditions:
          type: array
          items:
            $ref: '#/components/schemas/TriggerCondition'
          minItems: 1
          description: Conditions that must ALL be met to trigger
        phases:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioPhase'
          minItems: 1
          description: Execution phases in order
        mutations:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioMutation'
          nullable: true
          description: State mutations to apply on completion
        questHooks:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioQuestHook'
          nullable: true
          description: Quests to spawn on completion
        cooldownSeconds:
          type: integer
          minimum: 0
          nullable: true
          description: Per-character cooldown in seconds
        exclusivityTags:
          type: array
          items:
            type: string
          nullable: true
          description: Tags for mutual exclusivity checking
        priority:
          type: integer
          default: 0
          description: Higher priority scenarios are checked first
        enabled:
          type: boolean
          default: true
          description: Whether scenario can be triggered
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Realm scope (null means all realms)
        gameServiceId:
          type: string
          format: uuid
          nullable: true
          description: Game service scope (null means all games)
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Classification tags for filtering
    GetScenarioDefinitionRequest:
      type: object
      additionalProperties: false
      description: Request to retrieve a scenario definition
      properties:
        scenarioId:
          type: string
          format: uuid
          nullable: true
          description: Scenario ID to retrieve
        code:
          type: string
          nullable: true
          description: Scenario code to retrieve (if ID not provided)
    GetScenarioDefinitionResponse:
      type: object
      additionalProperties: false
      description: Response with scenario definition
      required:
      - found
      properties:
        found:
          type: boolean
          description: Whether the scenario was found
        scenario:
          $ref: '#/components/schemas/ScenarioDefinition'
          nullable: true
          description: The scenario definition (null if not found)
    ListScenarioDefinitionsRequest:
      type: object
      additionalProperties: false
      description: Request to list scenario definitions
      properties:
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Filter by realm
        gameServiceId:
          type: string
          format: uuid
          nullable: true
          description: Filter by game service
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Filter by tags (OR logic)
        includeDeprecated:
          type: boolean
          default: false
          description: Include deprecated scenarios
        limit:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Maximum scenarios to return
        offset:
          type: integer
          minimum: 0
          default: 0
          description: Pagination offset
    ListScenarioDefinitionsResponse:
      type: object
      additionalProperties: false
      description: List of scenario definitions
      required:
      - scenarios
      - totalCount
      properties:
        scenarios:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioDefinitionSummary'
          description: Scenario definition summaries
        totalCount:
          type: integer
          description: Total matching scenarios
    ScenarioDefinitionSummary:
      type: object
      additionalProperties: false
      description: Summary of a scenario definition
      required:
      - scenarioId
      - code
      - name
      - priority
      - enabled
      - createdAt
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Scenario identifier
        code:
          type: string
          description: Scenario code
        name:
          type: string
          description: Scenario name
        priority:
          type: integer
          description: Scenario priority
        enabled:
          type: boolean
          description: Whether enabled
        isDeprecated:
          type: boolean
          description: Whether deprecated
        deprecatedAt:
          type: string
          format: date-time
          nullable: true
          description: When deprecated
        deprecationReason:
          type: string
          nullable: true
          maxLength: 500
          description: Reason for deprecation
        conditionCount:
          type: integer
          description: Number of trigger conditions
        phaseCount:
          type: integer
          description: Number of phases
        mutationCount:
          type: integer
          description: Number of mutations
        questHookCount:
          type: integer
          description: Number of quest hooks
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Realm scope
        gameServiceId:
          type: string
          format: uuid
          nullable: true
          description: Game service scope
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: Classification tags
        createdAt:
          type: string
          format: date-time
          description: When created
    UpdateScenarioDefinitionRequest:
      type: object
      additionalProperties: false
      description: Request to update a scenario definition
      required:
      - scenarioId
      - etag
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Scenario to update
        etag:
          type: string
          description: ETag for optimistic concurrency
        name:
          type: string
          nullable: true
          description: New name
        description:
          type: string
          nullable: true
          description: New description
        triggerConditions:
          type: array
          items:
            $ref: '#/components/schemas/TriggerCondition'
          nullable: true
          description: New trigger conditions
        phases:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioPhase'
          nullable: true
          description: New phases
        mutations:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioMutation'
          nullable: true
          description: New mutations
        questHooks:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioQuestHook'
          nullable: true
          description: New quest hooks
        cooldownSeconds:
          type: integer
          minimum: 0
          nullable: true
          description: New cooldown
        exclusivityTags:
          type: array
          items:
            type: string
          nullable: true
          description: New exclusivity tags
        priority:
          type: integer
          nullable: true
          description: New priority
        enabled:
          type: boolean
          nullable: true
          description: New enabled state
        tags:
          type: array
          items:
            type: string
          nullable: true
          description: New classification tags
    DeprecateScenarioDefinitionRequest:
      type: object
      additionalProperties: false
      description: Request to deprecate a scenario definition
      required:
      - scenarioId
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Scenario to deprecate
        reason:
          type: string
          nullable: true
          maxLength: 500
          description: Reason for deprecation
    FindAvailableScenariosRequest:
      type: object
      additionalProperties: false
      description: Request to find scenarios matching character state
      required:
      - characterId
      - characterState
      properties:
        characterId:
          type: string
          format: uuid
          description: Character to find scenarios for
        characterState:
          $ref: '#/components/schemas/CharacterStateSnapshot'
          description: Current character state (caller provides this)
        locationId:
          type: string
          format: uuid
          nullable: true
          description: Current character location
        timeOfDay:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
          description: Current in-game hour (0-23)
        worldState:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Current world state key-value pairs
        realmId:
          type: string
          format: uuid
          nullable: true
          description: Realm to search within
        gameServiceId:
          type: string
          format: uuid
          nullable: true
          description: Game service to search within
        maxResults:
          type: integer
          minimum: 1
          maximum: 50
          default: 10
          description: Maximum scenarios to return
        excludeTags:
          type: array
          items:
            type: string
          nullable: true
          description: Exclude scenarios with these tags
    CharacterStateSnapshot:
      type: object
      additionalProperties: false
      description: Snapshot of character state for condition evaluation
      properties:
        age:
          type: integer
          nullable: true
          description: Character age in years
        traits:
          type: array
          items:
            $ref: '#/components/schemas/TraitSnapshot'
          nullable: true
          description: Current personality traits
        backstoryElements:
          type: array
          items:
            $ref: '#/components/schemas/BackstorySnapshot'
          nullable: true
          description: Current backstory elements
        relationships:
          type: array
          items:
            $ref: '#/components/schemas/RelationshipSnapshot'
          nullable: true
          description: Current relationships
    TraitSnapshot:
      type: object
      additionalProperties: false
      description: Snapshot of a personality trait
      required:
      - axis
      - value
      properties:
        axis:
          type: string
          description: Trait axis name (e.g., AGGRESSION, OPENNESS)
        value:
          type: number
          format: float
          description: Trait value (-1.0 to 1.0)
    BackstorySnapshot:
      type: object
      additionalProperties: false
      description: Snapshot of a backstory element
      required:
      - elementType
      - key
      properties:
        elementType:
          type: string
          description: Backstory element type (e.g., TRAUMA, GOAL)
        key:
          type: string
          description: Backstory element key
    RelationshipSnapshot:
      type: object
      additionalProperties: false
      description: Snapshot of a relationship
      required:
      - relationshipTypeCode
      - otherEntityId
      - otherEntityType
      properties:
        relationshipTypeCode:
          type: string
          description: Relationship type code
        otherEntityId:
          type: string
          format: uuid
          description: ID of other entity
        otherEntityType:
          type: string
          description: Type of other entity
    FindAvailableScenariosResponse:
      type: object
      additionalProperties: false
      description: Matching scenarios with fit scores
      required:
      - matches
      properties:
        matches:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioMatch'
          description: Matching scenarios ordered by fit score
    ScenarioMatch:
      type: object
      additionalProperties: false
      description: A scenario that matches character state
      required:
      - scenarioId
      - code
      - name
      - fitScore
      - conditionsMet
      - conditionsTotal
      - onCooldown
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Scenario definition ID
        code:
          type: string
          description: Scenario code
        name:
          type: string
          description: Scenario name
        fitScore:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: Narrative fit score (0-1)
        conditionsMet:
          type: integer
          description: Number of conditions met
        conditionsTotal:
          type: integer
          description: Total conditions
        onCooldown:
          type: boolean
          description: Whether scenario is on cooldown for this character
        cooldownExpiresAt:
          type: string
          format: date-time
          nullable: true
          description: When cooldown expires (if on cooldown)
    TestScenarioRequest:
      type: object
      additionalProperties: false
      description: Request to dry-run scenario trigger
      required:
      - scenarioId
      - characterId
      - characterState
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Scenario to test
        characterId:
          type: string
          format: uuid
          description: Character to test against
        characterState:
          $ref: '#/components/schemas/CharacterStateSnapshot'
          description: Current character state
        locationId:
          type: string
          format: uuid
          nullable: true
          description: Location context
        timeOfDay:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
          description: Current in-game hour
        worldState:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: World state context
    TestScenarioResponse:
      type: object
      additionalProperties: false
      description: Result of scenario dry-run
      required:
      - wouldTrigger
      - conditionResults
      properties:
        wouldTrigger:
          type: boolean
          description: Whether scenario would trigger
        conditionResults:
          type: array
          items:
            $ref: '#/components/schemas/ConditionResult'
          description: Result of each condition check
        predictedMutations:
          type: array
          items:
            $ref: '#/components/schemas/PredictedMutation'
          nullable: true
          description: Mutations that would be applied
        blockingReason:
          type: string
          nullable: true
          description: Why scenario would not trigger (cooldown, exclusivity, etc.)
    ConditionResult:
      type: object
      additionalProperties: false
      description: Result of evaluating a single condition
      required:
      - conditionType
      - met
      properties:
        conditionType:
          $ref: '#/components/schemas/TriggerConditionType'
          description: Condition type
        met:
          type: boolean
          description: Whether condition was met
        actualValue:
          type: string
          nullable: true
          description: Actual value found
        expectedValue:
          type: string
          nullable: true
          description: Expected value
        details:
          type: string
          nullable: true
          description: Additional details
    PredictedMutation:
      type: object
      additionalProperties: false
      description: Mutation that would be applied
      required:
      - mutationType
      - description
      properties:
        mutationType:
          $ref: '#/components/schemas/MutationType'
          description: Type of mutation
        description:
          type: string
          description: Human-readable description
    EvaluateFitRequest:
      type: object
      additionalProperties: false
      description: Request for lightweight fit scoring
      required:
      - scenarioId
      - characterState
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Scenario to evaluate
        characterState:
          $ref: '#/components/schemas/CharacterStateSnapshot'
          description: Character state snapshot
    EvaluateFitResponse:
      type: object
      additionalProperties: false
      description: Fit score result
      required:
      - fitScore
      - conditionsMet
      - conditionsTotal
      properties:
        fitScore:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: Narrative fit score (0-1)
        conditionsMet:
          type: integer
          description: Number of conditions met
        conditionsTotal:
          type: integer
          description: Total conditions
    TriggerScenarioRequest:
      type: object
      additionalProperties: false
      description: Request to trigger scenario execution
      required:
      - scenarioId
      - characterId
      - characterState
      properties:
        scenarioId:
          type: string
          format: uuid
          description: Scenario to trigger
        characterId:
          type: string
          format: uuid
          description: Primary character in scenario
        characterState:
          $ref: '#/components/schemas/CharacterStateSnapshot'
          description: Current character state for condition validation
        additionalParticipants:
          type: object
          additionalProperties:
            type: string
            format: uuid
          nullable: true
          description: Additional participants by role name
        locationId:
          type: string
          format: uuid
          nullable: true
          description: Location context
        timeOfDay:
          type: integer
          minimum: 0
          maximum: 23
          nullable: true
          description: Current in-game hour
        worldState:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: World state context
        orchestratorId:
          type: string
          format: uuid
          nullable: true
          description: Actor ID of the orchestrating watcher
        skipConditionCheck:
          type: boolean
          default: false
          description: Skip condition validation (for forced triggers)
        idempotencyKey:
          type: string
          nullable: true
          description: Idempotency key for safe retries
    TriggerScenarioResponse:
      type: object
      additionalProperties: false
      description: Result of scenario trigger
      required:
      - executionId
      - scenarioId
      - status
      - triggeredAt
      properties:
        executionId:
          type: string
          format: uuid
          description: Scenario execution instance ID
        scenarioId:
          type: string
          format: uuid
          description: Scenario definition ID
        status:
          $ref: '#/components/schemas/ScenarioStatus'
          description: Execution status
        triggeredAt:
          type: string
          format: date-time
          description: When scenario was triggered
        mutationsApplied:
          type: array
          items:
            $ref: '#/components/schemas/AppliedMutation'
          nullable: true
          description: Mutations that were applied
        questsSpawned:
          type: array
          items:
            $ref: '#/components/schemas/SpawnedQuest'
          nullable: true
          description: Quests that were spawned
        failureReason:
          type: string
          nullable: true
          description: Reason for failure (if status is Failed)
    AppliedMutation:
      type: object
      additionalProperties: false
      description: A mutation that was applied
      required:
      - mutationType
      - success
      properties:
        mutationType:
          $ref: '#/components/schemas/MutationType'
          description: Type of mutation
        success:
          type: boolean
          description: Whether mutation succeeded
        targetCharacterId:
          type: string
          format: uuid
          nullable: true
          description: Character affected
        details:
          type: string
          nullable: true
          description: Details of what changed
    SpawnedQuest:
      type: object
      additionalProperties: false
      description: A quest that was spawned
      required:
      - questInstanceId
      - questCode
      properties:
        questInstanceId:
          type: string
          format: uuid
          description: Quest instance ID
        questCode:
          type: string
          description: Quest definition code
    GetActiveScenariosRequest:
      type: object
      additionalProperties: false
      description: Request for active scenarios
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: Character to query
    GetActiveScenariosResponse:
      type: object
      additionalProperties: false
      description: Active scenario executions
      required:
      - executions
      properties:
        executions:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioExecution'
          description: Active scenario executions
    ScenarioExecution:
      type: object
      additionalProperties: false
      description: A scenario execution instance
      required:
      - executionId
      - scenarioId
      - code
      - name
      - status
      - currentPhase
      - totalPhases
      - triggeredAt
      properties:
        executionId:
          type: string
          format: uuid
          description: Execution instance ID
        scenarioId:
          type: string
          format: uuid
          description: Scenario definition ID
        code:
          type: string
          description: Scenario code
        name:
          type: string
          description: Scenario name
        status:
          $ref: '#/components/schemas/ScenarioStatus'
          description: Current status
        currentPhase:
          type: integer
          description: Current phase number
        totalPhases:
          type: integer
          description: Total phases
        triggeredAt:
          type: string
          format: date-time
          description: When triggered
        completedAt:
          type: string
          format: date-time
          nullable: true
          description: When completed (if applicable)
    GetScenarioHistoryRequest:
      type: object
      additionalProperties: false
      description: Request for scenario execution history
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: Character to query
        limit:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Max results
        offset:
          type: integer
          minimum: 0
          default: 0
          description: Pagination offset
    GetScenarioHistoryResponse:
      type: object
      additionalProperties: false
      description: Scenario execution history
      required:
      - executions
      - totalCount
      properties:
        executions:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioExecution'
          description: Historical executions
        totalCount:
          type: integer
          description: Total count for pagination
    GetCompressDataRequest:
      type: object
      description: Request to get storyline data for compression
      additionalProperties: false
      required:
      - characterId
      properties:
        characterId:
          type: string
          format: uuid
          description: ID of the character to get compress data for
    StorylineArchive:
      type: object
      x-archive-type: true
      description: |
        Complete storyline participation data for archive storage and SDK consumption.
        Inherits base archive properties from ResourceArchiveBase.
        The characterId field equals resourceId for convenience.
      allOf:
      - $ref: './common-api.yaml#/components/schemas/ResourceArchiveBase'
      additionalProperties: false
      required:
      - characterId
      - participations
      - activeArcs
      - completedStorylines
      properties:
        characterId:
          type: string
          format: uuid
          description: Character this data belongs to (equals resourceId)
        participations:
          type: array
          items:
            $ref: '#/components/schemas/StorylineParticipation'
          description: All scenario participations (completed and active)
        activeArcs:
          type: array
          items:
            type: string
          description: Story arcs the character is currently involved in
        completedStorylines:
          type: integer
          minimum: 0
          description: Total count of completed scenarios
    StorylineParticipation:
      type: object
      description: Summary of a scenario participation for archive purposes
      additionalProperties: false
      required:
      - executionId
      - scenarioCode
      - role
      - phase
      - totalPhases
      - status
      - startedAt
      properties:
        executionId:
          type: string
          format: uuid
          description: Scenario execution ID
        scenarioId:
          type: string
          format: uuid
          nullable: true
          description: Scenario definition ID (if available)
        scenarioCode:
          type: string
          description: Scenario code for lookup
        scenarioName:
          type: string
          nullable: true
          description: Scenario display name
        role:
          type: string
          description: Character's role in the scenario (primary, secondary, witness)
        phase:
          type: integer
          minimum: 0
          description: Current phase number (or final phase if completed)
        totalPhases:
          type: integer
          minimum: 0
          description: Total number of phases in the scenario
        status:
          $ref: '#/components/schemas/ScenarioStatus'
          description: Current status of the scenario execution
        startedAt:
          type: string
          format: date-time
          description: When the scenario was triggered
        completedAt:
          type: string
          format: date-time
          nullable: true
          description: When the scenario completed (null if still active)
        choices:
          type: array
          items:
            type: string
          nullable: true
          description: Key choices made during the scenario (for narrative hooks)
tags:
- name: Composition
  description: Storyline plan composition
- name: Plans
  description: Plan management and retrieval
- name: Scenario Definitions
  description: Scenario definition CRUD operations
- name: Scenario Discovery
  description: Find and test scenarios for characters
- name: Scenario Execution
  description: Trigger and track scenario executions
- name: Compression
  description: Resource service compression integration
