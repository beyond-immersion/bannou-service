//----------------------
// <auto-generated>
//     Generated from OpenAPI schema: schemas/transit-configuration.yaml
//
//     WARNING: DO NOT EDIT THIS FILE (FOUNDATION TENETS)
//     This file is auto-generated from configuration schema.
//     Any manual changes will be overwritten on next generation.
//
//     To add/modify configuration:
//     1. Edit the source schema (schemas/transit-configuration.yaml)
//     2. Run: scripts/generate-all-services.sh
//
//     IMPLEMENTATION TENETS - Configuration-First:
//     - Access configuration via dependency injection, never Environment.GetEnvironmentVariable.
//     - ALL properties below MUST be referenced somewhere in the plugin (no dead config).
//     - Any hardcoded tunable (limit, timeout, threshold, capacity) in service code means
//       a configuration property is MISSING - add it to the configuration schema.
//     - If a property is unused, remove it from the configuration schema.
//
//     Example: public MyService(TransitServiceConfiguration config) { _config = config; }
//
//     See: docs/reference/tenets/IMPLEMENTATION.md (Configuration-First, Internal Model Type Safety)
// </auto-generated>
//----------------------

using System.ComponentModel.DataAnnotations;
using BeyondImmersion.BannouService;
using BeyondImmersion.BannouService.Attributes;
using BeyondImmersion.BannouService.Configuration;

#nullable enable

namespace BeyondImmersion.BannouService.Transit;

/// <summary>
/// Configuration class for Transit service.
/// Properties are automatically bound from environment variables.
/// </summary>
/// <remarks>
/// <para>
/// <b>IMPLEMENTATION TENETS - Configuration-First:</b> Access configuration via dependency injection.
/// Never use <c>Environment.GetEnvironmentVariable()</c> directly in service code.
/// ALL properties in this class MUST be referenced somewhere in the plugin.
/// If a property is unused, remove it from the configuration schema.
/// </para>
/// <para>
/// Environment variable names follow the pattern: {SERVICE}_{PROPERTY} (e.g., AUTH_JWT_SECRET).
/// </para>
/// </remarks>
[ServiceConfiguration(typeof(TransitService))]
public class TransitServiceConfiguration : BaseServiceConfiguration
{

    /// <summary>
    /// Default walking speed used when no mode is specified
    /// Environment variable: TRANSIT_DEFAULT_WALKING_SPEED_KM_PER_GAME_HOUR
    /// </summary>
    [ConfigRange(Minimum = 0.1)]
    public double DefaultWalkingSpeedKmPerGameHour { get; set; } = 5.0;

    /// <summary>
    /// Maximum number of legs to consider in route calculation (prevents combinatorial explosion)
    /// Environment variable: TRANSIT_MAX_ROUTE_CALCULATION_LEGS
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 50)]
    public int MaxRouteCalculationLegs { get; set; } = 8;

    /// <summary>
    /// Maximum number of route options to return from calculate endpoint
    /// Environment variable: TRANSIT_MAX_ROUTE_OPTIONS
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 20)]
    public int MaxRouteOptions { get; set; } = 5;

    /// <summary>
    /// TTL for cached connection graph in Redis (seconds). Graph is rebuilt on cache miss. 0 = no caching.
    /// Environment variable: TRANSIT_CONNECTION_GRAPH_CACHE_SECONDS
    /// </summary>
    [ConfigRange(Minimum = 0)]
    public int ConnectionGraphCacheSeconds { get; set; } = 300;

    /// <summary>
    /// Game-hours after arrival/abandonment before journey is archived from Redis to MySQL. 0 = archive immediately.
    /// Environment variable: TRANSIT_JOURNEY_ARCHIVE_AFTER_GAME_HOURS
    /// </summary>
    [ConfigRange(Minimum = 0)]
    public double JourneyArchiveAfterGameHours { get; set; } = 168.0;

    /// <summary>
    /// Cargo weight above this threshold reduces speed. Speed reduction = (cargo - threshold) / (capacity - threshold) * DefaultCargoSpeedPenaltyRate
    /// Environment variable: TRANSIT_CARGO_SPEED_PENALTY_THRESHOLD_KG
    /// </summary>
    [ConfigRange(Minimum = 0)]
    public double CargoSpeedPenaltyThresholdKg { get; set; } = 100.0;

    /// <summary>
    /// How often the background worker checks Worldstate for seasonal connection status changes
    /// Environment variable: TRANSIT_SEASONAL_CONNECTION_CHECK_INTERVAL_SECONDS
    /// </summary>
    [ConfigRange(Minimum = 1)]
    public int SeasonalConnectionCheckIntervalSeconds { get; set; } = 60;

    /// <summary>
    /// TTL for per-entity discovery cache in Redis (seconds). Route calculation checks this cache to filter discoverable connections. 0 = no caching.
    /// Environment variable: TRANSIT_DISCOVERY_CACHE_TTL_SECONDS
    /// </summary>
    [ConfigRange(Minimum = 0)]
    public int DiscoveryCacheTtlSeconds { get; set; } = 600;

    /// <summary>
    /// Default cargo speed penalty rate applied when a mode's cargoSpeedPenaltyRate is null. Speed reduction = (cargo - threshold) / (capacity - threshold) * rate. 0.3 = 30% max speed reduction at full capacity.
    /// Environment variable: TRANSIT_DEFAULT_CARGO_SPEED_PENALTY_RATE
    /// </summary>
    [ConfigRange(Minimum = 0, Maximum = 1)]
    public double DefaultCargoSpeedPenaltyRate { get; set; } = 0.3;

    /// <summary>
    /// Number of real-time days to retain archived journeys in MySQL before cleanup. 0 = retain indefinitely. The archival worker deletes records older than this threshold during each sweep.
    /// Environment variable: TRANSIT_JOURNEY_ARCHIVE_RETENTION_DAYS
    /// </summary>
    [ConfigRange(Minimum = 0)]
    public int JourneyArchiveRetentionDays { get; set; } = 365;

    /// <summary>
    /// Real-time interval in seconds between journey archival worker sweeps. The worker scans Redis for completed/abandoned journeys older than JourneyArchiveAfterGameHours and moves them to MySQL.
    /// Environment variable: TRANSIT_JOURNEY_ARCHIVAL_WORKER_INTERVAL_SECONDS
    /// </summary>
    [ConfigRange(Minimum = 1)]
    public int JourneyArchivalWorkerIntervalSeconds { get; set; } = 300;

    /// <summary>
    /// When true, Transit automatically calls Location's /location/report-entity-position endpoint to update the entity's current location on journey departure, waypoint arrival, and final arrival. Location's presence system uses ephemeral Redis storage with 30s TTL, so Transit must re-report on each state transition. When false, the caller is responsible for updating Location separately. Both Transit and Location are L2 (always co-deployed on game nodes), so direct API calls are used -- not events.
    /// Environment variable: TRANSIT_AUTO_UPDATE_LOCATION_ON_TRANSITION
    /// </summary>
    public bool AutoUpdateLocationOnTransition { get; set; } = true;

    /// <summary>
    /// Minimum allowed preference cost after aggregating all DI cost modifier providers. PreferenceCostDelta values are summed across providers and clamped to [MinPreferenceCost, MaxPreferenceCost].
    /// Environment variable: TRANSIT_MIN_PREFERENCE_COST
    /// </summary>
    [ConfigRange(Minimum = 0)]
    public double MinPreferenceCost { get; set; } = 0.0;

    /// <summary>
    /// Maximum allowed preference cost after aggregating all DI cost modifier providers. PreferenceCostDelta values are summed across providers and clamped to [MinPreferenceCost, MaxPreferenceCost].
    /// Environment variable: TRANSIT_MAX_PREFERENCE_COST
    /// </summary>
    [ConfigRange(Minimum = 0)]
    public double MaxPreferenceCost { get; set; } = 2.0;

    /// <summary>
    /// Minimum allowed speed multiplier after aggregating all DI cost modifier providers. SpeedMultiplier values are multiplied across providers and clamped to [MinSpeedMultiplier, MaxSpeedMultiplier].
    /// Environment variable: TRANSIT_MIN_SPEED_MULTIPLIER
    /// </summary>
    [ConfigRange(Minimum = 0.01)]
    public double MinSpeedMultiplier { get; set; } = 0.1;

    /// <summary>
    /// Maximum allowed speed multiplier after aggregating all DI cost modifier providers. SpeedMultiplier values are multiplied across providers and clamped to [MinSpeedMultiplier, MaxSpeedMultiplier].
    /// Environment variable: TRANSIT_MAX_SPEED_MULTIPLIER
    /// </summary>
    [ConfigRange(Minimum = 0.01)]
    public double MaxSpeedMultiplier { get; set; } = 3.0;

    /// <summary>
    /// Timeout in seconds for distributed lock acquisition on mode registration uniqueness checks and mode mutation operations.
    /// Environment variable: TRANSIT_LOCK_TIMEOUT_SECONDS
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 60)]
    public int LockTimeoutSeconds { get; set; } = 10;

    /// <summary>
    /// Minimum effective speed floor in km/game-hour applied after terrain and cargo modifiers. Prevents division-by-zero in travel time calculations. Speed is clamped to at least this value.
    /// Environment variable: TRANSIT_MINIMUM_EFFECTIVE_SPEED_KM_PER_GAME_HOUR
    /// </summary>
    [ConfigRange(Minimum = 0.001)]
    public double MinimumEffectiveSpeedKmPerGameHour { get; set; } = 0.01;

    /// <summary>
    /// Default fallback mode code used when no compatible transit mode can be found for a connection during route calculation. This mode is used as a last resort when neither the requested mode, multi-modal selection, nor any registered mode matches.
    /// Environment variable: TRANSIT_DEFAULT_FALLBACK_MODE_CODE
    /// </summary>
    public string DefaultFallbackModeCode { get; set; } = "walking";

}
