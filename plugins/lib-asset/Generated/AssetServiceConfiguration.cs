//----------------------
// <auto-generated>
//     Generated from OpenAPI schema: schemas/asset-configuration.yaml
//
//     WARNING: DO NOT EDIT THIS FILE (TENETS T1/T2)
//     This file is auto-generated from configuration schema.
//     Any manual changes will be overwritten on next generation.
//
//     To add/modify configuration:
//     1. Edit the source schema (schemas/asset-configuration.yaml)
//     2. Run: scripts/generate-all-services.sh
//
//     USAGE (IMPLEMENTATION TENETS - Configuration-First):
//     Access configuration via dependency injection, never Environment.GetEnvironmentVariable.
//     Example: public MyService(AssetServiceConfiguration config) { _config = config; }
//
//     See: docs/reference/tenets/FOUNDATION.md
//     See: docs/reference/tenets/IMPLEMENTATION.md
// </auto-generated>
//----------------------

using System.ComponentModel.DataAnnotations;
using BeyondImmersion.BannouService;
using BeyondImmersion.BannouService.Attributes;
using BeyondImmersion.BannouService.Configuration;

#nullable enable

namespace BeyondImmersion.BannouService.Asset;

/// <summary>
/// Configuration class for Asset service.
/// Properties are automatically bound from environment variables.
/// </summary>
/// <remarks>
/// <para>
/// <b>IMPLEMENTATION TENETS - Configuration-First:</b> Access configuration via dependency injection.
/// Never use <c>Environment.GetEnvironmentVariable()</c> directly in service code.
/// </para>
/// <para>
/// Environment variable names follow the pattern: {SERVICE}_{PROPERTY} (e.g., AUTH_JWT_SECRET).
/// </para>
/// </remarks>
[ServiceConfiguration(typeof(AssetService))]
public class AssetServiceConfiguration : IServiceConfiguration
{
    /// <inheritdoc />
    public string? ForceServiceId { get; set; }

    /// <summary>
    /// Storage backend type (minio, s3, r2, azure, filesystem)
    /// Environment variable: ASSET_STORAGE_PROVIDER
    /// </summary>
    public string StorageProvider { get; set; } = "minio";

    /// <summary>
    /// Primary bucket/container name for assets
    /// Environment variable: ASSET_STORAGE_BUCKET
    /// </summary>
    public string StorageBucket { get; set; } = "bannou-assets";

    /// <summary>
    /// Storage endpoint host:port for internal service connections (MinIO/S3 compatible, no http prefix)
    /// Environment variable: ASSET_STORAGE_ENDPOINT
    /// </summary>
    public string StorageEndpoint { get; set; } = "minio:9000";

    /// <summary>
    /// Public endpoint for pre-signed URLs accessible by clients. If not set, uses StorageEndpoint. Use for Docker/K8s where internal hostname differs from public access.
    /// Environment variable: ASSET_STORAGE_PUBLIC_ENDPOINT
    /// </summary>
    public string? StoragePublicEndpoint { get; set; }

    /// <summary>
    /// Storage access key/username
    /// Environment variable: ASSET_STORAGE_ACCESS_KEY
    /// </summary>
    public string StorageAccessKey { get; set; } = "minioadmin";

    /// <summary>
    /// Storage secret key/password
    /// Environment variable: ASSET_STORAGE_SECRET_KEY
    /// </summary>
    public string StorageSecretKey { get; set; } = "minioadmin";

    /// <summary>
    /// Storage region (for S3/R2)
    /// Environment variable: ASSET_STORAGE_REGION
    /// </summary>
    public string StorageRegion { get; set; } = "us-east-1";

    /// <summary>
    /// Force path-style URLs (required for MinIO)
    /// Environment variable: ASSET_STORAGE_FORCE_PATH_STYLE
    /// </summary>
    public bool StorageForcePathStyle { get; set; } = true;

    /// <summary>
    /// Use SSL/TLS for storage connections
    /// Environment variable: ASSET_STORAGE_USE_SSL
    /// </summary>
    public bool StorageUseSsl { get; set; } = false;

    /// <summary>
    /// TTL for pre-signed upload/download URLs in seconds
    /// Environment variable: ASSET_TOKEN_TTL_SECONDS
    /// </summary>
    public int TokenTtlSeconds { get; set; } = 3600;

    /// <summary>
    /// TTL for download URLs (can be shorter than upload)
    /// Environment variable: ASSET_DOWNLOAD_TOKEN_TTL_SECONDS
    /// </summary>
    public int DownloadTokenTtlSeconds { get; set; } = 900;

    /// <summary>
    /// Maximum upload size in megabytes
    /// Environment variable: ASSET_MAX_UPLOAD_SIZE_MB
    /// </summary>
    public int MaxUploadSizeMb { get; set; } = 500;

    /// <summary>
    /// File size threshold for multipart uploads in megabytes
    /// Environment variable: ASSET_MULTIPART_THRESHOLD_MB
    /// </summary>
    public int MultipartThresholdMb { get; set; } = 50;

    /// <summary>
    /// Size of each part in multipart uploads in megabytes
    /// Environment variable: ASSET_MULTIPART_PART_SIZE_MB
    /// </summary>
    public int MultipartPartSizeMb { get; set; } = 16;

    /// <summary>
    /// Maximum number of asset IDs allowed in a single bundle resolution request
    /// Environment variable: ASSET_MAX_RESOLUTION_ASSETS
    /// </summary>
    public int MaxResolutionAssets { get; set; } = 500;

    /// <summary>
    /// Maximum number of asset IDs allowed in a single bulk get request
    /// Environment variable: ASSET_MAX_BULK_GET_ASSETS
    /// </summary>
    public int MaxBulkGetAssets { get; set; } = 100;

    /// <summary>
    /// File size threshold for delegating to processing pool
    /// Environment variable: ASSET_LARGE_FILE_THRESHOLD_MB
    /// </summary>
    public int LargeFileThresholdMb { get; set; } = 50;

    /// <summary>
    /// Processing pool identifier for orchestrator
    /// Environment variable: ASSET_PROCESSING_POOL_TYPE
    /// </summary>
    public string ProcessingPoolType { get; set; } = "asset-processor";

    /// <summary>
    /// Service mode (api, worker, both)
    /// Environment variable: ASSET_PROCESSING_MODE
    /// </summary>
    public string ProcessingMode { get; set; } = "both";

    /// <summary>
    /// Worker pool identifier when running in worker mode
    /// Environment variable: ASSET_WORKER_POOL
    /// </summary>
    public string? WorkerPool { get; set; }

    /// <summary>
    /// Unique processor node ID (set by orchestrator when spawning worker)
    /// Environment variable: ASSET_PROCESSOR_NODE_ID
    /// </summary>
    public string? ProcessorNodeId { get; set; }

    /// <summary>
    /// Seconds of zero-load before auto-termination (0 to disable)
    /// Environment variable: ASSET_PROCESSOR_IDLE_TIMEOUT_SECONDS
    /// </summary>
    public int ProcessorIdleTimeoutSeconds { get; set; } = 300;

    /// <summary>
    /// Heartbeat emission interval in seconds
    /// Environment variable: ASSET_PROCESSOR_HEARTBEAT_INTERVAL_SECONDS
    /// </summary>
    public int ProcessorHeartbeatIntervalSeconds { get; set; } = 30;

    /// <summary>
    /// Maximum concurrent jobs per processor node
    /// Environment variable: ASSET_PROCESSOR_MAX_CONCURRENT_JOBS
    /// </summary>
    public int ProcessorMaxConcurrentJobs { get; set; } = 10;

    /// <summary>
    /// Mark node unhealthy after this many seconds without heartbeat
    /// Environment variable: ASSET_PROCESSOR_HEARTBEAT_TIMEOUT_SECONDS
    /// </summary>
    public int ProcessorHeartbeatTimeoutSeconds { get; set; } = 90;

    /// <summary>
    /// Path to FFmpeg binary (empty = use system PATH)
    /// Environment variable: ASSET_FFMPEG_PATH
    /// </summary>
    public string? FfmpegPath { get; set; }

    /// <summary>
    /// Working directory for FFmpeg temporary files
    /// Environment variable: ASSET_FFMPEG_WORKING_DIR
    /// </summary>
    public string FfmpegWorkingDirectory { get; set; } = "/tmp/bannou-ffmpeg";

    /// <summary>
    /// Default audio output format (mp3, opus, aac)
    /// Environment variable: ASSET_AUDIO_OUTPUT_FORMAT
    /// </summary>
    public string AudioOutputFormat { get; set; } = "mp3";

    /// <summary>
    /// Default audio bitrate in kbps
    /// Environment variable: ASSET_AUDIO_BITRATE_KBPS
    /// </summary>
    public int AudioBitrateKbps { get; set; } = 192;

    /// <summary>
    /// Keep original lossless file alongside transcoded version
    /// Environment variable: ASSET_AUDIO_PRESERVE_LOSSLESS
    /// </summary>
    public bool AudioPreserveLossless { get; set; } = true;

    /// <summary>
    /// Default compression for bundles (lz4, lzma, none)
    /// Environment variable: ASSET_BUNDLE_COMPRESSION_DEFAULT
    /// </summary>
    public string BundleCompressionDefault { get; set; } = "lz4";

    /// <summary>
    /// TTL for cached ZIP conversions in hours
    /// Environment variable: ASSET_ZIP_CACHE_TTL_HOURS
    /// </summary>
    public int ZipCacheTtlHours { get; set; } = 24;

    /// <summary>
    /// Secret for validating MinIO webhook requests
    /// Environment variable: ASSET_MINIO_WEBHOOK_SECRET
    /// </summary>
    public string? MinioWebhookSecret { get; set; }

    /// <summary>
    /// Path prefix for temporary upload staging in storage bucket
    /// Environment variable: ASSET_TEMP_UPLOAD_PATH_PREFIX
    /// </summary>
    public string TempUploadPathPrefix { get; set; } = "temp";

    /// <summary>
    /// Path prefix for final asset storage in bucket
    /// Environment variable: ASSET_FINAL_ASSET_PATH_PREFIX
    /// </summary>
    public string FinalAssetPathPrefix { get; set; } = "assets";

    /// <summary>
    /// Path prefix for finalized bundles in storage bucket
    /// Environment variable: ASSET_BUNDLE_CURRENT_PATH_PREFIX
    /// </summary>
    public string BundleCurrentPathPrefix { get; set; } = "bundles/current";

    /// <summary>
    /// Path prefix for ZIP conversion cache in storage bucket
    /// Environment variable: ASSET_BUNDLE_ZIP_CACHE_PATH_PREFIX
    /// </summary>
    public string BundleZipCachePathPrefix { get; set; } = "bundles/zip-cache";

    /// <summary>
    /// Path prefix for bundle upload staging in storage bucket
    /// Environment variable: ASSET_BUNDLE_UPLOAD_PATH_PREFIX
    /// </summary>
    public string BundleUploadPathPrefix { get; set; } = "bundles/uploads";

    /// <summary>
    /// Maximum seconds to wait for processor availability
    /// Environment variable: ASSET_PROCESSOR_AVAILABILITY_MAX_WAIT_SECONDS
    /// </summary>
    public int ProcessorAvailabilityMaxWaitSeconds { get; set; } = 60;

    /// <summary>
    /// Polling interval in seconds when waiting for processor
    /// Environment variable: ASSET_PROCESSOR_AVAILABILITY_POLL_INTERVAL_SECONDS
    /// </summary>
    public int ProcessorAvailabilityPollIntervalSeconds { get; set; } = 2;

    /// <summary>
    /// Maximum retry attempts for asset processing
    /// Environment variable: ASSET_PROCESSING_MAX_RETRIES
    /// </summary>
    public int ProcessingMaxRetries { get; set; } = 5;

    /// <summary>
    /// Delay in seconds between processing retries
    /// Environment variable: ASSET_PROCESSING_RETRY_DELAY_SECONDS
    /// </summary>
    public int ProcessingRetryDelaySeconds { get; set; } = 30;

    /// <summary>
    /// Name of the state store for asset metadata
    /// Environment variable: ASSET_STATESTORE_NAME
    /// </summary>
    public string StatestoreName { get; set; } = "asset-statestore";

    /// <summary>
    /// Name of the state store for processor pool management
    /// Environment variable: ASSET_PROCESSOR_POOL_STORE_NAME
    /// </summary>
    public string ProcessorPoolStoreName { get; set; } = "asset-processor-pool";

    /// <summary>
    /// Key prefix for upload session entries in state store
    /// Environment variable: ASSET_UPLOAD_SESSION_KEY_PREFIX
    /// </summary>
    public string UploadSessionKeyPrefix { get; set; } = "upload:";

    /// <summary>
    /// Key prefix for asset entries in state store
    /// Environment variable: ASSET_KEY_PREFIX
    /// </summary>
    public string AssetKeyPrefix { get; set; } = "asset:";

    /// <summary>
    /// Key prefix for asset index entries in state store
    /// Environment variable: ASSET_INDEX_KEY_PREFIX
    /// </summary>
    public string AssetIndexKeyPrefix { get; set; } = "asset-index:";

    /// <summary>
    /// Key prefix for bundle entries in state store
    /// Environment variable: ASSET_BUNDLE_KEY_PREFIX
    /// </summary>
    public string BundleKeyPrefix { get; set; } = "bundle:";

    /// <summary>
    /// Pool type name for texture processing
    /// Environment variable: ASSET_TEXTURE_PROCESSOR_POOL_TYPE
    /// </summary>
    public string TextureProcessorPoolType { get; set; } = "texture-processor";

    /// <summary>
    /// Pool type name for 3D model processing
    /// Environment variable: ASSET_MODEL_PROCESSOR_POOL_TYPE
    /// </summary>
    public string ModelProcessorPoolType { get; set; } = "model-processor";

    /// <summary>
    /// Pool type name for audio processing
    /// Environment variable: ASSET_AUDIO_PROCESSOR_POOL_TYPE
    /// </summary>
    public string AudioProcessorPoolType { get; set; } = "audio-processor";

    /// <summary>
    /// Default pool type name for general asset processing
    /// Environment variable: ASSET_DEFAULT_PROCESSOR_POOL_TYPE
    /// </summary>
    public string DefaultProcessorPoolType { get; set; } = "asset-processor";

    /// <summary>
    /// Comma-separated list of additional processable content types beyond defaults
    /// Environment variable: ASSET_ADDITIONAL_PROCESSABLE_CONTENT_TYPES
    /// </summary>
    public string? AdditionalProcessableContentTypes { get; set; }

    /// <summary>
    /// Comma-separated ext=type pairs for additional extension mappings (e.g., ".ktx=image/ktx")
    /// Environment variable: ASSET_ADDITIONAL_EXTENSION_MAPPINGS
    /// </summary>
    public string? AdditionalExtensionMappings { get; set; }

    /// <summary>
    /// Comma-separated list of additional forbidden content types
    /// Environment variable: ASSET_ADDITIONAL_FORBIDDEN_CONTENT_TYPES
    /// </summary>
    public string? AdditionalForbiddenContentTypes { get; set; }

}
