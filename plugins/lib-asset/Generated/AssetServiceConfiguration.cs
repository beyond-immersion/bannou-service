//----------------------
// <auto-generated>
//     Generated from OpenAPI schema: schemas/asset-configuration.yaml
//
//     WARNING: DO NOT EDIT THIS FILE (FOUNDATION TENETS)
//     This file is auto-generated from configuration schema.
//     Any manual changes will be overwritten on next generation.
//
//     To add/modify configuration:
//     1. Edit the source schema (schemas/asset-configuration.yaml)
//     2. Run: scripts/generate-all-services.sh
//
//     IMPLEMENTATION TENETS - Configuration-First:
//     - Access configuration via dependency injection, never Environment.GetEnvironmentVariable.
//     - ALL properties below MUST be referenced somewhere in the plugin (no dead config).
//     - Any hardcoded tunable (limit, timeout, threshold, capacity) in service code means
//       a configuration property is MISSING - add it to the configuration schema.
//     - If a property is unused, remove it from the configuration schema.
//
//     Example: public MyService(AssetServiceConfiguration config) { _config = config; }
//
//     See: docs/reference/tenets/IMPLEMENTATION.md (Configuration-First, Internal Model Type Safety)
// </auto-generated>
//----------------------

using System.ComponentModel.DataAnnotations;
using BeyondImmersion.BannouService;
using BeyondImmersion.BannouService.Attributes;
using BeyondImmersion.BannouService.Configuration;

#nullable enable

namespace BeyondImmersion.BannouService.Asset;


#pragma warning disable CS1591 // Missing XML comment for publicly visible type or member
/// <summary>
/// Storage backend type
/// </summary>
public enum StorageProvider
{
    Minio,
    S3,
    R2,
    Azure,
    Filesystem,
}
#pragma warning restore CS1591


#pragma warning disable CS1591 // Missing XML comment for publicly visible type or member
/// <summary>
/// Service mode
/// </summary>
public enum ProcessingMode
{
    Api,
    Worker,
    Both,
}
#pragma warning restore CS1591


#pragma warning disable CS1591 // Missing XML comment for publicly visible type or member
/// <summary>
/// Default audio output format
/// </summary>
public enum AudioOutputFormat
{
    Mp3,
    Opus,
    Aac,
}
#pragma warning restore CS1591

/// <summary>
/// Configuration class for Asset service.
/// Properties are automatically bound from environment variables.
/// </summary>
/// <remarks>
/// <para>
/// <b>IMPLEMENTATION TENETS - Configuration-First:</b> Access configuration via dependency injection.
/// Never use <c>Environment.GetEnvironmentVariable()</c> directly in service code.
/// ALL properties in this class MUST be referenced somewhere in the plugin.
/// If a property is unused, remove it from the configuration schema.
/// </para>
/// <para>
/// Environment variable names follow the pattern: {SERVICE}_{PROPERTY} (e.g., AUTH_JWT_SECRET).
/// </para>
/// </remarks>
[ServiceConfiguration(typeof(AssetService))]
public class AssetServiceConfiguration : IServiceConfiguration
{
    /// <inheritdoc />
    public Guid? ForceServiceId { get; set; }

    /// <summary>
    /// Storage backend type
    /// Environment variable: ASSET_STORAGE_PROVIDER
    /// </summary>
    public StorageProvider StorageProvider { get; set; } = StorageProvider.Minio;

    /// <summary>
    /// Primary bucket/container name for assets
    /// Environment variable: ASSET_STORAGE_BUCKET
    /// </summary>
    public string StorageBucket { get; set; } = "bannou-assets";

    /// <summary>
    /// Storage endpoint host:port for internal service connections (MinIO/S3 compatible, no http prefix)
    /// Environment variable: ASSET_STORAGE_ENDPOINT
    /// </summary>
    public string StorageEndpoint { get; set; } = "minio:9000";

    /// <summary>
    /// Public endpoint for pre-signed URLs accessible by clients. If not set, uses StorageEndpoint. Use for Docker/K8s where internal hostname differs from public access.
    /// Environment variable: ASSET_STORAGE_PUBLIC_ENDPOINT
    /// </summary>
    public string? StoragePublicEndpoint { get; set; }

    /// <summary>
    /// Storage access key/username
    /// Environment variable: ASSET_STORAGE_ACCESS_KEY
    /// </summary>
    public string StorageAccessKey { get; set; } = "minioadmin";

    /// <summary>
    /// Storage secret key/password
    /// Environment variable: ASSET_STORAGE_SECRET_KEY
    /// </summary>
    public string StorageSecretKey { get; set; } = "minioadmin";

    /// <summary>
    /// Storage region (for S3/R2)
    /// Environment variable: ASSET_STORAGE_REGION
    /// </summary>
    public string StorageRegion { get; set; } = "us-east-1";

    /// <summary>
    /// Force path-style URLs (required for MinIO)
    /// Environment variable: ASSET_STORAGE_FORCE_PATH_STYLE
    /// </summary>
    public bool StorageForcePathStyle { get; set; } = true;

    /// <summary>
    /// Use SSL/TLS for storage connections
    /// Environment variable: ASSET_STORAGE_USE_SSL
    /// </summary>
    public bool StorageUseSsl { get; set; } = false;

    /// <summary>
    /// TTL for pre-signed upload/download URLs in seconds
    /// Environment variable: ASSET_TOKEN_TTL_SECONDS
    /// </summary>
    public int TokenTtlSeconds { get; set; } = 3600;

    /// <summary>
    /// TTL for download URLs (can be shorter than upload)
    /// Environment variable: ASSET_DOWNLOAD_TOKEN_TTL_SECONDS
    /// </summary>
    public int DownloadTokenTtlSeconds { get; set; } = 900;

    /// <summary>
    /// Maximum upload size in megabytes
    /// Environment variable: ASSET_MAX_UPLOAD_SIZE_MB
    /// </summary>
    public int MaxUploadSizeMb { get; set; } = 500;

    /// <summary>
    /// File size threshold for multipart uploads in megabytes
    /// Environment variable: ASSET_MULTIPART_THRESHOLD_MB
    /// </summary>
    public int MultipartThresholdMb { get; set; } = 50;

    /// <summary>
    /// Size of each part in multipart uploads in megabytes
    /// Environment variable: ASSET_MULTIPART_PART_SIZE_MB
    /// </summary>
    public int MultipartPartSizeMb { get; set; } = 16;

    /// <summary>
    /// Maximum number of asset IDs allowed in a single bundle resolution request
    /// Environment variable: ASSET_MAX_RESOLUTION_ASSETS
    /// </summary>
    public int MaxResolutionAssets { get; set; } = 500;

    /// <summary>
    /// Maximum number of asset IDs allowed in a single bulk get request
    /// Environment variable: ASSET_MAX_BULK_GET_ASSETS
    /// </summary>
    public int MaxBulkGetAssets { get; set; } = 100;

    /// <summary>
    /// File size threshold for delegating to processing pool
    /// Environment variable: ASSET_LARGE_FILE_THRESHOLD_MB
    /// </summary>
    public int LargeFileThresholdMb { get; set; } = 50;

    /// <summary>
    /// Processing pool identifier for orchestrator
    /// Environment variable: ASSET_PROCESSING_POOL_TYPE
    /// </summary>
    public string ProcessingPoolType { get; set; } = "asset-processor";

    /// <summary>
    /// Service mode
    /// Environment variable: ASSET_PROCESSING_MODE
    /// </summary>
    public ProcessingMode ProcessingMode { get; set; } = ProcessingMode.Both;

    /// <summary>
    /// Worker pool identifier when running in worker mode
    /// Environment variable: ASSET_WORKER_POOL
    /// </summary>
    public string? WorkerPool { get; set; }

    /// <summary>
    /// Unique processor node ID (set by orchestrator when spawning worker)
    /// Environment variable: ASSET_PROCESSOR_NODE_ID
    /// </summary>
    public string? ProcessorNodeId { get; set; }

    /// <summary>
    /// Seconds of zero-load before auto-termination (0 to disable)
    /// Environment variable: ASSET_PROCESSOR_IDLE_TIMEOUT_SECONDS
    /// </summary>
    public int ProcessorIdleTimeoutSeconds { get; set; } = 300;

    /// <summary>
    /// Heartbeat emission interval in seconds
    /// Environment variable: ASSET_PROCESSOR_HEARTBEAT_INTERVAL_SECONDS
    /// </summary>
    public int ProcessorHeartbeatIntervalSeconds { get; set; } = 30;

    /// <summary>
    /// Maximum concurrent jobs per processor node
    /// Environment variable: ASSET_PROCESSOR_MAX_CONCURRENT_JOBS
    /// </summary>
    public int ProcessorMaxConcurrentJobs { get; set; } = 10;

    /// <summary>
    /// Mark node unhealthy after this many seconds without heartbeat
    /// Environment variable: ASSET_PROCESSOR_HEARTBEAT_TIMEOUT_SECONDS
    /// </summary>
    public int ProcessorHeartbeatTimeoutSeconds { get; set; } = 90;

    /// <summary>
    /// Path to FFmpeg binary (empty = use system PATH)
    /// Environment variable: ASSET_FFMPEG_PATH
    /// </summary>
    public string? FfmpegPath { get; set; }

    /// <summary>
    /// Working directory for FFmpeg temporary files
    /// Environment variable: ASSET_FFMPEG_WORKING_DIR
    /// </summary>
    public string FfmpegWorkingDirectory { get; set; } = "/tmp/bannou-ffmpeg";

    /// <summary>
    /// Default audio output format
    /// Environment variable: ASSET_AUDIO_OUTPUT_FORMAT
    /// </summary>
    public AudioOutputFormat AudioOutputFormat { get; set; } = AudioOutputFormat.Mp3;

    /// <summary>
    /// Default audio bitrate in kbps
    /// Environment variable: ASSET_AUDIO_BITRATE_KBPS
    /// </summary>
    public int AudioBitrateKbps { get; set; } = 192;

    /// <summary>
    /// Keep original lossless file alongside transcoded version
    /// Environment variable: ASSET_AUDIO_PRESERVE_LOSSLESS
    /// </summary>
    public bool AudioPreserveLossless { get; set; } = true;

    /// <summary>
    /// Default compression for bundles
    /// Environment variable: ASSET_BUNDLE_COMPRESSION_DEFAULT
    /// </summary>
    public CompressionType BundleCompressionDefault { get; set; } = CompressionType.Lz4;

    /// <summary>
    /// TTL for cached ZIP conversions in hours
    /// Environment variable: ASSET_ZIP_CACHE_TTL_HOURS
    /// </summary>
    public int ZipCacheTtlHours { get; set; } = 24;

    /// <summary>
    /// Number of days to retain soft-deleted bundles before permanent removal. Set to 0 for immediate deletion.
    /// Environment variable: ASSET_DELETED_BUNDLE_RETENTION_DAYS
    /// </summary>
    public int DeletedBundleRetentionDays { get; set; } = 30;

    /// <summary>
    /// Secret for validating MinIO webhook requests
    /// Environment variable: ASSET_MINIO_WEBHOOK_SECRET
    /// </summary>
    public string? MinioWebhookSecret { get; set; }

    /// <summary>
    /// Path prefix for temporary upload staging in storage bucket
    /// Environment variable: ASSET_TEMP_UPLOAD_PATH_PREFIX
    /// </summary>
    public string TempUploadPathPrefix { get; set; } = "temp";

    /// <summary>
    /// Path prefix for final asset storage in bucket
    /// Environment variable: ASSET_FINAL_ASSET_PATH_PREFIX
    /// </summary>
    public string FinalAssetPathPrefix { get; set; } = "assets";

    /// <summary>
    /// Path prefix for finalized bundles in storage bucket
    /// Environment variable: ASSET_BUNDLE_CURRENT_PATH_PREFIX
    /// </summary>
    public string BundleCurrentPathPrefix { get; set; } = "bundles/current";

    /// <summary>
    /// Path prefix for ZIP conversion cache in storage bucket
    /// Environment variable: ASSET_BUNDLE_ZIP_CACHE_PATH_PREFIX
    /// </summary>
    public string BundleZipCachePathPrefix { get; set; } = "bundles/zip-cache";

    /// <summary>
    /// Path prefix for bundle upload staging in storage bucket
    /// Environment variable: ASSET_BUNDLE_UPLOAD_PATH_PREFIX
    /// </summary>
    public string BundleUploadPathPrefix { get; set; } = "bundles/uploads";

    /// <summary>
    /// Maximum seconds to wait for processor availability
    /// Environment variable: ASSET_PROCESSOR_AVAILABILITY_MAX_WAIT_SECONDS
    /// </summary>
    public int ProcessorAvailabilityMaxWaitSeconds { get; set; } = 60;

    /// <summary>
    /// Polling interval in seconds when waiting for processor
    /// Environment variable: ASSET_PROCESSOR_AVAILABILITY_POLL_INTERVAL_SECONDS
    /// </summary>
    public int ProcessorAvailabilityPollIntervalSeconds { get; set; } = 2;

    /// <summary>
    /// Maximum retry attempts for asset processing
    /// Environment variable: ASSET_PROCESSING_MAX_RETRIES
    /// </summary>
    public int ProcessingMaxRetries { get; set; } = 5;

    /// <summary>
    /// Delay in seconds between processing retries
    /// Environment variable: ASSET_PROCESSING_RETRY_DELAY_SECONDS
    /// </summary>
    public int ProcessingRetryDelaySeconds { get; set; } = 30;

    /// <summary>
    /// Key prefix for upload session entries in state store
    /// Environment variable: ASSET_UPLOAD_SESSION_KEY_PREFIX
    /// </summary>
    public string UploadSessionKeyPrefix { get; set; } = "upload:";

    /// <summary>
    /// Key prefix for asset entries in state store
    /// Environment variable: ASSET_KEY_PREFIX
    /// </summary>
    public string AssetKeyPrefix { get; set; } = "asset:";

    /// <summary>
    /// Key prefix for asset index entries in state store
    /// Environment variable: ASSET_INDEX_KEY_PREFIX
    /// </summary>
    public string AssetIndexKeyPrefix { get; set; } = "asset-index:";

    /// <summary>
    /// Key prefix for bundle entries in state store
    /// Environment variable: ASSET_BUNDLE_KEY_PREFIX
    /// </summary>
    public string BundleKeyPrefix { get; set; } = "bundle:";

    /// <summary>
    /// Pool type name for texture processing
    /// Environment variable: ASSET_TEXTURE_PROCESSOR_POOL_TYPE
    /// </summary>
    public string TextureProcessorPoolType { get; set; } = "texture-processor";

    /// <summary>
    /// Pool type name for 3D model processing
    /// Environment variable: ASSET_MODEL_PROCESSOR_POOL_TYPE
    /// </summary>
    public string ModelProcessorPoolType { get; set; } = "model-processor";

    /// <summary>
    /// Pool type name for audio processing
    /// Environment variable: ASSET_AUDIO_PROCESSOR_POOL_TYPE
    /// </summary>
    public string AudioProcessorPoolType { get; set; } = "audio-processor";

    /// <summary>
    /// Default pool type name for general asset processing
    /// Environment variable: ASSET_DEFAULT_PROCESSOR_POOL_TYPE
    /// </summary>
    public string DefaultProcessorPoolType { get; set; } = "asset-processor";

    /// <summary>
    /// Comma-separated list of additional processable content types beyond defaults
    /// Environment variable: ASSET_ADDITIONAL_PROCESSABLE_CONTENT_TYPES
    /// </summary>
    public string? AdditionalProcessableContentTypes { get; set; }

    /// <summary>
    /// Comma-separated ext=type pairs for additional extension mappings (e.g., ".ktx=image/ktx")
    /// Environment variable: ASSET_ADDITIONAL_EXTENSION_MAPPINGS
    /// </summary>
    public string? AdditionalExtensionMappings { get; set; }

    /// <summary>
    /// Comma-separated list of additional forbidden content types
    /// Environment variable: ASSET_ADDITIONAL_FORBIDDEN_CONTENT_TYPES
    /// </summary>
    public string? AdditionalForbiddenContentTypes { get; set; }

    /// <summary>
    /// Maximum retry attempts for optimistic concurrency index updates
    /// Environment variable: ASSET_INDEX_OPTIMISTIC_RETRY_MAX_ATTEMPTS
    /// </summary>
    public int IndexOptimisticRetryMaxAttempts { get; set; } = 5;

    /// <summary>
    /// Base delay in milliseconds between optimistic retry attempts (multiplied by attempt number)
    /// Environment variable: ASSET_INDEX_OPTIMISTIC_RETRY_BASE_DELAY_MS
    /// </summary>
    public int IndexOptimisticRetryBaseDelayMs { get; set; } = 10;

    /// <summary>
    /// Number of source bundles that triggers async processing. Jobs with fewer bundles process synchronously.
    /// Environment variable: ASSET_METABUNDLE_ASYNC_SOURCE_BUNDLE_THRESHOLD
    /// </summary>
    public int MetabundleAsyncSourceBundleThreshold { get; set; } = 3;

    /// <summary>
    /// Total asset count that triggers async processing. Jobs with fewer assets process synchronously.
    /// Environment variable: ASSET_METABUNDLE_ASYNC_ASSET_COUNT_THRESHOLD
    /// </summary>
    public int MetabundleAsyncAssetCountThreshold { get; set; } = 50;

    /// <summary>
    /// Estimated total size in bytes that triggers async processing. Default 100MB.
    /// Environment variable: ASSET_METABUNDLE_ASYNC_SIZE_BYTES_THRESHOLD
    /// </summary>
    public int MetabundleAsyncSizeBytesThreshold { get; set; } = 104857600;

    /// <summary>
    /// How long job status records are retained after completion (for polling)
    /// Environment variable: ASSET_METABUNDLE_JOB_TTL_SECONDS
    /// </summary>
    public int MetabundleJobTtlSeconds { get; set; } = 86400;

    /// <summary>
    /// Key prefix for metabundle job entries in state store
    /// Environment variable: ASSET_METABUNDLE_JOB_KEY_PREFIX
    /// </summary>
    public string MetabundleJobKeyPrefix { get; set; } = "metabundle-job:";

    /// <summary>
    /// Maximum time for a metabundle job before marking as failed
    /// Environment variable: ASSET_METABUNDLE_JOB_TIMEOUT_SECONDS
    /// </summary>
    public int MetabundleJobTimeoutSeconds { get; set; } = 3600;

    /// <summary>
    /// Maximum memory in MB for streaming operations. Limits total buffer allocation during streaming metabundle assembly.
    /// Environment variable: ASSET_STREAMING_MAX_MEMORY_MB
    /// </summary>
    public int StreamingMaxMemoryMb { get; set; } = 100;

    /// <summary>
    /// Size of each part in MB for streaming multipart uploads. S3/MinIO requires minimum 5MB per part except for the last part.
    /// Environment variable: ASSET_STREAMING_PART_SIZE_MB
    /// </summary>
    public int StreamingPartSizeMb { get; set; } = 50;

    /// <summary>
    /// Maximum number of source bundles to stream concurrently during metabundle assembly. Higher values use more memory but improve throughput.
    /// Environment variable: ASSET_STREAMING_MAX_CONCURRENT_SOURCE_STREAMS
    /// </summary>
    public int StreamingMaxConcurrentSourceStreams { get; set; } = 2;

    /// <summary>
    /// Size of compression buffer in KB for LZ4 streaming compression. Larger buffers improve compression ratio but use more memory.
    /// Environment variable: ASSET_STREAMING_COMPRESSION_BUFFER_KB
    /// </summary>
    public int StreamingCompressionBufferKb { get; set; } = 16384;

    /// <summary>
    /// Number of assets to process before updating job progress. Lower values give more frequent updates but add overhead.
    /// Environment variable: ASSET_STREAMING_PROGRESS_UPDATE_INTERVAL_ASSETS
    /// </summary>
    public int StreamingProgressUpdateIntervalAssets { get; set; } = 10;

    /// <summary>
    /// Maximum seconds to wait for a synchronous processing job to complete
    /// Environment variable: ASSET_PROCESSING_JOB_MAX_WAIT_SECONDS
    /// </summary>
    public int ProcessingJobMaxWaitSeconds { get; set; } = 60;

    /// <summary>
    /// Interval in seconds to check processing queue when no jobs are available
    /// Environment variable: ASSET_PROCESSING_QUEUE_CHECK_INTERVAL_SECONDS
    /// </summary>
    public int ProcessingQueueCheckIntervalSeconds { get; set; } = 30;

    /// <summary>
    /// Delay in seconds between batch processing attempts
    /// Environment variable: ASSET_PROCESSING_BATCH_INTERVAL_SECONDS
    /// </summary>
    public int ProcessingBatchIntervalSeconds { get; set; } = 5;

    /// <summary>
    /// Maximum minutes to allow queue draining during graceful shutdown
    /// Environment variable: ASSET_SHUTDOWN_DRAIN_TIMEOUT_MINUTES
    /// </summary>
    public int ShutdownDrainTimeoutMinutes { get; set; } = 2;

    /// <summary>
    /// Interval in seconds between shutdown drain checks
    /// Environment variable: ASSET_SHUTDOWN_DRAIN_INTERVAL_SECONDS
    /// </summary>
    public int ShutdownDrainIntervalSeconds { get; set; } = 2;

    /// <summary>
    /// Default TTL in hours for bundle cache entries
    /// Environment variable: ASSET_DEFAULT_BUNDLE_CACHE_TTL_HOURS
    /// </summary>
    public int DefaultBundleCacheTtlHours { get; set; } = 24;

}
