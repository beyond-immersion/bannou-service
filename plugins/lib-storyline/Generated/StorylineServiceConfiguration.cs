//----------------------
// <auto-generated>
//     Generated from OpenAPI schema: schemas/storyline-configuration.yaml
//
//     WARNING: DO NOT EDIT THIS FILE (FOUNDATION TENETS)
//     This file is auto-generated from configuration schema.
//     Any manual changes will be overwritten on next generation.
//
//     To add/modify configuration:
//     1. Edit the source schema (schemas/storyline-configuration.yaml)
//     2. Run: scripts/generate-all-services.sh
//
//     IMPLEMENTATION TENETS - Configuration-First:
//     - Access configuration via dependency injection, never Environment.GetEnvironmentVariable.
//     - ALL properties below MUST be referenced in StorylineService.cs (no dead config).
//     - Any hardcoded tunable (limit, timeout, threshold, capacity) in service code means
//       a configuration property is MISSING - add it to the configuration schema.
//     - If a property is unused, remove it from the configuration schema.
//
//     Example: public MyService(StorylineServiceConfiguration config) { _config = config; }
//
//     See: docs/reference/tenets/IMPLEMENTATION.md (Configuration-First, Internal Model Type Safety)
// </auto-generated>
//----------------------

using System.ComponentModel.DataAnnotations;
using BeyondImmersion.BannouService;
using BeyondImmersion.BannouService.Attributes;
using BeyondImmersion.BannouService.Configuration;
using BeyondImmersion.Bannou.StorylineStoryteller.Planning;

#nullable enable

namespace BeyondImmersion.BannouService.Storyline;

/// <summary>
/// Configuration class for Storyline service.
/// Properties are automatically bound from environment variables.
/// </summary>
/// <remarks>
/// <para>
/// <b>IMPLEMENTATION TENETS - Configuration-First:</b> Access configuration via dependency injection.
/// Never use <c>Environment.GetEnvironmentVariable()</c> directly in service code.
/// ALL properties in this class MUST be referenced in the service implementation.
/// If a property is unused, remove it from the configuration schema.
/// </para>
/// <para>
/// Environment variable names follow the pattern: {SERVICE}_{PROPERTY} (e.g., AUTH_JWT_SECRET).
/// </para>
/// </remarks>
[ServiceConfiguration(typeof(StorylineService))]
public class StorylineServiceConfiguration : IServiceConfiguration
{
    /// <inheritdoc />
    public Guid? ForceServiceId { get; set; }

    /// <summary>
    /// TTL in seconds for cached composed plans.
    /// Default: 3600 (1 hour)
    /// Environment variable: STORYLINE_PLAN_CACHE_TTL_SECONDS
    /// </summary>
    [ConfigRange(Minimum = 60, Maximum = 86400)]
    public int PlanCacheTtlSeconds { get; set; } = 3600;

    /// <summary>
    /// Default urgency tier for GOAP planning.
    /// low = more iterations (1000/20)
    /// medium = balanced (500/15)
    /// high = fewer iterations (200/10)
    /// Environment variable: STORYLINE_DEFAULT_PLANNING_URGENCY
    /// </summary>
    public PlanningUrgency DefaultPlanningUrgency { get; set; } = PlanningUrgency.Medium;

    /// <summary>
    /// Whether to cache deterministic plans (those with explicit seed).
    /// Disable for testing or when cache overhead is undesirable.
    /// Environment variable: STORYLINE_PLAN_CACHE_ENABLED
    /// </summary>
    public bool PlanCacheEnabled { get; set; } = true;

    /// <summary>
    /// Default genre when not specified and cannot be inferred.
    /// Environment variable: STORYLINE_DEFAULT_GENRE
    /// </summary>
    public string DefaultGenre { get; set; } = "drama";

    /// <summary>
    /// Maximum number of seed sources per compose request.
    /// Environment variable: STORYLINE_MAX_SEED_SOURCES
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 20)]
    public int MaxSeedSources { get; set; } = 10;

    /// <summary>
    /// Base confidence score before any bonuses are applied.
    /// Environment variable: STORYLINE_CONFIDENCE_BASE_SCORE
    /// </summary>
    [ConfigRange(Minimum = 0, Maximum = 1)]
    public double ConfidenceBaseScore { get; set; } = 0.5;

    /// <summary>
    /// Minimum number of phases to receive a phase count bonus.
    /// Environment variable: STORYLINE_CONFIDENCE_PHASE_THRESHOLD
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 10)]
    public int ConfidencePhaseThreshold { get; set; } = 3;

    /// <summary>
    /// Confidence bonus when phase threshold is met.
    /// Environment variable: STORYLINE_CONFIDENCE_PHASE_BONUS
    /// </summary>
    [ConfigRange(Minimum = 0, Maximum = 0.5)]
    public double ConfidencePhaseBonus { get; set; } = 0.2;

    /// <summary>
    /// Confidence bonus when plan contains core events.
    /// Environment variable: STORYLINE_CONFIDENCE_CORE_EVENT_BONUS
    /// </summary>
    [ConfigRange(Minimum = 0, Maximum = 0.5)]
    public double ConfidenceCoreEventBonus { get; set; } = 0.15;

    /// <summary>
    /// Confidence bonus when action count is within acceptable range.
    /// Environment variable: STORYLINE_CONFIDENCE_ACTION_COUNT_BONUS
    /// </summary>
    [ConfigRange(Minimum = 0, Maximum = 0.5)]
    public double ConfidenceActionCountBonus { get; set; } = 0.15;

    /// <summary>
    /// Minimum action count for action count bonus.
    /// Environment variable: STORYLINE_CONFIDENCE_MIN_ACTION_COUNT
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 50)]
    public int ConfidenceMinActionCount { get; set; } = 5;

    /// <summary>
    /// Maximum action count for action count bonus.
    /// Environment variable: STORYLINE_CONFIDENCE_MAX_ACTION_COUNT
    /// </summary>
    [ConfigRange(Minimum = 5, Maximum = 100)]
    public int ConfidenceMaxActionCount { get; set; } = 20;

    /// <summary>
    /// Minimum action count before "thin_content" risk is flagged.
    /// Environment variable: STORYLINE_RISK_MIN_ACTION_THRESHOLD
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 20)]
    public int RiskMinActionThreshold { get; set; } = 3;

    /// <summary>
    /// Minimum phase count before "flat_arc" risk is flagged.
    /// Environment variable: STORYLINE_RISK_MIN_PHASE_THRESHOLD
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 10)]
    public int RiskMinPhaseThreshold { get; set; } = 2;

}
