//----------------------
// <auto-generated>
//     Generated from OpenAPI schema: schemas/auth-configuration.yaml
//
//     WARNING: DO NOT EDIT THIS FILE (FOUNDATION TENETS)
//     This file is auto-generated from configuration schema.
//     Any manual changes will be overwritten on next generation.
//
//     To add/modify configuration:
//     1. Edit the source schema (schemas/auth-configuration.yaml)
//     2. Run: scripts/generate-all-services.sh
//
//     IMPLEMENTATION TENETS - Configuration-First:
//     - Access configuration via dependency injection, never Environment.GetEnvironmentVariable.
//     - ALL properties below MUST be referenced in AuthService.cs (no dead config).
//     - Any hardcoded tunable (limit, timeout, threshold, capacity) in service code means
//       a configuration property is MISSING - add it to the configuration schema.
//     - If a property is unused, remove it from the configuration schema.
//
//     Example: public MyService(AuthServiceConfiguration config) { _config = config; }
//
//     See: docs/reference/tenets/IMPLEMENTATION.md (Configuration-First, Internal Model Type Safety)
// </auto-generated>
//----------------------

using System.ComponentModel.DataAnnotations;
using BeyondImmersion.BannouService;
using BeyondImmersion.BannouService.Attributes;
using BeyondImmersion.BannouService.Configuration;

#nullable enable

namespace BeyondImmersion.BannouService.Auth;

/// <summary>
/// Configuration class for Auth service.
/// Properties are automatically bound from environment variables.
/// </summary>
/// <remarks>
/// <para>
/// <b>IMPLEMENTATION TENETS - Configuration-First:</b> Access configuration via dependency injection.
/// Never use <c>Environment.GetEnvironmentVariable()</c> directly in service code.
/// ALL properties in this class MUST be referenced in the service implementation.
/// If a property is unused, remove it from the configuration schema.
/// </para>
/// <para>
/// Environment variable names follow the pattern: {SERVICE}_{PROPERTY} (e.g., AUTH_JWT_SECRET).
/// </para>
/// </remarks>
[ServiceConfiguration(typeof(AuthService))]
public class AuthServiceConfiguration : IServiceConfiguration
{
    /// <inheritdoc />
    public Guid? ForceServiceId { get; set; }

    /// <summary>
    /// JWT token expiration time in minutes
    /// Environment variable: AUTH_JWT_EXPIRATION_MINUTES
    /// </summary>
    public int JwtExpirationMinutes { get; set; } = 60;

    /// <summary>
    /// URL to Connect service for WebSocket connections. Defaults to wss://{BANNOU_SERVICE_DOMAIN}/connect if domain set, else ws://localhost:5014/connect.
    /// Environment variable: AUTH_CONNECT_URL
    /// </summary>
    public string ConnectUrl { get; set; } = "ws://localhost:5014/connect";

    /// <summary>
    /// Enable mock OAuth providers for testing
    /// Environment variable: AUTH_MOCK_PROVIDERS
    /// </summary>
    public bool MockProviders { get; set; } = false;

    /// <summary>
    /// Mock Discord user ID for testing
    /// Environment variable: AUTH_MOCK_DISCORD_ID
    /// </summary>
    public string MockDiscordId { get; set; } = "mock-discord-123456";

    /// <summary>
    /// Mock Google user ID for testing
    /// Environment variable: AUTH_MOCK_GOOGLE_ID
    /// </summary>
    public string MockGoogleId { get; set; } = "mock-google-123456";

    /// <summary>
    /// Mock Twitch user ID for testing
    /// Environment variable: AUTH_MOCK_TWITCH_ID
    /// </summary>
    public string MockTwitchId { get; set; } = "mock-twitch-123456";

    /// <summary>
    /// Mock Steam user ID for testing
    /// Environment variable: AUTH_MOCK_STEAM_ID
    /// </summary>
    public string MockSteamId { get; set; } = "76561198000000000";

    /// <summary>
    /// Discord OAuth client ID
    /// Environment variable: AUTH_DISCORD_CLIENT_ID
    /// </summary>
    public string? DiscordClientId { get; set; }

    /// <summary>
    /// Discord OAuth client secret
    /// Environment variable: AUTH_DISCORD_CLIENT_SECRET
    /// </summary>
    public string? DiscordClientSecret { get; set; }

    /// <summary>
    /// Discord OAuth redirect URI. Optional if BANNOU_SERVICE_DOMAIN is set (defaults to https://{domain}/auth/oauth/discord/callback).
    /// Environment variable: AUTH_DISCORD_REDIRECT_URI
    /// </summary>
    public string? DiscordRedirectUri { get; set; }

    /// <summary>
    /// Google OAuth client ID
    /// Environment variable: AUTH_GOOGLE_CLIENT_ID
    /// </summary>
    public string? GoogleClientId { get; set; }

    /// <summary>
    /// Google OAuth client secret
    /// Environment variable: AUTH_GOOGLE_CLIENT_SECRET
    /// </summary>
    public string? GoogleClientSecret { get; set; }

    /// <summary>
    /// Google OAuth redirect URI. Optional if BANNOU_SERVICE_DOMAIN is set (defaults to https://{domain}/auth/oauth/google/callback).
    /// Environment variable: AUTH_GOOGLE_REDIRECT_URI
    /// </summary>
    public string? GoogleRedirectUri { get; set; }

    /// <summary>
    /// Twitch OAuth client ID
    /// Environment variable: AUTH_TWITCH_CLIENT_ID
    /// </summary>
    public string? TwitchClientId { get; set; }

    /// <summary>
    /// Twitch OAuth client secret
    /// Environment variable: AUTH_TWITCH_CLIENT_SECRET
    /// </summary>
    public string? TwitchClientSecret { get; set; }

    /// <summary>
    /// Twitch OAuth redirect URI. Optional if BANNOU_SERVICE_DOMAIN is set (defaults to https://{domain}/auth/oauth/twitch/callback).
    /// Environment variable: AUTH_TWITCH_REDIRECT_URI
    /// </summary>
    public string? TwitchRedirectUri { get; set; }

    /// <summary>
    /// Steam Web API key for session ticket validation
    /// Environment variable: AUTH_STEAM_API_KEY
    /// </summary>
    public string? SteamApiKey { get; set; }

    /// <summary>
    /// Steam application ID
    /// Environment variable: AUTH_STEAM_APP_ID
    /// </summary>
    public string? SteamAppId { get; set; }

    /// <summary>
    /// Email delivery provider (none=console logging, sendgrid=SendGrid API, smtp=SMTP via MailKit, ses=AWS SES v2)
    /// Environment variable: AUTH_EMAIL_PROVIDER
    /// </summary>
    public EmailProvider EmailProvider { get; set; } = EmailProvider.None;

    /// <summary>
    /// Sender email address for outgoing emails. Required when EmailProvider is not 'none'.
    /// Environment variable: AUTH_EMAIL_FROM_ADDRESS
    /// </summary>
    public string? EmailFromAddress { get; set; }

    /// <summary>
    /// Display name for the sender in outgoing emails (e.g., 'Bannou Support'). Optional.
    /// Environment variable: AUTH_EMAIL_FROM_NAME
    /// </summary>
    public string? EmailFromName { get; set; }

    /// <summary>
    /// SendGrid API key. Required when EmailProvider is 'sendgrid'.
    /// Environment variable: AUTH_SENDGRID_API_KEY
    /// </summary>
    public string? SendGridApiKey { get; set; }

    /// <summary>
    /// AWS access key ID for SES API authentication. Required when EmailProvider is 'ses'.
    /// Environment variable: AUTH_SES_ACCESS_KEY_ID
    /// </summary>
    public string? SesAccessKeyId { get; set; }

    /// <summary>
    /// AWS secret access key for SES API authentication. Required when EmailProvider is 'ses'.
    /// Environment variable: AUTH_SES_SECRET_ACCESS_KEY
    /// </summary>
    public string? SesSecretAccessKey { get; set; }

    /// <summary>
    /// AWS region for SES API (e.g., us-east-1, eu-west-1). SES must be configured in this region.
    /// Environment variable: AUTH_SES_REGION
    /// </summary>
    public string SesRegion { get; set; } = "us-east-1";

    /// <summary>
    /// SMTP server hostname. Required when EmailProvider is 'smtp'.
    /// Environment variable: AUTH_SMTP_HOST
    /// </summary>
    public string? SmtpHost { get; set; }

    /// <summary>
    /// SMTP server port (587 for STARTTLS, 465 for implicit SSL, 25 for unencrypted).
    /// Environment variable: AUTH_SMTP_PORT
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 65535)]
    public int SmtpPort { get; set; } = 587;

    /// <summary>
    /// SMTP authentication username. Optional if server allows anonymous relay.
    /// Environment variable: AUTH_SMTP_USERNAME
    /// </summary>
    public string? SmtpUsername { get; set; }

    /// <summary>
    /// SMTP authentication password. Optional if server allows anonymous relay.
    /// Environment variable: AUTH_SMTP_PASSWORD
    /// </summary>
    public string? SmtpPassword { get; set; }

    /// <summary>
    /// Use SSL/TLS when connecting to SMTP server. When true with port 587, uses STARTTLS.
    /// Environment variable: AUTH_SMTP_USE_SSL
    /// </summary>
    public bool SmtpUseSsl { get; set; } = true;

    /// <summary>
    /// Password reset token expiration time in minutes
    /// Environment variable: AUTH_PASSWORD_RESET_TOKEN_TTL_MINUTES
    /// </summary>
    public int PasswordResetTokenTtlMinutes { get; set; } = 30;

    /// <summary>
    /// Base URL for password reset page
    /// Environment variable: AUTH_PASSWORD_RESET_BASE_URL
    /// </summary>
    public string? PasswordResetBaseUrl { get; set; }

    /// <summary>
    /// Maximum failed login attempts before lockout. After this many consecutive failures for an email, further attempts return 429 until the lockout expires.
    /// Environment variable: AUTH_MAX_LOGIN_ATTEMPTS
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 100)]
    public int MaxLoginAttempts { get; set; } = 5;

    /// <summary>
    /// Duration in minutes to lock out an email after exceeding MaxLoginAttempts. The lockout counter resets on successful login.
    /// Environment variable: AUTH_LOGIN_LOCKOUT_MINUTES
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 1440)]
    public int LoginLockoutMinutes { get; set; } = 15;

    /// <summary>
    /// BCrypt work factor for password hashing. Higher values are more secure but slower. Existing hashes at lower factors continue to validate.
    /// Environment variable: AUTH_BCRYPT_WORK_FACTOR
    /// </summary>
    public int BcryptWorkFactor { get; set; } = 12;

    /// <summary>
    /// Session token TTL in days for persistent sessions
    /// Environment variable: AUTH_SESSION_TOKEN_TTL_DAYS
    /// </summary>
    public int SessionTokenTtlDays { get; set; } = 7;

    /// <summary>
    /// Master switch for edge-layer token revocation. When enabled, revoked tokens are pushed to configured edge providers for CDN/firewall-level blocking. Disabled by default.
    /// Environment variable: AUTH_EDGE_REVOCATION_ENABLED
    /// </summary>
    public bool EdgeRevocationEnabled { get; set; } = false;

    /// <summary>
    /// Timeout in seconds for edge provider push operations. Operations exceeding this timeout are logged and added to the failed-pushes retry set.
    /// Environment variable: AUTH_EDGE_REVOCATION_TIMEOUT_SECONDS
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 30)]
    public int EdgeRevocationTimeoutSeconds { get; set; } = 5;

    /// <summary>
    /// Maximum retry attempts for failed edge pushes before giving up and logging an error.
    /// Environment variable: AUTH_EDGE_REVOCATION_MAX_RETRY_ATTEMPTS
    /// </summary>
    [ConfigRange(Minimum = 1, Maximum = 10)]
    public int EdgeRevocationMaxRetryAttempts { get; set; } = 3;

    /// <summary>
    /// Enable CloudFlare Workers KV edge revocation. Requires CloudflareAccountId, CloudflareKvNamespaceId, and CloudflareApiToken to be configured.
    /// Environment variable: AUTH_CLOUDFLARE_EDGE_ENABLED
    /// </summary>
    public bool CloudflareEdgeEnabled { get; set; } = false;

    /// <summary>
    /// CloudFlare account ID for KV API access. Required when CloudflareEdgeEnabled is true.
    /// Environment variable: AUTH_CLOUDFLARE_ACCOUNT_ID
    /// </summary>
    public string? CloudflareAccountId { get; set; }

    /// <summary>
    /// CloudFlare KV namespace ID where revoked tokens are stored. Create via CloudFlare dashboard or API.
    /// Environment variable: AUTH_CLOUDFLARE_KV_NAMESPACE_ID
    /// </summary>
    public string? CloudflareKvNamespaceId { get; set; }

    /// <summary>
    /// CloudFlare API token with Workers KV write permissions. Use a scoped token with only KV Edit permission for security.
    /// Environment variable: AUTH_CLOUDFLARE_API_TOKEN
    /// </summary>
    public string? CloudflareApiToken { get; set; }

    /// <summary>
    /// Enable OpenResty/NGINX edge revocation verification. When enabled, the OpenResty Lua scripts read revocation entries directly from Redis (auth:edge prefix) to block revoked tokens at the edge layer before requests reach upstream services.
    /// Environment variable: AUTH_OPENRESTY_EDGE_ENABLED
    /// </summary>
    public bool OpenrestyEdgeEnabled { get; set; } = false;

}
