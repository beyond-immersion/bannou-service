//----------------------
// <auto-generated>
//     Generated from OpenAPI schema: schemas/messaging-configuration.yaml
//
//     WARNING: DO NOT EDIT THIS FILE (FOUNDATION TENETS)
//     This file is auto-generated from configuration schema.
//     Any manual changes will be overwritten on next generation.
//
//     To add/modify configuration:
//     1. Edit the source schema (schemas/messaging-configuration.yaml)
//     2. Run: scripts/generate-all-services.sh
//
//     IMPLEMENTATION TENETS - Configuration-First:
//     - Access configuration via dependency injection, never Environment.GetEnvironmentVariable.
//     - ALL properties below MUST be referenced in MessagingService.cs (no dead config).
//     - Any hardcoded tunable (limit, timeout, threshold, capacity) in service code means
//       a configuration property is MISSING - add it to the configuration schema.
//     - If a property is unused, remove it from the configuration schema.
//
//     Example: public MyService(MessagingServiceConfiguration config) { _config = config; }
//
//     See: docs/reference/tenets/IMPLEMENTATION.md (Configuration-First, Internal Model Type Safety)
// </auto-generated>
//----------------------

using System.ComponentModel.DataAnnotations;
using BeyondImmersion.BannouService;
using BeyondImmersion.BannouService.Attributes;
using BeyondImmersion.BannouService.Configuration;

#nullable enable

namespace BeyondImmersion.BannouService.Messaging;

/// <summary>
/// Configuration class for Messaging service.
/// Properties are automatically bound from environment variables.
/// </summary>
/// <remarks>
/// <para>
/// <b>IMPLEMENTATION TENETS - Configuration-First:</b> Access configuration via dependency injection.
/// Never use <c>Environment.GetEnvironmentVariable()</c> directly in service code.
/// ALL properties in this class MUST be referenced in the service implementation.
/// If a property is unused, remove it from the configuration schema.
/// </para>
/// <para>
/// Environment variable names follow the pattern: {SERVICE}_{PROPERTY} (e.g., AUTH_JWT_SECRET).
/// </para>
/// </remarks>
[ServiceConfiguration(typeof(MessagingService))]
public class MessagingServiceConfiguration : IServiceConfiguration
{
    /// <inheritdoc />
    public Guid? ForceServiceId { get; set; }

    /// <summary>
    /// Use in-memory messaging instead of RabbitMQ. Messages are NOT persisted. ONLY for testing/minimal infrastructure.
    /// Environment variable: MESSAGING_USE_INMEMORY
    /// </summary>
    public bool UseInMemory { get; set; } = false;

    /// <summary>
    /// RabbitMQ server hostname
    /// Environment variable: MESSAGING_RABBITMQ_HOST
    /// </summary>
    public string RabbitMQHost { get; set; } = "rabbitmq";

    /// <summary>
    /// RabbitMQ server port
    /// Environment variable: MESSAGING_RABBITMQ_PORT
    /// </summary>
    public int RabbitMQPort { get; set; } = 5672;

    /// <summary>
    /// RabbitMQ username
    /// Environment variable: MESSAGING_RABBITMQ_USERNAME
    /// </summary>
    public string RabbitMQUsername { get; set; } = "guest";

    /// <summary>
    /// RabbitMQ password
    /// Environment variable: MESSAGING_RABBITMQ_PASSWORD
    /// </summary>
    public string RabbitMQPassword { get; set; } = "guest";

    /// <summary>
    /// RabbitMQ virtual host
    /// Environment variable: MESSAGING_RABBITMQ_VHOST
    /// </summary>
    public string RabbitMQVirtualHost { get; set; } = "/";

    /// <summary>
    /// Default exchange name for publishing
    /// Environment variable: MESSAGING_DEFAULT_EXCHANGE
    /// </summary>
    public string DefaultExchange { get; set; } = AppConstants.DEFAULT_APP_NAME;

    /// <summary>
    /// Enable RabbitMQ publisher confirms for reliability
    /// Environment variable: MESSAGING_ENABLE_CONFIRMS
    /// </summary>
    public bool EnablePublisherConfirms { get; set; } = true;

    /// <summary>
    /// Number of connection retry attempts
    /// Environment variable: MESSAGING_CONNECTION_RETRY_COUNT
    /// </summary>
    public int ConnectionRetryCount { get; set; } = 5;

    /// <summary>
    /// Delay between connection retry attempts in milliseconds
    /// Environment variable: MESSAGING_CONNECTION_RETRY_DELAY_MS
    /// </summary>
    public int ConnectionRetryDelayMs { get; set; } = 1000;

    /// <summary>
    /// Default prefetch count for subscriptions
    /// Environment variable: MESSAGING_DEFAULT_PREFETCH_COUNT
    /// </summary>
    public int DefaultPrefetchCount { get; set; } = 10;

    /// <summary>
    /// Default auto-acknowledge setting for subscriptions
    /// Environment variable: MESSAGING_DEFAULT_AUTO_ACK
    /// </summary>
    public bool DefaultAutoAck { get; set; } = false;

    /// <summary>
    /// Dead letter exchange name for failed messages
    /// Environment variable: MESSAGING_DEAD_LETTER_EXCHANGE
    /// </summary>
    public string DeadLetterExchange { get; set; } = "bannou-dlx";

    /// <summary>
    /// Maximum retry attempts before dead-lettering
    /// Environment variable: MESSAGING_RETRY_MAX_ATTEMPTS
    /// </summary>
    public int RetryMaxAttempts { get; set; } = 3;

    /// <summary>
    /// Delay between retry attempts in milliseconds
    /// Environment variable: MESSAGING_RETRY_DELAY_MS
    /// </summary>
    public int RetryDelayMs { get; set; } = 5000;

    /// <summary>
    /// Enable retry buffer for failed event publishes
    /// Environment variable: MESSAGING_RETRY_BUFFER_ENABLED
    /// </summary>
    public bool RetryBufferEnabled { get; set; } = true;

    /// <summary>
    /// Maximum number of messages in retry buffer before node crash
    /// Environment variable: MESSAGING_RETRY_BUFFER_MAX_SIZE
    /// </summary>
    public int RetryBufferMaxSize { get; set; } = 10000;

    /// <summary>
    /// Maximum age of buffered messages before node crash (prevents stale events)
    /// Environment variable: MESSAGING_RETRY_BUFFER_MAX_AGE_SECONDS
    /// </summary>
    public int RetryBufferMaxAgeSeconds { get; set; } = 300;

    /// <summary>
    /// Interval between retry attempts for buffered messages
    /// Environment variable: MESSAGING_RETRY_BUFFER_INTERVAL_SECONDS
    /// </summary>
    public int RetryBufferIntervalSeconds { get; set; } = 5;

    /// <summary>
    /// Maximum retry attempts for HTTP callback delivery (network failures only)
    /// Environment variable: MESSAGING_CALLBACK_RETRY_MAX_ATTEMPTS
    /// </summary>
    public int CallbackRetryMaxAttempts { get; set; } = 3;

    /// <summary>
    /// Delay between HTTP callback retry attempts in milliseconds
    /// Environment variable: MESSAGING_CALLBACK_RETRY_DELAY_MS
    /// </summary>
    public int CallbackRetryDelayMs { get; set; } = 1000;

    /// <summary>
    /// Use MassTransit wrapper (true) or direct RabbitMQ.Client (false)
    /// Environment variable: MESSAGING_USE_MASSTRANSIT
    /// </summary>
    public bool UseMassTransit { get; set; } = true;

    /// <summary>
    /// Interval in hours between subscription TTL refresh operations
    /// Environment variable: MESSAGING_SUBSCRIPTION_TTL_REFRESH_INTERVAL_HOURS
    /// </summary>
    public int SubscriptionTtlRefreshIntervalHours { get; set; } = 6;

    /// <summary>
    /// Delay in seconds before starting subscription recovery service
    /// Environment variable: MESSAGING_SUBSCRIPTION_RECOVERY_STARTUP_DELAY_SECONDS
    /// </summary>
    public int SubscriptionRecoveryStartupDelaySeconds { get; set; } = 2;

    /// <summary>
    /// Interval in seconds between RabbitMQ connection recovery attempts
    /// Environment variable: MESSAGING_RABBITMQ_NETWORK_RECOVERY_INTERVAL_SECONDS
    /// </summary>
    public int RabbitMQNetworkRecoveryIntervalSeconds { get; set; } = 10;

    /// <summary>
    /// TTL in seconds for external HTTP callback subscriptions (default 24 hours)
    /// Environment variable: MESSAGING_EXTERNAL_SUBSCRIPTION_TTL_SECONDS
    /// </summary>
    public int ExternalSubscriptionTtlSeconds { get; set; } = 86400;

}
