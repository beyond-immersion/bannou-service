name: 'WebSocket Backward Compatibility Tests'
description: 'Run WebSocket tests with published NuGet SDK for backward compatibility'

runs:
  using: 'composite'
  steps:
    - name: Start WebSocket Services
      shell: bash
      run: |
        echo "üìã Using .env.test.edge configuration for backward-compatibility WebSocket testing..."
        docker compose -p bannou-ci-edge \
          -f "./provisioning/docker-compose.yml" \
          -f "./provisioning/docker-compose.services.yml" \
          -f "./provisioning/docker-compose.ingress.yml" \
          -f "./provisioning/docker-compose.test.yml" \
          -f "./provisioning/docker-compose.test.edge.yml" \
          up -d

        echo "‚è≥ Waiting for WebSocket services to be ready..."
        sleep 30

    - name: Build Edge Tester with Published SDK
      shell: bash
      run: |
        echo "üîß Building edge-tester with published NuGet dependency..."
        dotnet build edge-tester --configuration Release -p:UsePublishedSDK=true --no-dependencies

    - name: Execute WebSocket Backward Compatibility Tests
      shell: bash
      run: |
        echo "üì° Running WebSocket tests with published NuGet SDK (backwards compatibility)..."
        DAEMON_MODE=true dotnet run --project edge-tester --configuration Release --no-build
