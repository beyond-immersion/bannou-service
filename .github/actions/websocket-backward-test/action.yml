name: 'WebSocket Backward Compatibility Tests'
description: 'Run WebSocket tests with published NuGet SDK for backward compatibility'

runs:
  using: 'composite'
  steps:
    - name: Start WebSocket Services
      shell: bash
      run: |
        echo "ğŸ“‹ Using .env.ci.edge configuration for backward-compatibility WebSocket testing..."
        docker compose -p bannou-ci-edge -f "./provisioning/docker-compose.yml" -f "./provisioning/docker-compose.ingress.yml" -f "./provisioning/docker-compose.ci.yml" -f "./provisioning/docker-compose.ci.edge.yml" up -d

        echo "â³ Waiting for WebSocket coordinator services to be ready..."
        sleep 30

    - name: Build Edge Tester with Published SDK
      shell: bash
      run: |
        echo "ğŸ”§ Building edge-tester with published NuGet dependency..."
        dotnet build edge-tester --configuration Release -p:UsePublishedSDK=true --no-dependencies

    - name: Execute WebSocket Backward Compatibility Tests
      shell: bash
      run: |
        echo "ğŸ“¡ Running WebSocket tests with published NuGet SDK (backwards compatibility)..."
        DAEMON_MODE=true dotnet run --project edge-tester --configuration Release --no-build
