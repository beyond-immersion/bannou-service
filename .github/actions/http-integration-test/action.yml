name: 'HTTP Integration Tests'
description: 'Run HTTP integration tests with coordinator service configuration'

runs:
  using: 'composite'
  steps:
    - name: Build HTTP Integration Services (All Services)
      shell: bash
      run: |
        echo "ðŸ”§ Building Docker image with all services for HTTP integration testing..."
        echo "ðŸ“‹ Using .env.ci.http configuration for coordinator mode..."
        docker compose -p bannou-ci-http -f "./provisioning/docker-compose.yml" -f "./provisioning/docker-compose.ingress.yml" -f "./provisioning/docker-compose.ci.yml" -f "./provisioning/docker-compose.ci.http.yml" build

    - name: Execute HTTP Integration Tests
      shell: bash
      run: |
        echo "ðŸ”— Running HTTP integration tests via containerized service-to-service testing..."
        docker compose -p bannou-ci-http -f "./provisioning/docker-compose.yml" -f "./provisioning/docker-compose.ingress.yml" -f "./provisioning/docker-compose.ci.yml" -f "./provisioning/docker-compose.ci.http.yml" up --exit-code-from=bannou-http-tester

    - name: Cleanup HTTP Integration Services
      if: always()
      shell: bash
      run: |
        echo "ðŸ›‘ Stopping integration testing services..."
        docker compose -p bannou-ci-http -f "./provisioning/docker-compose.yml" -f "./provisioning/docker-compose.ingress.yml" -f "./provisioning/docker-compose.ci.yml" -f "./provisioning/docker-compose.ci.http.yml" down --remove-orphans -v
