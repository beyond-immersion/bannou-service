name: 'Setup Bannou Development Environment'
description: 'Common setup steps for Bannou CI/CD pipeline'

inputs:
  dotnet-version:
    description: '.NET version to install'
    required: false
    default: '9.0.x'

outputs:
  commit-message:
    description: 'Git commit message'
    value: ${{ steps.commit-info.outputs.commit-message }}
  commit-author:
    description: 'Git commit author'
    value: ${{ steps.commit-info.outputs.commit-author }}

runs:
  using: 'composite'
  steps:
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: ${{ inputs.dotnet-version }}

    - name: Restore NuGet Packages
      shell: bash
      run: |
        echo "ðŸ“¦ Restoring NuGet packages..."
        dotnet restore

    # Note: Generated files are committed to git, validated by ci.generation-check.yml
    # No regeneration needed here - just use committed files

    - name: Build All Projects
      shell: bash
      run: |
        echo "ðŸ—ï¸ Building all projects with generated code..."
        dotnet build --configuration Release

    - name: Extract Commit Information
      id: commit-info
      shell: bash
      run: |
        echo "commit-message=$(git log -1 --pretty=format:'%s')" >> $GITHUB_OUTPUT
        echo "commit-author=$(git log -1 --pretty=format:'%an')" >> $GITHUB_OUTPUT
