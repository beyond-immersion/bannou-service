# =============================================================================
# Merchant Character Definition
# A shopkeeper who sells weapons and armor.
# =============================================================================

character:
  id: armorer_merchant
  name: "Garrett the Armorer"
  archetype: humanoid

  # ---------------------------------------------------------------------------
  # Personality traits
  # ---------------------------------------------------------------------------
  personality:
    friendliness: 0.7      # Generally friendly to customers
    greed: 0.5             # Fair but likes profit
    patience: 0.6          # Reasonably patient with haggling
    pride: 0.65            # Proud of craftsmanship
    honesty: 0.8           # Mostly honest dealings

  # ---------------------------------------------------------------------------
  # Willingness thresholds
  # Merchants are generally compliant but won't be pushed around
  # ---------------------------------------------------------------------------
  willingness:
    obey_threshold: 0.3    # Easy to work with
    refuse_threshold: 0.1  # Only refuse unreasonable demands

    pre_commits:
      - action: protect_merchandise
        override_all: true
        reason: "livelihood"
      - action: call_guards
        override_all: false
        min_threat: 0.6
        reason: "self_preservation"

  # ---------------------------------------------------------------------------
  # Cognition configuration
  # Merchants are perceptive about customers and threats to goods
  # ---------------------------------------------------------------------------
  cognition:
    base: humanoid-cognition-base
    overrides:
      # Stage 1: Filter - Merchants notice customers and thieves
      - stage: filter
        handler_id: attention_filter
        parameters:
          max_perception_distance: 25.0   # Shop-range awareness
          attention_budget: 12
          priority_weights:
            customer_interest: 10.0       # Notice browsing behavior
            theft_indicators: 12.0        # Very alert to stealing
            threat: 8.0
            wealth_indicators: 6.0        # Notice wealthy customers

      # Stage 3: Significance - Commerce-focused assessment
      - stage: significance
        handler_id: assess_significance
        parameters:
          base_significance:
            browsing_customer: 0.6
            returning_customer: 0.7
            wealthy_customer: 0.65
            suspicious_browsing: 0.8
            known_thief: 0.9
          context_multipliers:
            shop_busy: 0.8               # Less attention per customer when busy
            shop_empty: 1.2              # More attention when quiet

      # Stage 5: Intention - Commercial responses
      - stage: intention
        handler_id: generate_intention
        parameters:
          response_priorities:
            customer_enters: greet_warmly
            customer_browsing: offer_assistance
            purchase_interest: close_sale
            theft_attempt: confront_then_guards

  # ---------------------------------------------------------------------------
  # Behavior stack configuration
  # ---------------------------------------------------------------------------
  behaviors:
    # Base humanoid behaviors
    - id: humanoid-base
      category: base
      priority: 0
      source: behaviors/shared/humanoid-base

    # Professional shopkeeping behavior
    - id: merchant-shop
      category: professional
      priority: 50
      source: behaviors/merchant-shop
      config:
        shop_name: "Garrett's Arms & Armor"
        specialty: weapons_armor
        haggle_tolerance: 0.15          # Will go 15% below asking price

    # Crafting behavior (when shop is closed)
    - id: artisan-craft
      category: professional
      priority: 40
      source: behaviors/shared/artisan-craft
      triggers:
        - condition: "${!shop.is_open && inventory.needs_restock}"
      config:
        craft_type: smithing

  # ---------------------------------------------------------------------------
  # Shop configuration
  # ---------------------------------------------------------------------------
  shop:
    name: "Garrett's Arms & Armor"
    type: weapons_armor
    hours:
      open: "08:00"
      close: "20:00"

    # Inventory categories
    stock_categories:
      - swords
      - shields
      - armor
      - repair_services

    # Pricing modifiers
    pricing:
      base_markup: 1.3                  # 30% over cost
      regular_customer_discount: 0.1    # 10% off for regulars
      bulk_discount_threshold: 3
      bulk_discount: 0.15

  # ---------------------------------------------------------------------------
  # Equipment (merchant doesn't fight but has tools)
  # ---------------------------------------------------------------------------
  equipment:
    primary_weapon: null
    tools:
      - smithing_hammer
      - measuring_tape
      - coin_scale
    clothing: merchant_apron

  # ---------------------------------------------------------------------------
  # Faction and relationships
  # ---------------------------------------------------------------------------
  faction: merchants_guild
  relationships:
    merchants_guild: ally
    city_watch: friendly              # Good relationship with guards
    customers: business
    known_thieves: hostile
