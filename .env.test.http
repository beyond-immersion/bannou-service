# CI Environment Configuration for HTTP Integration Testing
# This file configures the coordinator service and test environment
# Uses canonical environment variable naming per IMPLEMENTATION TENETS

# =============================================================================
# Database Configuration
# =============================================================================
ACCOUNT_DB_USER=guest
ACCOUNT_DB_PASSWORD=guest

# =============================================================================
# Auth Service Configuration (canonical AUTH_* prefix)
# =============================================================================
AUTH_JWT_SECRET=ci-http-test-jwt-secret-key-2025
AUTH_JWT_ISSUER=bannou-auth-ci
AUTH_JWT_AUDIENCE=bannou-api-ci
AUTH_JWT_EXPIRATION_MINUTES=60
AUTH_CONNECT_URL=ws://bannou:80/connect

# Main App JWT Configuration (required for JWT validation in Program.cs)
BANNOU_JWT_SECRET=ci-http-test-jwt-secret-key-2025
BANNOU_JWT_ISSUER=bannou-auth-ci
BANNOU_JWT_AUDIENCE=bannou-api-ci

# OAuth/Steam Mock Providers (for CI testing without real credentials)
AUTH_MOCK_PROVIDERS=true
AUTH_MOCK_STEAM_ID=76561198000000001
AUTH_MOCK_DISCORD_ID=123456789012345678
AUTH_MOCK_GOOGLE_ID=mock-google-user-id-12345

# OAuth Provider Configuration (dummy values for mock mode)
AUTH_DISCORD_CLIENT_ID=test-discord-client-id
AUTH_DISCORD_CLIENT_SECRET=test-discord-client-secret
AUTH_GOOGLE_CLIENT_ID=test-google-client-id
AUTH_GOOGLE_CLIENT_SECRET=test-google-client-secret
AUTH_TWITCH_CLIENT_ID=test-twitch-client-id
AUTH_TWITCH_CLIENT_SECRET=test-twitch-client-secret
AUTH_STEAM_API_KEY=test-steam-api-key
AUTH_STEAM_APP_ID=123456

# Admin Role Configuration (for orchestrator API tests)
# NOTE: Admin role assignment is handled by Account service, not Auth service
ACCOUNT_ADMIN_EMAIL_DOMAIN=@admin.test.local

# =============================================================================
# Connect Service Configuration (canonical CONNECT_* prefix)
# =============================================================================
CONNECT_RABBITMQ_CONNECTION_STRING=amqp://guest:guest@rabbitmq:5672
CONNECT_SERVER_SALT=ci-http-test-server-salt

# =============================================================================
# Game Session Service Configuration (GAME_SESSION_*)
# =============================================================================
GAME_SESSION_SERVER_SALT=ci-http-test-server-salt

# =============================================================================
# Matchmaking Service Configuration (MATCHMAKING_*)
# =============================================================================
MATCHMAKING_SERVER_SALT=ci-http-test-server-salt

# =============================================================================
# Orchestrator Service Configuration (canonical ORCHESTRATOR_* prefix)
# =============================================================================
ORCHESTRATOR_DOCKER_NETWORK=bannou-test-http_default
# Disable secure mode to allow admin WebSocket access for testing
ORCHESTRATOR_SECURE_WEBSOCKET=false

# =============================================================================
# State Service Configuration (canonical STATE_* prefix)
# =============================================================================
STATE_REDIS_CONNECTION_STRING=bannou-redis:6379
STATE_MYSQL_CONNECTION_STRING=Server=bannou-mysql;Port=3306;Database=bannou;User=guest;Password=guest;

# =============================================================================
# Messaging Service Configuration (canonical MESSAGING_* prefix)
# =============================================================================

# =============================================================================
# Asset Service Configuration (canonical ASSET_* prefix)
# =============================================================================
ASSET_STORAGE_ENDPOINT=minio:9000
ASSET_STORAGE_ACCESS_KEY=minioadmin
ASSET_STORAGE_SECRET_KEY=minioadmin
ASSET_STORAGE_BUCKET=bannou-assets
ASSET_STORAGE_USE_SSL=false
ASSET_STORAGE_REGION=us-east-1

# Audio processing configuration
# Use 50MB threshold so small test bundles complete inline while large ones queue
ASSET_LARGE_FILE_THRESHOLD_MB=50
ASSET_AUDIO_OUTPUT_FORMAT=mp3
ASSET_AUDIO_BITRATE_KBPS=128
ASSET_AUDIO_PRESERVE_LOSSLESS=false

# =============================================================================
# Service Configuration
# =============================================================================
ASPNETCORE_ENVIRONMENT=Development
BANNOU_APP_ID=bannou
# BANNOU_SERVICE_DOMAIN not set for tests - internal docker networking handles routing
# Setting this incorrectly causes asset presigned URLs to use wrong hostname
SERVICES_ENABLED=true

# HTTP Tester Configuration - bannou listens on port 80 inside container
BANNOU_HTTP_ENDPOINT=http://bannou:80

# Test harness control (read directly by Program.cs)
DAEMON_MODE=true

# =============================================================================
# Service Heartbeat Configuration (faster for testing)
# =============================================================================
BANNOU_HEARTBEAT_ENABLED=true
BANNOU_HEARTBEAT_INTERVAL_SECONDS=5
BANNOU_PERMISSION_HEARTBEAT_ENABLED=true

# =============================================================================
# Documentation Service Configuration (canonical DOCUMENTATION_* prefix)
# =============================================================================
# Git storage path inside container for cloned repositories
DOCUMENTATION_GIT_STORAGE_PATH=/tmp/bannou-git-repos

# =============================================================================
# Repository Binding Live Tests (OPTIONAL - disabled by default)
# =============================================================================
# Set these to enable live git repository testing against a real remote repo.
# When not set, only the fixture-based tests run (using /fixtures/test-docs-repo).
# CI should NOT set these - they are for manual testing only.
#
# DOCUMENTATION_GIT_TEST_URL=https://github.com/example/repo.git
# DOCUMENTATION_GIT_TEST_BRANCH=main

# =============================================================================
# Analytics Service Configuration (canonical ANALYTICS_* prefix)
# =============================================================================
ANALYTICS_ENABLED=true
ANALYTICS_SUMMARY_STORE_NAME=analytics-summary
ANALYTICS_RATING_STORE_NAME=analytics-rating
ANALYTICS_HISTORY_STORE_NAME=analytics-history
ANALYTICS_EVENT_BUFFER_SIZE=100
ANALYTICS_EVENT_BUFFER_FLUSH_INTERVAL_SECONDS=1
ANALYTICS_GLICKO2_DEFAULT_RATING=1500.0
ANALYTICS_GLICKO2_DEFAULT_DEVIATION=350.0
ANALYTICS_GLICKO2_DEFAULT_VOLATILITY=0.06
ANALYTICS_GLICKO2_SYSTEM_CONSTANT=0.5
ANALYTICS_SUMMARY_CACHE_TTL_SECONDS=60

# =============================================================================
# Leaderboard Service Configuration (canonical LEADERBOARD_* prefix)
# =============================================================================
LEADERBOARD_ENABLED=true
LEADERBOARD_DEFINITION_STORE_NAME=leaderboard-definition
LEADERBOARD_RANKING_STORE_NAME=leaderboard-ranking
LEADERBOARD_SEASON_STORE_NAME=leaderboard-season
LEADERBOARD_MAX_ENTRIES_PER_QUERY=1000
LEADERBOARD_SCORE_UPDATE_BATCH_SIZE=1000
LEADERBOARD_AUTO_ARCHIVE_ON_SEASON_END=true
LEADERBOARD_RANK_CACHE_TTL_SECONDS=30

# =============================================================================
# Achievement Service Configuration (canonical ACHIEVEMENT_* prefix)
# =============================================================================
ACHIEVEMENT_ENABLED=true
ACHIEVEMENT_DEFINITION_STORE_NAME=achievement-definition
ACHIEVEMENT_PROGRESS_STORE_NAME=achievement-progress
ACHIEVEMENT_UNLOCK_STORE_NAME=achievement-unlock
ACHIEVEMENT_SYNC_RETRY_ATTEMPTS=3
ACHIEVEMENT_SYNC_RETRY_DELAY_SECONDS=5
ACHIEVEMENT_RARITY_CALCULATION_INTERVAL_MINUTES=60
ACHIEVEMENT_RARE_THRESHOLD_PERCENT=5.0
ACHIEVEMENT_AUTO_SYNC_ON_UNLOCK=false
ACHIEVEMENT_PROGRESS_CACHE_TTL_SECONDS=60
# Platform sync disabled for CI testing (no real credentials)
ACHIEVEMENT_STEAM_API_KEY=
ACHIEVEMENT_STEAM_APP_ID=
ACHIEVEMENT_XBOX_CLIENT_ID=
ACHIEVEMENT_XBOX_CLIENT_SECRET=
ACHIEVEMENT_PLAYSTATION_CLIENT_ID=
ACHIEVEMENT_PLAYSTATION_CLIENT_SECRET=
