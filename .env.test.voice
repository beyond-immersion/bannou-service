# Voice Integration Testing Environment Configuration
# Extends edge testing with voice infrastructure (Kamailio + RTPEngine)
# Use: make test-voice-scaled

# ============================================================================
# Include all edge test settings
# ============================================================================
# Note: Docker Compose doesn't support file includes, so we duplicate the base config
# and add voice-specific overrides at the bottom

# Database Configuration (CI-safe test values - must match docker-compose.services.yml)
ACCOUNT_DB_USER=guest
ACCOUNT_DB_PASSWORD=guest

# Auth Configuration (CI-safe test keys)
AUTH_TOKEN_PUBLIC_KEY=ci_edge_public_key_placeholder
AUTH_TOKEN_PRIVATE_KEY=ci_edge_private_key_placeholder

# Auth Service Configuration (BANNOU_ prefix for auto-binding)
BANNOU_JWTSECRET=ci-edge-test-jwt-secret-key-2025
BANNOU_JWTISSUER=bannou-auth-ci
BANNOU_JWTAUDIENCE=bannou-api-ci
BANNOU_JWTEXPIRATIONMINUTES=60
BANNOU_ACCESSTOKENEXPIRATIONMINUTES=60
# Connect URL returned to clients (container name for in-Docker clients)
BANNOU_CONNECTURL=ws://openresty:80/connect

# OAuth/Steam Mock Providers (for CI testing without real credentials)
BANNOU_MOCKPROVIDERS=true
BANNOU_MOCKSTEAMID=76561198000000001
BANNOU_MOCKDISCORDID=123456789012345678
BANNOU_MOCKGOOGLEID=mock-google-user-id-12345

# OAuth Provider Configuration (dummy values for mock mode)
BANNOU_DISCORDCLIENTID=test-discord-client-id
BANNOU_DISCORDCLIENTSECRET=test-discord-client-secret
BANNOU_GOOGLECLIENTID=test-google-client-id
BANNOU_GOOGLECLIENTSECRET=test-google-client-secret
BANNOU_TWITCHCLIENTID=test-twitch-client-id
BANNOU_TWITCHCLIENTSECRET=test-twitch-client-secret
BANNOU_STEAMAPIKEY=test-steam-api-key
BANNOU_STEAMAPPID=123456

# Fallback Auth Configuration (AUTH_ prefix)
AUTH_JWT_SECRET=ci-edge-test-jwt-secret-key-2025
AUTH_JWT_ISSUER=bannou-auth-ci
AUTH_JWT_AUDIENCE=bannou-api-ci
AUTH_JWT_EXPIRATION_MINUTES=60

# Legacy Auth Configuration (no prefix)
JWTSECRET=ci-edge-test-jwt-secret-key-2025
JWTISSUER=bannou-auth-ci
JWTAUDIENCE=bannou-api-ci
JWTEXPIRATIONMINUTES=60

# Service Configuration
ASPNETCORE_ENVIRONMENT=Development
BANNOU_APP_LOGGING_LEVEL=Debug
BANNOU_WEB_HOST_LOGGING_LEVEL=Warning
DAPR_APP_ID=bannou

# Orchestrator Service (required for orchestrator WebSocket tests)
ORCHESTRATOR_SERVICE_ENABLED=true
# Testing Service (required for BannouClient SDK Flow tests)
TESTING_SERVICE_ENABLED=true
# Orchestrator Redis connection (use container name from docker-compose)
BANNOU_RedisConnectionString=bannou-redis:6379
RedisConnectionString=bannou-redis:6379

# Direct RabbitMQ connection (used by Orchestrator and Connect service)
# TENET exception: Both services use direct RabbitMQ for infrastructure access
BANNOU_RabbitMqConnectionString=amqp://guest:guest@rabbitmq:5672

# DockerComposeOrchestrator Configuration (for split routing deployment)
BANNOU_DockerNetwork=bannou-test-voice_default
BANNOU_DaprComponentsHostPath=/tmp/dapr-components
BANNOU_DaprConfigHostPath=/tmp/dapr-components/config-consul.yaml
BANNOU_PlacementHost=placement:50006
BANNOU_DaprImage=daprio/daprd:1.16.3

# Coordinator Service Mode Configuration
SERVICE_DOMAIN=ci-voice-test
SERVICES_ENABLED=true
BANNOU_MODE=bannou
COORDINATOR_ENABLED=true

# WebSocket Protocol Configuration
WEBSOCKET_BINARY_PROTOCOL_ENABLED=true
WEBSOCKET_COMPRESSION_ENABLED=false

# Connection Strings
AUTHORIZATION_REDIS_CONNECTION_STRING=bannou-redis:6379
CONNECT_REDIS_CONNECTION_STRING=bannou-redis:6379

# Service Endpoints for Coordinator
COORDINATOR_TARGET_HOST=bannou-test-subject
COORDINATOR_TARGET_PORT=8080
COORDINATOR_WEBSOCKET_PORT=8443

# Edge Testing Configuration
EDGE_INTEGRATION_TESTING=true
WEBSOCKET_TESTING=true
DAEMON_MODE=true

EDGE_TESTER_MODE=compatibility_testing
SDK_COMPATIBILITY_MODE=dual_testing
# OpenResty Gateway Configuration
OPENRESTY_HOST=openresty
OPENRESTY_PORT=80
OPENRESTY_HTTP_PORT=9080
OPENRESTY_HTTPS_PORT=9443

# Configurable Dapr app_id routing
AUTH_SERVICE_APP_ID=bannou
CONNECT_SERVICE_APP_ID=bannou

# Auth endpoints through OpenResty gateway
REGISTER_ENDPOINT=openresty:80/auth/register
LOGIN_CREDENTIALS_ENDPOINT=openresty:80/auth/login
LOGIN_TOKEN_ENDPOINT=openresty:80/auth/refresh
CONNECT_ENDPOINT=openresty:80/connect
CLIENT_USERNAME=TestClient@example.com
CLIENT_PASSWORD=SimpleTestPassword

# Admin Role Configuration
BANNOU_ADMINEMAILDOMAIN=@admin.test.local
ADMIN_USERNAME=admin@admin.test.local
ADMIN_PASSWORD=admin-test-password-2025

# Service Heartbeat Configuration
HEARTBEAT_INTERVAL_SECONDS=5
PERMISSION_HEARTBEAT_ENABLED=true

# ============================================================================
# VOICE-SPECIFIC CONFIGURATION
# ============================================================================

# Voice Plugin Enabled (override the edge test default)
VOICE_SERVICE_DISABLED=false

# Voice Tests Enabled (tells edge-tester to run voice test suite)
VOICE_TESTS_ENABLED=true

# P2P Configuration - Lower threshold for testing tier upgrade
# With P2PMAXPARTICIPANTS=2, the 3rd participant triggers upgrade attempt
BANNOU_P2PENABLED=true
BANNOU_P2PMAXPARTICIPANTS=2

# Scaled Tier Configuration - Enable for upgrade testing
BANNOU_SCALEDTIERENABLED=true
BANNOU_TIERUPGRADEENABLED=true
BANNOU_SCALEDMAXPARTICIPANTS=100

# Kamailio SIP Proxy Configuration
# Uses container name for bridge networking (not localhost)
BANNOU_KAMAILIOHOST=kamailio
BANNOU_KAMAILIORPCPORT=5080

# RTPEngine Media Relay Configuration
BANNOU_RTPENGINEHOST=rtpengine
BANNOU_RTPENGINEPORT=22222

# SIP Domain for conference URIs
BANNOU_SIPDOMAIN=voice.bannou.test

# Voice Codec and STUN Configuration
BANNOU_DEFAULTCODEC=opus
BANNOU_STUNSERVERS=stun:stun.l.google.com:19302
